{"version":3,"sources":["util/lang.ts","i18n.ts","api/errors.ts","api/callApi.ts","api/getColorBars.ts","api/getDatasets.ts","api/getDatasetPlaceGroup.ts","util/assert.ts","model/dataset.ts","util/csv.ts","model/user-place/csv.ts","model/user-place/geojson.ts","model/user-place/wkt.ts","util/id.ts","util/baseurl.ts","util/path.ts","util/branding.ts","config.ts","model/place.ts","components/ol/layer/Layers.tsx","model/proj.ts","components/ol/Map.tsx","components/ol/MapComponent.tsx","components/ol/layer/Tile.tsx","components/ol/layer/Vector.tsx","util/find.ts","util/maps.ts","selectors/dataSelectors.tsx","util/storage.ts","states/userSettings.ts","states/controlState.ts","model/colorBar.ts","model/bg.png","selectors/controlSelectors.tsx","util/time.ts","model/timeSeries.ts","actions/messageLogActions.ts","actions/dataActions.tsx","api/getServerInfo.ts","api/updateResources.ts","api/getTimeSeries.ts","actions/controlActions.tsx","components/UserProfile.tsx","components/UserControl.tsx","actions/userAuthActions.ts","connected/UserControl.tsx","components/MarkdownPage.tsx","connected/AppBar.tsx","components/ControlBar.tsx","components/ControlBarItem.tsx","components/DatasetSelect.tsx","connected/DatasetSelect.tsx","components/VariableSelect.tsx","connected/VariableSelect.tsx","components/RgbSwitch.tsx","connected/RgbSwitch.tsx","components/PlaceGroupsSelect.tsx","connected/PlaceGroupsSelect.tsx","components/PlaceSelect.tsx","connected/PlaceSelect.tsx","components/MapInteractionsBar.tsx","connected/MapInteractionsBar.tsx","components/TimeSelect.tsx","connected/TimeSelect.tsx","components/TimeSlider.tsx","connected/TimeSlider.tsx","components/TimePlayer.tsx","connected/TimePlayer.tsx","components/ControlBarActions.tsx","connected/ControlBarActions.tsx","connected/ControlBar.tsx","components/ErrorBoundary.tsx","components/ol/control/Control.tsx","components/ol/control/ScaleLine.tsx","components/ol/interaction/Draw.tsx","components/ol/View.tsx","components/ol/style.ts","components/Viewer.tsx","util/label.ts","components/ColorBarCanvas.tsx","components/ColorBarLegend.tsx","connected/ColorBarLegend.tsx","connected/Viewer.tsx","components/TimeSeriesChart.tsx","components/TimeRangeSlider.tsx","components/TimeSeriesCharts.tsx","connected/TimeSeriesCharts.tsx","volume/OrbitControls.js","volume/VolumeShader.js","volume/ColorBarTextures.ts","volume/VolumeScene.ts","volume/webgl-utils.ts","volume/VolumeSlice.js","volume/Volume.js","volume/NRRDLoader.js","components/VolumeCanvas.tsx","components/VolumeCard.tsx","connected/VolumeCard.tsx","resources/python-bw.png","components/InfoCard.tsx","connected/InfoCard.tsx","components/Splitter.tsx","components/SplitPane.tsx","connected/Workspace.tsx","connected/AppPane.tsx","components/LegalAgreementDialog.tsx","connected/LegalAgreementDialog.tsx","components/LoadingDialog.tsx","connected/LoadingDialog.tsx","components/MessageLog.tsx","connected/MessageLog.tsx","components/AuthWrapper.tsx","components/ServerDialog.tsx","connected/ServerDialog.tsx","components/SettingsPanel.tsx","components/SettingsSubPanel.tsx","components/ToggleSetting.tsx","components/RadioSetting.tsx","components/SettingsDialog.tsx","connected/SettingsDialog.tsx","version.ts","components/ExportDialog.tsx","connected/ExportDialog.tsx","components/FileUpload.tsx","components/user-place/GeoJsonOptionsEditor.tsx","components/user-place/CsvTextFieldEditor.tsx","components/user-place/CsvOptionsEditor.tsx","components/user-place/WktOptionsEditor.tsx","model/user-place/common.ts","components/UserPlacesDialog.tsx","connected/UserPlacesDialog.tsx","connected/App.tsx","states/dataState.ts","reducers/dataReducer.ts","reducers/controlReducer.ts","reducers/messageLogReducer.ts","states/messageLogState.ts","reducers/userAuthReducer.ts","states/userAuthState.ts","reducers/appReducer.ts","serviceWorker.ts","index.tsx"],"names":["LanguageDictionary","json","_languages","_content","_locale","locales","Object","getOwnPropertyNames","languages","findIndex","locale","Error","content","dictionary","forEach","entry","index","phraseKey","getPhraseKey","console","warn","this","value","baseValue","split","error","phrase","values","translatedPhrase","key","keys","name","replace","toLowerCase","i18n","navigator","length","language","userLanguage","browserLanguage","HTTPError","statusCode","statusMessage","makeRequestInit","accessToken","headers","makeRequestUrl","url","query","queryString","map","kv","encodeURIComponent","join","includes","endsWith","callJsonApi","init","fetch","then","response","ok","status","statusText","catch","TypeError","get","callApi","parseColorBars","colorBarGroups","groups","images","colorBarGroup","title","description","names","colorBar","image","push","adjustTimeDimensionsForDatasets","datasets","adjustTimeDimensionsForDataset","dataset","dimensions","dimension","timeDimension","timeCoordinates","coordinates","labels","label","Date","getTime","getDatasetPlaceGroup","apiServerUrl","datasetId","placeGroupId","dsId","pgId","DeveloperError","assertDefinedAndNotNull","object","objectName","assertNotNull","assertDefined","assertArrayNotEmpty","array","arrayName","Array","isArray","assertArray","findDataset","selectedDatasetId","find","id","findDatasetVariable","variableName","variables","variable","getDatasetTimeDimension","getDatasetTimeRange","ParseError","defaultParseOptions","separator","comment","quote","escape","trim","nanToken","trueToken","falseToken","parseCsv","text","options","Parser","parse","parseLine","bind","parseText","line","filter","startsWith","message","colIndex","quoteSeen","start","end","char","collectValue","token","slice","parseToken","substring","Number","NaN","parseFloat","isNaN","indexOf","token2","unescapeString","csvFormat","fileExt","checkError","e","defaultCsvOptions","xName","yName","forceGeometry","geometryName","labelName","labelPrefix","geoJsonFormat","JSON","defaultGeoJsonOptions","labelNames","wktFormat","defaultWktOptions","newId","Math","random","toString","substr","now","toUpperCase","baseUrl","URL","window","location","href","pathComponents","pathname","numPathComponents","origin","_getBaseUrl","buildPath","base","path","components","c","log","COLORS","amber","blue","blueGrey","brown","cyan","deepOrange","deepPurple","green","grey","indigo","lightBlue","lightGreen","lime","orange","pink","purple","red","teal","yellow","setBrandingColor","brandingConfig","colorName","color","parseBranding","configPath","imagePath","setBrandingImage","appParams","URLSearchParams","search","Config","server","branding","authClient","configUrl","rawConfig","rawDefaultConfig","compact","parseInt","allow3D","_instance","windowTitle","changeWindowTitle","windowIcon","changeWindowIcon","assertConfigLoaded","document","iconUrl","favicon","querySelector","createElement","rel","head","appendChild","userPlaceColorsArray","userPlaceColors","obj","userPlaceColorNames","getUserPlaceColorName","getUserPlaceColor","paletteType","shade","getStrokeShade","tileAccess","param","DEFAULT_LABEL_PROPERTY_NAMES","mkCases","DEFAULT_DESCRIPTION_PROPERTY_NAMES","DEFAULT_COLOR_PROPERTY_NAMES","DEFAULT_IMAGE_PROPERTY_NAMES","getPlaceInfo","defaultMemoize","placeGroup","place","infoObj","updatePlaceInfo","i","hash","charCodeAt","getPlaceHash","propertyName","defaultValue","defaultPropertyNames","propertyValue","mappedPropertyValue","propertyMapping","interpolatedValue","properties","placeHolder","getInterpolatedPropertyValue","getPropertyValue","undefined","container","propertyNames","nameCases","concat","forEachPlace","placeGroups","callback","isValidPlaceGroup","features","findPlaceInPlaceGroup","placeId","subPlaceGroups","parentPlaceId","findPlaceInPlaceGroups","LAST_PLACE_LABEL_ID_CSV","LAST_PLACE_LABEL_ID_GEOJSON","LAST_PLACE_LABEL_ID_WKT","newGeoJsonFeature","geometry","type","OlGeoJSONFormat","writeGeometryObject","Layers","props","children","GEOGRAPHIC_CRS","WEB_MERCATOR_CRS","DEFAULT_MAP_CRS","MapContextType","React","mapObjects","DEFAULT_CONTAINER_STYLE","width","height","Map","contextValue","clickEventsKey","handleClick","event","onClick","handleDrop","onDropFiles","preventDefault","files","dataTransfer","items","item","kind","file","getAsFile","handleDragOver","handleRef","mapDiv","handleResize","updateSize","view","getView","minZoom","getMinZoom","setMinZoom","target","size","clientWidth","LOG2E","isStale","mapObject","OlMap","setTarget","un","listener","initialZoom","OlView","projection","center","zoom","getMapOptions","on","forceUpdate","addEventListener","onMapRef","prevProps","mapOptions","setProperties","removeEventListener","childrenWithContext","Provider","ref","style","onDragOver","onDrop","MapComponent","context","_updateMapObject","addMapObject","updateMapObject","removeMapObject","set","contextType","trace","Tile","layer","OlTileLayer","getLayers","oldSource","getSource","newSource","source","replaceSource","OlUrlTileSource","oldUrlTileSource","newUrlTileSource","oldTileGrid","newTileGrid","getMaxZoom","oldExtent","getExtent","newExtent","oldResolutions","getResolutions","newResolutions","numLevels","z","oldResolution","getResolution","newResolution","oldOrigin","getOrigin","newOrigin","oldTileSize","getTileSize","newTileSize","oldTileRange","getFullTileRange","newTileRange","getWidth","getHeight","equalTileGrids","getTileGrid","oldUrls","getUrls","newUrls","setUrls","oldTileLoadFunction","getTileLoadFunction","newTileLoadFunction","setTileLoadFunction","oldTileUrlFunction","getTileUrlFunction","newTileUrlFunction","setTileUrlFunction","oldContextOptions","getContextOptions","newContextOptions","imageSmoothing","setSource","visible","setVisible","opacity","setOpacity","zIndex","setZIndex","minResolution","setMinResolution","maxResolution","setMaxResolution","remove","OlXYZSource","attributions","OlOSMSource","Vector","OlVectorLayer","findIndexCloseTo","n","i1","i3","otherValue","i2","floor","abs","maps","datasetsSelector","state","dataState","timeSeriesGroupsSelector","timeSeriesGroups","userPlaceGroupSelector","userPlaceGroup","userServersSelector","userServers","placeGroupsSelector","createSelector","placeGroupsArray","getLocalStorage","brandingName","_getStorage","storage","x","setItem","removeItem","Storage","nativeStorage","parser","getItem","makeKey","defaultObj","getProperty","formatter","formattedValue","stringify","setObjectItem","storeUserSettings","settings","instance","setPrimitiveProperty","setObjectProperty","TIME_ANIMATION_INTERVALS","newControlState","defaultSettings","getStringProperty","getBooleanProperty","getIntProperty","getObjectProperty","loadUserSettings","selectedVariableName","selectedPlaceGroupIds","selectedPlaceId","selectedUserPlaceId","selectedServerId","selectedTime","selectedTimeRange","timeSeriesUpdateMode","timeAnimationActive","timeAnimationInterval","timeChunkSize","autoShowTimeSeries","showTimeSeriesPointsOnly","showTimeSeriesErrorBars","showTimeSeriesMedian","defaultAgg","userPlacesFormatName","userPlacesFormatOptions","geojson","csv","wkt","flyTo","activities","dialogOpen","privacyNoticeAccepted","mapInteraction","lastMapInteraction","showRgbLayer","volumeCardOpen","volumeRenderMode","volumeStates","infoCardOpen","infoCardElementStates","viewMode","mapProjection","imageSmoothingEnabled","showDatasetBoundaries","baseMapUrl","exportTimeSeries","exportTimeSeriesSeparator","exportPlaces","exportPlacesAsCollection","exportZipArchive","exportFileName","MAP_OBJECTS","CB_ALPHA_SUFFIX","CB_REVERSE_SUFFIX","BG_IMAGE","Image","formatColorBar","baseName","isReversed","isAlpha","renderColorBar","canvas","Promise","resolve","reject","onload","src","imageData","loadColorBarImage","offscreenCanvas","ctx","getContext","drawImage","rgbaArray","getImageData","data","reversedRgbaArray","Uint8ClampedArray","j","factor","ImageData","getColorBarImageData","loadColorBarImageData","createImageBitmap","imageBitmap","pattern","createPattern","fillStyle","fillRect","selectedDatasetIdSelector","controlState","selectedVariableNameSelector","selectedPlaceGroupIdsSelector","selectedPlaceIdSelector","selectedTimeSelector","timeAnimationActiveSelector","imageSmoothingSelector","infoCardElementStatesSelector","mapProjectionSelector","selectedDatasetSelector","selectedDatasetVariablesSelector","selectedVariableSelector","varName","v","selectedVariableUnitsSelector","units","selectedVariableColorBarMinMaxSelector","colorBarMin","colorBarMax","selectedVariableColorBarNameSelector","colorBarName","selectedVariableColorBarSelector","colorBars","parseColorBar","selectedVariableOpacitySelector","selectedDatasetTimeRangeSelector","selectedDatasetRgbSchemaSelector","rgbSchema","selectedDatasetPlaceGroupsSelector","selectPlaceGroups","placeGroupIds","selectedPlaceGroups","selectedDatasetSelectedPlaceGroupsSelector","selectedPlaceGroupsSelector","selectedPlaceGroupsTitleSelector","selectedPlaceGroupPlacesSelector","args","selectedPlaceSelector","places","selectedPlaceInfoSelector","predicate","findPlaceInfo","selectedVolumeIdSelector","canAddTimeSeriesSelector","timeSeriesGroup","timeSeriesArray","timeSeriesPlaceInfosSelector","placeInfos","ts","selectedPlaceGroupPlaceLabelsSelector","placeLabels","selectedDatasetVariableSelector","selectedTimeChunkSizeSelector","minTimeChunkSize","varTimeChunkSize","ceil","selectedDatasetTimeDimensionSelector","selectedDatasetAttributionsSelector","timeCoordinatesSelector","selectedTimeIndexSelector","time","_getLoadTileOnlyAfterMove","memoize","tile","getInteracting","once","getImage","serializer","getTarget","getTileLayer","layerId","tileUrl","tileLevelMin","tileLevelMax","queryParams","timeString","timeIndex","toISOString","tileGrid","tileLoadFunction","transition","maxZoom","getOlXYZSource","OlTileGrid","tileSize","extent","resolutions","from","_","pow","getOlTileGrid","selectedDatasetBoundaryLayerSelector","bbox","x1","y1","x2","y2","OlVectorSource","dataProjection","featureProjection","readFeatures","OlStyle","stroke","OlStrokeStyle","lineDash","selectedDatasetVariableLayerSelector","colorBarMinMax","selectedDatasetRgbLayerSelector","getDefaultStrokeStyle","getDefaultFillStyle","OlFillStyle","polygonFillOpacity","selectedDatasetPlaceGroupLayersSelector","layers","OlCircle","fill","radius","visibleInfoCardElementsSelector","visibleInfoCardElements","infoCardElementViewModesSelector","infoCardElementCodeModes","activityMessagesSelector","k","selectedServerSelector","serverId","baseMapLayerSelector","groupName","endpoint","group","findMap","access","link","LOCAL_OFFSET","utcTimeToIsoDate","utcTime","local","utcTimeToIsoDateString","utcTimeToIsoDateTimeString","skipSeconds","UNIT","POST_MESSAGE","postMessage","messageType","messageText","HIDE_MESSAGE","saveAs","require","UPDATE_SERVER_INFO","updateServerInfo","dispatch","getState","apiServer","addActivity","serverInfo","_updateServerInfo","removeActivity","UPDATE_RESOURCES","updateResources","api","userAuthState","reload","finally","UPDATE_DATASETS","updateDatasets","result","_updateDatasets","selectDataset","UPDATE_DATASET_PLACE_GROUP","updateDatasetPlaceGroup","ADD_USER_PLACE","ADD_USER_PLACES","addUserPlacesFromText","formatName","userPlacesFormatOptionsCsvSelector","table","headerRow","headerRowLC","numColumns","labelNameLC","xNameLC","yNameLC","geometryNameLC","labelNameIndex","xNameIndex","yNameIndex","geometryNameIndex","OlWktFormat","rowIndex","dataRow","readGeometry","y","isFinite","OlGeomPoint","geoJsonProps","labelId","getUserPlacesFromCsv","userPlacesFormatOptionsGeoJsonSelector","labelNamesSet","Set","OlFeature","feature","getProperties","getGeometry","has","getUserPlacesFromGeoJson","userPlacesFormatOptionsWktSelector","getUserPlacesFromWkt","openDialog","selectPlace","addUserPlaces","addTimeSeries","REMOVE_USER_PLACE","REMOVE_ALL_USER_PLACES","selectedDatasetTimeDim","selectedVariable","selectedPlace","useMedian","inclStDev","timeLabels","numTimeLabels","endTimeIndex","startTimeIndex","getTimeSeriesChunk","startDateLabel","endDateLabel","startDate","endDate","valueDataKey","errorDataKey","method","body","variableUnits","successAction","timeSeries","isValidPlace","hasMore","dataProgress","updateMode","dataMode","UPDATE_TIME_SERIES","updateTimeSeries","REMOVE_TIME_SERIES_GROUP","REMOVE_ALL_TIME_SERIES","CONFIGURE_SERVERS","_configureServers","servers","syncWithServer","UPDATE_COLOR_BARS","_updateColorBars","UPDATE_VARIABLE_COLOR_BAR","UPDATE_VARIABLE_VOLUME","Exporter","ZipExporter","fileName","zipArchive","JSZip","generateAsync","FileExporter","blob","Blob","SELECT_DATASET","showInMap","_selectDataset","flyToDataset","SIMPLE_GEOMETRY_TYPES","flyToPlace","FLY_TO","mapId","SELECT_PLACE_GROUPS","_selectPlaceGroups","activityId","SELECT_PLACE","_selectPlace","SET_RGB_LAYER_VISIBILITY","SELECT_VARIABLE","SELECT_TIME","selectTime","INC_SELECTED_TIME","SELECT_TIME_RANGE","selectTimeRange","SELECT_TIME_SERIES_UPDATE_MODE","UPDATE_TIME_ANIMATION","SET_MAP_INTERACTION","setMapInteraction","SHOW_VOLUME_CARD","showVolumeCard","SET_VOLUME_RENDER_MODE","UPDATE_VOLUME_STATE","SHOW_INFO_CARD","showInfoCard","SET_VISIBLE_INFO_CARD_ELEMENTS","UPDATE_INFO_CARD_ELEMENT_VIEW_MODE","ADD_ACTIVITY","REMOVE_ACTIVITY","CHANGE_LOCALE","changeLocale","OPEN_DIALOG","dialogId","CLOSE_DIALOG","closeDialog","UPDATE_SETTINGS","updateSettings","UserProfile","userInfo","Grid","justifyContent","spacing","picture","alt","Paper","elevation","List","ListItem","ListItemText","primary","secondary","Divider","light","email","email_verified","nickname","UserControlContent","classes","updateAccessToken","auth","useAuth","userMenuAnchorEl","setUserMenuAnchorEl","profileDialogOpen","setProfileDialogOpen","user","access_token","handleUserProfileDialogClose","handleUserMenuClose","avatar","profile","avatarContent","Avatar","className","imageAvatar","name1","given_name","name2","family_name","letters","letterAvatar","IconButton","currentTarget","aria-controls","aria-haspopup","iconButton","Menu","anchorEl","keepMounted","open","Boolean","onClose","MenuItem","signoutRedirect","Dialog","TransitionComponent","Transition","aria-labelledby","aria-describedby","DialogTitle","DialogContent","DialogActions","Button","userButton","isLoading","signinRedirect","signInWrapper","CircularProgress","signInProgress","withStyles","theme","createStyles","backgroundColor","margin","position","top","left","marginTop","marginLeft","padding","UPDATE_ACCESS_TOKEN","mapDispatchToProps","prevAccessToken","_updateAccessToken","connect","UserControl","useStyles","makeStyles","dialog","palette","appBar","flex","marginRight","forwardRef","Slide","direction","MarkdownPage","useState","markdownText","setMarkdownText","useEffect","fullScreen","AppBar","Toolbar","edge","aria-label","Typography","variant","linkTarget","appName","appBarTitle","allowRefresh","toolbar","headerBackgroundColor","paddingRight","drawer","transitions","create","easing","sharp","duration","leavingScreen","logoAnchor","display","alignItems","logo","flexGrow","headerTitleStyle","headerIconStyle","helpMenuAnchorEl","setHelpMenuAnchorEl","imprintOpen","setImprintOpen","manualOpen","setManualOpen","handleCloseHelpMenu","classNames","disableGutters","organisationUrl","logoImage","logoWidth","component","noWrap","Tooltip","arrow","getContentAnchorEl","anchorOrigin","vertical","horizontal","transformOrigin","form","flexWrap","paddingTop","paddingLeft","autoComplete","formControl","control","actions","FormControl","Box","marginBottom","minWidth","selectEmpty","datasetSelectLabel","InputLabel","shrink","htmlFor","datasetSelect","Select","onChange","input","Input","displayEmpty","selected","DatasetSelect","button","canAddTimeSeries","selectVariable","variableSelectLabel","variableSelect","timeSeriesButton","disabled","VariableSelect","setRgbLayerVisibility","FormControlLabel","Switch","checked","RgbSwitch","select","selectedPlaceGroupsTitle","removeAllUserPlaces","placeGroupsSelectLabel","placeGroupsSelect","multiple","renderValue","Checkbox","removeEnabled","placeGroupRemoveButton","PlaceGroupsSelect","removeUserPlace","placeSelectLabel","placeSelect","placeRemoveButton","PlaceSelect","ToggleButtonGroup","exclusive","ToggleButton","minTimeValue","maxTimeValue","hasTimeDimension","timeInputLabel","timeValue","timeInput","LocalizationProvider","dateAdapter","AdapterDateFns","DateTimePicker","emptyLabel","inputFormat","minDateTime","maxDateTime","date","ampm","renderInput","TextField","TimeSelect","box","fontSize","selectedTime_","setSelectedTime_","selectedTimeRangeValid","marks","Slider","min","max","valueLabelDisplay","valueLabelFormat","onChangeCommitted","TimeSlider","updateTimeAnimation","incSelectedTime","intervalId","useRef","playOrNot","uninstallTimer","handlePlayEvent","installTimer","current","setInterval","clearInterval","isValid","playToolTip","playIcon","playButton","firstTimeStepButton","prevTimeStepButton","nextTimeStepButton","lastTimeStepButton","increment","TimePlayer","flyToSelectedObject","downloadButton","canDownload","allowDownloads","refreshButton","settingsButton","flyToButton","volumeButton","infoButton","ControlBarActions","show","ErrorBoundary","errorInfo","componentStack","whiteSpace","Control","divRef","handleDivRef","OlControl","element","addControl","getControls","getArray","removeControl","_className","ScaleLine","OlScaleLineControl","getOptions","Draw","draw","OlDrawInteraction","active","setActive","addInteraction","listen","unlisten","removeInteraction","vectorLayer","getMapObject","onDrawStart","onDrawEnd","View","updateView","newProjection","oldProjection","getProjection","getCode","oldView","newView","olTransform","getCenter","getZoom","forEachFeature","transform","setView","setFeatureStyle","fillOpacity","OlPoint","setStyle","fillColor","strokeColor","strokeWidth","OlCircleStyle","createPointGeometryStyle","fillColorRgba","rgba","createGeometryStyle","USER_LAYER_SOURCE","SELECTION_LAYER_SOURCE","COLOR_LEGEND_STYLE","right","SELECTION_LAYER_STROKE","SELECTION_LAYER_FILL","SELECTION_LAYER_STYLE","withTheme","baseMapLayer","rgbLayer","variableLayer","datasetBoundaryLayer","placeGroupLayers","colorBarLegend","addUserPlace","setMap","selectedPlaceIdPrev","setSelectedPlaceIdPrev","selectedPlaceIdCurr","clear","selectedFeature","featureId","getFeatureById","findFeatureById","displayFeature","clone","setId","getId","addFeature","changed","handleDrawEnd","OlCircleGeometry","polygon","olPolygonFromCircle","setGeometry","geoJSONGeometry","colorIndex","userLayer","getFeatures","mode","nameBase","p","colorBarControl","getFeaturesAtPixel","pixel","f","handleMapClick","reader","FileReader","onloadend","readAsText","OlGeometryType","POINT","wrapX","stopClick","POLYGON","CIRCLE","bar","getLabelsFromArray","fractionDigits","round","log10","valueRounded","toFixed","formatValue","getLabelsFromRange","minValue","maxValue","count","arange","delta","ticks","ColorBarCanvas","onOpenEditor","canvasRef","fontWeight","paddingBottom","sliderBox","colorBarBox","COLOR_BAR_BOX_MARGIN","colorBarGroupTitle","colorBarGroupItemBox","colorBarMinMaxEditor","minMaxBox","minTextField","maxWidth","maxTextField","Labels","minMaxToText","minMaxValue","updateVariableColorBar","_updateVariableColorBar","variableColorBarMinMax","variableColorBarName","variableColorBar","variableOpacity","numTicks","colorBarMinMaxAnchorEl","setColorBarMinMaxAnchorEl","colorBarNameAnchorEl","setColorBarNameAnchorEl","currentColorBarMinMax","setCurrentColorBarMinMax","originalColorBarMinMax","setOriginalColorBarMinMax","enteredColorBarMinMax","setEnteredColorBarMinMax","enteredColorBarMinMaxError","setEnteredColorBarMinMaxError","colorBarMinMaxEditorOpen","colorBarNameEditorOpen","colorBarNameEditor","numStepsOuter","original1","original2","dist","distExp","distNorm","numStepsInner","numStepsFloat","numStepsInt","total1","total2","step","evt","enteredValue","newMinMax","handleEnteredColorBarMinChange","handleEnteredColorBarMaxChange","entries","cbg","placement","border","borderColor","Popover","_addUserPlace","ownProps","Viewer","styles","chartContainer","userSelect","flexDirection","responsiveContainer","actionButton","toolTipContainer","borderRadius","toolTipValue","toolTipLabel","chartTitle","X_AXIS_DOMAIN","Y_AXIS_DOMAIN","t1","t2","selectTimeSeries","dataTimeRange","showErrorBars","showPointsOnly","removeTimeSeriesGroup","completed","timeRangeSelection","setTimeRangeSelection","clearTimeRangeSelection","lightStroke","mainStroke","main","labelTextColor","contrastText","isZoomedIn","time1","time2","zoomIn","firstTime","secondTime","minTime","maxTime","zoomOut","commonValueDataKey","lines","lineName","lineColor","placeInfo","lon","lat","point","time1Ok","time2Ok","errorBar","shadedLineColor","ErrorBar","dataKey","Line","unit","dot","activeDot","strokeOpacity","isAnimationActive","timeSeriesGroupId","timeSeriesIndex","referenceLine","ReferenceLine","isFront","referenceArea","ReferenceArea","actionButtons","zoomOutButton","removeAllButton","progress","reduce","a","b","timeSeriesText","unitsText","ResponsiveContainer","LineChart","onMouseDown","activeLabel","onMouseMove","onMouseUp","onMouseEnter","onMouseLeave","syncId","XAxis","tickCount","domain","tickFormatter","allowDuplicatedCategory","YAxis","CartesianGrid","strokeDasharray","CustomTooltip","Legend","payload","valueText","suffix","CustomizedDot","cx","cy","totalRadius","totalDiameter","r","sw","viewBox","selectedTimeRange_","setSelectedTimeRange_","dataTimeRangeValid","flexFlow","noChartsCard","noChartsTitle","charts","TimeSeriesCharts","_changeEvent","_startEvent","_endEvent","OrbitControls","domElement","touchAction","enabled","Vector3","minDistance","maxDistance","Infinity","minPolarAngle","maxPolarAngle","PI","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","touches","ONE","TOUCH","TWO","DOLLY_PAN","target0","position0","zoom0","_domElementKeyEvents","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","getDistance","distanceTo","listenToKeyEvents","onKeyDown","saveState","scope","copy","reset","updateProjectionMatrix","dispatchEvent","update","STATE","NONE","offset","quat","Quaternion","setFromUnitVectors","up","quatInverse","invert","lastPosition","lastQuaternion","twoPI","sub","applyQuaternion","setFromVector3","rotateLeft","sphericalDelta","makeSafe","scale","addScaledVector","panOffset","add","setFromSpherical","lookAt","multiplyScalar","zoomChanged","distanceToSquared","EPS","quaternion","dispose","onContextMenu","onPointerDown","onPointerCancel","onMouseWheel","onPointerMove","onPointerUp","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","Vector2","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","pointers","pointerPositions","getZoomScale","angle","rotateUp","panLeft","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","isPerspectiveCamera","targetDistance","tan","fov","clientHeight","matrix","isOrthographicCamera","bottom","dollyOut","dollyScale","dollyIn","handleMouseDownRotate","clientX","clientY","handleMouseDownPan","handleTouchStartRotate","pageX","pageY","handleTouchStartPan","handleTouchStartDolly","dx","dy","sqrt","handleTouchMoveRotate","getSecondPointerPosition","subVectors","handleTouchMovePan","handleTouchMoveDolly","setPointerCapture","pointerId","addPointer","pointerType","trackPointer","DOLLY_ROTATE","onTouchStart","mouseAction","handleMouseDownDolly","ctrlKey","metaKey","shiftKey","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","onTouchMove","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","removePointer","releasePointerCapture","handleMouseWheel","needsUpdate","code","handleKeyDown","splice","pointer","passive","EventDispatcher","VolumeShader","uniforms","vertexShader","fragmentShader","colorBarTextures","textures","onLoad","texture","THREE","load","VolumeScene","camera","controls","renderer","scene","material","WebGL2RenderingContext","isWebGL2Available","render","setPixelRatio","devicePixelRatio","setSize","h","aspect","onCanvasResize","volume","xLength","yLength","zLength","format","minFilter","magFilter","unpackAlignment","shader","sx","sy","sz","sizeX","sizeY","sizeZ","side","translate","mesh","setVolumeOptions","value1","value2","isoThreshold","renderMode","frustumHeight","VolumeSlice","axis","defineProperty","geometryNeedsUpdate","canvasBuffer","updateGeometry","canvasMap","Texture","LinearFilter","wrapS","wrapT","ClampToEdgeWrapping","MeshBasicMaterial","DoubleSide","transparent","Mesh","matrixAutoUpdate","repaint","iLength","jLength","sliceAccess","ctxBuffer","imgData","volumeData","upperThreshold","lowerThreshold","windowLow","windowHigh","pixelCount","dataType","colorMap","alpha","putImageData","extracted","extractPerpendicularPlane","planeWidth","planeHeight","PlaneGeometry","identity","applyMatrix4","Volume","arrayBuffer","axisOrder","Uint8Array","Int8Array","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","Matrix3","sliceList","functionToMap","call","RASIndex","firstSpacing","secondSpacing","positionOffset","IJKIndex","axisInIJK","firstDirection","secondDirection","planeMatrix","Matrix4","multiply","makeRotationY","RASDimensions","setPosition","makeRotationX","inverseMatrix","normalize","arglet","iDirection","jDirection","kDirection","si","sj","sk","accessI","accessJ","accessK","datasize","NRRDLoader","manager","onProgress","onError","loader","FileLoader","setPath","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","itemError","_data","_dataPointer","_nativeLittleEndian","buffer","headerObject","_bytes","chunks","_chunkSize","_array_type","chunkSize","u8","byteOffset","byteLength","tmp","flipEndianness","scan","_length","_header","_data_start","parseChars","header","field","fn","l","m","_i","_len","match","isNrrd","_fieldFunctions","encoding","vectors","spacings","parseHeader","subarray","fflate","number","lengthOfTheResult","sizes","previous","__array","resultIndex","parsingFunction","String","fromCharCode","parseDataAsText","_copy","min_max","computeMinMax","xIndex","vector","yIndex","spacingX","fromArray","spacingY","spacingZ","transitionMatrix","space","ijk_to_transition","multiplyMatrices","toArray","output","Loader","endian","dim","_ref","_results","space_origin","parts","_results2","_j","_len2","CANVAS_STYLE","MESSAGE_STYLE","HINT_ELEMENT","DIV_STYLE","volumeCache","VolumeCanvas","volumeScene","createRef","handleLoadVolume","updateVolumeScene","selectedDataset","selectedPlaceInfo","volumeId","updateVolumeState","bboxArg","bBox","getBBoxFromPolygon","bBoxes","xMin","yMin","xMax","yMax","getBBoxFromBBoxes","noCacheArg","toLocaleTimeString","serverUrl","setVolume","getVolumeOptions","Response","responseObject","errorObject","exception","debug","messageComp","loadComp","volumeState","isNewScene","volumeIsoThreshold","PureComponent","POSITIVE_INFINITY","NEGATIVE_INFINITY","pos","card","info","close","cardContent","isoEditor","isoTextField","isoSlider","VolumeCard","setVolumeRenderMode","updateVariableVolume","Card","CardActions","disableSpacing","setValue","CardContent","IsoThresholdEditor","sliderValue","setSliderValue","textValue","setTextValue","setError","onKeyPress","InputProps","endAdornment","keyValueTableContainer","background","divider","variableHtmlReprContainer","media","fontFamily","InfoCard","setVisibleInfoCardElements","infoCardElementViewModes","updateInfoCardElementViewMode","serverConfig","allowViewModePython","datasetInfoContent","variableInfoContent","placeInfoContent","elementType","isVisible","isIn","setViewMode","hasPython","visibleElementTypes","DatasetInfoContent","jsonDimensions","selectObj","jsonDataset","attrs","d","dtype","spatialRef","getDatasetPythonCode","subheader","VariableInfoContent","htmlReprPaper","jsonVariable","htmlRepr","innerHTML","dims","shape","s","getVariablePythonCode","PlaceInfoContent","CardMedia","InfoCardContent","Collapse","in","timeout","unmountOnExit","CardHeader","action","pythonLogo","KeyValueTable","TableContainer","Table","TableBody","renderedValue","Link","TableRow","TableCell","align","CardContent2","CodeContent","extension","themeName","extensions","readOnly","JsonCodeContent","PythonCodeContent","python","newObj","lastIndexOf","splitExt","vmin","vmax","cmap","timeSel","visibleElements","Splitter","bodyEventListeners","onBodyMouseMove","onBodyMouseUp","onBodyMouseEnter","onBodyMouseLeave","removeBodyMouseListeners","dir","hor","ver","isButton1Pressed","getCurrentPosition","addBodyMouseListeners","currentPosition","positionDelta","endDragging","buttons","screenX","screenY","pair","outline","minHeight","maxHeight","cursor","SplitPane","handleSplitDelta","initialSize","setState","oldSize","newSize","childClassName","child1Style","child2Style","width1","childVer","height1","child1ClassName","child2ClassName","childHor","mapExtraStyle","getLayout","innerWidth","innerHeight","hasDatasets","hasInfoCard","hasVolumeCard","hasTimeseries","splitPaneHor","overflow","splitPaneVer","overflowX","overflowY","mapPaneHor","mapPaneVer","detailsPaneHor","detailsPaneVer","viewerContainer","layout","setLayout","updateLayout","onresize","splitPaneClassName","mapPaneClassName","detailsPaneClassName","hasConsent","breakpoints","icon","disableEscapeKeyDown","scroll","DialogContentText","history","back","home","contentContainer","textAlign","messages","LoadingDialog","variantIcon","success","CheckCircleIcon","warning","WarningIcon","ErrorIcon","InfoIcon","SNACKBAR_ANCHOR_ORIGIN","dark","iconVariant","hideMessage","handleClose","MessageIcon","Snackbar","autoHideDuration","SnackbarContent","messageId","newEntries","messageLogState","MessageLog","AuthWrapper","redirectUri","loadUserInfo","automaticSilentRenew","redirect_uri","post_logout_redirect_uri","popup_post_logout_redirect_uri","onSigninCallback","_user","replaceState","onRemoveUser","textField","textField2","selectedServer","configureServers","servers_","setServers_","selectedServer_","setSelectedServer_","dialogMode","setDialogMode","okButtonName","dialogTitle","dialogContent","doClose","getSelectedServerIndex","setSelectedServer","selectedServerIndex","setServers","doAddServer","doEditServer","cancelAddOrEditMode","doRemoveServer","menuItems","dividers","required","selectedServerName","selectedServerURL","inputProps","FormHelperText","autoFocus","ServerDialog","settingsPanelTitle","settingsPanelPaper","lighten","darken","paper","settingsPanelList","SettingsPanel","childCount","Children","listItems","child","dense","SettingsSubPanel","listItemStyle","listItemSecondaryAction","listItemText","ListItemSecondaryAction","ToggleSetting","RadioSetting","RadioGroup","row","Radio","typography","intTextField","localeAvatar","SettingsDialog","viewerVersion","languageMenuAnchor","setLanguageMenuAnchor","baseMapMenuAnchor","setBaseMapMenuAnchor","setTimeChunkSize","newTimeChunkSize","localeMenuItems","langLocale","langName","baseMapMenuItems","mapGroup","ListSubheader","disableSticky","mapSource","baseMapLabel","fullWidth","getOnOff","version","separatorTextField","fileNameTextField","ExportDialog","downloadTimeSeries","handleCloseDialog","test","exporter","placesToExport","includeTimeSeries","includePlaces","placesAsCollection","zip","dataColNames","placeIds","timePlaceRows","valueColName","errorColName","timePlaceId","timePlaceRow","colNames","sort","dataRows","rowData","colName","row1","row2","timeDelta","localeCompare","placeId1","placeId2","referencedPlaces","timeSeriesGroupsToTable","validTypes","string","csvHeaderRow","csvDataRows","csvText","write","collection","_exportData","FileUpload","accept","onSelect","fileInput","hidden","click","GeoJsonOptionsEditor","updateOptions","CsvTextFieldEditor","optionName","CsvOptionsEditor","gap","gridTemplateColumns","WktOptionsEditor","WKT_GEOM_NAMES","detectFormatName","marker","geomName","formats","codeExt","spacer","actionBox","UserPlacesDialog","nextMapInteraction","setText","loading","setLoading","expanded","setExpanded","_userPlacesFormatName","setUserPlacesFormatName","_userPlacesFormatOptions","setUserPlacesFormatOptions","formatOptionsEditor","handleCodePaste","handleFormatNameChange","placeholder","onPaste","onPasteCapture","selection","onabort","onerror","endIcon","StyledEngineProvider","injectFirst","ThemeProvider","createTheme","adaptV4Theme","htmlFontSize","primaryColor","secondaryColor","CssBaseline","newDataState","extraUserServers","getObjectItem","loadUserServers","extraUserServer","userServer","dataReducer","updateVariableProps","placeGroupIndex","pg","readFeature","addUserPlaceToLayer","removeUserPlacesFromLayer","getTimeSeriesArray","updateTimeSeriesGroups","userPlaceIds","tsgIndex","tsg","storeUserServers","removeFeature","variableProps","datasetIndex","ds","variableIndex","newTimeSeriesGroups","currentTimeSeries","newTimeSeriesArray","tsIndex","oldTimeSeries","controlReducer","appState","flyToCurr","flyToTarget","olProjTransformExtent","fit","getSize","getType","setCenter","getFirstCoordinate","newState","numMessages","messageLogReducer","oldEntries","newMessageLogEntries","latestEntry","hiddenEntry","userAuthReducer","appReducer","hostname","logger","ReduxLogger","collapsed","diff","store","Redux","thunk","ReactDOM","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.611a5a23.chunk.js","sourcesContent":["/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport type LanguageDictionaryEntry = { [locale: string]: string };\n\nexport interface LanguageDictionaryJson {\n    languages: LanguageDictionaryEntry;\n    dictionary: LanguageDictionaryEntry[];\n}\n\ntype LanguageDictionaryContent = { [key: string]: LanguageDictionaryEntry };\n\nexport interface WithLocale {\n    locale?: string;\n}\n\nexport class LanguageDictionary {\n    private readonly _languages: LanguageDictionaryEntry;\n    private readonly _content: LanguageDictionaryContent;\n    private _locale: string;\n\n    constructor(json: LanguageDictionaryJson) {\n\n        const locales = Object.getOwnPropertyNames(json.languages);\n        if (locales.findIndex(locale => locale === \"en\") < 0) {\n            throw new Error(`Internal error: locale \"en\" must be included in supported languages`)\n        }\n\n        const content: any = {};\n        json.dictionary.forEach((entry, index) => {\n            locales.forEach(locale => {\n                if (!entry[locale]) {\n                    throw new Error(`Internal error: invalid entry at index ${index} in \"./resources/lang.json\":` +\n                                    ` missing translation for locale: \"${locale}\": ${entry}`)\n                }\n            });\n            const phraseKey = getPhraseKey(entry[\"en\"]);\n            if (content[phraseKey]) {\n                console.warn(`Translation already defined for \"${entry[\"en\"]}\".`);\n            }\n            content[phraseKey] = entry;\n        });\n\n        this._languages = json.languages;\n        this._content = content;\n        this._locale = \"en\";\n    }\n\n    get languages(): LanguageDictionaryEntry {\n        return this._languages;\n    }\n\n    get locale(): string {\n        return this._locale;\n    }\n\n    set locale(value: string) {\n        const locales = Object.getOwnPropertyNames(this._languages);\n        if (locales.findIndex(locale => locale === value) < 0) {\n            const baseValue = value.split(\"-\")[0];\n            if (locales.findIndex(locale => locale === baseValue) < 0) {\n                console.error(`No translation found for locale \"${value}\", staying with \"${this._locale}\".`);\n                return;\n            } else {\n                console.warn(`No translation found for locale \"${value}\", falling back to \"${baseValue}\".`);\n                value = baseValue;\n            }\n        }\n\n        this._locale = value;\n    }\n\n    get(phrase: string, values?: { [name: string]: any }): string {\n        const key = getPhraseKey(phrase);\n        const entry = this._content[key];\n        let translatedPhrase: string;\n        if (!entry) {\n            console.warn(`missing translation for phrase \"${phrase}\"`);\n            translatedPhrase = phrase;\n        } else {\n            translatedPhrase = entry[this._locale];\n            if (!translatedPhrase) {\n                console.warn(`missing translation of phrase \"${phrase}\" for locale \"${this._locale}\"`);\n                translatedPhrase = phrase;\n            }\n        }\n        if (values) {\n            Object.keys(values).forEach(name => {\n                translatedPhrase = translatedPhrase.replace(\"${\" + name + \"}\", `${values[name]}`)\n            });\n        }\n        return translatedPhrase;\n    }\n}\n\nexport const getCurrentLocale = (): string => {\n    let locale;\n    if (navigator.languages && navigator.languages.length > 0) {\n        locale = navigator.languages[0];\n    } else {\n        locale = navigator.language || (navigator as any).userLanguage || (navigator as any).browserLanguage || 'en';\n    }\n    return locale.split('-')[0];\n};\n\n\nconst getPhraseKey = (phrase: string) => phrase.toLowerCase();\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { getCurrentLocale, LanguageDictionary } from './util/lang';\nimport lang from './resources/lang.json';\n\nconst i18n = new LanguageDictionary(lang);\ni18n.locale = getCurrentLocale();\n\nexport default i18n;\n\n\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport class HTTPError extends Error {\n    readonly statusCode: number;\n\n    constructor(statusCode: number, statusMessage: string) {\n        super(statusMessage);\n        this.statusCode = statusCode;\n    }\n}","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport i18n from '../i18n';\nimport { HTTPError } from './errors';\n\n\nexport type QueryComponent = [string, string];\n\nexport function makeRequestInit(accessToken: string | null): RequestInit {\n    if (accessToken) {\n        return {\n            headers: [['Authorization', `Bearer ${accessToken}`]],\n        };\n    }\n    return {};\n}\n\nexport function makeRequestUrl(url: string, query: QueryComponent[]) {\n    if (query.length > 0) {\n        const queryString = query.map(kv => kv.map(encodeURIComponent).join('=')).join('&');\n        if (!url.includes('?')) {\n            return url + '?' + queryString;\n        } else if (!url.endsWith('&')) {\n            return url +  '&' + queryString;\n        } else {\n            return url +  queryString;\n        }\n    }\n    return url;\n}\n\nexport function callApi(url: string, init?: RequestInit): Promise<Response> {\n\n    if (process.env.NODE_ENV === 'development') {\n        console.debug('Calling API: ', url, init);\n    }\n\n    return fetch(url, init)\n        .then(response => {\n            if (!response.ok) {\n                throw new HTTPError(response.status, response.statusText);\n            }\n            return response;\n        })\n        .catch(error => {\n            if (error instanceof TypeError) {\n                console.error(`Server did not respond for ${url}. `\n                              +  \"May be caused by timeout, refused connection, network error, etc.\", error);\n                throw new Error(i18n.get(\"Cannot reach server\"));\n            } else {\n                console.error(error);\n                throw error;\n            }\n        });\n}\n\nexport function callJsonApi<T>(url: string, init?: RequestInit): Promise<T> {\n    return callApi(url, init).then(response => response.json());\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { callJsonApi } from './callApi';\nimport { ColorBars, ColorBarGroup } from \"../model/colorBar\";\n\n\nexport function getColorBars(apiServerUrl: string): Promise<ColorBars> {\n    return callJsonApi<ColorBars>(`${apiServerUrl}/colorbars`)\n        .then(parseColorBars);\n}\n\nfunction parseColorBars(colorBarGroups: any): ColorBars {\n    const groups: ColorBarGroup[] = [];\n    const images: any = {};\n    colorBarGroups.forEach((colorBarGroup: [string, string, any[]]) => {\n        const title = colorBarGroup[0];\n        const description = colorBarGroup[1];\n        const names: string[] = [];\n        colorBarGroup[2].forEach((colorBar: [string, string]) => {\n            const name = colorBar[0];\n            const image = colorBar[1];\n            names.push(name);\n            images[name] = image;\n        });\n        groups.push({title, description, names});\n    });\n    return {groups, images};\n}","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { callJsonApi, makeRequestInit, makeRequestUrl } from './callApi';\nimport { Dataset, Dimension, TimeDimension } from '../model/dataset';\n\n\nexport function getDatasets(apiServerUrl: string, accessToken: string | null): Promise<Dataset[]> {\n    const url = makeRequestUrl(`${apiServerUrl}/datasets`, [['details', '1']]);\n    const init = makeRequestInit(accessToken);\n    return callJsonApi<Dataset[]>(url, init)\n        .then((result: any) => result['datasets'])\n        .then(adjustTimeDimensionsForDatasets);\n}\n\nfunction adjustTimeDimensionsForDatasets(datasets: Dataset[]): Dataset[] {\n    return datasets.map(adjustTimeDimensionsForDataset);\n}\n\nfunction adjustTimeDimensionsForDataset(dataset: Dataset): Dataset {\n    if (dataset.dimensions && dataset.dimensions.length) {\n        let dimensions = dataset.dimensions;\n        const index = dimensions.findIndex((dimension: Dimension) => dimension.name === 'time');\n        if (index > -1) {\n            const timeDimension = dimensions[index];\n            let timeCoordinates: any = timeDimension.coordinates;\n            if (timeCoordinates && timeCoordinates.length && typeof timeCoordinates[0] === 'string') {\n                let labels = timeCoordinates as string[];\n                let coordinates = labels.map((label: string) => new Date(label).getTime());\n                dimensions = [...dimensions];\n                dimensions[index] = {...timeDimension, coordinates, labels} as TimeDimension;\n                return {...dataset, dimensions};\n            }\n        }\n    }\n    return dataset;\n}","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport {callJsonApi, makeRequestInit} from './callApi';\nimport {PlaceGroup} from '../model/place';\n\n\nexport function getDatasetPlaceGroup(\n    apiServerUrl: string,\n    datasetId: string,\n    placeGroupId: string,\n    accessToken: string | null\n): Promise<PlaceGroup> {\n    const init = makeRequestInit(accessToken);\n    const dsId = encodeURIComponent(datasetId);\n    const pgId = encodeURIComponent(placeGroupId);\n    return callJsonApi<PlaceGroup>(\n        `${apiServerUrl}/datasets/${dsId}/places/${pgId}`,\n        init\n    );\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport class DeveloperError extends Error {\n}\n\nexport function assertTrue(condition: any, message: string) {\n    if (!condition) {\n        throw new DeveloperError(`assertion failed: ${message}`);\n    }\n}\n\nexport function assertNotNull(object: any, objectName: string) {\n    if (object === null) {\n        throw new DeveloperError(`assertion failed: ${objectName} must not be null`);\n    }\n}\n\nexport function assertDefined(object: any, objectName: string) {\n    if (typeof object === \"undefined\") {\n        throw new DeveloperError(`assertion failed: ${objectName} must not be undefined`);\n    }\n}\n\nexport function assertDefinedAndNotNull(object: any, objectName: string) {\n    assertNotNull(object, objectName);\n    assertDefined(object, objectName);\n}\n\nexport function assertArray(array: any, arrayName: string) {\n    if (!Array.isArray(array)) {\n        throw new DeveloperError(`assertion failed: ${arrayName} must be an array`);\n    }\n}\n\nexport function assertArrayNotEmpty(array: any, arrayName: string) {\n    assertArray(array, arrayName);\n    if (array.length === 0) {\n        throw new DeveloperError(`assertion failed: ${arrayName} must be a non-empty array`);\n    }\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { TileSourceOptions } from './tile';\nimport { Variable } from './variable';\nimport { PlaceGroup } from './place';\nimport { TimeRange } from './timeSeries';\nimport {\n    assertArrayNotEmpty,\n    assertDefinedAndNotNull,\n} from '../util/assert';\n\n\nexport interface Dimension {\n    name: string;\n    size: number;\n    dtype: string;\n    coordinates: number[];\n}\n\n// export interface LonDimension extends Dimension {\n//     name: 'lon';\n// }\n//\n// export interface LatDimension extends Dimension {\n//     name: 'lat';\n// }\n\nexport interface TimeDimension extends Dimension {\n    name: 'time';\n    labels: string[];\n}\n\nexport type NormRange = [number, number];\n\nexport interface RgbSchema {\n    // The following are new since xcube 0.11\n    tileUrl: string;\n    tileLevelMin?: number;\n    tileLevelMax?: number;\n    // tileSourceOptions are longer used since xcube 0.11\n    tileSourceOptions?: TileSourceOptions;\n    varNames: [string, string, string];\n    normRanges: [NormRange, NormRange, NormRange];\n}\n\nexport interface Dataset {\n    id: string;\n    title: string;\n    bbox: [number, number, number, number];\n    geometry: {\n        type: \"Polygon\";\n        coordinates: Array<Array<[number, number]>>;\n    };\n    spatialRef: string;\n    dimensions: Dimension[];\n    variables: Variable[];\n    placeGroups?: PlaceGroup[];\n    attributions?: string[];\n    attrs: { [name: string]: any };\n    rgbSchema?: RgbSchema;\n}\n\n\nexport function findDataset(datasets: Dataset[], selectedDatasetId: string | null): Dataset | null {\n    return (selectedDatasetId && datasets.find(dataset => dataset.id === selectedDatasetId)) || null;\n}\n\nexport function findDatasetVariable(dataset: Dataset, variableName: string | null): Variable | null {\n    return (variableName && dataset.variables.find(variable => variable.name === variableName)) || null;\n}\n\nexport function getDatasetTimeDimension(dataset: Dataset): TimeDimension | null {\n    assertDefinedAndNotNull(dataset, 'dataset');\n    assertArrayNotEmpty(dataset.dimensions, 'dataset.dimensions');\n    const dimension: any = dataset.dimensions.find(dimension => dimension.name === 'time');\n    if (!dimension) {\n        return null;\n    }\n    assertArrayNotEmpty(dimension!.coordinates, 'timeDimension.coordinates');\n    assertArrayNotEmpty(dimension!.labels, 'timeDimension.labels');\n    return dimension as TimeDimension;\n}\n\nexport function getDatasetTimeRange(dataset: Dataset): TimeRange | null {\n    const timeDimension = getDatasetTimeDimension(dataset);\n    if (!timeDimension) {\n        return null;\n    }\n    const coordinates = timeDimension.coordinates;\n    return [coordinates[0], coordinates[coordinates.length - 1]];\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport class ParseError extends Error {\n}\n\nexport interface ParseOptions {\n    separator: string;\n    comment: string;\n    quote: string;\n    escape: string;\n    trim: boolean;\n    nanToken: string;\n    trueToken: string;\n    falseToken: string;\n}\n\nexport const defaultParseOptions: ParseOptions = {\n    separator: ',',\n    comment: '#',\n    quote: '\"',\n    escape: '\\\\',\n    trim: true,\n    nanToken: 'NaN',\n    trueToken: 'true',\n    falseToken: 'false',\n}\n\ntype Line = [string, number];\nexport type Value = string | number | boolean | null;\n\nexport function parseCsv(text: string, options?: Partial<ParseOptions>): Value[][] {\n    return new Parser(options).parse(text);\n}\n\nclass Parser {\n    readonly options: ParseOptions;\n\n    constructor(options?: Partial<ParseOptions>) {\n        this.options = {\n            ...defaultParseOptions,\n            ...options\n        };\n        this.parseLine = this.parseLine.bind(this);\n    }\n\n    parse(text: string): Value[][] {\n        return this.parseText(text).map(this.parseLine);\n    }\n\n    parseText(text: string): Line[] {\n        const {comment, trim} = this.options;\n        return text\n            .split(\"\\n\")\n            .map((line, index): Line => {\n                if (trim) {\n                    line = line.trim();\n                }\n                return [line, index];\n            })\n            .filter(([line, index]): boolean => {\n                return line.trim() !== \"\" && !line.startsWith(comment);\n            });\n    }\n\n    parseLine([line, index]: Line): Value[] {\n        const {separator, quote, escape} = this.options;\n        let quoteSeen = false;\n        let values: Value[] = [];\n        let start = 0;\n        let end = 0;\n        for (; end < line.length; end++) {\n            const char = line[end];\n            if (char === escape) {\n                end++;\n            } else if (quoteSeen) {\n                if (char === quote) {\n                    quoteSeen = false;\n                }\n            } else if (char === quote) {\n                quoteSeen = true;\n            } else if (char === separator) {\n                this.collectValue(line, start, end, values);\n                start = end + 1;\n            }\n        }\n        if (quoteSeen) {\n            throw error(`missing quote character [${this.options.quote}]`, index, start);\n        }\n        this.collectValue(line, start, end, values);\n        return values;\n    }\n\n    collectValue(line: string, start: number, end: number, values: Value[]): void {\n        const token = line.slice(start, end);\n        values.push(this.parseToken(token));\n    }\n\n    parseToken(token: string): Value {\n        const options = this.options;\n        if (options.trim) {\n            token = token.trim();\n        }\n        if (token === \"\") {\n            return null;\n        }\n        if (token.startsWith(options.quote)) {\n            token = token.substring(1, token.length - 1);\n        } else {\n            if (token === options.trueToken) {\n                return true;\n            }\n            if (token === options.falseToken) {\n                return false;\n            }\n            if (token === options.nanToken) {\n                return Number.NaN;\n            }\n            const value = parseFloat(token);\n            if (!Number.isNaN(value)) {\n                return value;\n            }\n        }\n        return unescapeString(token, options.escape);\n    }\n}\n\nfunction error(message: string, lineIndex: number, colIndex: number): ParseError {\n    return new ParseError(`line ${lineIndex + 1}, column ${colIndex + 1}: ${message}`);\n}\n\nfunction unescapeString(token: string, escape: string) {\n    let end = token.indexOf(escape);\n    if (end < 0) {\n        return token;\n    }\n    let start = 0;\n    let token2 = '';\n    for (; end < token.length; end++) {\n        if (token[end] === escape) {\n            token2 += token.substring(start, end) + token.substring(end + 1, end + 2);\n            end += 2;\n            start = end;\n        }\n    }\n    token2 += token.substring(start, token.length);\n    return token2;\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { parseCsv, ParseOptions, defaultParseOptions } from '../../util/csv';\nimport { Format } from './common';\n\n\nconst checkError = (text: string): string | null => {\n    if (text.trim() !== '') {\n        try {\n            parseCsv(text);\n        } catch (e) {\n            console.error(e);\n            return `${e}`;\n        }\n    }\n    return null;\n};\n\nexport const csvFormat: Format = {\n    name: 'Text/CSV',\n    fileExt: '.txt,.csv',\n    checkError\n};\n\nexport interface CsvOptions extends ParseOptions {\n    xName: string;\n    yName: string;\n    forceGeometry: boolean;\n    geometryName: string;\n    labelName: string;\n    labelPrefix: string;\n}\n\nexport const defaultCsvOptions: CsvOptions = {\n    ...defaultParseOptions,\n    xName: \"longitude\",\n    yName: \"latitude\",\n    forceGeometry: false,\n    geometryName: \"geometry\",\n    labelName: \"name\",\n    labelPrefix: \"CSV-\",\n};\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Format } from './common';\n\n\nconst checkError = (text: string): string | null => {\n    if (text.trim() !== '') {\n        try {\n            JSON.parse(text);\n        } catch (e) {\n            console.error(e);\n            return `${e}`;\n        }\n    }\n    return null;\n};\n\nexport const geoJsonFormat: Format = {\n    name: 'GeoJSON',\n    fileExt: '.json,.geojson',\n    checkError\n};\n\nexport interface GeoJsonOptions {\n    labelNames: string;\n    labelPrefix: string;\n}\n\nexport const defaultGeoJsonOptions: GeoJsonOptions = {\n    labelNames: \"label, name, title, id\",\n    labelPrefix: \"GeoJSON-\",\n};\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Format } from './common';\n\n\nconst checkError = (text: string): string | null => {\n    // TODO\n    return null;\n};\n\nexport const wktFormat: Format = {\n    name: 'WKT',\n    fileExt: '.txt,.wkt',\n    checkError\n};\n\nexport interface WktOptions {\n    label: string;\n    labelPrefix: string;\n}\n\nexport const defaultWktOptions: WktOptions = {\n    label: \"\",\n    labelPrefix: \"WKT-\"\n};\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport function newId(): string {\n    return (Math.random().toString(16).substr(2) + '-' + Date.now().toString(16)).toUpperCase();\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2023 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nfunction _getBaseUrl(): URL {\n    const url = new URL(window.location.href);\n    const pathComponents = url.pathname.split('/');\n    const numPathComponents = pathComponents.length;\n    if (numPathComponents > 0) {\n        const lastComponent = pathComponents[numPathComponents - 1];\n        if (lastComponent === 'index.html') {\n            return new URL(pathComponents.slice(0, numPathComponents - 1).join('/'), window.location.origin);\n        } else {\n            return new URL(url.pathname, window.location.origin);\n        }\n    }\n    return new URL(window.location.origin);\n}\n\nconst baseUrl = _getBaseUrl();\n\nexport default baseUrl;\n\nconsole.log(\"baseUrl = \", baseUrl.href);","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2023 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n\n/**\n * Builds a path by concatenating a base path and subsequent path components.\n * The function ensures that only single path separators are used between\n * path components.\n *\n * @param base\n * @param components\n */\nexport function buildPath(base: string, ...components: string[]): string {\n    let path = base;\n    for (let c of components) {\n        if (c !== '') {\n            if (path.endsWith('/')) {\n                if (c.startsWith('/')) {\n                    path += c.substr(1);\n                } else {\n                    path += c;\n                }\n            } else {\n                if (c.startsWith('/')) {\n                    path += c;\n                } else {\n                    path += '/' + c;\n                }\n            }\n        }\n    }\n    return path;\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { CSSProperties } from \"react\";\nimport {\n    amber,\n    blue,\n    blueGrey,\n    brown,\n    cyan,\n    deepOrange,\n    deepPurple,\n    green,\n    grey,\n    indigo,\n    lightBlue,\n    lightGreen,\n    lime,\n    orange,\n    pink,\n    purple,\n    red,\n    teal,\n    yellow,\n} from '@mui/material/colors';\nimport {Color} from '@mui/material';\nimport { PaletteColorOptions } from '@mui/material/styles';\nimport baseUrl from './baseurl';\nimport { buildPath } from './path';\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst COLORS: { [name: string]: Partial<Color> } = {\n    amber,\n    blue,\n    blueGrey,\n    brown,\n    cyan,\n    deepOrange,\n    deepPurple,\n    green,\n    grey,\n    indigo,\n    lightBlue,\n    lightGreen,\n    lime,\n    orange,\n    pink,\n    purple,\n    red,\n    teal,\n    yellow,\n};\n\n// Align any changes made here with\n// - resources/config.json\n// - resources/config.schema.json\nexport interface Branding {\n    appBarTitle: string;\n    windowTitle: string;\n    windowIcon: string | null;\n    compact: boolean;\n    themeName: 'dark' | 'light';\n    primaryColor: PaletteColorOptions;\n    secondaryColor: PaletteColorOptions;\n    headerBackgroundColor?: string;\n    headerTitleStyle?: CSSProperties;\n    headerIconStyle?: CSSProperties;\n    organisationUrl?: string;\n    logoImage: any;\n    logoWidth: number;\n    baseMapUrl?: string;\n    defaultAgg?: 'median' | 'mean';\n    polygonFillOpacity?: number;\n    mapProjection?: string;\n    allowDownloads?: boolean;\n    allowRefresh?: boolean;\n    allowViewModePython?: boolean;\n    allow3D?: boolean;\n}\n\n\nfunction setBrandingColor(brandingConfig: any, key: keyof Branding) {\n    const colorName = brandingConfig[key];\n    if (typeof colorName === 'string') {\n        const color = COLORS[colorName];\n        if (color) {\n            brandingConfig[key] = color;\n        } else {\n            throw new Error(`branding.${key} \"${colorName}\" is invalid`);\n        }\n    }\n}\n\nfunction setBrandingImage(brandingConfig: any, key: keyof Branding, configPath: string) {\n    const imagePath = brandingConfig[key];\n    if (typeof imagePath === 'string') {\n        brandingConfig[key] = buildPath(baseUrl.href, configPath, imagePath);\n    }\n}\n\nexport function parseBranding(brandingConfig: any, configPath: string): Branding {\n    brandingConfig = {...brandingConfig};\n    setBrandingColor(brandingConfig, 'primaryColor');\n    setBrandingColor(brandingConfig, 'secondaryColor');\n    setBrandingImage(brandingConfig, 'logoImage', configPath);\n    return brandingConfig as Branding;\n}\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Color, PaletteType } from '@mui/material';\nimport {\n    cyan,\n    deepPurple,\n    green,\n    indigo,\n    lightBlue,\n    lime,\n    orange,\n    pink,\n    purple,\n    red,\n    yellow,\n} from '@mui/material/colors';\nimport { ApiServerConfig } from './model/apiServer';\nimport rawDefaultConfig from './resources/config.json';\nimport { AuthClientConfig } from './util/auth';\nimport { Branding, parseBranding } from './util/branding';\nimport baseUrl from './util/baseurl';\nimport { buildPath } from './util/path';\n\n\nexport const appParams = new URLSearchParams(window.location.search);\n\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport class Config {\n    readonly name: string;\n    readonly server: ApiServerConfig;\n    readonly branding: Branding;\n    readonly authClient?: AuthClientConfig;\n    private static _instance: Config;\n\n    constructor(\n        name: string,\n        server: ApiServerConfig,\n        branding: Branding,\n        authClient?: AuthClientConfig\n    ) {\n        this.name = name;\n        this.server = server;\n        this.branding = branding;\n        this.authClient = authClient;\n    }\n\n    static async load(): Promise<Config> {\n        let configPath = appParams.get('configPath') || 'config';\n        let rawConfig;\n        const configUrl = buildPath(baseUrl.href, configPath, 'config.json');\n        try {\n            rawConfig = await fetch(configUrl);\n            rawConfig = await rawConfig.json();\n            if (process.env.NODE_ENV === 'development') {\n                console.debug(`Configuration loaded from ${configUrl}`);\n            }\n        } catch (e) {\n            configPath = '';\n            rawConfig = rawDefaultConfig;\n            if (process.env.NODE_ENV === 'development') {\n                console.debug(`Failed loading configuration from ${configUrl}:`, e);\n                console.debug(`Using defaults.`);\n            }\n        }\n\n        const name = rawConfig.name || 'default';\n        const authClient = rawConfig.authClient && {...rawConfig.authClient};\n        const server = {...rawDefaultConfig.server, ...rawConfig.server} as ApiServerConfig;\n        server.id = appParams.get('serverId') || server.id;\n        server.name = appParams.get('serverName') || server.name;\n        server.url = appParams.get('serverUrl') || server.url;\n        const compact = parseInt(appParams.get('compact') || '0') !== 0;\n        const branding = parseBranding(\n            {\n                ...rawDefaultConfig.branding,\n                ...rawConfig.branding,\n                compact: compact || !!rawConfig.branding.compact\n            },\n            configPath\n        );\n        branding.allow3D = !!parseInt(appParams.get('allow3D') || '0') || branding.allow3D;\n        Config._instance = new Config(name, server, branding, authClient);\n        if (process.env.NODE_ENV === 'development') {\n            console.debug('Configuration:', Config._instance);\n        }\n        if (branding.windowTitle) {\n            this.changeWindowTitle(branding.windowTitle);\n        }\n        if (branding.windowIcon) {\n            this.changeWindowIcon(branding.windowIcon);\n        }\n        return Config._instance;\n    }\n\n    static get instance(): Config {\n        Config.assertConfigLoaded();\n        return Config._instance;\n    }\n\n    private static assertConfigLoaded() {\n        if (!Config._instance) {\n            throw new Error('internal error: configuration not available yet');\n        }\n    }\n\n    private static changeWindowTitle(title: string) {\n        document.title = title;\n    }\n\n    private static changeWindowIcon(iconUrl: string) {\n        let favicon = document.querySelector<HTMLLinkElement>('link[rel=\"icon\"]');\n        if (favicon !== null) {\n            favicon.href = iconUrl;\n        } else {\n            favicon = document.createElement(\"link\");\n            favicon.rel = \"icon\";\n            favicon.href = iconUrl;\n            document.head.appendChild(favicon);\n        }\n    }\n}\n\n\ninterface TileAccess {\n    param: string;\n    token: string;\n}\n\n\n// Array of user place colors in stable order (see #153)\nconst userPlaceColorsArray: [string, Color][] = [\n    [\"yellow\", yellow],\n    [\"red\", red],\n    [\"pink\", pink],\n    [\"lightBlue\", lightBlue],\n    [\"green\", green],\n    [\"orange\", orange],\n    [\"lime\", lime],\n    [\"purple\", purple],\n    [\"indigo\", indigo],\n    [\"cyan\", cyan],\n    [\"deepPurple\", deepPurple],\n];\n\nconst userPlaceColors: { [name: string]: Color } = (() => {\n    const obj: { [name: string]: Color } = {};\n    userPlaceColorsArray.forEach(([name, color]) => {\n        obj[name] = color;\n    });\n    return obj;\n})();\n\nexport const userPlaceColorNames = userPlaceColorsArray.map(([name, _]) => name);\n\n\nexport function getStrokeShade(paletteType: PaletteType) {\n    return paletteType === 'light' ? 800 : 400;\n}\n\nexport function getUserPlaceColorName(index: number): string {\n    return userPlaceColorNames[index % userPlaceColorNames.length];\n}\n\nexport function getUserPlaceColor(colorName: string, paletteType: PaletteType): string {\n    const shade = getStrokeShade(paletteType);\n    return userPlaceColors[colorName][shade];\n}\n\n// See resources/maps.json\nconst tileAccess: { [name: string]: TileAccess } = {\n    'Mapbox': {\n        param: 'access_token',\n        token: 'pk.eyJ1IjoiZm9ybWFuIiwiYSI6ImNrM2JranV0bDBtenczb2szZG84djh6bWUifQ.q0UKwf4CWt5fcQwIDwF8Bg'\n    },\n};\n\n\nexport function getTileAccess(groupName: string) {\n    return tileAccess[groupName];\n}\n\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as  GeoJSON from 'geojson';\nimport { defaultMemoize } from 'reselect';\nimport { default as OlWktFormat } from \"ol/format/WKT\";\nimport { default as OlGeomPoint } from \"ol/geom/Point\";\nimport { default as OlGeoJSONFormat } from \"ol/format/GeoJSON\";\nimport { default as OlFeature } from \"ol/Feature\";\nimport { default as OlGeometry } from \"ol/geom/Geometry\";\n\nimport { CsvOptions, defaultCsvOptions } from \"./user-place/csv\";\nimport { defaultGeoJsonOptions, GeoJsonOptions } from \"./user-place/geojson\";\nimport { defaultWktOptions, WktOptions } from \"./user-place/wkt\";\nimport { newId } from \"../util/id\";\nimport { getUserPlaceColorName } from '../config';\nimport { parseCsv } from \"../util/csv\";\nimport i18n from \"../i18n\";\n\n\n/**\n * A place is a GeoJSON feature with a mandatory string ID.\n */\nexport interface Place extends GeoJSON.Feature {\n    id: string;\n\n    [name: string]: any;\n}\n\n/**\n * A group of places represented by GeoJSON features.\n */\nexport interface PlaceGroup extends GeoJSON.FeatureCollection {\n    id: string;\n    title: string;\n    features: Place[];\n    propertyMapping?: { [role: string]: string };\n    placeGroups?: { [placeId: string]: PlaceGroup }; // placeGroups in placeGroups are not yet supported\n}\n\n/**\n * Computed place information.\n */\nexport interface PlaceInfo {\n    placeGroup: PlaceGroup;\n    place: Place;\n    label: string;\n    color: string;\n    image: string | null;\n    description: string | null;\n}\n\nexport const DEFAULT_LABEL_PROPERTY_NAMES = mkCases(['label', 'title', 'name', 'id']);\nexport const DEFAULT_DESCRIPTION_PROPERTY_NAMES = mkCases(['description', 'desc', 'abstract', 'comment']);\nexport const DEFAULT_COLOR_PROPERTY_NAMES = mkCases(['color']);\nexport const DEFAULT_IMAGE_PROPERTY_NAMES = mkCases(['image', 'img', 'picture', 'pic']);\n\nexport function computePlaceInfo(placeGroup: PlaceGroup, place: Place): PlaceInfo {\n    const infoObj = {};\n    updatePlaceInfo(infoObj, placeGroup, place, 'label', place.id + '',\n        DEFAULT_LABEL_PROPERTY_NAMES);\n    updatePlaceInfo(infoObj, placeGroup, place, 'color', getUserPlaceColorName(getPlaceHash(place)),\n        DEFAULT_COLOR_PROPERTY_NAMES);\n    updatePlaceInfo(infoObj, placeGroup, place, 'image', null,\n        DEFAULT_IMAGE_PROPERTY_NAMES);\n    updatePlaceInfo(infoObj, placeGroup, place, 'description', null,\n        DEFAULT_DESCRIPTION_PROPERTY_NAMES);\n    return {placeGroup, place, ...infoObj} as PlaceInfo;\n}\n\nexport const getPlaceInfo = defaultMemoize(computePlaceInfo);\n\n\nfunction updatePlaceInfo(infoObj: { [name: string]: any },\n                         placeGroup: PlaceGroup,\n                         place: Place,\n                         propertyName: string,\n                         defaultValue: any,\n                         defaultPropertyNames: string[]) {\n    let propertyValue;\n    const mappedPropertyValue = placeGroup.propertyMapping && placeGroup.propertyMapping[propertyName];\n    if (mappedPropertyValue) {\n        if (mappedPropertyValue.includes('${')) {\n            infoObj[propertyName] = getInterpolatedPropertyValue(place, mappedPropertyValue);\n            return;\n        }\n        if (defaultPropertyNames.length > 0 && defaultPropertyNames[0] !== mappedPropertyValue) {\n            defaultPropertyNames = [mappedPropertyValue, ...defaultPropertyNames];\n        }\n    }\n    if (place.properties) {\n        propertyValue = getPropertyValue(place.properties, defaultPropertyNames);\n    }\n    if (propertyValue === undefined) {\n        propertyValue = getPropertyValue(place, defaultPropertyNames);\n    }\n    infoObj[propertyName] = propertyValue || defaultValue;\n}\n\nfunction getInterpolatedPropertyValue(place: Place, propertyValue: string) {\n    let interpolatedValue = propertyValue;\n    if (place.properties) {\n        for (let name of Object.getOwnPropertyNames(place.properties)) {\n            if (!interpolatedValue.includes('${')) {\n                break;\n            }\n            const placeHolder = '${' + name + '}';\n            if (interpolatedValue.includes(placeHolder)) {\n                interpolatedValue = interpolatedValue.replace(placeHolder, `${place.properties[name]}`);\n            }\n        }\n    }\n    return interpolatedValue;\n}\n\nfunction getPropertyValue(container: any, propertyNames: string[]) {\n    let value;\n    for (let propertyName of propertyNames) {\n        if (propertyName in container) {\n            return container[propertyName];\n        }\n    }\n    // noinspection JSUnusedAssignment\n    return value;\n}\n\nfunction mkCases(names: string[]): string[] {\n    let nameCases: string[] = [];\n    for (let name of names) {\n        nameCases = nameCases.concat(name.toLowerCase(),\n            name.toUpperCase(),\n            name[0].toUpperCase() + name.substr(1).toLowerCase())\n    }\n    return nameCases;\n}\n\nexport function forEachPlace(placeGroups: PlaceGroup[], callback: (placeGroup: PlaceGroup, place: Place) => void) {\n    placeGroups.forEach(placeGroup => {\n        if (isValidPlaceGroup(placeGroup)) {\n            placeGroup.features.forEach((place: Place) => {\n                callback(placeGroup, place);\n            });\n        }\n    });\n}\n\nexport function findPlaceInfo(placeGroups: PlaceGroup[], predicate: (placeGroup: PlaceGroup, place: Place) => boolean): PlaceInfo | null {\n    for (let placeGroup of placeGroups) {\n        if (isValidPlaceGroup(placeGroup)) {\n            const place = placeGroup.features.find((place: Place) => predicate(placeGroup, place));\n            if (place) {\n                return getPlaceInfo(placeGroup, place);\n            }\n        }\n    }\n    return null;\n}\n\nfunction getPlaceHash(place: Place): number {\n    const id = place.id + '';\n    let hash = 0, i, c;\n    if (id.length === 0) {\n        return hash;\n    }\n    for (i = 0; i < id.length; i++) {\n        c = id.charCodeAt(i);\n        hash = ((hash << 5) - hash) + c;\n        hash |= 0; // Convert to 32bit integer\n    }\n    return hash;\n}\n\nexport function isValidPlaceGroup(placeGroup: PlaceGroup): boolean {\n    return !!placeGroup.features;\n}\n\nexport function findPlaceInPlaceGroup(placeGroup: PlaceGroup, placeId: string | null): Place | null {\n    if (!placeId || !isValidPlaceGroup(placeGroup)) {\n        return null;\n    }\n    const place = placeGroup.features.find(place => place.id === placeId);\n    if (!!place) {\n        return place as Place;\n    }\n    let subPlaceGroups = placeGroup.placeGroups;\n    if (subPlaceGroups) {\n        for (let parentPlaceId in subPlaceGroups) {\n            const place = findPlaceInPlaceGroup(subPlaceGroups[parentPlaceId], placeId);\n            if (!!place) {\n                return place;\n            }\n        }\n    }\n    return null;\n}\n\nexport function findPlaceInPlaceGroups(placeGroups: PlaceGroup[], placeId: string | null): Place | null {\n    if (placeId) {\n        for (let placeGroup of placeGroups) {\n            const place = findPlaceInPlaceGroup(placeGroup, placeId);\n            if (place !== null) {\n                return place;\n            }\n        }\n    }\n    return null;\n}\n\n\nlet LAST_PLACE_LABEL_ID_CSV = 0;\nlet LAST_PLACE_LABEL_ID_GEOJSON = 0;\nlet LAST_PLACE_LABEL_ID_WKT = 0;\n\n\nexport function getUserPlacesFromCsv(text: string, options: CsvOptions): Place[] {\n    let table = parseCsv(text, options);\n    if (table.length < 2) {\n        throw new Error(i18n.get('Missing header line in CSV'));\n    }\n\n    for (let v of table[0]) {\n        if (typeof v !== 'string' || v === '') {\n            throw new Error(i18n.get('Invalid header line in CSV'));\n        }\n    }\n\n    const headerRow: string[] = table[0].map(v => v as string);\n    const headerRowLC = headerRow.map(v => v.toLowerCase());\n    const numColumns = headerRow.length;\n\n    for (let row of table) {\n        if (row.length !== numColumns) {\n            throw new Error(i18n.get('All rows must have same length'));\n        }\n    }\n\n    const labelNameLC = options.labelName.toLowerCase();\n    const xNameLC = options.xName.toLowerCase();\n    const yNameLC = options.yName.toLowerCase();\n    const geometryNameLC = options.geometryName.toLowerCase();\n    const forceGeometry = options.forceGeometry;\n\n    const labelNameIndex = headerRowLC.findIndex(name => name === labelNameLC);\n    const xNameIndex = headerRowLC.findIndex(name => name === xNameLC);\n    const yNameIndex = headerRowLC.findIndex(name => name === yNameLC);\n    let geometryNameIndex = headerRowLC.findIndex(name => name === geometryNameLC);\n    if (forceGeometry || xNameIndex < 0 || yNameIndex < 0 || xNameIndex === yNameIndex) {\n        if (geometryNameIndex < 0) {\n            throw new Error(i18n.get('No geometry column(s) found'));\n        }\n    } else {\n        geometryNameIndex = -1;\n    }\n\n    let labelPrefix = options.labelPrefix.trim();\n    if (labelPrefix === '') {\n        labelPrefix = defaultCsvOptions.labelPrefix;\n    }\n\n    const wktFormat = new OlWktFormat();\n\n    const places: Place[] = [];\n    let rowIndex = 1;\n    for (; rowIndex < table.length; rowIndex++) {\n        const dataRow = table[rowIndex];\n        let geometry = null;\n        if (geometryNameIndex >= 0) {\n            const wkt = dataRow[geometryNameIndex];\n            if (typeof wkt === 'string') {\n                try {\n                    geometry = wktFormat.readGeometry(text);\n                } catch (e) {\n                    // will handle error below\n                }\n            }\n        } else {\n            const x = dataRow[xNameIndex];\n            const y = dataRow[yNameIndex];\n            if (typeof x === 'number' && Number.isFinite(x) && typeof y === 'number' && Number.isFinite(y)) {\n                geometry = new OlGeomPoint([x, y]);\n            }\n        }\n        if (geometry === null) {\n            throw new Error(i18n.get(`Invalid geometry in data row ${rowIndex}`));\n        }\n\n        const geoJsonProps: { [k: string]: number | string | boolean | null } = {color: 'red'};\n        dataRow.forEach((propertyValue, index) => {\n            if (index !== xNameIndex && index !== yNameIndex && index !== geometryNameIndex) {\n                const propertyName = headerRow[index];\n                geoJsonProps[propertyName] = propertyValue;\n            }\n        });\n\n        let label: string;\n        if (labelNameIndex >= 0) {\n            label = `${dataRow[labelNameIndex]}`;\n        } else {\n            const labelId = ++LAST_PLACE_LABEL_ID_CSV;\n            label = `${labelPrefix}${labelId}`;\n        }\n        geoJsonProps['label'] = label;\n\n        places.push(newGeoJsonFeature(geometry, geoJsonProps));\n    }\n\n    return places;\n}\n\nexport function getUserPlacesFromGeoJson(text: string, options: GeoJsonOptions): Place[] {\n    const labelNames = options.labelNames;\n    const labelNamesSet = new Set(\n        labelNames.split(',')\n            .map(name => name.trim().toLowerCase())\n            .filter(name => name !== '')\n    )\n    let labelPrefix = options.labelPrefix.trim();\n    if (labelPrefix === '') {\n        labelPrefix = defaultGeoJsonOptions.labelPrefix;\n    }\n\n    const geoJsonFormat = new OlGeoJSONFormat();\n\n    let features: OlFeature[];\n    try {\n        features = geoJsonFormat.readFeatures(text);\n    } catch (e) {\n        try {\n            const geometry = geoJsonFormat.readGeometry(text);\n            features = [new OlFeature(geometry)];\n        } catch (e) {\n            throw new Error(i18n.get(`Invalid GeoJSON`));\n        }\n    }\n\n    const places: Place[] = [];\n    features.forEach(feature => {\n        const properties = feature.getProperties();\n        const geometry = feature.getGeometry();\n        if (geometry) {\n            let label = '';\n            const geoJsonProps: { [k: string]: number | string | boolean | null } = {color: 'red'};\n            if (properties) {\n                for (let propertyName in properties) {\n                    const propertyValue = properties[propertyName];\n                    if (propertyValue === null\n                        || typeof propertyValue === 'number'\n                        || typeof propertyValue === 'string'\n                        || typeof propertyValue === 'boolean') {\n                        geoJsonProps[propertyName] = propertyValue;\n                    }\n                    if (label === ''\n                        && typeof propertyValue === 'string'\n                        && labelNamesSet.has(propertyName.toLowerCase())) {\n                        label = propertyValue;\n                    }\n                }\n            }\n\n            if (label === '') {\n                const labelId = ++LAST_PLACE_LABEL_ID_GEOJSON;\n                label = `${labelPrefix}-${labelId}`;\n            }\n            geoJsonProps['label'] = label;\n\n            places.push(newGeoJsonFeature(geometry, geoJsonProps));\n        }\n    });\n\n    return places;\n}\n\nexport function getUserPlacesFromWkt(text: string, options: WktOptions): Place[] {\n    let labelPrefix = options.labelPrefix.trim();\n    if (labelPrefix === '') {\n        labelPrefix = defaultWktOptions.labelPrefix;\n    }\n    let label = options.label.trim();\n    if (label === '') {\n        const labelId = ++LAST_PLACE_LABEL_ID_WKT;\n        label = `${labelPrefix}${labelId}`;\n    }\n    try {\n        const geometry = new OlWktFormat().readGeometry(text);\n        return [newGeoJsonFeature(geometry, {label})];\n    } catch (e) {\n        throw new Error(i18n.get(`Invalid Geometry WKT`));\n    }\n}\n\nfunction newGeoJsonFeature(geometry: OlGeometry, properties: { [name: string]: any }): Place {\n    return {\n        type: 'Feature',\n        id: newId(),\n        geometry: new OlGeoJSONFormat().writeGeometryObject(geometry),\n        properties: properties,\n    };\n}\n\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { MapElement } from '../Map';\n\ninterface LayersProps {\n    children: MapElement[];\n}\n\nexport function Layers(props: LayersProps) {\n    return (<React.Fragment>{props.children}</React.Fragment>);\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport const GEOGRAPHIC_CRS = 'EPSG:4326';\nexport const WEB_MERCATOR_CRS = 'EPSG:3857';\n\nexport const DEFAULT_MAP_CRS = WEB_MERCATOR_CRS;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport {default as OlMap} from 'ol/Map';\nimport {default as OlBaseObject} from 'ol/Object';\nimport {default as OlMapBrowserEvent} from 'ol/MapBrowserEvent';\nimport {default as OlView} from 'ol/View';\nimport {default as OlEvent} from 'ol/events/Event';\nimport {EventsKey as OlEventsKey} from 'ol/events';\nimport {MapOptions as OlMapOptions} from 'ol/PluggableMap';\n\nimport 'ol/ol.css';\nimport './Map.css';\nimport {DEFAULT_MAP_CRS} from \"../../model/proj\";\n\nexport type MapElement = React.ReactElement | null | undefined;\n\nexport interface MapContext {\n    map?: OlMap;\n    mapDiv?: HTMLDivElement | null;\n    mapObjects: { [id: string]: OlBaseObject };\n}\n\nexport const MapContextType = React.createContext<MapContext>({mapObjects: {}});\n\ninterface MapProps extends OlMapOptions {\n    id: string;\n    children?: React.ReactNode;\n    mapObjects?: { [id: string]: OlBaseObject };\n    onClick?: (event: OlMapBrowserEvent) => void;\n    onMapRef?: (map: OlMap | null) => void;\n    isStale?: boolean;\n    onDropFiles?: (files: File[]) => any;\n}\n\ninterface MapState {\n}\n\nconst DEFAULT_CONTAINER_STYLE: React.CSSProperties = {width: '100%', height: '100%'};\n\nexport class Map extends React.Component<MapProps, MapState> {\n\n    private readonly contextValue: MapContext;\n    private clickEventsKey: OlEventsKey | null = null;\n\n    constructor(props: MapProps) {\n        super(props);\n        // console.log(\"Map.constructor: id =\", this.props.id);\n\n        const {id, mapObjects} = props;\n        if (mapObjects) {\n            this.contextValue = {\n                map: mapObjects[id] as OlMap || undefined,\n                mapObjects: mapObjects\n            };\n        } else {\n            this.contextValue = {\n                mapObjects: {}\n            };\n        }\n    }\n\n    componentDidMount(): void {\n        // console.log('Map.componentDidMount: id =', this.props.id);\n\n        const {id} = this.props;\n        const mapDiv = this.contextValue.mapDiv!;\n\n        let map: OlMap | null = null;\n        if (this.props.isStale) {\n            const mapObject = this.contextValue.mapObjects[id];\n            if (mapObject instanceof OlMap) {\n                map = mapObject;\n                map.setTarget(mapDiv);\n                if (this.clickEventsKey) {\n                    map.un('click', this.clickEventsKey.listener)\n                }\n            }\n        }\n\n        if (!map) {\n            const initialZoom = this.getMinZoom(mapDiv);\n            const view = new OlView({\n                projection: DEFAULT_MAP_CRS,\n                center: [0, 0],\n                minZoom: initialZoom,\n                zoom: initialZoom,\n            });\n            map = new OlMap({\n                view,\n                ...this.getMapOptions(),\n                target: mapDiv\n            });\n        }\n\n        this.contextValue.map = map;\n        this.contextValue.mapObjects[id] = map;\n\n        this.clickEventsKey = map.on('click', this.handleClick);\n\n        //map.set('objectId', this.props.id);\n        map.updateSize();\n\n        // Force update so we can pass this.map as context to all children in next render()\n        this.forceUpdate();\n\n        // Add resize listener, so we can adjust the view's minZoom.\n        // See https://openlayers.org/en/latest/examples/min-zoom.html\n        window.addEventListener('resize', this.handleResize);\n\n        const onMapRef = this.props.onMapRef;\n        if (onMapRef) {\n            onMapRef(map);\n        }\n    }\n\n    componentDidUpdate(prevProps: Readonly<MapProps>): void {\n        // console.log('Map.componentDidUpdate: id =', this.props.id);\n\n        const map = this.contextValue.map!;\n        const mapDiv = this.contextValue.mapDiv!;\n        const mapOptions = this.getMapOptions();\n        map.setProperties({...mapOptions});\n        map.setTarget(mapDiv);\n        // if (this.clickEventsKey) {\n        //     unByKey(this.clickEventsKey);\n        // }\n        // this.clickEventsKey = map.on('click', this.handleClick);\n        // console.log('Map: ', this.handleClick, this.clickEventsKey);\n        map.updateSize();\n    }\n\n    componentWillUnmount(): void {\n        // console.log('Map.componentWillUnmount: id =', this.props.id);\n\n        // Remove resize listeners\n        window.removeEventListener('resize', this.handleResize);\n\n        // if (this.clickEventsKey) {\n        //     unByKey(this.clickEventsKey);\n        // }\n\n        const onMapRef = this.props.onMapRef;\n        if (onMapRef) {\n            onMapRef(null);\n        }\n    }\n\n    render() {\n        let childrenWithContext;\n        if (this.contextValue.map) {\n            childrenWithContext = (\n                <MapContextType.Provider value={this.contextValue}>\n                    {this.props.children}\n                </MapContextType.Provider>\n            );\n        }\n        return (\n            <div\n                ref={this.handleRef}\n                style={DEFAULT_CONTAINER_STYLE}\n                onDragOver={this.handleDragOver}\n                onDrop={this.handleDrop}\n            >\n                {childrenWithContext}\n            </div>\n        );\n    }\n\n    private getMapOptions(): OlMapOptions {\n        const mapOptions = {...this.props};\n        delete mapOptions['children'];\n        delete mapOptions['onClick'];\n        delete mapOptions['onDropFiles'];\n        return mapOptions;\n    }\n\n    private handleClick = (event: OlEvent) => {\n        const onClick = this.props.onClick;\n        if (onClick) {\n            onClick(event as OlMapBrowserEvent);\n        }\n    };\n\n    private handleDrop = (event: React.DragEvent<HTMLDivElement>) => {\n        if (this.props.onDropFiles) {\n            event.preventDefault();\n\n            const files: File[] = [];\n            if (event.dataTransfer.items) {\n                for (let i = 0; i < event.dataTransfer.items.length; i++) {\n                    const item = event.dataTransfer.items[i];\n                    // If dropped items aren't files, reject them\n                    if (item.kind === 'file') {\n                        const file = item.getAsFile();\n                        if (file !== null) {\n                            files.push(file);\n                        }\n                    }\n                }\n            } else if (event.dataTransfer.files) {\n                for (let i = 0; i < event.dataTransfer.files.length; i++) {\n                    const file = event.dataTransfer.files[i];\n                    if (file !== null) {\n                        files.push(file);\n                    }\n                }\n            }\n            if (files.length) {\n                this.props.onDropFiles(files);\n            }\n        }\n    };\n\n    private handleDragOver = (event: React.DragEvent<HTMLDivElement>) => {\n        if (this.props.onDropFiles) {\n            event.preventDefault();\n        }\n    };\n\n    private readonly handleRef = (mapDiv: HTMLDivElement | null) => {\n        this.contextValue.mapDiv = mapDiv;\n    };\n\n    private handleResize = () => {\n        const mapDiv = this.contextValue.mapDiv;\n        const map = this.contextValue.map;\n        if (mapDiv && map) {\n            map.updateSize();\n            const view = map.getView();\n            const minZoom = this.getMinZoom(mapDiv);\n            if (minZoom !== view.getMinZoom()) {\n                view.setMinZoom(minZoom);\n            }\n        }\n    };\n\n    private getMinZoom = (target: HTMLDivElement) => {\n        // Adjust the view's minZoom so there is only one world,\n        // see https://openlayers.org/en/latest/examples/min-zoom.html\n        const size = target.clientWidth;\n        const minZoom = Math.LOG2E * Math.log(size / 256);\n        if (minZoom >= 0.0) {\n            return minZoom;\n        }\n        return 0;\n    };\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { default as OlBaseObject } from 'ol/Object';\nimport { default as OlMap } from 'ol/Map';\n\nimport { MapContext, MapContextType } from './Map';\n\n\nexport interface MapComponentProps {\n    id?: string;\n}\n\nexport abstract class MapComponent<T extends OlBaseObject, P extends MapComponentProps, S = {}> extends React.PureComponent<P, S> {\n    // noinspection JSUnusedGlobalSymbols\n    static contextType = MapContextType;\n    context: MapContext = {} as MapContext;\n    object: T | null = null;\n\n    abstract addMapObject(map: OlMap): T;\n\n    abstract updateMapObject(map: OlMap, object: T, prevProps: Readonly<P>): T;\n\n    abstract removeMapObject(map: OlMap, object: T): void;\n\n    getMapObject(id: string): OlBaseObject | null {\n        return (this.context.mapObjects && this.context.mapObjects[id]) || null;\n    }\n\n    getOptions(): any {\n        let options: any = {...this.props};\n        delete options.id;\n        return options;\n    }\n\n    componentDidMount(): void {\n        // console.log(\"MapComponent.componentDidMount: id =\", this.props.id);\n        this._updateMapObject(this.addMapObject(this.context.map!));\n    }\n\n    componentDidUpdate(prevProps: Readonly<P>): void {\n        // console.log(\"MapComponent.componentDidUpdate: id =\", this.props.id);\n        this._updateMapObject(this.updateMapObject(this.context.map!, this.object!, prevProps));\n    }\n\n    componentWillUnmount(): void {\n        // console.log(\"MapComponent.componentWillUnmount: id =\", this.props.id);\n        const map = this.context.map!;\n        this.removeMapObject(map, this.object!);\n        if (this.props.id) {\n            delete this.context.mapObjects![this.props.id!];\n        }\n        this.object = null;\n    }\n\n    private _updateMapObject(object: T) {\n        if (object != null && this.props.id) {\n            object.set(\"objectId\", this.props.id);\n            this.context.mapObjects![this.props.id!] = object;\n        }\n        this.object = object;\n    }\n\n    render(): React.ReactNode {\n        return null;\n    }\n}\n\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { default as OlMap } from 'ol/Map';\nimport { default as OlTileLayer } from 'ol/layer/Tile';\nimport { default as OlTileSource } from 'ol/source/Tile';\nimport { default as OlTileGrid } from 'ol/tilegrid/TileGrid';\nimport { default as OlUrlTileSource } from 'ol/source/UrlTile';\nimport { default as OlXYZSource } from 'ol/source/XYZ';\nimport { default as OlOSMSource } from 'ol/source/OSM';\nimport { Options as OlTileLayerOptions } from 'ol/layer/BaseTile';\n\nimport { MapComponent, MapComponentProps } from '../MapComponent';\n\nconst DEBUG = false;\n\nlet trace: (message?: string, ...optionalParams: any[]) => void;\nif (process.env.NODE_ENV === 'development' && DEBUG) {\n    trace = console.debug;\n} else {\n    trace = () => {};\n}\n\n// noinspection JSUnusedGlobalSymbols\nexport function NaturalEarth2(): JSX.Element {\n    return <Tile id={'NaturalEarth2'} source={NATURAL_EARTH_2_SOURCE}/>;\n}\n\n// noinspection JSUnusedGlobalSymbols\nexport function Bathymetry(): JSX.Element {\n    return <Tile id={'Bathymetry'} source={BATHYMETRY_SOURCE}/>;\n}\n\n// noinspection JSUnusedGlobalSymbols\nexport function OSM(): JSX.Element {\n    return <Tile id={'OSM'} source={OSM_SOURCE}/>;\n}\n\n// noinspection JSUnusedGlobalSymbols\nexport function OSMBlackAndWhite(): JSX.Element {\n    return <Tile id={'OSMBW'} source={OSM_BW_SOURCE}/>;\n}\n\n\ninterface TileProps extends MapComponentProps, OlTileLayerOptions {\n}\n\n\nexport class Tile extends MapComponent<OlTileLayer, TileProps> {\n\n    addMapObject(map: OlMap): OlTileLayer {\n        const layer = new OlTileLayer(this.props);\n        map.getLayers().push(layer);\n        return layer;\n    }\n\n    updateMapObject(map: OlMap, layer: OlTileLayer, prevProps: Readonly<TileProps>): OlTileLayer {\n        const oldSource: OlTileSource = layer.getSource();\n        const newSource: OlTileSource | undefined = this.props.source;\n        if (newSource && oldSource !== newSource) {\n            // We don't expect anything to change in a XYZ source\n            // but the tile URL and the new imageSmoothing property.\n            // Just setting source properties allows for\n            // smooth layer transitions.\n            // Replacing the entire source cause the layer\n            // to flicker in the map.\n            // See https://github.com/dcs4cop/xcube-viewer/issues/119\n            //\n            // If the tile source's URL changes, we just set the URL.\n            // Otherwise we replace the source.\n            // Since we cannot detect which single source properties\n            // have changed, we assume here that the URL, if changed, is the\n            // only changed property. This is not a valid assumption\n            // in the general case.\n            //\n            let replaceSource = true;\n            if (oldSource instanceof OlUrlTileSource && newSource instanceof OlUrlTileSource) {\n                const oldUrlTileSource: OlUrlTileSource = oldSource;\n                const newUrlTileSource: OlUrlTileSource = newSource;\n\n                const oldTileGrid = oldUrlTileSource.getTileGrid();\n                const newTileGrid = newUrlTileSource.getTileGrid();\n                if (equalTileGrids(oldTileGrid, newTileGrid)) {\n                    trace(\"--> Equal tile grids!\")\n                    const oldUrls = oldUrlTileSource.getUrls();\n                    const newUrls = newUrlTileSource.getUrls();\n                    if (oldUrls !== newUrls && newUrls && (oldUrls === null || oldUrls[0] !== newUrls[0])) {\n                        oldUrlTileSource.setUrls(newUrls!);\n                        replaceSource = false;\n                    }\n                    const oldTileLoadFunction = oldUrlTileSource.getTileLoadFunction();\n                    const newTileLoadFunction = newUrlTileSource.getTileLoadFunction();\n                    if (oldTileLoadFunction !== newTileLoadFunction) {\n                        oldUrlTileSource.setTileLoadFunction(newTileLoadFunction!);\n                        replaceSource = false;\n                    }\n                    const oldTileUrlFunction = oldUrlTileSource.getTileUrlFunction();\n                    const newTileUrlFunction = newUrlTileSource.getTileUrlFunction();\n                    if (oldTileUrlFunction !== newTileUrlFunction) {\n                        oldUrlTileSource.setTileUrlFunction(newTileUrlFunction!);\n                        replaceSource = false;\n                    }\n                } else {\n                    trace('--> Tile grids are not equal!');\n                }\n            }\n            const oldContextOptions = oldSource.getContextOptions()\n            const newContextOptions = newSource.getContextOptions()\n            const oldImageSmoothing = typeof oldContextOptions === 'object' ?\n                                      (oldContextOptions as { [key: string]: any }).imageSmoothing : true;\n            const newImageSmoothing = typeof newContextOptions === 'object' ?\n                                      (newContextOptions as { [key: string]: any }).imageSmoothing : true;\n            if (oldImageSmoothing !== newImageSmoothing) {\n                replaceSource = true;\n            }\n\n            if (replaceSource) {\n                // Replace the entire source and accept layer flickering.\n                layer.setSource(newSource);\n                trace(\"--> Replaced source (expect flickering!)\")\n            } else {\n                trace(\"--> Updated source (check, is it still flickering?)\")\n            }\n        }\n\n        // TODO: Code duplication in ./Vector.tsx\n        if (this.props.visible && this.props.visible !== prevProps.visible) {\n            layer.setVisible(this.props.visible);\n        }\n        if (this.props.opacity && this.props.opacity !== prevProps.opacity) {\n            layer.setOpacity(this.props.opacity);\n        }\n        if (this.props.zIndex && this.props.zIndex !== prevProps.zIndex) {\n            layer.setZIndex(this.props.zIndex);\n        }\n        if (this.props.minResolution && this.props.minResolution !== prevProps.minResolution) {\n            layer.setMinResolution(this.props.minResolution);\n        }\n        if (this.props.maxResolution && this.props.maxResolution !== prevProps.maxResolution) {\n            layer.setMaxResolution(this.props.maxResolution);\n        }\n        // TODO: add more props here\n        return layer;\n    }\n\n    removeMapObject(map: OlMap, layer: OlTileLayer): void {\n        map.getLayers().remove(layer);\n    }\n}\n\nconst NATURAL_EARTH_2_SOURCE = new OlXYZSource(\n    {\n        url: 'https://a.tiles.mapbox.com/v3/mapbox.natural-earth-2/{z}/{x}/{y}.png',\n        attributions: [\n            '&copy; <a href=&quot;https://www.naturalearthdata.com/&quot;>MapBox</a>',\n            '&copy; <a href=&quot;https://www.mapbox.com/&quot;>MapBox</a> and contributors',\n        ],\n    });\n\nconst BATHYMETRY_SOURCE = new OlXYZSource(\n    {\n        url: 'https://gis.ngdc.noaa.gov/arcgis/rest/services/web_mercator/gebco_2014_contours/MapServer/tile/{z}/{y}/{x}',\n        attributions: [\n            '&copy; <a href=&quot;https://www.gebco.net/data_and_products/gridded_bathymetry_data/&quot;>GEBCO</a>',\n            '&copy; <a href=&quot;https://maps.ngdc.noaa.gov/&quot;>NOAHH</a> and contributors',\n        ]\n    });\n\nconst OSM_SOURCE = new OlOSMSource();\n\nconst OSM_BW_SOURCE = new OlXYZSource(\n    {\n        url: 'https://tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png',\n        attributions: [\n            '&copy; <a href=&quot;https://www.openstreetmap.org/copyright&quot;>OpenStreetMap</a> contributors',\n        ]\n    });\n\n\nfunction equalTileGrids(oldTileGrid: OlTileGrid, newTileGrid: OlTileGrid) {\n    trace('tile grid:', oldTileGrid, newTileGrid);\n    // Check min/max zoom level\n    trace('min zoom:', oldTileGrid.getMinZoom(), newTileGrid.getMinZoom());\n    trace('max zoom:', oldTileGrid.getMaxZoom(), newTileGrid.getMaxZoom());\n    if (oldTileGrid.getMinZoom() !== newTileGrid.getMinZoom()\n        || oldTileGrid.getMaxZoom() !== newTileGrid.getMaxZoom()) {\n        return false;\n    }\n\n    // Check extents\n    const oldExtent = oldTileGrid.getExtent();\n    const newExtent = newTileGrid.getExtent();\n    trace('extent:', oldExtent, newExtent);\n    for (let i = 0; i < oldExtent.length; i++) {\n        if (oldExtent[i] !== newExtent[i]) {\n            return false;\n        }\n    }\n\n    // Check number of z-levels\n    const oldResolutions = oldTileGrid.getResolutions();\n    const newResolutions = newTileGrid.getResolutions();\n    trace('resolutions:', oldResolutions, newResolutions);\n    const numLevels = oldResolutions.length;\n    if (numLevels !== newResolutions.length) {\n        return false;\n    }\n\n    // Check all z-level properties are equal\n    for (let z = 0; z < numLevels; z++) {\n        // Check resolution\n        const oldResolution = oldTileGrid.getResolution(z);\n        const newResolution = newTileGrid.getResolution(z);\n        trace(`resolution ${z}:`, oldResolution, newResolution);\n        if (oldResolution !== newResolution) {\n            return false;\n        }\n        // Check origin\n        const oldOrigin = oldTileGrid.getOrigin(z);\n        const newOrigin = newTileGrid.getOrigin(z);\n        trace(`origin ${z}:`, oldOrigin, newOrigin);\n        for (let i = 0; i < oldOrigin.length; i++) {\n            if (oldOrigin[i] !== newOrigin[i]) {\n                return false;\n            }\n        }\n        // Check tile size\n        let oldTileSize = oldTileGrid.getTileSize(z);\n        let newTileSize = newTileGrid.getTileSize(z);\n        trace(`tile size ${z}:`, oldTileSize, newTileSize);\n        for (let i = 0; i < oldOrigin.length; i++) {\n            if (typeof oldTileSize === 'number') {\n                oldTileSize = [oldTileSize, oldTileSize]\n            }\n            if (typeof newTileSize === 'number') {\n                newTileSize = [newTileSize, newTileSize]\n            }\n            if (oldTileSize[0] !== newTileSize[0]\n                || oldTileSize[1] !== newTileSize[1]) {\n                return false;\n            }\n        }\n        // Check tile range\n        let oldTileRange = oldTileGrid.getFullTileRange(z);\n        let newTileRange = newTileGrid.getFullTileRange(z);\n        trace(`tile range ${z}:`, oldTileRange, newTileRange);\n        if (oldTileRange && newTileRange) {\n            if (oldTileRange.getWidth() !== newTileRange.getWidth()\n                || oldTileRange.getHeight() !== newTileRange.getHeight()) {\n                return false;\n            }\n        } else if (!!oldTileRange || !!newTileRange) {\n            return false;\n        }\n    }\n    return true;\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { default as OlMap } from 'ol/Map';\nimport { default as OlVectorLayer } from 'ol/layer/Vector';\nimport { Options as OlVectorLayerOptions } from 'ol/layer/Vector';\n\nimport { MapComponent, MapComponentProps } from \"../MapComponent\";\n\n\ninterface VectorProps extends MapComponentProps, OlVectorLayerOptions {\n}\n\nexport class Vector extends MapComponent<OlVectorLayer, VectorProps> {\n    addMapObject(map: OlMap): OlVectorLayer {\n        const layer = new OlVectorLayer(this.props);\n        map.getLayers().push(layer);\n        return layer;\n    }\n\n    updateMapObject(map: OlMap, layer: OlVectorLayer, prevProps: Readonly<VectorProps>): OlVectorLayer {\n        // TODO: Code duplication in ./Tile.tsx\n        if (this.props.source !== prevProps.source && this.props.source) {\n            layer.setSource(this.props.source);\n        }\n        if (this.props.visible && this.props.visible !== prevProps.visible) {\n            layer.setVisible(this.props.visible);\n        }\n        if (this.props.opacity && this.props.opacity !== prevProps.opacity) {\n            layer.setOpacity(this.props.opacity);\n        }\n        if (this.props.zIndex && this.props.zIndex !== prevProps.zIndex) {\n            layer.setZIndex(this.props.zIndex);\n        }\n        if (this.props.minResolution && this.props.minResolution !== prevProps.minResolution) {\n            layer.setMinResolution(this.props.minResolution);\n        }\n        if (this.props.maxResolution && this.props.maxResolution !== prevProps.maxResolution) {\n            layer.setMaxResolution(this.props.maxResolution);\n        }\n        return layer;\n    }\n\n    removeMapObject(map: OlMap, layer: OlVectorLayer): void {\n        map.getLayers().remove(layer);\n    }\n}\n\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n/**\n * Find index into `array` so that `array[index]` is closest to `value`.\n * Uses a bi-section algorithm, so it should perform according to O(log2(N)).\n *\n * @param {number[]} array of monotonically increasing values\n * @param {number} value some value to find the index for\n * @returns {number} the integer index or -1 if the array is empty\n */\nexport function findIndexCloseTo(array: number[], value: number): number {\n    const n = array.length;\n    if (n === 0) {\n        return -1;\n    }\n    if (n === 1) {\n        return 0;\n    }\n    let i1 = 0, i3 = n - 1;\n    if (value <= array[i1]) {\n        return i1;\n    }\n    if (value >= array[i3]) {\n        return i3;\n    }\n    let i2 = Math.floor(n / 2), otherValue;\n    for (let i = 0; i < n; i++) {\n        otherValue = array[i2];\n        if (value < otherValue) {\n            [i2, i3] = [Math.floor((i1 + i2) / 2), i2];\n        } else if (value > otherValue) {\n            [i1, i2] = [i2, Math.floor((i2 + i3) / 2)];\n        } else {\n            return i2;\n        }\n        if (i1 === i2 || i2 === i3) {\n            return Math.abs(array[i1] - value) <= Math.abs(array[i3] - value) ? i1 : i3;\n        }\n    }\n    return -1;\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n// Thanks to alexurquhart, maps.json is content of https://github.com/alexurquhart/free-tiles/blob/master/tiles.json\n// Check http://alexurquhart.github.io/free-tiles/\nimport _maps from '../resources/maps.json';\n\nexport const maps = _maps as  MapGroup[];\n\nexport interface MapGroup {\n    name: string;\n    link: string;\n    datasets: MapSource[];\n    overlays: MapSource[];\n}\n\nexport interface MapSource {\n    name: string;\n    endpoint: string;\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { AppState } from \"../states/appState\";\nimport { createSelector } from \"reselect\";\nimport { Dataset } from \"../model/dataset\";\nimport { PlaceGroup } from \"../model/place\";\n\nexport const datasetsSelector = (state: AppState) => state.dataState.datasets || [];\nexport const colorBarsSelector = (state: AppState) => state.dataState.colorBars;\nexport const timeSeriesGroupsSelector = (state: AppState) => state.dataState.timeSeriesGroups;\nexport const userPlaceGroupSelector = (state: AppState) => state.dataState.userPlaceGroup;\nexport const userServersSelector = (state: AppState) => state.dataState.userServers || [];\n\nexport const placeGroupsSelector = createSelector(\n    datasetsSelector,\n    userPlaceGroupSelector,\n    (datasets: Dataset[], userPlaceGroup: PlaceGroup): PlaceGroup[] => {\n        const placeGroups: any = {};\n        const placeGroupsArray = [userPlaceGroup];\n        datasets.forEach(dataset => {\n            if (dataset.placeGroups) {\n                dataset.placeGroups.forEach(placeGroup => {\n                    if (!placeGroups[placeGroup.id]) {\n                        placeGroups[placeGroup.id] = placeGroup;\n                        placeGroupsArray.push(placeGroup);\n                    }\n\n                });\n            }\n        });\n        return placeGroupsArray;\n    }\n);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport interface NativeStorage {\n    getItem: (key: string) => string | null;\n    setItem: (key: string, value: string) => void;\n    removeItem: (key: string) => void;\n    clear: () => void;\n    length: number;\n}\n\nexport function getLocalStorage(brandingName: string): Storage | null {\n    return _getStorage('localStorage', brandingName);\n}\n\nexport function getSessionStorage(brandingName: string): Storage | null {\n    return _getStorage('sessionStorage', brandingName);\n}\n\nfunction _getStorage(type: 'localStorage' | 'sessionStorage', brandingName: string): Storage | null {\n    try {\n        const storage = window[type];\n        const x = '__storage_test__';\n        storage.setItem(x, x);\n        storage.removeItem(x);\n        return new Storage(storage as NativeStorage, brandingName);\n    } catch (e) {\n        return null;\n    }\n}\n\nexport class Storage {\n\n    private readonly nativeStorage: NativeStorage;\n    private readonly brandingName: string;\n\n    constructor(nativeStorage: NativeStorage, brandingName: string) {\n        this.nativeStorage = nativeStorage;\n        this.brandingName = brandingName;\n    }\n\n    getItem(propertyName: string, defaultValue?: any, parser?: (value: string) => any): any {\n        let value = this.nativeStorage.getItem(this.makeKey(propertyName));\n        if (value !== null) {\n            return parser ? parser(value) : value;\n        } else {\n            return defaultValue;\n        }\n    }\n\n    getObjectItem(propertyName: string, defaultValue?: any): any {\n        return this.getItem(propertyName, defaultValue, (value) => JSON.parse(value));\n    }\n\n    getBooleanProperty<T>(propertyName: keyof T, target: T, defaultObj: T) {\n        this.getProperty(propertyName, target, defaultObj, (value) => value === 'true');\n    }\n\n    getIntProperty(propertyName: string, target: any, defaultObj: any) {\n        this.getProperty(propertyName, target, defaultObj, parseInt);\n    }\n\n    getStringProperty<T>(propertyName: keyof T, target: T, defaultObj: T) {\n        this.getProperty(propertyName, target, defaultObj, (value) => value);\n    }\n\n    getObjectProperty<T>(propertyName: keyof T, target: T, defaultObj: T) {\n        this.getProperty(propertyName, target, defaultObj, (value) => JSON.parse(value));\n    }\n\n    private getProperty<T>(propertyName: keyof T,\n                        target: T,\n                        defaultObj: T,\n                        parser: (value: string) => any) {\n        target[propertyName] = this.getItem(propertyName as string, defaultObj[propertyName], parser);\n    }\n\n    setItem(propertyName: string, value: any, formatter?: (value: any) => string) {\n        if (typeof value === 'undefined' || value === null) {\n            this.nativeStorage.removeItem(this.makeKey(propertyName));\n        } else {\n            const formattedValue = formatter ? formatter(value) : value + '';\n            this.nativeStorage.setItem(this.makeKey(propertyName), formattedValue);\n        }\n    }\n\n    setObjectItem(propertyName: string, value: any) {\n        this.setItem(propertyName, value, (value) => JSON.stringify(value));\n    }\n\n    setPrimitiveProperty<T>(propertyName: keyof T, source: T) {\n        this.setItem(propertyName as string, source[propertyName]);\n    }\n\n    setObjectProperty<T>(propertyName: keyof T, source: T) {\n        this.setObjectItem(propertyName as string, source[propertyName]);\n    }\n\n    private makeKey(propertyName: string): string {\n        return `xcube.${this.brandingName}.${propertyName}`;\n    }\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Config } from '../config';\nimport { ApiServerConfig } from '../model/apiServer';\nimport { getLocalStorage } from '../util/storage';\nimport { ControlState } from './controlState';\n\nexport function storeUserServers(userServers: ApiServerConfig[]) {\n    const storage = getLocalStorage(Config.instance.name);\n    if (storage) {\n        try {\n            storage.setObjectItem('userServers', userServers);\n        } catch (e) {\n            console.warn(`failed to store user servers: ${e}`);\n        }\n    }\n}\n\nexport function loadUserServers(): ApiServerConfig[] {\n    const storage = getLocalStorage(Config.instance.name);\n    if (storage) {\n        try {\n            return storage.getObjectItem('userServers', []);\n        } catch (e) {\n            console.warn(`failed to load user servers: ${e}`);\n        }\n    }\n    return [];\n}\n\n\nexport function storeUserSettings(settings: ControlState) {\n    const storage = getLocalStorage(Config.instance.name);\n    if (storage) {\n        try {\n            storage.setPrimitiveProperty('locale', settings);\n            storage.setPrimitiveProperty('privacyNoticeAccepted', settings);\n            storage.setPrimitiveProperty('autoShowTimeSeries', settings);\n            storage.setPrimitiveProperty('showTimeSeriesErrorBars', settings);\n            storage.setPrimitiveProperty('showTimeSeriesPointsOnly', settings);\n            storage.setPrimitiveProperty('showTimeSeriesMedian', settings);\n            storage.setPrimitiveProperty('timeAnimationInterval', settings);\n            storage.setPrimitiveProperty('timeChunkSize', settings);\n            storage.setPrimitiveProperty('volumeCardOpen', settings);\n            storage.setPrimitiveProperty('volumeRenderMode', settings);\n            storage.setPrimitiveProperty('infoCardOpen', settings);\n            storage.setObjectProperty('infoCardElementStates', settings);\n            storage.setPrimitiveProperty('imageSmoothingEnabled', settings);\n            storage.setPrimitiveProperty('mapProjection', settings);\n            storage.setPrimitiveProperty('baseMapUrl', settings);\n            storage.setPrimitiveProperty('exportTimeSeries', settings);\n            storage.setPrimitiveProperty('exportTimeSeriesSeparator', settings);\n            storage.setPrimitiveProperty('exportPlaces', settings);\n            storage.setPrimitiveProperty('exportPlacesAsCollection', settings);\n            storage.setPrimitiveProperty('exportZipArchive', settings);\n            storage.setPrimitiveProperty('exportFileName', settings);\n            storage.setPrimitiveProperty('userPlacesFormatName', settings);\n            storage.setObjectProperty('userPlacesFormatOptions', settings);\n        } catch (e) {\n            console.warn(`failed to store user settings: ${e}`);\n        }\n    }\n}\n\nexport function loadUserSettings(defaultSettings: ControlState): ControlState {\n    const storage = getLocalStorage(Config.instance.name);\n    if (storage) {\n        const settings = {...defaultSettings};\n        try {\n            storage.getStringProperty('locale', settings, defaultSettings);\n            storage.getBooleanProperty('privacyNoticeAccepted', settings, defaultSettings);\n            storage.getBooleanProperty('autoShowTimeSeries', settings, defaultSettings);\n            storage.getBooleanProperty('showTimeSeriesErrorBars', settings, defaultSettings);\n            storage.getBooleanProperty('showTimeSeriesPointsOnly', settings, defaultSettings);\n            storage.getBooleanProperty('showTimeSeriesMedian', settings, defaultSettings);\n            storage.getIntProperty('timeAnimationInterval', settings, defaultSettings);\n            storage.getIntProperty('timeChunkSize', settings, defaultSettings);\n            storage.getBooleanProperty('volumeCardOpen', settings, defaultSettings);\n            storage.getStringProperty('volumeRenderMode', settings, defaultSettings);\n            storage.getBooleanProperty('infoCardOpen', settings, defaultSettings);\n            storage.getObjectProperty('infoCardElementStates', settings, defaultSettings);\n            storage.getBooleanProperty('imageSmoothingEnabled', settings, defaultSettings);\n            storage.getStringProperty('mapProjection', settings, defaultSettings);\n            storage.getStringProperty('baseMapUrl', settings, defaultSettings);\n            storage.getBooleanProperty('exportTimeSeries', settings, defaultSettings);\n            storage.getStringProperty('exportTimeSeriesSeparator', settings, defaultSettings);\n            storage.getBooleanProperty('exportPlaces', settings, defaultSettings);\n            storage.getBooleanProperty('exportPlacesAsCollection', settings, defaultSettings);\n            storage.getBooleanProperty('exportZipArchive', settings, defaultSettings);\n            storage.getStringProperty('exportFileName', settings, defaultSettings);\n            storage.getStringProperty('userPlacesFormatName', settings, defaultSettings);\n            storage.getObjectProperty('userPlacesFormatOptions', settings, defaultSettings);\n            if (process.env.NODE_ENV === 'development') {\n                console.debug('Loaded user settings:', settings);\n            }\n        } catch (e) {\n            console.warn(`Failed to load user settings: ${e}`);\n        }\n        return settings;\n    } else {\n        console.warn('User settings not found or access denied');\n    }\n    return defaultSettings;\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Extent as OlExtent } from 'ol/extent';\nimport { Geometry as OlGeometry } from 'ol/geom';\nimport { default as OlBaseObject } from 'ol/Object';\nimport { Config } from '../config';\n\nimport { Time, TimeRange } from '../model/timeSeries';\nimport { loadUserSettings } from './userSettings';\nimport { DEFAULT_MAP_CRS } from \"../model/proj\";\nimport { CsvOptions, defaultCsvOptions } from \"../model/user-place/csv\";\nimport { GeoJsonOptions, defaultGeoJsonOptions } from \"../model/user-place/geojson\";\nimport { WktOptions, defaultWktOptions } from \"../model/user-place/wkt\";\n\n\nexport type TimeAnimationInterval = 250 | 500 | 1000 | 2500;\nexport const TIME_ANIMATION_INTERVALS: TimeAnimationInterval[] = [250, 500, 1000, 2500];\n\nexport type MapInteraction = 'Select' | 'Point' | 'Polygon' | 'Circle' | 'Geometry';\n\nexport type ViewMode = 'text' | 'list' | 'code' | 'python';\n\n\nexport interface InfoCardElementState {\n    visible?: boolean;\n    viewMode?: ViewMode;\n}\n\nexport interface InfoCardElementStates {\n    [key: string]: InfoCardElementState;\n}\n\nexport type UserPlacesFormatName = 'geojson' | 'csv' | 'wkt';\n\nexport interface UserPlacesFormatOptions {\n    csv: CsvOptions;\n    geojson: GeoJsonOptions;\n    wkt: WktOptions;\n}\n\nexport interface ExportSettings {\n    format: \"GeoJSON\" | \"CSV\";\n    multiFile: boolean;\n    zipArchive: boolean;\n}\n\nexport type VolumeRenderMode = 'mip' | 'aip' | 'iso';\nexport type VolumeStatus = 'loading' | 'ok' | 'error';\nexport type VolumeState = { status: VolumeStatus; message?: string; };\nexport type VolumeStates = { [volumeId: string]: VolumeState };\n\nexport interface ControlState {\n    selectedDatasetId: string | null;\n    selectedVariableName: string | null;\n    selectedPlaceGroupIds: string[] | null;\n    selectedPlaceId: string | null;\n    selectedUserPlaceId: string | null;\n    selectedServerId: string;\n    selectedTime: Time | null;\n    selectedTimeRange: TimeRange | null;\n    timeSeriesUpdateMode: 'add' | 'replace';\n    timeAnimationActive: boolean;\n    timeAnimationInterval: TimeAnimationInterval;\n    timeChunkSize: number;\n    autoShowTimeSeries: boolean;\n    showTimeSeriesPointsOnly: boolean;\n    showTimeSeriesErrorBars: boolean;\n    showTimeSeriesMedian: boolean;\n    userPlacesFormatName: UserPlacesFormatName;\n    userPlacesFormatOptions: UserPlacesFormatOptions;\n    flyTo: OlGeometry | OlExtent | null;\n    activities: { [id: string]: string };\n    locale: string;\n    dialogOpen: { [dialogId: string]: boolean };\n    privacyNoticeAccepted: boolean;\n    mapInteraction: MapInteraction;\n    lastMapInteraction: MapInteraction;\n    volumeCardOpen: boolean;\n    volumeRenderMode: VolumeRenderMode;\n    volumeStates: VolumeStates;\n    infoCardOpen: boolean;\n    infoCardElementStates: InfoCardElementStates;\n    mapProjection: string;\n    imageSmoothingEnabled: boolean;\n    showDatasetBoundaries: boolean;\n    baseMapUrl: string;\n    showRgbLayer: boolean;\n    exportTimeSeries: boolean;\n    exportPlaces: boolean;\n    exportTimeSeriesSeparator: string;\n    exportPlacesAsCollection: boolean;\n    exportZipArchive: boolean;\n    exportFileName: string;\n}\n\n\nexport function newControlState(): ControlState {\n    const branding = Config.instance.branding;\n    const state: ControlState = {\n        selectedDatasetId: null,\n        selectedVariableName: null,\n        selectedPlaceGroupIds: ['user'],\n        selectedPlaceId: null,\n        selectedUserPlaceId: null,\n        selectedServerId: Config.instance.server.id,\n        selectedTime: null,\n        selectedTimeRange: null,\n        timeSeriesUpdateMode: 'add',\n        timeAnimationActive: false,\n        timeAnimationInterval: 1000,\n        timeChunkSize: 20,\n        autoShowTimeSeries: true,\n        showTimeSeriesPointsOnly: false,\n        showTimeSeriesErrorBars: true,\n        showTimeSeriesMedian: branding.defaultAgg === 'median',\n        userPlacesFormatName: 'csv',\n        userPlacesFormatOptions: {\n            geojson: {...defaultGeoJsonOptions},\n            csv: {...defaultCsvOptions},\n            wkt: {...defaultWktOptions},\n        },\n        flyTo: null,\n        activities: {},\n        locale: 'en',\n        dialogOpen: {},\n        privacyNoticeAccepted: false,\n        mapInteraction: 'Point',\n        lastMapInteraction: 'Point',\n        showRgbLayer: false,\n        volumeCardOpen: false,\n        volumeRenderMode: 'mip',\n        volumeStates: {},\n        infoCardOpen: false,\n        infoCardElementStates: {\n            dataset: {visible: true, viewMode: 'text'},\n            variable: {visible: true, viewMode: 'text'},\n            place: {visible: true, viewMode: 'text'},\n        },\n        mapProjection: branding.mapProjection || DEFAULT_MAP_CRS,\n        imageSmoothingEnabled: false,\n        showDatasetBoundaries: false,\n        baseMapUrl: branding.baseMapUrl || 'http://a.tile.osm.org/{z}/{x}/{y}.png',\n        exportTimeSeries: true,\n        exportTimeSeriesSeparator: 'TAB',\n        exportPlaces: true,\n        exportPlacesAsCollection: true,\n        exportZipArchive: true,\n        exportFileName: 'export',\n    };\n    return loadUserSettings(state);\n}\n\n// We cannot keep \"MAP_OBJECTS\" in control state object, because these objects are (1) not serializable\n// and (2) logging actions will cause the browsers to crash\n\nexport const MAP_OBJECTS: { [id: string]: OlBaseObject } = {};\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport bgImageData from \"./bg.png\";\n\n\nexport interface ColorBars {\n    groups: ColorBarGroup[];\n    images: { [name: string]: string };\n}\n\nexport interface ColorBarGroup {\n    title: string;\n    description: string;\n    names: string[];\n}\n\nexport const CB_ALPHA_SUFFIX = '_alpha';\nexport const CB_REVERSE_SUFFIX = '_r';\n\n\nconst BG_IMAGE = new Image();\nBG_IMAGE.src = bgImageData;\n\n\nexport interface ColorBar {\n    baseName: string;\n    isAlpha: boolean;\n    isReversed: boolean;\n    // https://stackoverflow.com/questions/13416800/how-to-generate-an-image-from-imagedata-in-javascript\n    imageData: string | null;\n}\n\nexport function parseColorBar(name: string, colorBars: ColorBars | null): ColorBar {\n    let baseName = name;\n\n    const isAlpha = baseName.endsWith(CB_ALPHA_SUFFIX);\n    if (isAlpha) {\n        baseName = baseName.slice(0, baseName.length - CB_ALPHA_SUFFIX.length);\n    }\n\n    const isReversed = baseName.endsWith(CB_REVERSE_SUFFIX);\n    if (isReversed) {\n        baseName = baseName.slice(0, baseName.length - CB_REVERSE_SUFFIX.length);\n    }\n\n    const imageData = (colorBars && colorBars.images[baseName]) || null;\n\n    return {baseName, isAlpha, isReversed, imageData};\n}\n\nexport function formatColorBar(colorBar: ColorBar): string {\n    let name = colorBar.baseName;\n    if (colorBar.isReversed) {\n        name += CB_REVERSE_SUFFIX;\n    }\n    if (colorBar.isAlpha) {\n        name += CB_ALPHA_SUFFIX;\n    }\n    return name;\n}\n\nexport function renderColorBar(colorBar: ColorBar,\n                               opacity: number,\n                               canvas: HTMLCanvasElement) {\n    loadColorBarImageData(colorBar, opacity).then(imageData => {\n        // We must resolve in case ImageBitmap is already resolved\n        Promise.resolve(\n            createImageBitmap(imageData)\n        ).then(imageBitmap => {\n            const ctx = canvas.getContext(\"2d\");\n            if (ctx !== null) {\n                const pattern = ctx.createPattern(BG_IMAGE, \"repeat\");\n                if (pattern !== null) {\n                    ctx.fillStyle = pattern;\n                } else {\n                    ctx.fillStyle = \"#ffffff\";\n                }\n                ctx.fillRect(\n                    0, 0,\n                    canvas.width, canvas.height\n                );\n                ctx.drawImage(\n                    imageBitmap,\n                    0, 0,\n                    canvas.width, canvas.height\n                );\n            }\n        });\n    });\n}\n\nexport function loadColorBarImage(colorBar: ColorBar, image?: HTMLImageElement): Promise<HTMLImageElement> {\n    return new Promise<HTMLImageElement>(\n        (resolve: (value?: HTMLImageElement | PromiseLike<HTMLImageElement>) => void, reject: (reason?: any) => void) => {\n            image = image || new Image();\n            image.onload = () => {\n                resolve(image);\n            };\n            image.src = `data:image/png;base64,${colorBar.imageData}`;\n        }\n    );\n}\n\nexport function loadColorBarImageData(colorBar: ColorBar, opacity: number): Promise<ImageData> {\n    return loadColorBarImage(colorBar).then(image => {\n        const imageData = getColorBarImageData(colorBar, opacity, image);\n        if (imageData !== null) {\n            return imageData;\n        } else {\n            throw new Error(\"failed to retrieve 2d context\");\n        }\n    });\n}\n\nfunction getColorBarImageData(colorBar: ColorBar,\n                              opacity: number,\n                              image: HTMLImageElement): ImageData | null {\n    const offscreenCanvas = document.createElement('canvas');\n    offscreenCanvas.width = image.width;\n    offscreenCanvas.height = image.height;\n    const ctx = offscreenCanvas.getContext(\"2d\");\n    if (ctx === null) {\n        return null;\n    }\n    ctx.drawImage(image, 0, 0);\n    const imageData = ctx.getImageData(\n        0, 0,\n        offscreenCanvas.width,\n        offscreenCanvas.height\n    );\n\n    let rgbaArray = imageData.data;\n\n    if (colorBar.isReversed) {\n        const reversedRgbaArray = new Uint8ClampedArray(rgbaArray.length);\n        for (let i = 0; i < rgbaArray.length; i += 4) {\n            const j = rgbaArray.length - i - 4;\n            reversedRgbaArray[j] = rgbaArray[i];\n            reversedRgbaArray[j + 1] = rgbaArray[i + 1];\n            reversedRgbaArray[j + 2] = rgbaArray[i + 2];\n            reversedRgbaArray[j + 3] = rgbaArray[i + 3];\n        }\n        rgbaArray = reversedRgbaArray;\n    }\n\n    if (colorBar.isAlpha) {\n        const factor = 256 * 2 / rgbaArray.length;\n        for (let i = 0; i < rgbaArray.length / 2; i += 4) {\n            rgbaArray[i + 3] = factor * i;\n        }\n    }\n\n    if (opacity < 1.0) {\n        for (let i = 0; i < rgbaArray.length; i += 4) {\n            rgbaArray[i + 3] *= opacity;\n        }\n    }\n\n    return new ImageData(rgbaArray, rgbaArray.length / 4, 1);\n}\n\n\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURcDAwP///ytph7QAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAUSURBVBjTYwABQSCglEENMxgYGAAynwRB8BEAgQAAAABJRU5ErkJggg==\"","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { createSelector } from 'reselect'\nimport { default as OlMap } from 'ol/map';\nimport { default as OlGeoJSONFormat } from 'ol/format/GeoJSON';\nimport { default as OlVectorSource } from 'ol/source/Vector';\nimport { default as OlXYZSource } from 'ol/source/XYZ';\nimport { default as OlCircle } from 'ol/style/Circle';\nimport { default as OlFillStyle } from 'ol/style/Fill';\nimport { default as OlStrokeStyle } from 'ol/style/Stroke';\nimport { default as OlStyle } from 'ol/style/Style';\nimport { default as OlTileGrid } from 'ol/tilegrid/TileGrid';\nimport { Layers } from '../components/ol/layer/Layers';\nimport { Tile } from '../components/ol/layer/Tile';\nimport { Vector } from '../components/ol/layer/Vector';\nimport { MapElement } from '../components/ol/Map';\nimport memoize from 'fast-memoize';\nimport { Config, getTileAccess } from '../config';\nimport { ApiServerConfig } from '../model/apiServer';\n\nimport {\n    Dataset,\n    findDataset,\n    findDatasetVariable,\n    getDatasetTimeDimension,\n    getDatasetTimeRange,\n    RgbSchema,\n    TimeDimension\n} from '../model/dataset';\nimport {\n    findPlaceInfo,\n    forEachPlace,\n    getPlaceInfo,\n    isValidPlaceGroup,\n    Place,\n    PlaceGroup,\n    PlaceInfo,\n} from '../model/place';\nimport { Time, TimeRange, TimeSeriesGroup } from '../model/timeSeries';\nimport { Variable } from '../model/variable';\n\nimport { AppState } from '../states/appState';\nimport { findIndexCloseTo } from '../util/find';\nimport { MapGroup, maps, MapSource } from '../util/maps';\nimport {\n    colorBarsSelector,\n    datasetsSelector,\n    timeSeriesGroupsSelector,\n    userPlaceGroupSelector,\n    userServersSelector\n} from './dataSelectors';\nimport { makeRequestUrl } from '../api/callApi';\nimport { MAP_OBJECTS } from '../states/controlState';\nimport { GEOGRAPHIC_CRS, WEB_MERCATOR_CRS } from '../model/proj';\nimport { ColorBar, ColorBars, parseColorBar } from '../model/colorBar';\n\nexport const selectedDatasetIdSelector = (state: AppState) => state.controlState.selectedDatasetId;\nexport const selectedVariableNameSelector = (state: AppState) => state.controlState.selectedVariableName;\nexport const selectedPlaceGroupIdsSelector = (state: AppState) => state.controlState.selectedPlaceGroupIds;\nexport const selectedPlaceIdSelector = (state: AppState) => state.controlState.selectedPlaceId;\nexport const selectedTimeSelector = (state: AppState) => state.controlState.selectedTime;\nexport const selectedServerIdSelector = (state: AppState) => state.controlState.selectedServerId;\nexport const activitiesSelector = (state: AppState) => state.controlState.activities;\nexport const timeAnimationActiveSelector = (state: AppState) => state.controlState.timeAnimationActive;\nexport const imageSmoothingSelector = (state: AppState) => state.controlState.imageSmoothingEnabled;\nexport const baseMapUrlSelector = (state: AppState) => state.controlState.baseMapUrl;\nexport const showRgbLayerSelector = (state: AppState) => state.controlState.showRgbLayer;\nexport const infoCardElementStatesSelector = (state: AppState) => state.controlState.infoCardElementStates;\nexport const mapProjectionSelector = (state: AppState) => state.controlState.mapProjection;\nexport const timeChunkSizeSelector = (state: AppState) => state.controlState.timeChunkSize;\nexport const showDatasetBoundariesSelector = (state: AppState) => state.controlState.showDatasetBoundaries;\nexport const userPlacesFormatNameSelector = (state: AppState) => state.controlState.userPlacesFormatName;\nexport const userPlacesFormatOptionsCsvSelector = (state: AppState) => state.controlState.userPlacesFormatOptions.csv;\nexport const userPlacesFormatOptionsGeoJsonSelector = (state: AppState) => state.controlState.userPlacesFormatOptions.geojson;\nexport const userPlacesFormatOptionsWktSelector = (state: AppState) => state.controlState.userPlacesFormatOptions.wkt;\n\n\nexport const selectedDatasetSelector = createSelector(\n    datasetsSelector,\n    selectedDatasetIdSelector,\n    findDataset\n);\n\nexport const selectedDatasetVariablesSelector = createSelector(\n    selectedDatasetSelector,\n    (dataset: Dataset | null): Variable[] => {\n        return (dataset && dataset.variables) || [];\n    }\n);\n\nexport const selectedVariableSelector = createSelector(\n    selectedDatasetSelector,\n    selectedVariableNameSelector,\n    (dataset: Dataset | null, varName: string | null): Variable | null => {\n        if (!dataset || !varName) {\n            return null;\n        }\n        return dataset.variables.find(v => v.name === varName) || null;\n    }\n);\n\nexport const selectedVariableUnitsSelector = createSelector(\n    selectedVariableSelector,\n    (variable: Variable | null): string => {\n        return (variable && variable.units) || '-';\n    }\n);\n\nexport const selectedVariableColorBarMinMaxSelector = createSelector(\n    selectedVariableSelector,\n    (variable: Variable | null): [number, number] => {\n        return variable ? [variable.colorBarMin, variable.colorBarMax] : [0, 1];\n    }\n);\n\nexport const selectedVariableColorBarNameSelector = createSelector(\n    selectedVariableSelector,\n    (variable: Variable | null): string => {\n        return (variable && variable.colorBarName) || 'viridis';\n    }\n);\n\nexport const selectedVariableColorBarSelector = createSelector(\n    selectedVariableColorBarNameSelector,\n    colorBarsSelector,\n    (colorBarName: string, colorBars: ColorBars | null): ColorBar => {\n        return parseColorBar(colorBarName, colorBars);\n    }\n);\n\nexport const selectedVariableOpacitySelector = createSelector(\n    selectedVariableSelector,\n    (variable: Variable | null): number => {\n        if (!variable || typeof variable.opacity != 'number') {\n            return 1;\n        }\n        return variable.opacity;\n    }\n);\n\nexport const selectedDatasetTimeRangeSelector = createSelector(\n    selectedDatasetSelector,\n    (dataset: Dataset | null): TimeRange | null => {\n        return dataset !== null ? getDatasetTimeRange(dataset) : null;\n    }\n);\n\nexport const selectedDatasetRgbSchemaSelector = createSelector(\n    selectedDatasetSelector,\n    (dataset: Dataset | null): RgbSchema | null => {\n        return dataset !== null ? (dataset.rgbSchema || null) : null;\n    }\n);\n\nexport const selectedDatasetPlaceGroupsSelector = createSelector(\n    selectedDatasetSelector,\n    (dataset: Dataset | null): PlaceGroup[] => {\n        return (dataset && dataset.placeGroups) || [];\n    }\n);\n\nexport const placeGroupsSelector = createSelector(\n    selectedDatasetPlaceGroupsSelector,\n    userPlaceGroupSelector,\n    (placeGroups: PlaceGroup[], userPlaceGroup: PlaceGroup): PlaceGroup[] => {\n        if (!userPlaceGroup.features || userPlaceGroup.features.length === 0) {\n            return placeGroups;\n        }\n        return placeGroups.concat([userPlaceGroup]);\n    }\n);\n\nfunction selectPlaceGroups(placeGroups: PlaceGroup[],\n                           placeGroupIds: string[] | null): PlaceGroup[] {\n    const selectedPlaceGroups: PlaceGroup[] = [];\n    if (placeGroupIds !== null && placeGroupIds.length > 0) {\n        placeGroups.forEach(placeGroup => {\n            if (placeGroupIds.indexOf(placeGroup.id) > -1) {\n                selectedPlaceGroups.push(placeGroup);\n            }\n        });\n    }\n    return selectedPlaceGroups;\n}\n\nexport const selectedDatasetSelectedPlaceGroupsSelector = createSelector(\n    selectedDatasetPlaceGroupsSelector,\n    selectedPlaceGroupIdsSelector,\n    selectPlaceGroups\n);\n\nexport const selectedPlaceGroupsSelector = createSelector(\n    placeGroupsSelector,\n    selectedPlaceGroupIdsSelector,\n    selectPlaceGroups\n);\n\nexport const selectedPlaceGroupsTitleSelector = createSelector(\n    selectedPlaceGroupsSelector,\n    (placeGroups: PlaceGroup[]): string => {\n        return placeGroups.map(placeGroup => placeGroup.title || placeGroup.id).join(', ');\n    }\n);\n\nexport const selectedPlaceGroupPlacesSelector = createSelector(\n    selectedPlaceGroupsSelector,\n    (placeGroups: PlaceGroup[]): Place[] => {\n        const args = placeGroups.map(placeGroup => (isValidPlaceGroup(placeGroup) ? placeGroup.features : []) as Place[]);\n        return ([] as Array<Place>).concat(...args);\n    }\n);\n\nexport const selectedPlaceSelector = createSelector(\n    selectedPlaceGroupPlacesSelector,\n    selectedPlaceIdSelector,\n    (places: Place[], placeId: string | null): Place | null => {\n        return places.find(place => place.id === placeId) || null;\n    }\n);\n\nexport const selectedPlaceInfoSelector = createSelector(\n    selectedPlaceGroupsSelector,\n    selectedPlaceIdSelector,\n    (placeGroups: PlaceGroup[], placeId: string | null): PlaceInfo | null => {\n        if (placeGroups.length === 0 || placeId === null) {\n            return null;\n        }\n        return findPlaceInfo(placeGroups, (placeGroup, place) => place.id === placeId);\n    }\n);\n\nexport const selectedVolumeIdSelector = createSelector(\n    selectedDatasetIdSelector,\n    selectedVariableNameSelector,\n    selectedPlaceSelector,\n    (datasetId: string | null, variableName: string | null, place: Place | null): string | null => {\n        if (datasetId && variableName) {\n            if (!place) {\n                return `${datasetId}-${variableName}-all`;\n            }\n            if (place.geometry.type === 'Polygon' || place.geometry.type === 'MultiPolygon') {\n                return `${datasetId}-${variableName}-${place.id}`;\n            }\n        }\n        return null;\n    }\n);\n\nexport const canAddTimeSeriesSelector = createSelector(\n    timeSeriesGroupsSelector,\n    selectedDatasetIdSelector,\n    selectedVariableNameSelector,\n    selectedPlaceIdSelector,\n    (timeSeriesGroups: TimeSeriesGroup[],\n     datasetId: string | null,\n     variableName: string | null,\n     placeId: string | null): boolean => {\n        if (!datasetId || !variableName || !placeId) {\n            return false;\n        }\n        for (let timeSeriesGroup of timeSeriesGroups) {\n            for (let timeSeries of timeSeriesGroup.timeSeriesArray) {\n                const source = timeSeries.source;\n                if (source.datasetId === datasetId\n                    && source.variableName === variableName\n                    && source.placeId === placeId) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n);\n\nexport const timeSeriesPlaceInfosSelector = createSelector(\n    timeSeriesGroupsSelector,\n    placeGroupsSelector,\n    (timeSeriesGroups: TimeSeriesGroup[], placeGroups: PlaceGroup[]): { [placeId: string]: PlaceInfo } => {\n        const placeInfos: any = {};\n        forEachPlace(placeGroups, (placeGroup, place) => {\n            for (let timeSeriesGroup of timeSeriesGroups) {\n                if (timeSeriesGroup.timeSeriesArray.find(ts => ts.source.placeId === place.id)) {\n                    placeInfos[place.id] = getPlaceInfo(placeGroup, place);\n                    break;\n                }\n            }\n        });\n        return placeInfos;\n    }\n);\n\n\nexport const selectedPlaceGroupPlaceLabelsSelector = createSelector(\n    selectedPlaceGroupsSelector,\n    (placeGroups: PlaceGroup[]): string[] => {\n        const placeLabels: string[] = [];\n        forEachPlace(placeGroups, (placeGroup, place) => {\n            placeLabels.push(getPlaceInfo(placeGroup, place).label);\n        });\n        return placeLabels;\n    }\n);\n\nexport const selectedDatasetVariableSelector = createSelector(\n    selectedDatasetSelector,\n    selectedVariableNameSelector,\n    (dataset: Dataset | null, variableName: string | null): Variable | null => {\n        return (dataset && findDatasetVariable(dataset, variableName)) || null;\n    }\n);\n\nexport const selectedTimeChunkSizeSelector = createSelector(\n    selectedDatasetVariableSelector,\n    timeChunkSizeSelector,\n    (variable: Variable | null, minTimeChunkSize): number => {\n        if (variable && variable.timeChunkSize) {\n            const varTimeChunkSize = variable.timeChunkSize;\n            return varTimeChunkSize * Math.ceil(minTimeChunkSize / varTimeChunkSize);\n        }\n        return minTimeChunkSize;\n    }\n);\n\nexport const selectedDatasetTimeDimensionSelector = createSelector(\n    selectedDatasetSelector,\n    (dataset: Dataset | null): TimeDimension | null => {\n        return (dataset && getDatasetTimeDimension(dataset)) || null;\n    }\n);\n\nexport const selectedDatasetAttributionsSelector = createSelector(\n    selectedDatasetSelector,\n    (dataset: Dataset | null): string[] | null => {\n        return (dataset && dataset.attributions) || null;\n    }\n);\n\nexport const timeCoordinatesSelector = createSelector(\n    selectedDatasetTimeDimensionSelector,\n    (timeDimension: TimeDimension | null): Time[] | null => {\n        if (timeDimension === null || timeDimension.coordinates.length === 0) {\n            return null;\n        }\n        return timeDimension.coordinates;\n    }\n);\n\nexport const selectedTimeIndexSelector = createSelector(\n    selectedTimeSelector,\n    timeCoordinatesSelector,\n    (time: Time | null, timeCoordinates: Time[] | null): number => {\n        if (time === null || timeCoordinates === null) {\n            return -1;\n        }\n        return findIndexCloseTo(timeCoordinates, time);\n    }\n);\n\nfunction getOlTileGrid(mapProjection: string,\n                       tileLevelMax: number | undefined) {\n    if (mapProjection !== WEB_MERCATOR_CRS) {\n        // If projection is not web mercator, it is geographical.\n        // We need to define the geographical tile grid used by xcube:\n        const numLevels = (typeof tileLevelMax === 'number') ? tileLevelMax + 1 : 20;\n        return new OlTileGrid({\n            tileSize: [256, 256],\n            origin: [-180, 90],\n            extent: [-180, -90, 180, 90],\n            // Note, although correct, setting minZoom\n            // will cause OpenLayers to crash:\n            // minZoom: tileLevelMin,\n            resolutions: Array.from(\n                {length: numLevels},\n                (_, i) => 180 / 256 / Math.pow(2, i)\n            )\n        });\n    }\n}\n\nfunction getOlXYZSource(url: string,\n                        mapProjection: string,\n                        tileGrid: undefined | OlTileGrid,\n                        attributions: string[] | null,\n                        timeAnimationActive: boolean,\n                        imageSmoothing: boolean,\n                        tileLoadFunction: any,\n                        tileLevelMin: number | undefined,\n                        tileLevelMax: number | undefined) {\n    return new OlXYZSource(\n        {\n            url,\n            projection: mapProjection,\n            tileGrid,\n            attributions: attributions || undefined,\n            transition: timeAnimationActive ? 0 : 250,\n            imageSmoothing: imageSmoothing,\n            tileLoadFunction,\n            // TODO (forman): if we provide minZoom, we also need to set\n            //   tileGrid.extent, otherwise way to many tiles are loaded from\n            //   level at minZoom when zooming out!\n            // minZoom: tileLevelMin,\n            maxZoom: tileLevelMax,\n        });\n}\n\n\nfunction __getLoadTileOnlyAfterMove(map: OlMap | undefined) {\n    if (map) {\n        // Define a special tileLoadFunction\n        // that prevents tiles from being loaded while the user\n        // pans or zooms, because this leads to high server loads.\n        return (tile: any, src: string) => {\n            if (map.getView().getInteracting()) {\n                map.once('moveend', function () {\n                    tile.getImage().src = src;\n                });\n            } else {\n                tile.getImage().src = src;\n            }\n        }\n    }\n}\n\nconst _getLoadTileOnlyAfterMove = memoize(__getLoadTileOnlyAfterMove, {\n    serializer: args => {\n        const map = args[0] as OlMap | undefined;\n        if (map) {\n            const target = map.getTarget();\n            if (typeof target === 'string') {\n                return target;\n            } else if (target) {\n                return target.id || 'map';\n            }\n            return 'map';\n        }\n        return '';\n    }\n});\n\nfunction getLoadTileOnlyAfterMove() {\n    const map = MAP_OBJECTS['map'] as OlMap | undefined;\n    return _getLoadTileOnlyAfterMove(map);\n}\n\n\nfunction getTileLayer(layerId: string,\n                      tileUrl: string,\n                      tileLevelMin: number | undefined,\n                      tileLevelMax: number | undefined,\n                      queryParams: Array<[string, string]>,\n                      opacity: number,\n                      timeDimension: TimeDimension | null,\n                      time: number | null,\n                      timeAnimationActive: boolean,\n                      mapProjection: string,\n                      attributions: string[] | null,\n                      imageSmoothing: boolean) {\n    if (time !== null) {\n        let timeString;\n        if (timeDimension) {\n            const timeIndex = findIndexCloseTo(timeDimension.coordinates, time);\n            if (timeIndex > -1) {\n                timeString = timeDimension.labels[timeIndex];\n                // console.log(\"adjusted time from\", new Date(time).toISOString(), \"to\", timeString);\n            }\n        }\n        if (!timeString) {\n            timeString = new Date(time).toISOString();\n        }\n        queryParams = [...queryParams, ['time', timeString]];\n    }\n\n    const url = makeRequestUrl(tileUrl, queryParams);\n\n    if (typeof tileLevelMax === 'number') {\n        // It is ok to have some extra zoom levels, so we can magnify pixels.\n        // Using more, artifacts will become visible.\n        tileLevelMax += 3;\n    }\n\n    const tileGrid = getOlTileGrid(mapProjection, tileLevelMax);\n    const source = getOlXYZSource(\n        url,\n        mapProjection,\n        tileGrid,\n        attributions,\n        timeAnimationActive,\n        imageSmoothing,\n        getLoadTileOnlyAfterMove(),\n        tileLevelMin,\n        tileLevelMax\n    );\n    // console.debug('source = ', source)\n\n    return (\n        <Tile\n            id={layerId}\n            source={source}\n            zIndex={10}\n            opacity={opacity}\n        />\n    );\n}\n\nexport const selectedDatasetBoundaryLayerSelector = createSelector(\n    selectedDatasetSelector,\n    mapProjectionSelector,\n    showDatasetBoundariesSelector,\n    (dataset: Dataset | null,\n     mapProjection: string,\n     showDatasetBoundaries: boolean\n    ): MapElement | null => {\n        if (!dataset || !showDatasetBoundaries) {\n            return null;\n        }\n\n        let geometry = dataset.geometry;\n        if (!geometry) {\n            if (dataset.bbox) {\n                const [x1, y1, x2, y2] = dataset.bbox;\n                geometry = {\n                    type: \"Polygon\",\n                    coordinates: [\n                        [\n                            [x1, y1],\n                            [x2, y1],\n                            [x2, y2],\n                            [x1, y2],\n                            [x1, y1],\n                        ],\n                    ]\n                }\n            } else {\n                console.warn(`Dataset ${dataset.id} has no bbox!`);\n                return null;\n            }\n        }\n\n        const source = new OlVectorSource({\n            features: new OlGeoJSONFormat(\n                {\n                    dataProjection: GEOGRAPHIC_CRS,\n                    featureProjection: mapProjection\n                }\n            ).readFeatures({type: \"Feature\", geometry}),\n        });\n\n        const style = new OlStyle({\n            stroke: new OlStrokeStyle({\n                color: \"orange\",\n                width: 3,\n                lineDash: [2, 4],\n            }),\n        });\n\n        return (\n            <Vector\n                id={`${dataset.id}.bbox`}\n                source={source}\n                style={style}\n                zIndex={11}\n                opacity={0.5}\n            />\n        );\n    }\n);\n\nexport const selectedDatasetVariableLayerSelector = createSelector(\n    selectedDatasetVariableSelector,\n    selectedDatasetTimeDimensionSelector,\n    selectedTimeSelector,\n    timeAnimationActiveSelector,\n    mapProjectionSelector,\n    selectedVariableColorBarMinMaxSelector,\n    selectedVariableColorBarNameSelector,\n    selectedVariableOpacitySelector,\n    selectedDatasetAttributionsSelector,\n    imageSmoothingSelector,\n    (variable: Variable | null,\n     timeDimension: TimeDimension | null,\n     time: Time | null,\n     timeAnimationActive: boolean,\n     mapProjection: string,\n     colorBarMinMax: [number, number],\n     colorBarName: string,\n     opacity: number,\n     attributions: string[] | null,\n     imageSmoothing: boolean\n    ): MapElement => {\n        if (!variable) {\n            return null;\n        }\n        if (!variable.tileUrl) {\n            console.warn(`Variable ${variable.name} has no tileUrl!`);\n            return null;\n        }\n        const queryParams: Array<[string, string]> = [\n            ['crs', mapProjection],\n            ['vmin', `${colorBarMinMax[0]}`],\n            ['vmax', `${colorBarMinMax[1]}`],\n            ['cbar', colorBarName],\n            // ['retina', '1'],\n        ];\n        return getTileLayer(\n            'variable',\n            variable.tileUrl,\n            variable.tileLevelMin,\n            variable.tileLevelMax,\n            queryParams,\n            opacity,\n            timeDimension,\n            time,\n            timeAnimationActive,\n            mapProjection,\n            attributions,\n            imageSmoothing\n        );\n    }\n);\n\nexport const selectedDatasetRgbLayerSelector = createSelector(\n    showRgbLayerSelector,\n    selectedDatasetRgbSchemaSelector,\n    selectedVariableOpacitySelector,\n    selectedDatasetTimeDimensionSelector,\n    selectedTimeSelector,\n    timeAnimationActiveSelector,\n    mapProjectionSelector,\n    selectedDatasetAttributionsSelector,\n    imageSmoothingSelector,\n    (showRgbLayer: boolean,\n     rgbSchema: RgbSchema | null,\n     opacity: number,\n     timeDimension: TimeDimension | null,\n     time: Time | null,\n     timeAnimationActive: boolean,\n     mapProjection: string,\n     attributions: string[] | null,\n     imageSmoothing: boolean\n    ): MapElement => {\n        if (!showRgbLayer || !rgbSchema) {\n            return null;\n        }\n        const queryParams: Array<[string, string]> = [\n            ['crs', mapProjection],\n        ];\n        return getTileLayer('rgb',\n            rgbSchema.tileUrl,\n            rgbSchema.tileLevelMin,\n            rgbSchema.tileLevelMax,\n            queryParams,\n            opacity,\n            timeDimension,\n            time,\n            timeAnimationActive,\n            mapProjection,\n            attributions,\n            imageSmoothing);\n    }\n);\n\n\nexport function getDefaultFillOpacity() {\n    return Config.instance.branding.polygonFillOpacity || 0.25;\n}\n\nexport function getDefaultStyleImage() {\n    return new OlCircle({\n        fill: getDefaultFillStyle(),\n        stroke: getDefaultStrokeStyle(),\n        radius: 6\n    })\n}\n\nexport function getDefaultStrokeStyle() {\n    return new OlStrokeStyle({\n        color: [200, 0, 0, 0.75],\n        width: 1.25\n    });\n}\n\nexport function getDefaultFillStyle() {\n    return new OlFillStyle({\n        color: [255, 0, 0, getDefaultFillOpacity()]\n    });\n}\n\nexport function getDefaultPlaceGroupStyle() {\n    return new OlStyle({\n        image: getDefaultStyleImage(),\n        stroke: getDefaultStrokeStyle(),\n        fill: getDefaultFillStyle(),\n    });\n}\n\nexport const selectedDatasetPlaceGroupLayersSelector = createSelector(\n    selectedDatasetSelectedPlaceGroupsSelector,\n    mapProjectionSelector,\n    (placeGroups: PlaceGroup[], mapProjection: string): MapElement => {\n        if (placeGroups.length === 0) {\n            return null;\n        }\n        const layers: MapElement[] = [];\n        placeGroups.forEach((placeGroup, index) => {\n            if (isValidPlaceGroup(placeGroup)) {\n                layers.push(\n                    <Vector\n                        key={index}\n                        id={`placeGroup.${placeGroup.id}`}\n                        style={getDefaultPlaceGroupStyle()}\n                        zIndex={100}\n                        source={new OlVectorSource(\n                            {\n                                features: new OlGeoJSONFormat(\n                                    {\n                                        dataProjection: GEOGRAPHIC_CRS,\n                                        featureProjection: mapProjection\n                                    }\n                                ).readFeatures(placeGroup),\n                            })}\n                    />\n                );\n            }\n        });\n        return (<Layers>{layers}</Layers>);\n    }\n);\n\nexport const visibleInfoCardElementsSelector = createSelector(\n    infoCardElementStatesSelector,\n    (infoCardElementStates): string[] => {\n        const visibleInfoCardElements: string[] = [];\n        Object.getOwnPropertyNames(infoCardElementStates).forEach(e => {\n            if (!!infoCardElementStates[e].visible) {\n                visibleInfoCardElements.push(e);\n            }\n        });\n        return visibleInfoCardElements;\n    }\n);\n\nexport const infoCardElementViewModesSelector = createSelector(\n    infoCardElementStatesSelector,\n    (infoCardElementStates) => {\n        const infoCardElementCodeModes: { [elementType: string]: string } = {};\n        Object.getOwnPropertyNames(infoCardElementStates).forEach(e => {\n            infoCardElementCodeModes[e] = infoCardElementStates[e].viewMode || 'text';\n        });\n        return infoCardElementCodeModes;\n    }\n);\n\nexport const activityMessagesSelector = createSelector(\n    activitiesSelector,\n    (activities: { [id: string]: string }): string[] => {\n        return Object.keys(activities).map(k => activities[k]);\n    }\n);\n\nexport const selectedServerSelector = createSelector(\n    userServersSelector,\n    selectedServerIdSelector,\n    (userServers: ApiServerConfig[], serverId: string): ApiServerConfig => {\n        if (userServers.length === 0) {\n            throw new Error(`internal error: no servers configured`);\n        }\n        const server = userServers.find(server => server.id === serverId);\n        if (!server) {\n            throw new Error(`internal error: server with ID \"${serverId}\" not found`);\n        }\n        return server;\n    }\n);\n\nexport const baseMapLayerSelector = createSelector(\n    baseMapUrlSelector,\n    (baseMapUrl: string): JSX.Element | null => {\n        const map = findMap(baseMapUrl);\n        if (map) {\n            const access = getTileAccess(map.group.name);\n            const source = new OlXYZSource(\n                {\n                    url: map.dataset.endpoint + (access ? `?${access.param}=${access.token}` : ''),\n                    attributions: [\n                        `&copy; <a href=&quot;${map.group.link}&quot;>${map.group.name}</a>`,\n                    ]\n                });\n            return <Tile id={map.group.name + '-' + map.dataset.name} source={source} zIndex={0}/>;\n        }\n        if (baseMapUrl) {\n            const source = new OlXYZSource({url: baseMapUrl});\n            return <Tile id={baseMapUrl} source={source} zIndex={0}/>;\n        }\n        return null;\n    }\n);\n\nfunction findMap(endpoint: string): { group: MapGroup, dataset: MapSource } | null {\n    for (let group of maps) {\n        const dataset = group.datasets.find(dataset => dataset.endpoint === endpoint);\n        if (dataset) {\n            return {group, dataset};\n        }\n    }\n    return null;\n}","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport const LOCAL_OFFSET = -new Date(\"1970-01-01T00:00:00\").getTime();\n\nexport function dateTimeToUtcTime(dateTime: Date): number {\n    return dateTime.getTime();\n}\n\nexport function utcTimeToIsoDate(utcTime: number, local: boolean = false): Date {\n    return new Date(utcTime + (local ? LOCAL_OFFSET : 0));\n}\n\n\nexport function utcTimeToIsoDateString(utcTime: number, local: boolean = false) {\n    return utcTimeToIsoDate(utcTime, local)\n        .toISOString()\n        .substr(0, 10);\n}\n\nexport function utcTimeToIsoDateTimeString(utcTime: number, local: boolean = false, skipSeconds: boolean = false) {\n    return utcTimeToIsoDate(utcTime, local)\n        .toISOString()\n        .substr(0, skipSeconds ? 16 : 19)\n        .replace(\"T\", \" \");\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as geojson from 'geojson';\n\nimport { utcTimeToIsoDateTimeString } from '../util/time';\nimport { findPlaceInPlaceGroups, Place, PlaceGroup } from './place';\n\n\n/**\n * Time is an integer value that is the number of milliseconds since 1 January 1970 UTC (Unix Time Stamp).\n */\nexport type Time = number;\nexport type TimeRange = [Time, Time];\n\nexport const UNIT = {\n    seconds: 1000,\n    minutes: 1000 * 60,\n    hours: 1000 * 60 * 60,\n    days: 1000 * 60 * 60 * 24,\n    weeks: 1000 * 60 * 60 * 24 * 7,\n    years: 1000 * 60 * 60 * 24 * 365,\n};\n\nexport interface TimeSeriesSource {\n    datasetId: string;\n    variableName: string;\n    variableUnits?: string;\n    placeId: string;\n    geometry: geojson.Geometry;\n    valueDataKey: keyof TimeSeriesPoint;\n    errorDataKey: keyof TimeSeriesPoint | null;\n}\n\nexport interface TimeSeriesPoint {\n    time: Time;\n    countTot: number;\n    count?: number;\n    mean?: number | null;\n    median?: number | null;\n    std?: number | null;\n    min?: number | null;\n    max?: number | null;\n    standard_error?: number | null;\n}\n\nexport interface TimeSeries {\n    source: TimeSeriesSource;\n    data: TimeSeriesPoint[];\n    dataProgress?: number;\n}\n\nexport interface TimeSeriesGroup {\n    id: string;\n    variableUnits?: string;\n    timeSeriesArray: TimeSeries[];\n}\n\nexport function equalTimeRanges(t1: TimeRange | null, t2: TimeRange | null) {\n    if (t1 === t2) {\n        return true;\n    } else if (t1 !== null && t2 != null) {\n        return t1[0] === t2[0] && t1[1] === t2[1];\n    }\n    return false;\n}\n\ntype CellValue = number | string | null | undefined;\ntype DataRow = CellValue[];\ntype RowData = {\n    placeId: string;\n    time: string;\n    [colName: string]: CellValue;\n};\ntype TimePlaceRows = { [timePlaceId: string]: RowData };\n\nexport interface TimeSeriesTable {\n    colNames: string[];\n    dataRows: DataRow[];\n    referencedPlaces: {[placeId: string]: Place};\n}\n\nexport function timeSeriesGroupsToTable(timeSeriesGroups: TimeSeriesGroup[],\n                                        placeGroups: PlaceGroup[]): TimeSeriesTable {\n\n    const dataColNames = new Set<string>();\n    const placeIds = new Set<string>();\n    const timePlaceRows: TimePlaceRows = {};\n    for (let timeSeriesGroup of timeSeriesGroups) {\n        for (let timeSeries of timeSeriesGroup.timeSeriesArray) {\n            const {placeId, datasetId, variableName, valueDataKey, errorDataKey} = timeSeries.source;\n            placeIds.add(placeId);\n            const valueColName = `${datasetId}.${variableName}.${valueDataKey}`;\n            dataColNames.add(valueColName);\n            let errorColName: string | null = null;\n            if (Boolean(errorDataKey)) {\n                errorColName = `${datasetId}.${variableName}.${errorDataKey}`;\n                dataColNames.add(errorColName);\n            }\n            timeSeries.data.forEach(point => {\n                const time = utcTimeToIsoDateTimeString(point.time);\n                const timePlaceId = placeId + '-' + time;\n                const timePlaceRow = timePlaceRows[timePlaceId];\n                if (!timePlaceRow) {\n                    timePlaceRows[timePlaceId] = {placeId, time, [valueColName]: point[valueDataKey]};\n                } else {\n                    timePlaceRows[timePlaceId] = {...timePlaceRow, [valueColName]: point[valueDataKey]};\n                }\n                if (errorColName !== null) {\n                    timePlaceRows[timePlaceId][errorColName!] = point[errorDataKey!];\n                }\n            });\n        }\n\n    }\n\n    const colNames: string[] = ['placeId', 'time'].concat(Array.from(dataColNames).sort());\n    const dataRows: DataRow[] = [];\n\n    Object.keys(timePlaceRows).forEach(timePlaceId => {\n        const rowData = timePlaceRows[timePlaceId];\n        const dataRow = new Array<CellValue>(colNames.length);\n        colNames.forEach((colName, i) => {\n            dataRow[i] = rowData[colName];\n        })\n        dataRows.push(dataRow);\n    });\n\n    dataRows.sort((row1, row2) => {\n        const time1: string = row1[1] as string;\n        const time2: string = row2[1] as string;\n        const timeDelta = time1.localeCompare(time2);\n        if (timeDelta !== 0) {\n            return timeDelta;\n        }\n        const placeId1: string = row1[0] as string;\n        const placeId2: string = row2[0] as string;\n        return placeId1.localeCompare(placeId2);\n    });\n\n    const referencedPlaces: {[placeId: string]: Place} = {};\n    placeIds.forEach(placeId => {\n        referencedPlaces[placeId] = findPlaceInPlaceGroups(placeGroups, placeId)!;\n    })\n\n    return {colNames, dataRows, referencedPlaces};\n}\n\n\n\nexport function timeSeriesGroupsToGeoJSON(timeSeriesGroups: TimeSeriesGroup[]): geojson.FeatureCollection {\n    const features: geojson.Feature[] = [];\n    for (let timeSeriesGroup of timeSeriesGroups) {\n        for (let timeSeries of timeSeriesGroup.timeSeriesArray) {\n            features.push(timeSeriesToGeoJSON(timeSeries));\n        }\n    }\n    return {type: \"FeatureCollection\", features};\n}\n\n\nexport function timeSeriesToGeoJSON(timeSeries: TimeSeries): geojson.Feature {\n    return {\n        type: \"Feature\",\n        id: `${timeSeries.source.datasetId}-${timeSeries.source.variableName}-${timeSeries.source.placeId}`,\n        geometry: timeSeries.source.geometry,\n        properties: {\n            datasetId: timeSeries.source.datasetId,\n            variableName: timeSeries.source.variableName,\n            variableUnits: timeSeries.source.variableUnits,\n            placeId: timeSeries.source.placeId,\n            valueDataKey: timeSeries.source.valueDataKey,\n            errorDataKey: timeSeries.source.errorDataKey,\n            data: timeSeries.data.map(p => {\n                return {\n                    ...p,\n                    time: utcTimeToIsoDateTimeString(p.time)\n                };\n            })\n        }\n    };\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { MessageType } from '../states/messageLogState';\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const POST_MESSAGE = 'POST_MESSAGE';\n\nexport interface PostMessage {\n    type: typeof POST_MESSAGE;\n    messageType: MessageType;\n    messageText: string;\n}\n\nexport function postMessage(messageType: MessageType, messageText: string | Error): PostMessage {\n    return {type: POST_MESSAGE, messageType, messageText: (messageText as any).message || messageText + ''};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const HIDE_MESSAGE = 'HIDE_MESSAGE';\n\nexport interface HideMessage {\n    type: typeof HIDE_MESSAGE;\n    messageId: number;\n}\n\nexport function hideMessage(messageId: number): HideMessage {\n    return {type: HIDE_MESSAGE, messageId};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport type MessageLogAction = PostMessage | HideMessage;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Dispatch } from 'redux';\nimport * as geojson from 'geojson';\nimport JSZip from 'jszip';\n\nimport * as api from '../api'\nimport i18n from '../i18n';\nimport { ApiServerConfig, ApiServerInfo } from '../model/apiServer';\nimport { ColorBar, ColorBars } from '../model/colorBar';\nimport { Dataset } from '../model/dataset';\nimport {\n    findPlaceInPlaceGroups,\n    getUserPlacesFromCsv,\n    getUserPlacesFromGeoJson,\n    getUserPlacesFromWkt,\n    Place,\n    PlaceGroup\n} from '../model/place';\nimport { TimeSeries, TimeSeriesGroup, timeSeriesGroupsToTable } from '../model/timeSeries';\nimport {\n    mapProjectionSelector,\n    selectedDatasetIdSelector,\n    selectedDatasetTimeDimensionSelector,\n    selectedDatasetVariableSelector,\n    selectedPlaceGroupPlacesSelector,\n    selectedPlaceGroupsSelector,\n    selectedPlaceIdSelector,\n    selectedPlaceSelector,\n    selectedServerSelector,\n    selectedTimeChunkSizeSelector,\n    userPlacesFormatNameSelector,\n    userPlacesFormatOptionsCsvSelector,\n    userPlacesFormatOptionsGeoJsonSelector,\n    userPlacesFormatOptionsWktSelector\n} from '../selectors/controlSelectors';\nimport { datasetsSelector, placeGroupsSelector, userPlaceGroupSelector } from '../selectors/dataSelectors';\nimport { AppState } from '../states/appState';\nimport {\n    AddActivity,\n    addActivity,\n    openDialog,\n    OpenDialog,\n    RemoveActivity,\n    removeActivity,\n    SelectDataset,\n    selectDataset,\n    selectPlace,\n    SelectPlace,\n    selectPlaceGroups,\n    SelectPlaceGroups,\n    UpdateSettings,\n} from './controlActions';\nimport { VolumeRenderMode } from \"../states/controlState\";\nimport { MessageLogAction, PostMessage, postMessage } from './messageLogActions';\n\nconst saveAs = require('file-saver');\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_SERVER_INFO = 'UPDATE_SERVER_INFO';\n\nexport interface UpdateServerInfo {\n    type: typeof UPDATE_SERVER_INFO;\n    serverInfo: ApiServerInfo;\n}\n\nexport function updateServerInfo() {\n    return (dispatch: Dispatch<UpdateServerInfo | AddActivity | RemoveActivity | MessageLogAction>, getState: () => AppState) => {\n        const apiServer = selectedServerSelector(getState());\n\n        dispatch(addActivity(UPDATE_SERVER_INFO, i18n.get('Connecting to server')));\n\n        api.getServerInfo(apiServer.url)\n            .then((serverInfo: ApiServerInfo) => {\n                dispatch(_updateServerInfo(serverInfo));\n            })\n            .catch(error => {\n                dispatch(postMessage('error', error));\n            })\n            // 'then' because Microsoft Edge does not understand method finally\n            .then(() => {\n                dispatch(removeActivity(UPDATE_SERVER_INFO));\n            });\n    };\n}\n\nexport function _updateServerInfo(serverInfo: ApiServerInfo): UpdateServerInfo {\n    return {type: UPDATE_SERVER_INFO, serverInfo};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_RESOURCES = 'UPDATE_RESOURCES';\n\nexport function updateResources() {\n    return (dispatch: Dispatch<UpdateDatasets | SelectDataset | AddActivity | RemoveActivity | MessageLogAction>, getState: () => AppState) => {\n        const apiServer = selectedServerSelector(getState());\n        dispatch(addActivity(UPDATE_RESOURCES, i18n.get('Updating resources')));\n        api.updateResources(apiServer.url, getState().userAuthState.accessToken)\n            .then(ok => {\n                if (ok) {\n                    window.location.reload();\n                }\n            })\n            .finally(() =>\n                dispatch(removeActivity(UPDATE_RESOURCES))\n            );\n    }\n}\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_DATASETS = 'UPDATE_DATASETS';\n\nexport interface UpdateDatasets {\n    type: typeof UPDATE_DATASETS;\n    datasets: Dataset[];\n}\n\nexport function updateDatasets() {\n    return (dispatch: Dispatch<UpdateDatasets | SelectDataset | AddActivity | RemoveActivity | MessageLogAction>, getState: () => AppState) => {\n        const apiServer = selectedServerSelector(getState());\n\n        dispatch(addActivity(UPDATE_DATASETS, i18n.get('Loading data')));\n\n        api.getDatasets(apiServer.url, getState().userAuthState.accessToken)\n            .then((datasets: Dataset[]) => {\n                dispatch(_updateDatasets(datasets));\n                if (datasets.length > 0) {\n                    const selectedDatasetId = getState().controlState.selectedDatasetId || datasets[0].id;\n                    dispatch(selectDataset(selectedDatasetId, datasets, true) as any);\n                }\n            })\n            .catch(error => {\n                dispatch(postMessage('error', error));\n                dispatch(_updateDatasets([]));\n            })\n            // 'then' because Microsoft Edge does not understand method finally\n            .then(() => {\n                dispatch(removeActivity(UPDATE_DATASETS));\n            });\n    };\n}\n\nexport function _updateDatasets(datasets: Dataset[]): UpdateDatasets {\n    return {type: UPDATE_DATASETS, datasets};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_DATASET_PLACE_GROUP = 'UPDATE_DATASET_PLACE_GROUP';\n\nexport interface UpdateDatasetPlaceGroup {\n    type: typeof UPDATE_DATASET_PLACE_GROUP;\n    datasetId: string;\n    placeGroup: PlaceGroup;\n}\n\nexport function updateDatasetPlaceGroup(datasetId: string,\n                                        placeGroup: PlaceGroup): UpdateDatasetPlaceGroup {\n    return {type: UPDATE_DATASET_PLACE_GROUP, datasetId, placeGroup};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const ADD_USER_PLACE = 'ADD_USER_PLACE';\n\nexport interface AddUserPlace {\n    type: typeof ADD_USER_PLACE;\n    id: string;\n    label: string;\n    color: string;\n    geometry: geojson.Geometry;\n    selectPlace: boolean;\n}\n\nexport function addUserPlace(id: string,\n                             label: string,\n                             color: string,\n                             geometry: geojson.Geometry,\n                             selectPlace: boolean) {\n    return (dispatch: Dispatch<AddUserPlace>, getState: () => AppState) => {\n        dispatch(_addUserPlace(id, label, color, geometry, selectPlace));\n        if (getState().controlState.autoShowTimeSeries) {\n            dispatch(addTimeSeries() as any);\n        }\n    };\n}\n\nexport function _addUserPlace(id: string,\n                              label: string,\n                              color: string,\n                              geometry: geojson.Geometry,\n                              selectPlace: boolean): AddUserPlace {\n    return {type: ADD_USER_PLACE, id, label, color, geometry, selectPlace};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const ADD_USER_PLACES = 'ADD_USER_PLACES';\n\nexport interface AddUserPlaces {\n    type: typeof ADD_USER_PLACES;\n    places: Place[];\n    mapProjection: string;\n    selectPlace: boolean;\n}\n\nexport function addUserPlaces(places: Place[],\n                              mapProjection: string,\n                              selectPlace: boolean): AddUserPlaces {\n    return {\n        type: ADD_USER_PLACES,\n        places: places,\n        mapProjection,\n        selectPlace\n    };\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ntype UserPlacesDispatch = Dispatch<AddUserPlaces\n    | SelectPlaceGroups\n    | SelectPlace\n    | UpdateSettings\n    | OpenDialog\n    | PostMessage>;\n\n\nexport function addUserPlacesFromText(text: string) {\n    return (dispatch: UserPlacesDispatch, getState: () => AppState) => {\n        const formatName = userPlacesFormatNameSelector(getState());\n        let places: Place[];\n        try {\n            if (formatName === 'csv') {\n                const options = userPlacesFormatOptionsCsvSelector(getState());\n                places = getUserPlacesFromCsv(text, options);\n            } else if (formatName === 'geojson') {\n                const options = userPlacesFormatOptionsGeoJsonSelector(getState());\n                places = getUserPlacesFromGeoJson(text, options);\n            } else if (formatName === 'wkt') {\n                const options = userPlacesFormatOptionsWktSelector(getState());\n                places = getUserPlacesFromWkt(text, options);\n            } else {\n                places = [];\n            }\n        } catch (e) {\n            dispatch(postMessage('error', e));\n            dispatch(openDialog('addUserPlacesFromText'));\n            places = [];\n        }\n        if (places.length) {\n            dispatch(addUserPlaces(places, mapProjectionSelector(getState()), true));\n            dispatch(selectPlaceGroups(['user']) as any);\n            if (places.length === 1) {\n                dispatch(selectPlace(\n                    places[0].id,\n                    selectedPlaceGroupPlacesSelector(getState()),\n                    true\n                ) as any);\n                if (getState().controlState.autoShowTimeSeries) {\n                    dispatch(addTimeSeries() as any);\n                }\n            }\n            dispatch(postMessage('info', i18n.get(`Imported ${places.length} place(s)`)));\n        } else {\n            dispatch(postMessage('warning', i18n.get('No places imported')));\n        }\n    };\n}\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const REMOVE_USER_PLACE = 'REMOVE_USER_PLACE';\n\nexport interface RemoveUserPlace {\n    type: typeof REMOVE_USER_PLACE;\n    id: string;\n    places: Place[];\n}\n\nexport function removeUserPlace(id: string, places: Place[]): RemoveUserPlace {\n    return {type: REMOVE_USER_PLACE, id, places};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const REMOVE_ALL_USER_PLACES = 'REMOVE_ALL_USER_PLACES';\n\nexport interface RemoveAllUserPlaces {\n    type: typeof REMOVE_ALL_USER_PLACES;\n}\n\nexport function removeAllUserPlaces(): RemoveAllUserPlaces {\n    return {type: REMOVE_ALL_USER_PLACES};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport function addTimeSeries() {\n    return (dispatch: Dispatch<UpdateTimeSeries | MessageLogAction>, getState: () => AppState) => {\n        const apiServer = selectedServerSelector(getState());\n\n        const selectedDatasetId = selectedDatasetIdSelector(getState());\n        const selectedDatasetTimeDim = selectedDatasetTimeDimensionSelector(getState());\n        const selectedVariable = selectedDatasetVariableSelector(getState());\n        const selectedPlaceId = selectedPlaceIdSelector(getState());\n        const selectedPlace = selectedPlaceSelector(getState())!;\n        const timeSeriesUpdateMode = getState().controlState.timeSeriesUpdateMode;\n        const useMedian = getState().controlState.showTimeSeriesMedian;\n        const inclStDev = getState().controlState.showTimeSeriesErrorBars;\n        let timeChunkSize = selectedTimeChunkSizeSelector(getState());\n\n        const placeGroups = placeGroupsSelector(getState());\n\n        if (selectedDatasetId && selectedVariable && selectedPlaceId && selectedDatasetTimeDim) {\n            const timeLabels = selectedDatasetTimeDim.labels;\n            const numTimeLabels = timeLabels.length;\n\n            timeChunkSize = timeChunkSize > 0 ? timeChunkSize : numTimeLabels;\n\n            let endTimeIndex = numTimeLabels - 1;\n            let startTimeIndex = endTimeIndex - timeChunkSize + 1;\n\n            const getTimeSeriesChunk = () => {\n                const startDateLabel = startTimeIndex >= 0 ? timeLabels[startTimeIndex] : null;\n                const endDateLabel = timeLabels[endTimeIndex];\n                return api.getTimeSeriesForGeometry(apiServer.url,\n                    selectedDatasetId,\n                    selectedVariable,\n                    selectedPlace.id,\n                    selectedPlace.geometry,\n                    startDateLabel,\n                    endDateLabel,\n                    useMedian,\n                    inclStDev,\n                    getState().userAuthState.accessToken);\n            };\n\n            const successAction = (timeSeries: TimeSeries | null) => {\n                if (timeSeries !== null && isValidPlace(placeGroups, selectedPlace.id)) {\n                    const hasMore = startTimeIndex > 0;\n                    const dataProgress = hasMore ? (numTimeLabels - startTimeIndex) / numTimeLabels:1.0;\n                    dispatch(updateTimeSeries({...timeSeries, dataProgress},\n                        timeSeriesUpdateMode,\n                        endTimeIndex === numTimeLabels - 1 ? 'new':'append'));\n                    if (hasMore && isValidPlace(placeGroups, selectedPlace.id)) {\n                        startTimeIndex -= timeChunkSize;\n                        endTimeIndex -= timeChunkSize;\n                        getTimeSeriesChunk().then(successAction);\n                    }\n                } else {\n                    dispatch(postMessage('info', 'No data found here'));\n                }\n            };\n\n            getTimeSeriesChunk()\n                .then(successAction)\n                .catch((error: any) => {\n                    dispatch(postMessage('error', error));\n                });\n        }\n    };\n}\n\nfunction isValidPlace(placeGroups: PlaceGroup[], placeId: string) {\n    return findPlaceInPlaceGroups(placeGroups, placeId) !== null;\n}\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_TIME_SERIES = 'UPDATE_TIME_SERIES';\n\nexport interface UpdateTimeSeries {\n    type: typeof UPDATE_TIME_SERIES;\n    timeSeries: TimeSeries;\n    updateMode: 'add' | 'replace' | 'remove';\n    dataMode: 'new' | 'append';\n}\n\nexport function updateTimeSeries(timeSeries: TimeSeries, updateMode: 'add' | 'replace' | 'remove', dataMode: 'new' | 'append'): UpdateTimeSeries {\n    return {type: UPDATE_TIME_SERIES, timeSeries, updateMode, dataMode};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const REMOVE_TIME_SERIES_GROUP = 'REMOVE_TIME_SERIES_GROUP';\n\nexport interface RemoveTimeSeriesGroup {\n    type: typeof REMOVE_TIME_SERIES_GROUP;\n    id: string;\n}\n\nexport function removeTimeSeriesGroup(id: string): RemoveTimeSeriesGroup {\n    return {type: REMOVE_TIME_SERIES_GROUP, id};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const REMOVE_ALL_TIME_SERIES = 'REMOVE_ALL_TIME_SERIES';\n\nexport interface RemoveAllTimeSeries {\n    type: typeof REMOVE_ALL_TIME_SERIES;\n}\n\nexport function removeAllTimeSeries(): RemoveAllTimeSeries {\n    return {type: REMOVE_ALL_TIME_SERIES};\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////\n\n\nexport const CONFIGURE_SERVERS = 'CONFIGURE_SERVERS';\n\nexport interface ConfigureServers {\n    type: typeof CONFIGURE_SERVERS;\n    servers: ApiServerConfig[];\n    selectedServerId: string;\n}\n\nexport function configureServers(servers: ApiServerConfig[], selectedServerId: string) {\n    return (dispatch: Dispatch<any>, getState: () => AppState) => {\n        if (getState().controlState.selectedServerId !== selectedServerId) {\n            dispatch(removeAllTimeSeries());\n            dispatch(_configureServers(servers, selectedServerId));\n            dispatch(syncWithServer());\n        } else if (getState().dataState.userServers !== servers) {\n            dispatch(_configureServers(servers, selectedServerId));\n        }\n    };\n}\n\nexport function _configureServers(servers: ApiServerConfig[], selectedServerId: string): ConfigureServers {\n    return {type: CONFIGURE_SERVERS, servers, selectedServerId};\n}\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport function syncWithServer() {\n    return (dispatch: Dispatch<any>) => {\n        dispatch(updateServerInfo());\n        dispatch(updateDatasets());\n        dispatch(updateColorBars());\n    };\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_COLOR_BARS = 'UPDATE_COLOR_BARS';\n\nexport interface UpdateColorBars {\n    type: typeof UPDATE_COLOR_BARS;\n    colorBars: ColorBars;\n}\n\nexport function updateColorBars() {\n    return (dispatch: Dispatch<UpdateColorBars | MessageLogAction>, getState: () => AppState) => {\n        const apiServer = selectedServerSelector(getState());\n\n        api.getColorBars(apiServer.url)\n            .then((colorBars: ColorBars) => {\n                dispatch(_updateColorBars(colorBars));\n            })\n            .catch(error => {\n                dispatch(postMessage('error', error));\n            });\n    };\n}\n\nexport function _updateColorBars(colorBars: ColorBars): UpdateColorBars {\n    return {type: UPDATE_COLOR_BARS, colorBars};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n\nexport const UPDATE_VARIABLE_COLOR_BAR = 'UPDATE_VARIABLE_COLOR_BAR';\n\nexport interface UpdateVariableColorBar {\n    type: typeof UPDATE_VARIABLE_COLOR_BAR;\n    datasetId: string;\n    variableName: string;\n    colorBarMinMax: [number, number];\n    colorBarName: string;\n    opacity: number;\n}\n\nexport function updateVariableColorBar(\n    colorBarMinMax: [number, number],\n    colorBarName: string,\n    opacity: number\n) {\n    return (dispatch: Dispatch<UpdateVariableColorBar>, getState: () => AppState) => {\n        const selectedDatasetId = getState().controlState.selectedDatasetId;\n        const selectedVariableName = getState().controlState.selectedVariableName;\n        if (selectedDatasetId && selectedVariableName) {\n            dispatch(_updateVariableColorBar(\n                selectedDatasetId, selectedVariableName,\n                colorBarMinMax, colorBarName, opacity\n            ));\n        }\n    };\n}\n\nexport function _updateVariableColorBar(\n    datasetId: string,\n    variableName: string,\n    colorBarMinMax: [number, number],\n    colorBarName: string,\n    opacity: number\n): UpdateVariableColorBar {\n    return {\n        type: UPDATE_VARIABLE_COLOR_BAR,\n        datasetId,\n        variableName,\n        colorBarMinMax,\n        colorBarName,\n        opacity\n    };\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n\nexport const UPDATE_VARIABLE_VOLUME = 'UPDATE_VARIABLE_VOLUME';\n\nexport interface UpdateVariableVolume {\n    type: typeof UPDATE_VARIABLE_VOLUME;\n    datasetId: string;\n    variableName: string;\n    variableColorBar: ColorBar;\n    volumeRenderMode: VolumeRenderMode;\n    volumeIsoThreshold: number;\n}\n\nexport function updateVariableVolume(\n    datasetId: string,\n    variableName: string,\n    variableColorBar: ColorBar,\n    volumeRenderMode: VolumeRenderMode,\n    volumeIsoThreshold: number\n): UpdateVariableVolume {\n    return {\n        type: UPDATE_VARIABLE_VOLUME,\n        datasetId,\n        variableName,\n        variableColorBar,\n        volumeRenderMode,\n        volumeIsoThreshold,\n    };\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport function exportData() {\n    return (dispatch: Dispatch<UpdateVariableColorBar>, getState: () => AppState) => {\n        const {\n            exportTimeSeries,\n            exportTimeSeriesSeparator,\n            exportPlaces,\n            exportPlacesAsCollection,\n            exportZipArchive,\n            exportFileName,\n        } = getState().controlState;\n\n        let placeGroups: PlaceGroup[] = [];\n\n        if (exportTimeSeries) {\n            // Time series may reference any place, so collect all known place groups.\n            placeGroups = [];\n            const datasets = datasetsSelector(getState());\n            datasets.forEach(dataset => {\n                if (dataset.placeGroups) {\n                    placeGroups = placeGroups.concat(dataset.placeGroups);\n                }\n            });\n            placeGroups.push(userPlaceGroupSelector(getState()));\n        } else if (exportPlaces) {\n            // Just export all visible places.\n            placeGroups = selectedPlaceGroupsSelector(getState());\n        }\n\n        _exportData(getState().dataState.timeSeriesGroups,\n            placeGroups,\n            {\n                includeTimeSeries: exportTimeSeries,\n                includePlaces: exportPlaces,\n                separator: exportTimeSeriesSeparator,\n                placesAsCollection: exportPlacesAsCollection,\n                zip: exportZipArchive,\n                fileName: exportFileName,\n            }\n        );\n    };\n}\n\n\nabstract class Exporter {\n    abstract write(path: string, content: string): any;\n\n    abstract close(): any;\n}\n\nclass ZipExporter extends Exporter {\n    fileName: string;\n    zipArchive: JSZip;\n\n    constructor(fileName: string) {\n        super();\n        this.fileName = fileName;\n        this.zipArchive = new JSZip();\n    }\n\n    write(path: string, content: string) {\n        this.zipArchive.file(path, content);\n    }\n\n    close() {\n        this.zipArchive.generateAsync({type: 'blob'})\n            .then((content) => saveAs(content, this.fileName));\n    }\n}\n\nclass FileExporter extends Exporter {\n\n    write(path: string, content: string) {\n        const blob = new Blob([content],\n            {type: 'text/plain;charset=utf-8'});\n        saveAs(blob, path);\n    }\n\n    close() {\n    }\n}\n\ninterface ExportOptions {\n    includeTimeSeries?: boolean;\n    separator?: string;\n    includePlaces?: boolean;\n    fileName?: string;\n    placesAsCollection?: boolean;\n    zip?: boolean;\n}\n\nfunction _exportData(timeSeriesGroups: TimeSeriesGroup[],\n                     placeGroups: PlaceGroup[],\n                     options: ExportOptions) {\n\n    let {\n        includeTimeSeries,\n        separator,\n        includePlaces,\n        fileName,\n        placesAsCollection,\n        zip,\n    } = options;\n\n    separator = separator || 'TAB';\n    if (separator.toUpperCase() === 'TAB') {\n        separator = '\\t';\n    }\n\n    fileName = fileName || 'export';\n\n    if (!includeTimeSeries && !includePlaces) {\n        return;\n    }\n\n    let exporter: Exporter;\n    if (zip) {\n        exporter = new ZipExporter(`${fileName}.zip`);\n    } else {\n        exporter = new FileExporter();\n    }\n\n    let placesToExport: { [placeId: string]: Place };\n\n    if (includeTimeSeries) {\n        const {colNames, dataRows, referencedPlaces} = timeSeriesGroupsToTable(timeSeriesGroups, placeGroups);\n        const validTypes: { [typeName: string]: boolean } = {number: true, string: true};\n        const csvHeaderRow = colNames.join(separator);\n        const csvDataRows = dataRows.map(row => row.map(value => validTypes[typeof value] ? value + '':'').join(separator));\n        const csvText = [csvHeaderRow].concat(csvDataRows).join('\\n');\n        exporter.write(`${fileName}.txt`, csvText);\n        placesToExport = referencedPlaces;\n    } else {\n        placesToExport = {};\n        placeGroups.forEach(placeGroup => {\n            if (placeGroup.features) {\n                placeGroup.features.forEach(place => {\n                    placesToExport[place.id] = place;\n                });\n            }\n        });\n    }\n\n    if (includePlaces) {\n        if (placesAsCollection) {\n            const collection = {\n                type: 'FeatureCollection',\n                features: Object.keys(placesToExport).map(placeId => placesToExport![placeId])\n            };\n            exporter.write(`${fileName}.geojson`,\n                JSON.stringify(collection, null, 2));\n        } else {\n            Object.keys(placesToExport).forEach(placeId => {\n                exporter.write(`${placeId}.geojson`,\n                    JSON.stringify(placesToExport![placeId], null, 2));\n            });\n        }\n    }\n\n    exporter.close();\n}\n\n/*\nfunction _downloadTimeSeriesGeoJSON(timeSeriesGroups: TimeSeriesGroup[],\n                                    placeGroups: PlaceGroup[],\n                                    format: 'GeoJSON' | 'CSV',\n                                    fileName: string = 'time-series',\n                                    multiFile: boolean = true,\n                                    zipArchive: boolean = true) {\n    const featureCollection = timeSeriesGroupsToGeoJSON(timeSeriesGroups);\n\n    if (format === 'GeoJSON') {\n        if (zipArchive) {\n            const zip = new JSZip();\n            if (multiFile) {\n                zip.file(`${fileName}.geojson`,\n                         JSON.stringify(featureCollection, null, 2));\n            } else {\n                for (let feature of featureCollection.features) {\n                    zip.file(`${feature.id}.geojson`,\n                             JSON.stringify(feature, null, 2));\n                }\n            }\n            zip.generateAsync({type: \"blob\"})\n               .then((content) => saveAs(content, `${fileName}.zip`));\n        } else {\n            if (multiFile) {\n                throw new Error('Cannot download multi-file exports');\n            }\n            const blob = new Blob([JSON.stringify(featureCollection, null, 2)],\n                                  {type: \"text/plain;charset=utf-8\"});\n            saveAs(blob, `${fileName}.geojson`);\n        }\n    } else {\n        // TODO (forman): implement CSV export\n        throw new Error(`Download as ${format} is not yet implemented`);\n    }\n\n}\n*/\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport type DataAction =\n    UpdateServerInfo\n    | UpdateDatasets\n    | UpdateDatasetPlaceGroup\n    | AddUserPlace\n    | AddUserPlaces\n    | RemoveUserPlace\n    | RemoveAllUserPlaces\n    | UpdateTimeSeries\n    | RemoveTimeSeriesGroup\n    | RemoveAllTimeSeries\n    | ConfigureServers\n    | UpdateColorBars\n    | UpdateVariableColorBar\n    | UpdateVariableVolume;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { callJsonApi } from './callApi';\nimport { ApiServerInfo } from '../model/apiServer';\n\nexport function getServerInfo(apiServerUrl: string): Promise<ApiServerInfo> {\n    return callJsonApi<ApiServerInfo>(`${apiServerUrl}/`);\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { callJsonApi, makeRequestInit, makeRequestUrl } from './callApi';\n\n\nexport function updateResources(apiServerUrl: string, accessToken: string | null): Promise<boolean> {\n    const url = makeRequestUrl(`${apiServerUrl}/maintenance/update`, []);\n    const init = makeRequestInit(accessToken);\n    try {\n        return callJsonApi<boolean>(url, init)\n            .then(() => {\n                return true;\n            })\n            .catch(error => {\n                console.error(error);\n                return false;\n            });\n    } catch (error) {\n        console.error(error);\n        return Promise.resolve(false);\n    }\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as geojson from 'geojson';\n\nimport { Variable } from '../model/variable';\nimport { TimeSeries, TimeSeriesPoint } from '../model/timeSeries';\nimport { callJsonApi, makeRequestInit, makeRequestUrl, QueryComponent } from './callApi';\n\n\nexport function getTimeSeriesForGeometry(apiServerUrl: string,\n                                         datasetId: string,\n                                         variable: Variable,\n                                         placeId: string,\n                                         geometry: geojson.Geometry,\n                                         startDate: string | null,\n                                         endDate: string | null,\n                                         useMedian: boolean,\n                                         inclStDev: boolean,\n                                         accessToken: string | null): Promise<TimeSeries | null> {\n\n    let valueDataKey: keyof TimeSeriesPoint;\n    let errorDataKey: keyof TimeSeriesPoint | null = null;\n    const query: QueryComponent[] = [];\n    if (useMedian) {\n        query.push(['aggMethods', 'median']);\n        valueDataKey = 'median';\n    } else if (inclStDev) {\n        query.push(['aggMethods', 'mean,std']);\n        valueDataKey = 'mean';\n        errorDataKey = 'std';\n    } else {\n        query.push(['aggMethods', 'mean']);\n        valueDataKey = 'mean';\n    }\n    if (startDate) {\n        query.push(['startDate', startDate]);\n    }\n    if (endDate) {\n        query.push(['endDate', endDate]);\n    }\n    const dsId = encodeURIComponent(datasetId);\n    const variableName = encodeURIComponent(variable.name);\n    const url = makeRequestUrl(\n        `${apiServerUrl}/timeseries/${dsId}/${variableName}`,\n        query\n    );\n\n    const init = {\n        ...makeRequestInit(accessToken),\n        method: 'post',\n        body: JSON.stringify(geometry),\n    };\n\n    const convertTimeSeriesResult = (result: { [name: string]: any }) => {\n        result = result['result'];\n        if (!result || result.length === 0) {\n            return null;\n        }\n        const data = result.map((item: any) => {\n            return {...item, time: new Date(item.time).getTime()};\n        });\n        const source = {\n            datasetId,\n            variableName: variable.name,\n            variableUnits: variable.units || undefined,\n            placeId,\n            geometry,\n            valueDataKey,\n            errorDataKey,\n        };\n        return {source, data, color: \"green\"};\n    };\n\n    return callJsonApi<TimeSeries>(url, init)\n        .then(convertTimeSeriesResult);\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Extent as OlExtent } from 'ol/extent';\nimport { default as OlGeoJSONFormat } from 'ol/format/GeoJSON';\nimport { Geometry as OlGeometry } from 'ol/geom';\nimport { Dispatch } from 'redux';\nimport * as api from '../api'\nimport i18n from '../i18n';\nimport { Dataset, findDataset } from '../model/dataset';\nimport { findPlaceInPlaceGroups, isValidPlaceGroup, Place, PlaceGroup } from '../model/place';\nimport { Time, TimeRange } from '../model/timeSeries';\n\nimport {\n    selectedDatasetIdSelector,\n    selectedDatasetSelectedPlaceGroupsSelector,\n    selectedDatasetSelector,\n    selectedPlaceGroupsSelector,\n    selectedPlaceIdSelector,\n    selectedServerSelector,\n} from '../selectors/controlSelectors';\nimport { datasetsSelector } from '../selectors/dataSelectors';\nimport { AppState } from '../states/appState';\nimport {\n    ControlState,\n    MapInteraction,\n    TimeAnimationInterval,\n    VolumeRenderMode,\n    VolumeState\n} from '../states/controlState';\nimport { UPDATE_DATASET_PLACE_GROUP, updateDatasetPlaceGroup, UpdateDatasetPlaceGroup, } from './dataActions';\nimport { MessageLogAction, postMessage } from './messageLogActions';\nimport { BBox } from \"geojson\";\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SELECT_DATASET = 'SELECT_DATASET';\n\nexport interface SelectDataset {\n    type: typeof SELECT_DATASET;\n    selectedDatasetId: string | null;\n    // TODO: Having datasets in here is ugly, but we need it in the reducer.\n    // See\n    // - https://medium.com/@williamjoshualacey/refactoring-redux-using-react-context-aa29fa16f4b7\n    // - https://codeburst.io/the-ugly-side-of-redux-6591fde68200\n    datasets: Dataset[];\n}\n\nexport function selectDataset(selectedDatasetId: string | null, datasets: Dataset[], showInMap: boolean) {\n    return (dispatch: Dispatch<SelectDataset>) => {\n        dispatch(_selectDataset(selectedDatasetId, datasets));\n        if (selectedDatasetId && showInMap) {\n            dispatch(flyToDataset(selectedDatasetId) as any);\n        }\n    }\n}\n\nexport function _selectDataset(selectedDatasetId: string | null, datasets: Dataset[]): SelectDataset {\n    return {type: SELECT_DATASET, selectedDatasetId, datasets};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport function flyToDataset(selectedDatasetId: string) {\n    return (dispatch: Dispatch<FlyTo>, getState: () => AppState) => {\n        const datasets = datasetsSelector(getState());\n        const dataset = findDataset(datasets, selectedDatasetId);\n        if (dataset && dataset.bbox) {\n            dispatch(flyTo(dataset.bbox));\n        }\n    }\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst SIMPLE_GEOMETRY_TYPES = [\n    'Point',\n    'LineString',\n    'LinearRing',\n    'Polygon',\n    'MultiPoint',\n    'MultiLineString',\n    'MultiPolygon',\n    'Circle'\n];\n\nexport function flyToPlace(selectedPlaceId: string) {\n    return (dispatch: Dispatch<FlyTo>, getState: () => AppState) => {\n        const placeGroups = selectedPlaceGroupsSelector(getState());\n        const place = findPlaceInPlaceGroups(placeGroups, selectedPlaceId);\n        if (place) {\n            if (place.bbox) {\n                dispatch(flyTo(place.bbox));\n            } else if (place.geometry && SIMPLE_GEOMETRY_TYPES.includes(place.geometry.type)) {\n                dispatch(flyTo(new OlGeoJSONFormat().readGeometry(place.geometry)));\n            }\n        }\n    }\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport function flyToSelectedObject() {\n    return (dispatch: Dispatch, getState: () => AppState) => {\n        const placeId = selectedPlaceIdSelector(getState());\n        const datasetId = selectedDatasetIdSelector(getState());\n        if (placeId) {\n            dispatch(flyToPlace(placeId) as any);\n        } else if (datasetId) {\n            dispatch(flyToDataset(datasetId) as any);\n        }\n    }\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const FLY_TO = 'FLY_TO';\n\nexport interface FlyTo {\n    type: typeof FLY_TO;\n    mapId: string;\n    location: OlGeometry | OlExtent | BBox | null;\n}\n\nexport function flyTo(location: OlGeometry | OlExtent | BBox | null): FlyTo {\n    return {type: FLY_TO, mapId: 'map', location};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SELECT_PLACE_GROUPS = 'SELECT_PLACE_GROUPS';\n\nexport interface SelectPlaceGroups {\n    type: typeof SELECT_PLACE_GROUPS;\n    selectedPlaceGroupIds: string[] | null;\n}\n\nexport function selectPlaceGroups(selectedPlaceGroupIds: string[] | null) {\n\n    return (dispatch: Dispatch<SelectPlaceGroups | UpdateDatasetPlaceGroup | AddActivity | RemoveActivity | MessageLogAction>, getState: () => AppState) => {\n        const apiServer = selectedServerSelector(getState());\n\n        dispatch(_selectPlaceGroups(selectedPlaceGroupIds));\n\n        const dataset = selectedDatasetSelector(getState());\n        const placeGroups = selectedDatasetSelectedPlaceGroupsSelector(getState());\n        if (dataset!==null && placeGroups.length > 0) {\n            for (let placeGroup of placeGroups) {\n                if (!isValidPlaceGroup(placeGroup)) {\n                    const datasetId = dataset!.id;\n                    const placeGroupId = placeGroup.id;\n                    const activityId = `${UPDATE_DATASET_PLACE_GROUP}-${datasetId}-${placeGroupId}`;\n                    dispatch(addActivity(activityId, i18n.get('Loading places')));\n                    api.getDatasetPlaceGroup(apiServer.url,\n                        datasetId,\n                        placeGroupId,\n                        getState().userAuthState.accessToken)\n                        .then((placeGroup: PlaceGroup) => {\n                            dispatch(updateDatasetPlaceGroup(dataset!.id, placeGroup));\n                        })\n                        .catch(error => {\n                            dispatch(postMessage('error', error));\n                        })\n                        .finally(() => {\n                            dispatch(removeActivity(activityId));\n                        });\n                }\n            }\n        }\n    };\n}\n\nexport function _selectPlaceGroups(selectedPlaceGroupIds: string[] | null): SelectPlaceGroups {\n    return {type: SELECT_PLACE_GROUPS, selectedPlaceGroupIds};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SELECT_PLACE = 'SELECT_PLACE';\n\nexport interface SelectPlace {\n    type: typeof SELECT_PLACE;\n    selectedPlaceId: string | null;\n    // TODO: Having places in here is ugly, but we need it in the reducer.\n    places: Place[];\n}\n\n\nexport function selectPlace(selectedPlaceId: string | null, places: Place[], showInMap: boolean) {\n    return (dispatch: Dispatch<SelectPlace>) => {\n        dispatch(_selectPlace(selectedPlaceId, places));\n        if (showInMap && selectedPlaceId) {\n            dispatch(flyToPlace(selectedPlaceId) as any);\n        }\n    }\n}\n\nfunction _selectPlace(selectedPlaceId: string | null, places: Place[]): SelectPlace {\n    return {type: SELECT_PLACE, selectedPlaceId, places};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SET_RGB_LAYER_VISIBILITY = 'SET_RGB_LAYER_VISIBILITY';\n\nexport interface SetRgbLayerVisibility {\n    type: typeof SET_RGB_LAYER_VISIBILITY;\n    showRgbLayer: boolean;\n}\n\nexport function setRgbLayerVisibility(showRgbLayer: boolean): SetRgbLayerVisibility {\n    return {type: SET_RGB_LAYER_VISIBILITY, showRgbLayer};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SELECT_VARIABLE = 'SELECT_VARIABLE';\n\nexport interface SelectVariable {\n    type: typeof SELECT_VARIABLE;\n    selectedVariableName: string | null;\n}\n\nexport function selectVariable(selectedVariableName: string | null): SelectVariable {\n    return {type: SELECT_VARIABLE, selectedVariableName};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SELECT_TIME = 'SELECT_TIME';\n\nexport interface SelectTime {\n    type: typeof SELECT_TIME;\n    selectedTime: Time | null;\n}\n\nexport function selectTime(selectedTime: Time | null): SelectTime {\n    return {type: SELECT_TIME, selectedTime};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const INC_SELECTED_TIME = 'INC_SELECTED_TIME';\n\nexport interface IncSelectedTime {\n    type: typeof INC_SELECTED_TIME;\n    increment: -1 | 1;\n}\n\nexport function incSelectedTime(increment: -1 | 1): IncSelectedTime {\n    return {type: INC_SELECTED_TIME, increment};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SELECT_TIME_RANGE = 'SELECT_TIME_RANGE';\n\nexport interface SelectTimeRange {\n    type: typeof SELECT_TIME_RANGE;\n    selectedTimeRange: TimeRange | null;\n}\n\nexport function selectTimeRange(selectedTimeRange: TimeRange | null): SelectTimeRange {\n    return {type: SELECT_TIME_RANGE, selectedTimeRange};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n// TODO (forman): this action doesn't seem to be in use - remove!\n\nexport const SELECT_TIME_SERIES_UPDATE_MODE = 'SELECT_TIME_SERIES_UPDATE_MODE';\n\nexport interface SelectTimeSeriesUpdateMode {\n    type: typeof SELECT_TIME_SERIES_UPDATE_MODE;\n    timeSeriesUpdateMode: 'add' | 'replace';\n}\n\nexport function selectTimeSeriesUpdateMode(timeSeriesUpdateMode: 'add' | 'replace'): SelectTimeSeriesUpdateMode {\n    return {type: SELECT_TIME_SERIES_UPDATE_MODE, timeSeriesUpdateMode};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_TIME_ANIMATION = 'UPDATE_TIME_ANIMATION';\n\nexport interface UpdateTimeAnimation {\n    type: typeof UPDATE_TIME_ANIMATION;\n    timeAnimationActive: boolean;\n    timeAnimationInterval: TimeAnimationInterval;\n}\n\nexport function updateTimeAnimation(timeAnimationActive: boolean, timeAnimationInterval: TimeAnimationInterval): UpdateTimeAnimation {\n    return {type: UPDATE_TIME_ANIMATION, timeAnimationActive, timeAnimationInterval};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SET_MAP_INTERACTION = 'SET_MAP_INTERACTION';\n\nexport interface SetMapInteraction {\n    type: typeof SET_MAP_INTERACTION;\n    mapInteraction: MapInteraction;\n}\n\nexport function setMapInteraction(mapInteraction: MapInteraction): SetMapInteraction {\n    return {type: SET_MAP_INTERACTION, mapInteraction};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SHOW_VOLUME_CARD = 'SHOW_VOLUME_CARD';\n\nexport interface ShowVolumeCard {\n    type: typeof SHOW_VOLUME_CARD;\n    volumeCardOpen: boolean;\n}\n\nexport function showVolumeCard(volumeCardOpen: boolean): ShowVolumeCard {\n    return {type: SHOW_VOLUME_CARD, volumeCardOpen};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SET_VOLUME_RENDER_MODE = 'SET_VOLUME_RENDER_MODE';\n\nexport interface SetVolumeRenderMode {\n    type: typeof SET_VOLUME_RENDER_MODE;\n    volumeRenderMode: VolumeRenderMode;\n}\n\nexport function setVolumeRenderMode(volumeRenderMode: VolumeRenderMode): SetVolumeRenderMode {\n    return {type: SET_VOLUME_RENDER_MODE, volumeRenderMode};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_VOLUME_STATE = 'UPDATE_VOLUME_STATE';\n\nexport interface UpdateVolumeState {\n    type: typeof UPDATE_VOLUME_STATE;\n    volumeId: string;\n    volumeState: VolumeState;\n}\n\nexport function updateVolumeState(volumeId: string, volumeState: VolumeState): UpdateVolumeState {\n    return {type: UPDATE_VOLUME_STATE, volumeId, volumeState};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SHOW_INFO_CARD = 'SHOW_INFO_CARD';\n\nexport interface ShowInfoCard {\n    type: typeof SHOW_INFO_CARD;\n    infoCardOpen: boolean;\n}\n\nexport function showInfoCard(infoCardOpen: boolean): ShowInfoCard {\n    return {type: SHOW_INFO_CARD, infoCardOpen};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SET_VISIBLE_INFO_CARD_ELEMENTS = 'SET_VISIBLE_INFO_CARD_ELEMENTS';\n\nexport interface SetVisibleInfoCardElements {\n    type: typeof SET_VISIBLE_INFO_CARD_ELEMENTS;\n    visibleElements: string[];\n}\n\nexport function setVisibleInfoCardElements(visibleElements: string[]): SetVisibleInfoCardElements {\n    return {type: SET_VISIBLE_INFO_CARD_ELEMENTS, visibleElements};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_INFO_CARD_ELEMENT_VIEW_MODE = 'UPDATE_INFO_CARD_ELEMENT_VIEW_MODE';\n\nexport interface UpdateInfoCardElementCodeMode {\n    type: typeof UPDATE_INFO_CARD_ELEMENT_VIEW_MODE;\n    elementType: string;\n    viewMode: string;\n}\n\nexport function updateInfoCardElementViewMode(elementType: string, viewMode: string): UpdateInfoCardElementCodeMode {\n    return {type: UPDATE_INFO_CARD_ELEMENT_VIEW_MODE, elementType, viewMode};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const ADD_ACTIVITY = 'ADD_ACTIVITY';\n\nexport interface AddActivity {\n    type: typeof ADD_ACTIVITY;\n    id: string;\n    message: string;\n}\n\nexport function addActivity(id: string, message: string): AddActivity {\n    return {type: ADD_ACTIVITY, id, message};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const REMOVE_ACTIVITY = 'REMOVE_ACTIVITY';\n\nexport interface RemoveActivity {\n    type: typeof REMOVE_ACTIVITY;\n    id: string;\n}\n\nexport function removeActivity(id: string): RemoveActivity {\n    return {type: REMOVE_ACTIVITY, id};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const CHANGE_LOCALE = 'CHANGE_LOCALE';\n\nexport interface ChangeLocale {\n    type: typeof CHANGE_LOCALE;\n    locale: string;\n}\n\nexport function changeLocale(locale: string): ChangeLocale {\n    return {type: CHANGE_LOCALE, locale};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const OPEN_DIALOG = 'OPEN_DIALOG';\n\nexport interface OpenDialog {\n    type: typeof OPEN_DIALOG;\n    dialogId: string;\n}\n\nexport function openDialog(dialogId: string): OpenDialog {\n    return {type: OPEN_DIALOG, dialogId};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const CLOSE_DIALOG = 'CLOSE_DIALOG';\n\nexport interface CloseDialog {\n    type: typeof CLOSE_DIALOG;\n    dialogId: string;\n}\n\nexport function closeDialog(dialogId: string): CloseDialog {\n    return {type: CLOSE_DIALOG, dialogId};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_SETTINGS = 'UPDATE_SETTINGS';\n\nexport interface UpdateSettings {\n    type: typeof UPDATE_SETTINGS;\n    settings: Partial<ControlState>;\n}\n\nexport function updateSettings(settings: Partial<ControlState>): UpdateSettings {\n    return {type: UPDATE_SETTINGS, settings};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport type ControlAction =\n    SelectDataset\n    | UpdateDatasetPlaceGroup\n    | SelectVariable\n    | SelectPlaceGroups\n    | SelectPlace\n    | SelectTime\n    | SetRgbLayerVisibility\n    | IncSelectedTime\n    | SelectTimeRange\n    | SelectTimeSeriesUpdateMode\n    | UpdateTimeAnimation\n    | SetMapInteraction\n    | AddActivity\n    | RemoveActivity\n    | ChangeLocale\n    | UpdateSettings\n    | OpenDialog\n    | CloseDialog\n    | ShowVolumeCard\n    | SetVolumeRenderMode\n    | UpdateVolumeState\n    | ShowInfoCard\n    | SetVisibleInfoCardElements\n    | UpdateInfoCardElementCodeMode\n    | FlyTo;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport Divider from '@mui/material/Divider';\nimport Grid from '@mui/material/Grid';\nimport List from '@mui/material/List';\nimport ListItem from '@mui/material/ListItem';\nimport ListItemText from '@mui/material/ListItemText';\nimport Paper from '@mui/material/Paper';\nimport {UserProfile as UserInfo} from \"oidc-client-ts\";\n\nimport i18n from '../i18n';\nimport {WithLocale} from '../util/lang';\n\n\ninterface UserProfileProps extends WithLocale {\n    userInfo: UserInfo;\n}\n\nconst UserProfile: React.FC<UserProfileProps> = ({userInfo}) => {\n\n    return (\n        <Grid container justifyContent=\"center\" spacing={1}>\n            <Grid item>\n                <img src={userInfo.picture} width={84} alt={i18n.get('User Profile')}/>\n            </Grid>\n            <Grid item>\n                <Paper elevation={3}>\n                    <List>\n                        <ListItem>\n                            <ListItemText\n                                primary={userInfo.name}\n                                secondary={i18n.get('User name')}/>\n                        </ListItem>\n                        <Divider light/>\n                        <ListItem>\n                            <ListItemText\n                                primary={`${userInfo.email} (${userInfo.email_verified ? i18n.get('verified') : i18n.get('not verified')})`}\n                                secondary={i18n.get('E-mail')}/>\n                        </ListItem>\n                        <Divider light/>\n                        <ListItem>\n                            <ListItemText\n                                primary={userInfo.nickname}\n                                secondary={i18n.get('Nickname')}/>\n                        </ListItem>\n                    </List>\n                </Paper>\n            </Grid>\n        </Grid>\n    );\n};\n\nexport default UserProfile;","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport Transition from 'react-transition-group/Transition';\nimport { useAuth } from \"react-oidc-context\";\nimport { Theme } from '@mui/material';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Avatar from '@mui/material/Avatar';\nimport Button from '@mui/material/Button';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport IconButton from '@mui/material/IconButton';\nimport Menu from '@mui/material/Menu';\nimport MenuItem from '@mui/material/MenuItem';\nimport PersonIcon from '@mui/icons-material/Person';\nimport i18n from '../i18n';\n\nimport { WithLocale } from '../util/lang';\nimport { Config } from '../config';\nimport UserProfile from '../components/UserProfile';\nimport { deepOrange } from '@mui/material/colors';\n\n\nconst styles = (theme: Theme) => createStyles(\n        {\n            imageAvatar: {\n                width: 32,\n                height: 32,\n                color: '#fff',\n                backgroundColor: deepOrange[300],\n            },\n            letterAvatar: {\n                width: 32,\n                height: 32,\n                color: '#fff',\n                backgroundColor: deepOrange[300],\n            },\n            signInWrapper: {\n                margin: theme.spacing(1),\n                position: 'relative',\n            },\n            signInProgress: {\n                color: deepOrange[300],\n                position: 'absolute',\n                top: '50%',\n                left: '50%',\n                zIndex: 1,\n                marginTop: -12,\n                marginLeft: -12,\n            },\n            iconButton: {\n                padding: 0,\n            }\n        }\n);\n\ninterface UserControlProps extends WithStyles<typeof styles>, WithLocale {\n    updateAccessToken: (accessToken: string | null) => any;\n}\n\nconst UserControlContent: React.FC<UserControlProps> = ({classes, updateAccessToken}) => {\n    const auth = useAuth();\n    const [userMenuAnchorEl, setUserMenuAnchorEl] = React.useState<null | HTMLElement>(null);\n    const [profileDialogOpen, setProfileDialogOpen] = React.useState(false);\n\n    if (process.env.NODE_ENV === 'development') {\n        console.debug('User: ', auth.user);\n    }\n\n    React.useEffect(() => {\n        console.log(\"User changed:\", auth.user);\n        if (auth.user && auth.user.access_token) {\n            updateAccessToken(auth.user.access_token);\n        } else {\n            updateAccessToken(null);\n        }\n    }, [auth.user, updateAccessToken]);\n\n    const handleUserProfileMenuItemClicked = () => {\n        handleUserMenuClose();\n        setProfileDialogOpen(true);\n    };\n\n    const handleUserProfileDialogClose = () => {\n        setProfileDialogOpen(false);\n    };\n\n    const handleUserMenuOpen = (event: React.MouseEvent<HTMLButtonElement>) => {\n        setUserMenuAnchorEl(event.currentTarget);\n    };\n\n    const handleUserMenuClose = () => {\n        setUserMenuAnchorEl(null);\n    };\n\n    const handleSignInButtonClicked = () => {\n        auth.signinRedirect().then(() => {\n            if (process.env.NODE_ENV === 'development') {\n                console.debug('Signed in:', auth.user);\n            }\n        }).catch(e => {\n            console.error(e);\n        });\n    };\n\n    const handleSignOutMenuItemClicked = () => {\n        handleUserMenuClose();\n        auth.signoutRedirect().then(() => {\n            if (process.env.NODE_ENV === 'development') {\n                console.debug('Signed out:', auth.user);\n            }\n        }).catch(e => {\n            console.error(e);\n        });\n    };\n\n    if (auth.user) {\n        const userInfo = auth.user.profile;\n        let avatar;\n        let avatarContent: React.ReactNode = <PersonIcon/>;\n        if (!userInfo) {\n            avatar = <Avatar className={classes.letterAvatar}>?</Avatar>;\n        } else if (userInfo.picture) {\n            avatar = <Avatar className={classes.imageAvatar} src={userInfo.picture} alt={userInfo.name}/>;\n        } else {\n            const name1 = userInfo.given_name || userInfo.name || userInfo.nickname;\n            const name2 = userInfo.family_name;\n            let letters: string | null = null;\n            if (name1 && name2) {\n                letters = name1[0] + name2[0];\n            } else if (name1) {\n                letters = name1[0];\n            } else if (name2) {\n                letters = name2[0];\n            }\n            if (letters !== null) {\n                avatarContent = letters.toUpperCase();\n            }\n            avatar = <Avatar className={classes.letterAvatar}>{avatarContent}</Avatar>;\n        }\n        return (\n                <React.Fragment>\n                    <IconButton\n                            onClick={handleUserMenuOpen}\n                            aria-controls=\"user-menu\"\n                            aria-haspopup=\"true\"\n                            size=\"small\"\n                            className={classes.iconButton}\n                    >\n                        {avatar}\n                    </IconButton>\n                    <Menu\n                            id=\"user-menu\"\n                            anchorEl={userMenuAnchorEl}\n                            keepMounted\n                            open={Boolean(userMenuAnchorEl)}\n                            onClose={handleUserMenuClose}\n                    >\n                        <MenuItem onClick={handleUserProfileMenuItemClicked}>{i18n.get('Profile')}</MenuItem>\n                        <MenuItem onClick={handleSignOutMenuItemClicked}>{i18n.get('Log out')}</MenuItem>\n                    </Menu>\n                    <Dialog\n                            open={profileDialogOpen}\n                            TransitionComponent={Transition as any}\n                            keepMounted\n                            onClose={handleUserProfileDialogClose}\n                            aria-labelledby=\"alert-dialog-slide-title\"\n                            aria-describedby=\"alert-dialog-slide-description\"\n                    >\n                        <DialogTitle id=\"alert-dialog-slide-title\">{i18n.get('User Profile')}</DialogTitle>\n                        <DialogContent>\n                            <UserProfile userInfo={auth.user.profile}/>\n                        </DialogContent>\n                        <DialogActions>\n                            <Button onClick={handleUserProfileDialogClose} color=\"primary\">\n                                OK\n                            </Button>\n                        </DialogActions>\n                    </Dialog>\n                </React.Fragment>\n        );\n    } else {\n        let userButton = (\n                <IconButton onClick={auth.isLoading ? undefined : handleSignInButtonClicked} size=\"small\">\n                    <PersonIcon/>\n                </IconButton>\n        );\n        if (auth.isLoading) {\n            userButton = (\n                    <div className={classes.signInWrapper}>\n                        {userButton}\n                        <CircularProgress size={24} className={classes.signInProgress}/>\n                    </div>\n            );\n        }\n        return userButton;\n    }\n};\n\nconst UserControl: React.FC<UserControlProps> = (props) => {\n    if (!Config.instance.authClient) {\n        return null;\n    }\n    return <UserControlContent {...props}/>\n}\n\nexport default withStyles(styles)(UserControl);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nimport { Dispatch } from \"redux\";\nimport { AppState } from \"../states/appState\";\nimport { updateDatasets } from \"./dataActions\";\n\nexport const UPDATE_ACCESS_TOKEN = 'UPDATE_ACCESS_TOKEN';\n\nexport interface UpdateAccessToken {\n    type: typeof UPDATE_ACCESS_TOKEN;\n    accessToken: string | null;\n}\n\nexport function updateAccessToken(accessToken: string | null) {\n    return (dispatch: Dispatch, getState: () => AppState) => {\n        const prevAccessToken = getState().userAuthState.accessToken;\n        if (prevAccessToken !== accessToken) {\n            dispatch(_updateAccessToken(accessToken));\n            if (accessToken === null  || prevAccessToken === null) {\n                dispatch(updateDatasets() as any);\n            }\n        }\n    }\n}\n\nfunction _updateAccessToken(accessToken: string | null): UpdateAccessToken {\n    return {type: UPDATE_ACCESS_TOKEN, accessToken};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport type UserAuthAction = UpdateAccessToken;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\nimport { AppState } from '../states/appState';\nimport UserControl from '../components/UserControl';\nimport { updateAccessToken } from '../actions/userAuthActions';\n\n\n// noinspection JSUnusedLocalSymbols\nconst mapStateToProps = (state: AppState) => {\n    return {};\n};\n\nconst mapDispatchToProps = {\n    updateAccessToken\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(UserControl);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { DialogContent } from '@mui/material';\nimport React, { useEffect, useState } from 'react';\nimport Markdown from 'react-markdown';\nimport { Theme } from '@mui/material/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport makeStyles from '@mui/styles/makeStyles';\nimport Dialog from '@mui/material/Dialog';\nimport AppBar from '@mui/material/AppBar';\nimport Toolbar from '@mui/material/Toolbar';\nimport IconButton from '@mui/material/IconButton';\nimport Typography from '@mui/material/Typography';\nimport CloseIcon from '@mui/icons-material/Close';\nimport Slide from '@mui/material/Slide';\n\n\nconst useStyles = makeStyles((theme: Theme) => createStyles(\n    {\n        dialog: {\n            backgroundColor: theme.palette.grey[600]\n        },\n        appBar: {\n            position: 'relative',\n        },\n        title: {\n            marginLeft: theme.spacing(2),\n            flex: 1,\n        },\n        text: {\n            marginTop: theme.spacing(4),\n            marginLeft: theme.spacing(40),\n            marginRight: theme.spacing(40),\n        }\n    }\n));\n\nconst Transition = React.forwardRef(function Transition(props, ref) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\ninterface MarkdownPageProps {\n    title: string;\n    href: string;\n    open: boolean;\n    onClose: () => void;\n}\n\nconst MarkdownPage: React.FC<MarkdownPageProps> = ({\n                                                       title,\n                                                       href,\n                                                       open,\n                                                       onClose\n                                                   }) => {\n    const [markdownText, setMarkdownText] = useState('');\n\n    useEffect(() => {\n        fetch(href)\n            .then(response => response.text())\n            .then(text => setMarkdownText(text));\n    });\n\n    const classes = useStyles();\n\n    return (\n        <Dialog fullScreen open={open} onClose={onClose} TransitionComponent={Transition as any}>\n            <AppBar className={classes.appBar}>\n                <Toolbar>\n                    <IconButton\n                        edge=\"start\"\n                        color=\"inherit\"\n                        onClick={onClose}\n                        aria-label=\"close\"\n                        size=\"large\">\n                        <CloseIcon/>\n                    </IconButton>\n                    <Typography variant=\"h6\" className={classes.title}>{title}</Typography>\n                </Toolbar>\n            </AppBar>\n            <DialogContent className={classes.dialog}>\n                <div className={classes.text}>\n                    <Markdown children={markdownText} linkTarget=\"_blank\"/>\n                </div>\n            </DialogContent>\n        </Dialog>\n    );\n};\n\nexport default MarkdownPage;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { AppBar, IconButton, Menu, MenuItem, Theme, Toolbar, Typography } from '@mui/material';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport HelpOutlineIcon from '@mui/icons-material/HelpOutline';\nimport SettingsIcon from '@mui/icons-material/Settings';\nimport RefreshIcon from '@mui/icons-material/Refresh';\nimport { deepOrange } from '@mui/material/colors';\nimport classNames from 'classnames';\n\nimport { Config } from '../config';\nimport i18n from '../i18n';\nimport { AppState } from '../states/appState';\nimport { WithLocale } from '../util/lang';\nimport UserControl from './UserControl';\nimport { openDialog } from '../actions/controlActions';\nimport { updateResources } from \"../actions/dataActions\";\nimport MarkdownPage from '../components/MarkdownPage';\n\n\ninterface AppBarProps extends WithStyles<typeof styles>, WithLocale {\n    appName: string;\n    openDialog: (dialogId: string) => any;\n    allowRefresh?: boolean;\n    updateResources: () => any;\n}\n\n\n// noinspection JSUnusedLocalSymbols\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        appName: Config.instance.branding.appBarTitle,\n        allowRefresh: Config.instance.branding.allowRefresh,\n    };\n};\n\nconst mapDispatchToProps = {\n    openDialog,\n    updateResources,\n};\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        toolbar: {\n            backgroundColor: Config.instance.branding.headerBackgroundColor,\n            paddingRight: theme.spacing(1),\n        },\n        appBar: {\n            zIndex: theme.zIndex.drawer + 1,\n            transition: theme.transitions.create(['width', 'margin'], {\n                easing: theme.transitions.easing.sharp,\n                duration: theme.transitions.duration.leavingScreen,\n            }),\n        },\n        logoAnchor: {\n            display: \"flex\",\n            alignItems: \"center\"\n        },\n        logo: {\n            marginLeft: theme.spacing(1),\n        },\n        title: {\n            flexGrow: 1,\n            marginLeft: theme.spacing(1),\n            ...Config.instance.branding.headerTitleStyle,\n        },\n        imageAvatar: {\n            width: 24,\n            height: 24,\n            color: '#fff',\n            backgroundColor: deepOrange[300],\n        },\n        letterAvatar: {\n            width: 24,\n            height: 24,\n            color: '#fff',\n            backgroundColor: deepOrange[300],\n        },\n        signInWrapper: {\n            margin: theme.spacing(1),\n            position: 'relative',\n        },\n        signInProgress: {\n            color: deepOrange[300],\n            position: 'absolute',\n            top: '50%',\n            left: '50%',\n            zIndex: 1,\n            marginTop: -12,\n            marginLeft: -12,\n        },\n        iconButton: {\n            marginLeft: theme.spacing(2),\n            ...Config.instance.branding.headerIconStyle,\n        }\n    }\n);\n\nconst _AppBar: React.FC<AppBarProps> = (\n    {\n        classes,\n        appName,\n        openDialog,\n        allowRefresh,\n        updateResources\n    }: AppBarProps) => {\n    const [helpMenuAnchorEl, setHelpMenuAnchorEl] = React.useState(null);\n    const [imprintOpen, setImprintOpen] = React.useState(false);\n    const [manualOpen, setManualOpen] = React.useState(false);\n\n    const handleSettingsButtonClicked = () => {\n        openDialog('settings');\n    };\n\n    const handleOpenHelpMenu = (event: any) => {\n        setHelpMenuAnchorEl(event.currentTarget);\n    };\n\n    const handleCloseHelpMenu = () => {\n        setHelpMenuAnchorEl(null);\n    };\n\n    const handleOpenManual = () => {\n        handleCloseHelpMenu();\n        setManualOpen(true);\n    };\n\n    const handleCloseManual = () => {\n        setManualOpen(false);\n    };\n\n    const handleOpenImprint = () => {\n        handleCloseHelpMenu();\n        setImprintOpen(true);\n    };\n\n    const handleCloseImprint = () => {\n        setImprintOpen(false);\n    };\n\n    return (\n        <AppBar\n            position=\"absolute\"\n            className={classNames(classes.appBar)}\n        >\n            <Toolbar disableGutters className={classes.toolbar} variant=\"dense\">\n                <a\n                    href={Config.instance.branding.organisationUrl || \"\"}\n                    target=\"_blank\"\n                    rel=\"noreferrer\"\n                    className={classes.logoAnchor}\n                >\n                    <img\n                        src={Config.instance.branding.logoImage}\n                        width={Config.instance.branding.logoWidth}\n                        alt={'xcube logo'}\n                        className={classes.logo}\n                    />\n                </a>\n                <Typography\n                    component=\"h1\"\n                    variant=\"h6\"\n                    color=\"inherit\"\n                    noWrap\n                    className={classes.title}\n                >\n                    {appName}\n                </Typography>\n                <UserControl/>\n                {allowRefresh &&\n                    <Tooltip arrow title={i18n.get('Refresh')}>\n                        <IconButton onClick={updateResources} size=\"small\" className={classes.iconButton}>\n                            <RefreshIcon/>\n                        </IconButton>\n                    </Tooltip>\n                }\n                <Tooltip arrow title={i18n.get('Help')}>\n                    <IconButton onClick={handleOpenHelpMenu} size=\"small\" className={classes.iconButton}>\n                        <HelpOutlineIcon/>\n                    </IconButton>\n                </Tooltip>\n                <Tooltip arrow title={i18n.get('Settings')}>\n                    <IconButton onClick={handleSettingsButtonClicked} size=\"small\" className={classes.iconButton}>\n                        <SettingsIcon/>\n                    </IconButton>\n                </Tooltip>\n            </Toolbar>\n            <Menu\n                id=\"simple-menu\"\n                anchorEl={helpMenuAnchorEl}\n                keepMounted\n                open={Boolean(helpMenuAnchorEl)}\n                onClose={handleCloseHelpMenu}\n                getContentAnchorEl={null}\n                anchorOrigin={{vertical: 'bottom', horizontal: 'center'}}\n                transformOrigin={{vertical: 'top', horizontal: 'center'}}\n            >\n                <MenuItem onClick={handleOpenManual}>{i18n.get('User Manual')}</MenuItem>\n                <MenuItem onClick={handleOpenImprint}>{i18n.get('Imprint')}</MenuItem>\n            </Menu>\n            <MarkdownPage title={i18n.get('User Manual')}\n                          href='manual.md'\n                          open={manualOpen} onClose={handleCloseManual}/>\n            <MarkdownPage title={i18n.get('Imprint')}\n                          href='imprint.md'\n                          open={imprintOpen} onClose={handleCloseImprint}/>\n        </AppBar>\n    );\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(_AppBar));\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { Theme } from '@mui/material/styles';\n\nimport { WithStyles } from '@mui/styles';\nimport withStyles from '@mui/styles/withStyles';\nimport createStyles from '@mui/styles/createStyles';\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        form: {\n            display: 'flex',\n            flexWrap: 'wrap',\n            paddingTop: theme.spacing(1),\n            paddingLeft: theme.spacing(1),\n            paddingRight: theme.spacing(1),\n            flexGrow: 0,\n        },\n    });\n\ninterface ControlBarProps extends WithStyles<typeof styles> {\n}\n\nconst ControlBar: React.FC<ControlBarProps> = ({classes, children}) => {\n    return (\n        <form className={classes.form} autoComplete=\"off\">\n            {children}\n        </form>\n    );\n};\n\nexport default withStyles(styles)(ControlBar);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport withStyles from '@mui/styles/withStyles';\nimport createStyles from '@mui/styles/createStyles';\nimport FormControl from '@mui/material/FormControl';\n\nimport { WithLocale } from '../util/lang';\nimport Box from '@mui/material/Box';\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        formControl: {\n            marginRight: theme.spacing(1),\n        }\n    }\n);\n\ninterface ControlBarItemProps extends WithStyles<typeof styles>, WithLocale {\n    label: React.ReactNode;\n    control: React.ReactNode;\n    actions?: React.ReactNode | null;\n}\n\nconst ControlBarItem: React.FC<ControlBarItemProps> = ({\n                                                           classes,\n                                                           label,\n                                                           control,\n                                                           actions\n                                                       }) => {\n    return (\n        <FormControl variant=\"standard\" className={classes.formControl}>\n            <Box>\n                {label}\n                {control}\n                {actions}\n            </Box>\n        </FormControl>\n    );\n};\n\nexport default withStyles(styles)(ControlBarItem);\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Input from '@mui/material/Input';\nimport InputLabel from '@mui/material/InputLabel';\nimport MenuItem from '@mui/material/MenuItem';\nimport Select from '@mui/material/Select';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport * as React from 'react';\nimport i18n from '../i18n';\n\nimport { Dataset } from '../model/dataset';\nimport { WithLocale } from '../util/lang';\nimport ControlBarItem from './ControlBarItem';\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        formControl: {\n            marginRight: theme.spacing(2),\n            marginBottom: theme.spacing(1),\n            minWidth: 120,\n        },\n        selectEmpty: {},\n    });\n\ninterface DatasetSelectProps extends WithStyles<typeof styles>, WithLocale {\n    selectedDatasetId: string | null;\n    datasets: Dataset[];\n    selectDataset: (datasetId: string | null, datasets: Dataset[], showInMap: boolean) => void;\n}\n\nconst DatasetSelect: React.FC<DatasetSelectProps> = ({\n                                                         classes,\n                                                         selectedDatasetId,\n                                                         datasets,\n                                                         selectDataset,\n                                                     }) => {\n\n    const handleDatasetChange = (event: React.ChangeEvent<{ name?: string; value: any; }>) => {\n        const datasetId = event.target.value || null;\n        selectDataset(datasetId, datasets, true);\n    };\n\n    selectedDatasetId = selectedDatasetId || '';\n    datasets = datasets || [];\n\n    const datasetSelectLabel = (\n        <InputLabel shrink htmlFor=\"dataset-select\">\n            {i18n.get('Dataset')}\n        </InputLabel>\n    );\n\n    const datasetSelect = (\n        <Select\n            variant=\"standard\"\n            value={selectedDatasetId}\n            onChange={handleDatasetChange}\n            input={<Input name=\"dataset\" id=\"dataset-select\"/>}\n            displayEmpty\n            name=\"dataset\"\n            className={classes.selectEmpty}>\n            {datasets.map(dataset => (\n                <MenuItem\n                    key={dataset.id}\n                    value={dataset.id}\n                    selected={dataset.id === selectedDatasetId}\n                >\n                    {dataset.title}\n                </MenuItem>\n            ))}\n        </Select>\n    );\n\n    return (\n        <ControlBarItem\n            label={datasetSelectLabel}\n            control={datasetSelect}\n        />\n    );\n};\n\nexport default withStyles(styles)(DatasetSelect);\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport DatasetSelect from \"../components/DatasetSelect\";\nimport { AppState } from '../states/appState';\nimport { selectDataset } from '../actions/controlActions';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        selectedDatasetId: state.controlState.selectedDatasetId,\n        datasets: state.dataState.datasets,\n    };\n};\n\nconst mapDispatchToProps = {\n    selectDataset\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(DatasetSelect);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport IconButton from '@mui/material/IconButton';\nimport Input from '@mui/material/Input';\nimport InputLabel from '@mui/material/InputLabel';\nimport MenuItem from '@mui/material/MenuItem';\nimport Select from '@mui/material/Select';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport TimelineIcon from '@mui/icons-material/Timeline';\nimport * as React from 'react';\nimport i18n from '../i18n';\n\nimport { Variable } from '../model/variable';\nimport { WithLocale } from '../util/lang';\nimport ControlBarItem from './ControlBarItem';\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        formControl: {\n            marginRight: theme.spacing(2),\n            marginBottom: theme.spacing(1),\n            minWidth: 120,\n        },\n        selectEmpty: {},\n        button: {\n            margin: theme.spacing(0.1),\n        },\n    });\n\ninterface VariableSelectProps extends WithStyles<typeof styles>, WithLocale {\n    selectedVariableName: string | null;\n    canAddTimeSeries: boolean;\n    variables: Variable[];\n    selectVariable: (variableName: string | null) => void;\n    addTimeSeries: () => void;\n}\n\nconst VariableSelect: React.FC<VariableSelectProps> = ({\n                                                           classes,\n                                                           canAddTimeSeries,\n                                                           selectedVariableName,\n                                                           variables,\n                                                           selectVariable,\n                                                           addTimeSeries\n                                                       }) => {\n\n    const handleVariableChange = (event: React.ChangeEvent<{ name?: string; value: any; }>) => {\n        selectVariable(event.target.value || null);\n    };\n\n    const handleAddTimeSeriesButtonClick = () => {\n        addTimeSeries();\n    };\n\n\n    selectedVariableName = selectedVariableName || '';\n    variables = variables || [];\n\n    const variableSelectLabel = (\n        <InputLabel shrink htmlFor=\"variable-select\">\n            {i18n.get('Variable')}\n        </InputLabel>\n    );\n\n    const variableSelect = (\n        <Select\n            variant=\"standard\"\n            className={classes.selectEmpty}\n            value={selectedVariableName}\n            onChange={handleVariableChange}\n            input={<Input name=\"variable\" id=\"variable-select\"/>}\n            displayEmpty\n            name=\"variable\">\n            {variables.map(variable => (\n                <MenuItem\n                    key={variable.name}\n                    value={variable.name}\n                    selected={variable.name === selectedVariableName}\n                >\n                    {variable.title || variable.name}\n                </MenuItem>\n            ))}\n        </Select>\n    );\n    const timeSeriesButton = (\n        <IconButton\n            className={classes.button}\n            disabled={!canAddTimeSeries}\n            onClick={handleAddTimeSeriesButtonClick}\n            size=\"large\">\n            <Tooltip arrow title={i18n.get('Show time-series diagram')}>\n                {<TimelineIcon/>}\n            </Tooltip>\n        </IconButton>\n    );\n\n    return (\n        <ControlBarItem\n            label={variableSelectLabel}\n            control={variableSelect}\n            actions={timeSeriesButton}\n        />\n    );\n};\n\nexport default withStyles(styles)(VariableSelect);\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport VariableSelect from \"../components/VariableSelect\";\nimport { AppState } from '../states/appState';\nimport { addTimeSeries } from \"../actions/dataActions\";\nimport { selectVariable } from '../actions/controlActions';\nimport { canAddTimeSeriesSelector, selectedDatasetVariablesSelector } from '../selectors/controlSelectors';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n\n        selectedVariableName: state.controlState.selectedVariableName,\n        canAddTimeSeries: canAddTimeSeriesSelector(state),\n        variables: selectedDatasetVariablesSelector(state),\n    };\n};\n\nconst mapDispatchToProps = {\n    selectVariable,\n    addTimeSeries,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(VariableSelect);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport FormControlLabel from '@mui/material/FormControlLabel';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Switch from '@mui/material/Switch';\nimport Tooltip from '@mui/material/Tooltip';\nimport * as React from 'react';\nimport i18n from '../i18n';\n\nimport { RgbSchema } from '../model/dataset';\nimport { WithLocale } from '../util/lang';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {});\n\ninterface RgbSwitchProps extends WithStyles<typeof styles>, WithLocale {\n    showRgbLayer: boolean;\n    rgbSchema: RgbSchema | null;\n    setRgbLayerVisibility: (showRgbLayer: boolean) => void;\n}\n\nconst RgbSwitch: React.FC<RgbSwitchProps> = ({showRgbLayer, rgbSchema, setRgbLayerVisibility}) => {\n\n    const handleSwitchChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n        setRgbLayerVisibility(event.target.checked);\n    };\n\n    return (\n        <Tooltip arrow title={i18n.get('Show RGB layer instead')}>\n            <FormControlLabel label={i18n.get('RGB')} control={\n                <Switch\n                    color={'primary'}\n                    checked={rgbSchema !== null ? showRgbLayer : false}\n                    disabled={rgbSchema === null}\n                    onChange={handleSwitchChange}\n                />\n            }/>\n        </Tooltip>\n    );\n};\n\nexport default withStyles(styles)(RgbSwitch);\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport { setRgbLayerVisibility } from '../actions/controlActions';\nimport { selectedDatasetRgbSchemaSelector } from '../selectors/controlSelectors';\nimport RgbSwitch from '../components/RgbSwitch';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        rgbSchema: selectedDatasetRgbSchemaSelector(state),\n        showRgbLayer: state.controlState.showRgbLayer,\n    };\n};\n\nconst mapDispatchToProps = {\n    setRgbLayerVisibility,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(RgbSwitch);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Checkbox from '@mui/material/Checkbox';\nimport IconButton from '@mui/material/IconButton';\nimport Input from '@mui/material/Input';\nimport InputLabel from '@mui/material/InputLabel';\nimport ListItemText from '@mui/material/ListItemText';\nimport MenuItem from '@mui/material/MenuItem';\nimport Select from '@mui/material/Select';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport RemoveCircleOutlineIcon from '@mui/icons-material/RemoveCircleOutline';\nimport * as React from 'react';\nimport i18n from '../i18n';\n\nimport { PlaceGroup } from '../model/place';\nimport { WithLocale } from '../util/lang';\nimport ControlBarItem from './ControlBarItem';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        select: {\n            minWidth: '5em',\n        },\n    });\n\ninterface PlaceGroupSelectProps extends WithStyles<typeof styles>, WithLocale {\n    selectedPlaceGroupIds: string[] | null;\n    placeGroups: PlaceGroup[];\n    selectPlaceGroups: (placeGroupIds: string[] | null) => void;\n    removeAllUserPlaces: () => void;\n\n    selectedPlaceGroupsTitle: string;\n\n    language?: string;\n}\n\nconst PlaceGroupsSelect: React.FC<PlaceGroupSelectProps> = ({\n                                                                classes,\n                                                                placeGroups,\n                                                                selectPlaceGroups,\n                                                                selectedPlaceGroupIds,\n                                                                selectedPlaceGroupsTitle,\n                                                                removeAllUserPlaces,\n                                                            }) => {\n\n    const handlePlaceGroupsChange = (event: React.ChangeEvent<{ name?: string; value: any; }>) => {\n        selectPlaceGroups(event.target.value as any as string[] || null);\n    };\n\n    const handleRemoveButtonClick = () => {\n        removeAllUserPlaces();\n    };\n\n    const renderSelectedPlaceGroupsTitle = () => {\n        return selectedPlaceGroupsTitle;\n    };\n\n    placeGroups = placeGroups || [];\n    selectedPlaceGroupIds = selectedPlaceGroupIds || [];\n\n    if (placeGroups.length === 0 || (placeGroups.length === 1 && placeGroups[0].id === 'user')) {\n        return null;\n    }\n\n    const placeGroupsSelectLabel = (\n        <InputLabel\n            shrink\n            htmlFor=\"place-groups-select\"\n        >\n            {i18n.get('Places')}\n        </InputLabel>\n    );\n\n    const placeGroupsSelect = (\n        <Select\n            variant=\"standard\"\n            multiple\n            displayEmpty\n            onChange={handlePlaceGroupsChange}\n            input={<Input name=\"place-groups\" id=\"place-groups-select\"/>}\n            value={selectedPlaceGroupIds}\n            renderValue={renderSelectedPlaceGroupsTitle}\n            name=\"place-groups\"\n            className={classes.select}>\n            {placeGroups.map(placeGroup => (\n                <MenuItem\n                    key={placeGroup.id}\n                    value={placeGroup.id}\n                >\n                    <Checkbox checked={selectedPlaceGroupIds!.indexOf(placeGroup.id) > -1}/>\n                    <ListItemText primary={placeGroup.title}/>\n                </MenuItem>\n            ))}\n        </Select>\n    );\n\n    const removeEnabled = selectedPlaceGroupIds.length === 1 && selectedPlaceGroupIds[0] === 'user';\n    const placeGroupRemoveButton = (\n        <IconButton disabled={!removeEnabled} onClick={handleRemoveButtonClick} size=\"large\">\n            <Tooltip arrow title={i18n.get('Remove places')}>\n                {<RemoveCircleOutlineIcon/>}\n            </Tooltip>\n        </IconButton>\n    );\n\n    return (\n        <ControlBarItem\n            label={placeGroupsSelectLabel}\n            control={placeGroupsSelect}\n            actions={placeGroupRemoveButton}\n        />\n    );\n};\n\nexport default withStyles(styles)(PlaceGroupsSelect);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport PlaceGroupsSelect from \"../components/PlaceGroupsSelect\";\nimport { AppState } from '../states/appState';\nimport { removeAllUserPlaces } from '../actions/dataActions';\nimport { selectPlaceGroups } from '../actions/controlActions';\nimport {\n    placeGroupsSelector,\n    selectedPlaceGroupsTitleSelector\n} from '../selectors/controlSelectors';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n\n        selectedPlaceGroupIds: state.controlState.selectedPlaceGroupIds,\n        placeGroups: placeGroupsSelector(state),\n        selectedPlaceGroupsTitle: selectedPlaceGroupsTitleSelector(state),\n    };\n};\n\nconst mapDispatchToProps = {\n    selectPlaceGroups,\n    removeAllUserPlaces,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(PlaceGroupsSelect);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport IconButton from '@mui/material/IconButton';\nimport Input from '@mui/material/Input';\nimport InputLabel from '@mui/material/InputLabel';\nimport MenuItem from '@mui/material/MenuItem';\nimport Select from '@mui/material/Select';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport RemoveCircleOutlineIcon from '@mui/icons-material/RemoveCircleOutline';\n\nimport i18n from '../i18n';\nimport { Dataset } from '../model/dataset';\nimport { Place, PlaceGroup } from '../model/place';\nimport { WithLocale } from '../util/lang';\nimport ControlBarItem from './ControlBarItem';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        select: {\n            minWidth: '5em',\n        },\n        button: {},\n    });\n\ninterface PlaceSelectProps extends WithStyles<typeof styles>, WithLocale {\n    datasets: Dataset[];\n    userPlaceGroup: PlaceGroup;\n\n    selectedPlaceGroupIds: string[] | null;\n    selectedPlaceId: string | null;\n    places: Place[];\n    placeLabels: string[];\n    selectPlace: (placeId: string | null, places: Place[], showInMap: boolean) => void;\n    removeUserPlace: (placeId: string, places: Place[]) => void;\n    openDialog: (dialogId: string) => void;\n}\n\nconst PlaceSelect: React.FC<PlaceSelectProps> = ({\n                                                     classes,\n                                                     selectPlace,\n                                                     placeLabels,\n                                                     selectedPlaceId,\n                                                     selectedPlaceGroupIds,\n                                                     removeUserPlace,\n                                                     places,\n                                                 }) => {\n\n    const handlePlaceChange = (event: React.ChangeEvent<{ name?: string; value: any; }>) => {\n        selectPlace(event.target.value || null, places, true);\n    };\n\n    const handleRemoveButtonClick = () => {\n        if (selectedPlaceId !== null) {\n            removeUserPlace(selectedPlaceId, places);\n        }\n    };\n\n    places = places || [];\n    placeLabels = placeLabels || [];\n    selectedPlaceId = selectedPlaceId || '';\n    selectedPlaceGroupIds = selectedPlaceGroupIds || [];\n\n    const placeSelectLabel = (\n        <InputLabel\n            shrink\n            htmlFor=\"place-select\"\n        >\n            {i18n.get('Place')}\n        </InputLabel>\n    );\n\n    const placeSelect = (\n        <Select\n            variant=\"standard\"\n            value={selectedPlaceId}\n            onChange={handlePlaceChange}\n            input={<Input name=\"place\" id=\"place-select\"/>}\n            displayEmpty\n            name=\"place\"\n            className={classes.select}\n            disabled={places.length === 0}\n        >\n            {places.map((place, i) => (\n                <MenuItem\n                    key={place.id}\n                    value={place.id}\n                    selected={place.id === selectedPlaceId}\n                >\n                    {placeLabels[i]}\n                </MenuItem>\n            ))}\n        </Select>\n    );\n\n    const removeEnabled = places.length > 0\n        && selectedPlaceGroupIds.length === 1\n        && selectedPlaceGroupIds[0] === 'user'\n        && selectedPlaceId !== '';\n    const placeRemoveButton = (\n        <IconButton\n            className={classes.button}\n            disabled={!removeEnabled}\n            onClick={handleRemoveButtonClick}\n            size=\"large\">\n            <Tooltip arrow title={i18n.get('Remove place')}>\n                {<RemoveCircleOutlineIcon/>}\n            </Tooltip>\n        </IconButton>\n    );\n\n    return (\n        <ControlBarItem\n            label={placeSelectLabel}\n            control={placeSelect}\n            actions={placeRemoveButton}\n        />\n    );\n};\n\nexport default withStyles(styles)(PlaceSelect);\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport PlaceSelect from \"../components/PlaceSelect\";\nimport { AppState } from '../states/appState';\nimport { removeUserPlace } from \"../actions/dataActions\";\nimport { selectPlace, openDialog } from '../actions/controlActions';\nimport {\n    selectedPlaceGroupPlacesSelector,\n    selectedPlaceGroupPlaceLabelsSelector\n} from '../selectors/controlSelectors';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n\n        datasets: state.dataState.datasets,\n        userPlaceGroup: state.dataState.userPlaceGroup,\n\n        selectedPlaceGroupIds: state.controlState.selectedPlaceGroupIds,\n        selectedPlaceId: state.controlState.selectedPlaceId,\n        places: selectedPlaceGroupPlacesSelector(state),\n        placeLabels: selectedPlaceGroupPlaceLabelsSelector(state),\n    };\n};\n\nconst mapDispatchToProps = {\n    selectPlace,\n    removeUserPlace,\n    openDialog,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(PlaceSelect);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport FormControl from '@mui/material/FormControl';\nimport makeStyles from '@mui/styles/makeStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport AddLocationIcon from '@mui/icons-material/AddLocation';\nimport CategoryIcon from '@mui/icons-material/Category';\nimport CenterFocusStrongIcon from '@mui/icons-material/CenterFocusStrong';\nimport FiberManualRecordIcon from '@mui/icons-material/FiberManualRecord';\nimport FileUploadIcon from '@mui/icons-material/CloudUpload';\nimport ToggleButton from '@mui/material/ToggleButton';\nimport ToggleButtonGroup from '@mui/material/ToggleButtonGroup';\n\nimport i18n from '../i18n';\nimport { MapInteraction } from \"../states/controlState\";\nimport { WithLocale } from '../util/lang';\n\n\nconst useStyles = makeStyles(theme => ({\n        formControl: {\n            marginTop: theme.spacing(1.5),\n            marginRight: theme.spacing(2),\n        },\n    }\n));\n\ninterface MapInteractionsBarProps extends WithLocale {\n    mapInteraction: MapInteraction;\n    setMapInteraction: (interaction: MapInteraction) => void;\n}\n\nexport default function MapInteractionsBar({mapInteraction, setMapInteraction}: MapInteractionsBarProps) {\n    const classes = useStyles();\n\n    function handleChange(event: React.MouseEvent<HTMLElement>, value: MapInteraction | null) {\n        if (value !== null) {\n            setMapInteraction(value);\n        } else {\n            setMapInteraction('Select');\n        }\n    }\n\n    return (\n        <FormControl variant=\"standard\" className={classes.formControl}>\n            <ToggleButtonGroup size=\"small\" value={mapInteraction} exclusive onChange={handleChange}>\n                <ToggleButton key={0} value=\"Select\">\n                    <Tooltip arrow title={i18n.get('Select a place in map')}>\n                        <CenterFocusStrongIcon/>\n                    </Tooltip>\n                </ToggleButton>\n                <ToggleButton key={1} value=\"Point\">\n                    <Tooltip arrow title={i18n.get('Add a point location in map')}>\n                        <AddLocationIcon/>\n                    </Tooltip>\n                </ToggleButton>\n                <ToggleButton key={2} value=\"Polygon\">\n                    <Tooltip arrow title={i18n.get('Draw a polygon area in map')}>\n                        <CategoryIcon/>\n                    </Tooltip>\n                </ToggleButton>\n                <ToggleButton key={3} value=\"Circle\">\n                    <Tooltip arrow title={i18n.get('Draw a circular area in map')}>\n                        <FiberManualRecordIcon/>\n                    </Tooltip>\n                </ToggleButton>\n                <ToggleButton key={4} value=\"Geometry\">\n                    <Tooltip arrow title={i18n.get('Import geometry')}>\n                        <FileUploadIcon/>\n                    </Tooltip>\n                </ToggleButton>\n            </ToggleButtonGroup>\n        </FormControl>\n    );\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport MapInteractionsBar from '../components/MapInteractionsBar';\nimport { AppState } from '../states/appState';\nimport { setMapInteraction } from '../actions/controlActions';\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        mapInteraction: state.controlState.mapInteraction,\n    };\n};\n\nconst mapDispatchToProps = {\n    setMapInteraction,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MapInteractionsBar);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { Theme } from '@mui/material';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport { WithStyles } from '@mui/styles';\nimport TextField from '@mui/material/TextField';\nimport InputLabel from '@mui/material/InputLabel/InputLabel';\nimport { LocalizationProvider } from '@mui/x-date-pickers/LocalizationProvider';\nimport { AdapterDateFns } from '@mui/x-date-pickers/AdapterDateFns';\nimport { DateTimePicker } from '@mui/x-date-pickers/DateTimePicker';\n\nimport i18n from '../i18n';\nimport { Time, TimeRange } from '../model/timeSeries';\nimport { WithLocale } from '../util/lang';\nimport { dateTimeToUtcTime, utcTimeToIsoDate } from '../util/time';\nimport ControlBarItem from './ControlBarItem';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {}\n);\n\ninterface TimeSelectProps extends WithStyles<typeof styles>, WithLocale {\n    hasTimeDimension?: boolean;\n    selectedTime: Time | null;\n    selectTime: (time: Time | null) => void;\n    selectedTimeRange: TimeRange | null;\n}\n\n\nconst TimeSelect: React.FC<TimeSelectProps> = ({\n                                                   hasTimeDimension,\n                                                   selectedTime,\n                                                   selectedTimeRange,\n                                                   selectTime\n                                               }) => {\n\n    const handleTimeChange = (date: Date | null) => {\n        selectTime(date !== null ? dateTimeToUtcTime(date!) : null);\n    };\n\n    const timeInputLabel = (\n        <InputLabel\n            shrink\n            htmlFor=\"time-select\"\n        >\n            {`${i18n.get('Time')} (UTC)`}\n        </InputLabel>\n    );\n\n    const isValid = typeof selectedTime === 'number';\n    const timeValue = isValid ? utcTimeToIsoDate(selectedTime!) : null;\n\n    let minTimeValue, maxTimeValue;\n    if (Array.isArray(selectedTimeRange)) {\n        minTimeValue = utcTimeToIsoDate(selectedTimeRange[0]);\n        maxTimeValue = utcTimeToIsoDate(selectedTimeRange[1]);\n    }\n\n    const timeInput = (\n        <LocalizationProvider dateAdapter={AdapterDateFns}>\n            <DateTimePicker\n                disabled={!hasTimeDimension}\n                variant=\"inline\"\n                emptyLabel={\n                    !hasTimeDimension\n                        ? i18n.get('Missing time axis')\n                        : undefined\n                }\n                inputFormat=\"yyyy-MM-dd hh:mm:ss\"\n                id=\"time-select\"\n                value={timeValue}\n                minDateTime={minTimeValue}\n                maxDateTime={maxTimeValue}\n                onChange={handleTimeChange}\n                ampm={false}\n                renderInput={(props: any) => (\n                    <TextField\n                        {...props}\n                        variant=\"standard\"\n                        size=\"small\"\n                    />\n                )}\n            />\n        </LocalizationProvider>\n    );\n\n    return (\n        <ControlBarItem\n            label={timeInputLabel}\n            control={timeInput}\n        />\n    );\n};\n\nexport default withStyles(styles)(TimeSelect);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport TimeSelect from '../components/TimeSelect';\nimport { selectTime } from '../actions/controlActions';\nimport { selectedDatasetTimeDimensionSelector } from \"../selectors/controlSelectors\";\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n\n        hasTimeDimension: !!selectedDatasetTimeDimensionSelector(state),\n        selectedTime: state.controlState.selectedTime,\n        selectedTimeRange: state.controlState.selectedTimeRange,\n    };\n};\n\nconst mapDispatchToProps = {\n    selectTime,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TimeSelect);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport { Theme } from '@mui/material';\nimport Box from '@mui/material/Box';\nimport Slider, { Mark } from '@mui/material/Slider';\nimport Tooltip from '@mui/material/Tooltip';\n\nimport i18n from '../i18n';\nimport { Time, TimeRange, UNIT } from '../model/timeSeries';\nimport { utcTimeToIsoDateString, utcTimeToIsoDateTimeString, } from '../util/time';\n\nconst HOR_MARGIN = 5;\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        box: {\n            marginTop: theme.spacing(2),\n            marginLeft: theme.spacing(HOR_MARGIN),\n            marginRight: theme.spacing(HOR_MARGIN),\n            minWidth: 200,\n        },\n        label: {\n            color: \"grey\",\n            fontSize: \"1em\",\n        }\n    }\n);\n\ninterface TimeSliderProps extends WithStyles<typeof styles> {\n    hasTimeDimension?: boolean;\n    selectedTime?: Time | null;\n    selectTime?: (time: Time | null) => void;\n    selectedTimeRange?: TimeRange | null;\n    selectTimeRange?: (timeRange: TimeRange | null) => void;\n}\n\n\nconst TimeSlider: React.FC<TimeSliderProps> = ({\n                                                   classes,\n                                                   hasTimeDimension,\n                                                   selectedTime,\n                                                   selectTime,\n                                                   selectedTimeRange\n                                               }) => {\n    const [selectedTime_, setSelectedTime_] = useState(selectedTime);\n\n    useEffect(() => {\n        setSelectedTime_(selectedTime || (selectedTimeRange ? selectedTimeRange[0] : 0));\n    }, [selectedTime, selectedTimeRange]);\n\n    if (!hasTimeDimension) {\n        return null;\n    }\n\n    const handleChange = (event: Event, value: number | number[]) => {\n        if (typeof value === 'number') {\n            setSelectedTime_(value);\n        }\n    };\n\n    const handleChangeCommitted = (event: Event | SyntheticEvent, value: number | number[]) => {\n        if (selectTime && typeof value === 'number') {\n            selectTime(value as number);\n        }\n    };\n\n    let selectedTimeRangeValid = Array.isArray(selectedTimeRange);\n    if (!selectedTimeRangeValid) {\n        selectedTimeRange = [Date.now() - 2 * UNIT.years, Date.now()];\n    }\n\n    const marks: Mark[] = [\n        {value: selectedTimeRange![0], label: utcTimeToIsoDateString(selectedTimeRange![0])},\n        {value: selectedTimeRange![1], label: utcTimeToIsoDateString(selectedTimeRange![1])},\n    ];\n\n    function valueLabelFormat(value: number) {\n        return utcTimeToIsoDateTimeString(value);\n    }\n\n    return (\n        <Box className={classes.box}>\n            <Tooltip arrow title={i18n.get('Select time in dataset')}>\n                <Slider\n                    disabled={!selectedTimeRangeValid}\n                    min={selectedTimeRange![0]}\n                    max={selectedTimeRange![1]}\n                    value={selectedTime_ || 0}\n                    valueLabelDisplay=\"off\"\n                    valueLabelFormat={valueLabelFormat}\n                    marks={marks}\n                    onChange={handleChange}\n                    onChangeCommitted={handleChangeCommitted}\n                    size=\"small\"\n                />\n            </Tooltip>\n        </Box>\n    );\n};\n\nexport default withStyles(styles)(TimeSlider);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport TimeSlider from '../components/TimeSlider';\nimport { selectTime, selectTimeRange } from '../actions/controlActions';\nimport { selectedDatasetTimeDimensionSelector } from '../selectors/controlSelectors';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n\n        hasTimeDimension: !!selectedDatasetTimeDimensionSelector(state),\n        selectedTime: state.controlState.selectedTime,\n        selectedTimeRange: state.controlState.selectedTimeRange,\n    };\n};\n\nconst mapDispatchToProps = {\n    selectTime,\n    selectTimeRange,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TimeSlider);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Theme } from '@mui/material';\nimport Box from '@mui/material/Box';\nimport FormControl from '@mui/material/FormControl';\nimport IconButton from '@mui/material/IconButton';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport ChevronLeftIcon from '@mui/icons-material/ChevronLeft';\nimport ChevronRightIcon from '@mui/icons-material/ChevronRight';\nimport FirstPageIcon from '@mui/icons-material/FirstPage';\nimport LastPageIcon from '@mui/icons-material/LastPage';\nimport PauseCircleOutline from '@mui/icons-material/PauseCircleOutline';\nimport PlayCircleOutline from '@mui/icons-material/PlayCircleOutline';\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport i18n from '../i18n';\n\nimport { Time, TimeRange } from '../model/timeSeries';\nimport { TimeAnimationInterval } from '../states/controlState';\nimport { WithLocale } from '../util/lang';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        formControl: {\n            marginTop: theme.spacing(1),\n            marginRight: theme.spacing(1),\n        },\n    }\n);\n\ninterface TimePlayerProps extends WithStyles<typeof styles>, WithLocale {\n    selectedTime: Time | null;\n    selectTime: (time: Time | null) => void;\n    incSelectedTime: (increment: -1 | 1) => void;\n    selectedTimeRange: TimeRange | null;\n    timeAnimationActive: boolean;\n    timeAnimationInterval: TimeAnimationInterval;\n    updateTimeAnimation: (active: boolean, interval: TimeAnimationInterval) => void;\n}\n\n\nconst TimePlayer: React.FC<TimePlayerProps> = ({\n                                                   classes,\n                                                   timeAnimationActive,\n                                                   timeAnimationInterval,\n                                                   updateTimeAnimation,\n                                                   selectedTime,\n                                                   selectedTimeRange,\n                                                   selectTime,\n                                                   incSelectedTime\n                                               }) => {\n\n    const intervalId = useRef<number | null>(null);\n\n    useEffect(() => {\n        playOrNot();\n        return uninstallTimer;\n    });\n\n    const handlePlayEvent = () => {\n        incSelectedTime(1);\n    };\n\n    const handlePlayButtonClick = () => {\n        updateTimeAnimation(!timeAnimationActive, timeAnimationInterval);\n    };\n\n    const handleNextTimeStepButtonClick = () => {\n        incSelectedTime(1);\n    };\n\n    const handlePrevTimeStepButtonClick = () => {\n        incSelectedTime(-1);\n    };\n\n    const handleFirstTimeStepButtonClick = () => {\n        selectTime(selectedTimeRange ? selectedTimeRange[0] : null);\n    };\n\n    const handleLastTimeStepButtonClick = () => {\n        selectTime(selectedTimeRange ? selectedTimeRange[1] : null);\n    };\n\n    const playOrNot = () => {\n        if (timeAnimationActive) {\n            installTimer();\n        } else {\n            uninstallTimer();\n        }\n    };\n\n    const installTimer = () => {\n        uninstallTimer();\n        intervalId.current = window.setInterval(handlePlayEvent, timeAnimationInterval);\n    };\n\n    const uninstallTimer = () => {\n        if (intervalId.current !== null) {\n            window.clearInterval(intervalId.current!);\n            intervalId.current = null;\n        }\n    };\n\n\n    const isValid = typeof selectedTime === 'number';\n\n    const playToolTip = i18n.get(timeAnimationActive ? 'Stop' : 'Start');\n    const playIcon = timeAnimationActive ? <PauseCircleOutline/> : <PlayCircleOutline/>;\n\n    const playButton = (\n        <IconButton\n            disabled={!isValid}\n            aria-label={playToolTip}\n            onClick={handlePlayButtonClick}\n            size=\"large\">\n            <Tooltip arrow title={i18n.get('Auto-step through times in the dataset')}>\n                {playIcon}\n            </Tooltip>\n        </IconButton>\n    );\n\n    const firstTimeStepButton = (\n        <IconButton\n            disabled={!isValid || timeAnimationActive}\n            onClick={handleFirstTimeStepButtonClick}\n            size=\"large\">\n            <FirstPageIcon/>\n        </IconButton>\n    );\n\n    const prevTimeStepButton = (\n        <IconButton\n            disabled={!isValid || timeAnimationActive}\n            onClick={handlePrevTimeStepButtonClick}\n            size=\"large\">\n            <ChevronLeftIcon/>\n        </IconButton>\n    );\n    const nextTimeStepButton = (\n        <IconButton\n            disabled={!isValid || timeAnimationActive}\n            onClick={handleNextTimeStepButtonClick}\n            size=\"large\">\n            <ChevronRightIcon/>\n        </IconButton>\n    );\n    const lastTimeStepButton = (\n        <IconButton\n            disabled={!isValid || timeAnimationActive}\n            onClick={handleLastTimeStepButtonClick}\n            size=\"large\">\n            <LastPageIcon/>\n        </IconButton>);\n\n    return (\n        <FormControl variant=\"standard\" className={classes.formControl}>\n            <Box>\n                {firstTimeStepButton}\n                {prevTimeStepButton}\n                {playButton}\n                {nextTimeStepButton}\n                {lastTimeStepButton}\n            </Box>\n        </FormControl>\n    );\n};\n\nexport default withStyles(styles)(TimePlayer);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport TimePlayer from '../components/TimePlayer';\nimport { selectTime, incSelectedTime, updateTimeAnimation } from '../actions/controlActions';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n\n        selectedTime: state.controlState.selectedTime,\n        selectedTimeRange: state.controlState.selectedTimeRange,\n        timeAnimationActive: state.controlState.timeAnimationActive,\n        timeAnimationInterval: state.controlState.timeAnimationInterval,\n    };\n};\n\nconst mapDispatchToProps = {\n    selectTime,\n    incSelectedTime,\n    updateTimeAnimation,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TimePlayer);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport Box from '@mui/material/Box';\nimport FormControl from '@mui/material/FormControl';\nimport IconButton from '@mui/material/IconButton';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport CloudDownloadIcon from '@mui/icons-material/CloudDownload';\nimport InfoIcon from '@mui/icons-material/Info';\nimport VolumeIcon from '@mui/icons-material/ThreeDRotation';\nimport MyLocationIcon from '@mui/icons-material/MyLocation';\n\nimport { Config } from '../config';\nimport i18n from '../i18n';\nimport { TimeSeriesGroup } from '../model/timeSeries';\nimport { WithLocale } from '../util/lang';\nimport RefreshIcon from \"@mui/icons-material/Refresh\";\nimport SettingsIcon from \"@mui/icons-material/Settings\";\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        formControl: {\n            marginTop: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            marginLeft: 'auto',\n        },\n    });\n\ninterface ControlBarActionsProps extends WithStyles<typeof styles>, WithLocale {\n    visible: boolean;\n    flyToSelectedObject: () => void;\n    volumeCardOpen: boolean;\n    showVolumeCard: (open: boolean) => void;\n    infoCardOpen: boolean;\n    showInfoCard: (open: boolean) => void;\n    timeSeriesGroups: TimeSeriesGroup[];\n    openDialog: (dialogId: string) => void;\n    allowRefresh?: boolean;\n    updateResources: () => any;\n    compact: boolean;\n}\n\nconst ControlBarActions: React.FC<ControlBarActionsProps> = (\n    {\n        classes,\n        visible,\n        flyToSelectedObject,\n        volumeCardOpen,\n        showVolumeCard,\n        infoCardOpen,\n        showInfoCard,\n        timeSeriesGroups,\n        openDialog,\n        allowRefresh,\n        updateResources,\n        compact\n    }\n) => {\n    if (!visible) {\n        return null;\n    }\n\n    const canDownload = timeSeriesGroups.length > 0;\n\n    let downloadButton;\n    if (Config.instance.branding.allowDownloads) {\n        downloadButton = (\n            <IconButton disabled={!canDownload} onClick={() => openDialog('export')} size=\"small\">\n                <Tooltip arrow title={i18n.get('Export data')}>\n                    {<CloudDownloadIcon/>}\n                </Tooltip>\n            </IconButton>\n        );\n    }\n\n    const flyToButton = (\n        <IconButton onClick={flyToSelectedObject} size=\"small\">\n            <Tooltip arrow title={i18n.get('Show selected place in map')}>\n                <MyLocationIcon/>\n            </Tooltip>\n        </IconButton>\n    );\n\n    /*TODO: I18N*/\n    let volumeButton = Config.instance.branding.allow3D && (\n            <IconButton onClick={() => showVolumeCard(true)} disabled={volumeCardOpen} size=\"large\">\n                <Tooltip arrow title={'Open volume panel (experimental!)'}>\n                    {<VolumeIcon/>}\n                </Tooltip>\n            </IconButton>\n    );\n\n    let infoButton = (\n        <IconButton onClick={() => showInfoCard(true)} disabled={infoCardOpen} size=\"small\">\n            <Tooltip arrow title={i18n.get('Open information panel')}>\n                {<InfoIcon/>}\n            </Tooltip>\n        </IconButton>\n    );\n\n\n    let refreshButton;\n    let settingsButton;\n\n    if (compact) {\n        if (allowRefresh) {\n            refreshButton = (\n                <IconButton onClick={updateResources} size=\"small\">\n                    <Tooltip arrow title={i18n.get('Refresh')}>\n                        <RefreshIcon/>\n                    </Tooltip>\n                </IconButton>\n            );\n        }\n        settingsButton = (\n            <IconButton onClick={() => openDialog('settings')} size=\"small\">\n                <Tooltip arrow title={i18n.get('Settings')}>\n                    <SettingsIcon/>\n                </Tooltip>\n            </IconButton>\n        );\n    }\n\n    return (\n        <FormControl variant=\"standard\" className={classes.formControl}>\n            <Box>\n                {refreshButton}\n                {downloadButton}\n                {flyToButton}\n                {volumeButton}\n                {infoButton}\n                {settingsButton}\n            </Box>\n        </FormControl>\n    );\n};\n\nexport default withStyles(styles)(ControlBarActions);\n\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport ControlBarActions from '../components/ControlBarActions';\nimport {\n    flyToSelectedObject,\n    openDialog,\n    showInfoCard,\n    showVolumeCard,\n} from '../actions/controlActions';\nimport { Config } from '../config';\nimport { updateResources } from '../actions/dataActions';\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        visible: !!(state.controlState.selectedDatasetId || state.controlState.selectedPlaceId),\n        volumeCardOpen: state.controlState.volumeCardOpen,\n        infoCardOpen: state.controlState.infoCardOpen,\n        timeSeriesGroups: state.dataState.timeSeriesGroups,\n        compact: Config.instance.branding.compact,\n        allowRefresh: Config.instance.branding.allowRefresh,\n    }\n};\n\nconst mapDispatchToProps = {\n    showVolumeCard,\n    showInfoCard,\n    flyToSelectedObject,\n    openDialog,\n    updateResources,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ControlBarActions);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport ControlBar from '../components/ControlBar';\nimport { WithLocale } from '../util/lang';\nimport DatasetSelect from './DatasetSelect';\nimport VariableSelect from './VariableSelect';\nimport RgbSwitch from './RgbSwitch';\nimport PlaceGroupsSelect from './PlaceGroupsSelect';\nimport PlaceSelect from './PlaceSelect';\nimport MapInteractionsBar from './MapInteractionsBar';\nimport TimeSelect from './TimeSelect';\nimport TimeSlider from './TimeSlider';\nimport TimePlayer from './TimePlayer';\nimport ControlBarActions from './ControlBarActions';\n\ninterface ControlBarProps extends WithLocale {\n    show: boolean;\n}\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        show: state.dataState.datasets.length > 0,\n    };\n};\n\nconst mapDispatchToProps = {};\n\nconst _ControlBar: React.FC<ControlBarProps> = ({show}) => {\n    if (!show) {\n        return null;\n    }\n    return (\n        <ControlBar>\n            <DatasetSelect/>\n            <VariableSelect/>\n            <RgbSwitch/>\n            <PlaceGroupsSelect/>\n            <PlaceSelect/>\n            <MapInteractionsBar/>\n            <TimeSelect/>\n            <TimePlayer/>\n            <TimeSlider/>\n            <ControlBarActions/>\n        </ControlBar>\n    );\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(_ControlBar);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport i18n from '../i18n';\nimport { WithLocale } from '../util/lang';\n\nimport './ErrorBoundary.css';\n\n\ninterface ErrorBoundaryProps extends WithLocale {\n}\n\ninterface ErrorBoundaryState {\n    error: Error | null;\n}\n\n/**\n * An error boundary is used to catch JavaScript errors anywhere in their child component tree, log those errors,\n * and display a fallback UI (see https://reactjs.org/docs/error-boundaries.html).\n */\nexport default class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\n    constructor(props: object) {\n        super(props);\n        this.state = {error: null};\n    }\n\n    static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n        // Update state so the next render will show the fallback UI.\n        return {error};\n    }\n\n    componentDidCatch(error: Error, errorInfo: React.ErrorInfo): void {\n        // log error information here, e.g. send info to API\n        console.error(error);\n        if (errorInfo.componentStack) {\n            console.error(errorInfo.componentStack);\n        }\n    }\n\n    render() {\n        if (!this.props.children) {\n            throw new Error('An ErrorBoundary requires at least one child');\n        }\n\n        if (!this.state.error) {\n            return this.props.children;\n        }\n\n        return (\n            <div>\n                <h2 className=\"errorBoundary-header\">{i18n.get(\"Something went wrong.\")}</h2>\n                <details className=\"errorBoundary-details\" style={{whiteSpace: 'pre-wrap'}}>\n                    {this.state.error.toString()}\n                    <br/>\n                </details>\n            </div>\n        );\n    }\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { default as OlMap } from 'ol/Map';\nimport { Control as OlControl } from 'ol/control';\n\nimport { MapComponent, MapComponentProps } from \"../MapComponent\";\n\n\ninterface ControlProps extends MapComponentProps {\n    style?: React.CSSProperties;\n    className?: string;\n}\n\nexport class Control extends MapComponent<OlControl, ControlProps> {\n    divRef: HTMLDivElement | null = null;\n\n    handleDivRef = (divRef: HTMLDivElement | null) => {\n        this.divRef = divRef;\n    };\n\n    addMapObject(map: OlMap): OlControl {\n        // console.log(`Control: added control '${this.props.id}'`);\n        const control = new OlControl({element: this.divRef!});\n        map.addControl(control);\n        return control;\n    }\n\n    updateMapObject(map: OlMap, control: OlControl, prevProps: Readonly<ControlProps>): OlControl {\n        return control;\n    }\n\n    removeMapObject(map: OlMap, control: OlControl): void {\n        for (let addedControl of map.getControls().getArray()) {\n            if (addedControl === control) {\n                // console.log(`Control: removing control '${this.props.id}'`);\n                map.removeControl(control);\n                break;\n            }\n        }\n    }\n\n    render() {\n        const {children, style, className} = this.props;\n        const _className = (className ? className + ' ' : '') + 'ol-unselectable ol-control';\n        return <div style={style} className={_className} ref={this.handleDivRef}>{children}</div>;\n    }\n}\n\n\n\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { default as OlMap } from 'ol/Map';\nimport { default as OlScaleLineControl } from 'ol/control/ScaleLine';\nimport { Options as OlScaleLineControlOptions} from 'ol/control/ScaleLine';\n\nimport { MapComponent, MapComponentProps } from '../MapComponent';\n\n\ninterface ScaleLineProps extends MapComponentProps, OlScaleLineControlOptions {\n    bar?: boolean;\n    steps?: number;\n    text?: boolean;\n}\n\nexport class ScaleLine extends MapComponent<OlScaleLineControl, ScaleLineProps> {\n\n    addMapObject(map: OlMap): OlScaleLineControl {\n        const control = new OlScaleLineControl(this.getOptions());\n        map.addControl(control);\n        return control;\n    }\n\n    updateMapObject(map: OlMap, control: OlScaleLineControl, prevProps: Readonly<ScaleLineProps>): OlScaleLineControl {\n        control.setProperties(this.getOptions());\n        return control;\n    }\n\n    removeMapObject(map: OlMap, control: OlScaleLineControl): void {\n        map.removeControl(control);\n    }\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { default as OlMap } from 'ol/Map';\nimport { default as OlVectorLayer } from 'ol/layer/Vector';\nimport { default as OlDrawInteraction } from 'ol/interaction/Draw';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { Options as OlDrawInteractionOptions } from 'ol/interaction/Draw';\n\nimport { MapComponent, MapComponentProps } from '../MapComponent';\n\nexport type DrawEvent = OlDrawEvent;\nexport type DrawListener = ((event: DrawEvent) => void) | ((event: DrawEvent) => boolean);\n\ninterface DrawProps extends MapComponentProps, OlDrawInteractionOptions {\n    layerId?: string;\n    active?: boolean;\n    onDrawStart?: DrawListener;\n    onDrawEnd?: DrawListener;\n}\n\nexport class Draw extends MapComponent<OlDrawInteraction, DrawProps> {\n\n    addMapObject(map: OlMap): OlDrawInteraction {\n        const draw = new OlDrawInteraction(this.getOptions());\n        let active = !!this.props.active;\n        draw.setActive(active);\n        map.addInteraction(draw);\n        if (active) {\n            this.listen(draw, this.props);\n        }\n        return draw;\n    }\n\n    updateMapObject(map: OlMap, draw: OlDrawInteraction, prevProps: Readonly<DrawProps>): OlDrawInteraction {\n        draw.setProperties(this.getOptions());\n        let active = !!this.props.active;\n        draw.setActive(active);\n        this.unlisten(draw, prevProps);\n        if (active) {\n            this.listen(draw, this.props);\n        }\n        return draw;\n    }\n\n    removeMapObject(map: OlMap, draw: OlDrawInteraction): void {\n        this.unlisten(draw, this.props);\n        map.removeInteraction(draw);\n    }\n\n    getOptions(): OlDrawInteractionOptions {\n        let options = super.getOptions();\n        delete options['layerId'];\n        delete options['active'];\n        delete options['onDrawStart'];\n        delete options['onDrawEnd'];\n        const layerId = this.props.layerId;\n        if (layerId && !options.source) {\n            const vectorLayer = this.getMapObject(layerId);\n            if (vectorLayer) {\n                options['source'] = (vectorLayer as OlVectorLayer).getSource();\n            }\n        }\n        return options;\n    }\n\n    private listen(draw: OlDrawInteraction, props: Readonly<DrawProps>) {\n        const {onDrawStart, onDrawEnd} = props;\n        if (onDrawStart) {\n            draw.on('drawstart', onDrawStart);\n        }\n        if (onDrawEnd) {\n            draw.on('drawend', onDrawEnd);\n        }\n    }\n\n    private unlisten(draw: OlDrawInteraction, props: Readonly<DrawProps>) {\n        const {onDrawStart, onDrawEnd} = props;\n        if (onDrawStart) {\n            draw.un('drawstart', onDrawStart);\n        }\n        if (onDrawEnd) {\n            draw.un('drawend', onDrawEnd);\n        }\n    }\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport {default as OlMap} from 'ol/Map';\nimport {default as OlView, ViewOptions as OlViewOptions} from 'ol/View';\nimport { default as OlVectorLayer } from 'ol/layer/Vector';\nimport {ProjectionLike as OlProjectionLike, transform as olTransform} from 'ol/proj';\n\nimport {MapComponent, MapComponentProps} from \"./MapComponent\";\n\ninterface ViewProps extends MapComponentProps, OlViewOptions {\n}\n\nexport class View extends MapComponent<OlView, ViewProps> {\n\n    addMapObject(map: OlMap): OlView {\n        return this.updateView(map);\n    }\n\n    removeMapObject(map: OlMap, object: OlView): void {\n    }\n\n    updateMapObject(map: OlMap, object: OlView): OlView {\n        return this.updateView(map);\n    }\n\n    updateView(map: OlMap): OlView {\n        const newProjection = this.props.projection;\n        let oldProjection: OlProjectionLike = map.getView().getProjection();\n        if (typeof newProjection === 'string') {\n            if (oldProjection) {\n                oldProjection = oldProjection.getCode();\n            }\n        }\n        if (newProjection && newProjection !== oldProjection) {\n            const oldView = map.getView();\n            const newView = new OlView({\n                ...this.props,\n                center: olTransform(oldView.getCenter() || [0, 0],\n                    oldProjection,\n                    newProjection\n                ),\n                minZoom: oldView.getMinZoom(),\n                zoom: oldView.getZoom(),\n            });\n            map.getLayers().forEach(layer => {\n                if (layer instanceof OlVectorLayer) {\n                    layer.getSource().forEachFeature(feature => {\n                        feature.getGeometry()?.transform(oldProjection, newProjection);\n                    });\n                }\n            })\n            map.setView(newView);\n        } else {\n            map.getView().setProperties(this.props);\n        }\n        return map.getView();\n    }\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { default as OlStyle } from \"ol/style/Style\";\nimport { default as  OlFeature} from \"ol/Feature\";\nimport { default as OlFillStyle } from \"ol/style/Fill\";\nimport { default as OlStrokeStyle } from \"ol/style/Stroke\";\nimport { default as OlCircleStyle } from \"ol/style/Circle\";\nimport { Color as OlColor } from \"ol/color\";\nimport { default as OlPoint } from \"ol/geom/Point\";\nimport rgba from \"color-rgba\";\n\n\nexport function setFeatureStyle(feature: OlFeature, color: string, fillOpacity?: number) {\n    if (feature.getGeometry() instanceof OlPoint) {\n        feature.setStyle(createPointGeometryStyle(7, color, 'white', 1));\n    } else {\n        fillOpacity = typeof fillOpacity === \"number\" ? fillOpacity : 0.25;\n        let fillColorRgba = rgba(color);\n        if (Array.isArray(fillColorRgba)) {\n            fillColorRgba = [fillColorRgba[0], fillColorRgba[1], fillColorRgba[2], fillOpacity];\n        } else {\n            fillColorRgba = [255, 255, 255, fillOpacity];\n        }\n        feature.setStyle(createGeometryStyle(fillColorRgba, color, 2));\n    }\n}\n\n\nexport function createPointGeometryStyle(radius: number,\n                                         fillColor: string,\n                                         strokeColor: string,\n                                         strokeWidth: number): OlStyle {\n    const fill = new OlFillStyle(\n        {\n            color: fillColor,\n        });\n    const stroke = new OlStrokeStyle(\n        {\n            color: strokeColor,\n            width: strokeWidth,\n        }\n    );\n    return new OlStyle(\n        {\n            image: new OlCircleStyle({radius, fill, stroke})\n        }\n    );\n}\n\nexport function createGeometryStyle(fillColor: string | OlColor,\n                                    strokeColor: string | OlColor,\n                                    strokeWidth: number): OlStyle {\n    const fill = new OlFillStyle(\n        {\n            color: fillColor,\n        });\n    const stroke = new OlStrokeStyle(\n        {\n            color: strokeColor,\n            width: strokeWidth,\n        }\n    );\n    return new OlStyle({fill, stroke});\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport * as geojson from 'geojson';\nimport { default as OlFeature } from 'ol/Feature';\nimport { default as OlGeoJSONFormat } from 'ol/format/GeoJSON';\nimport { default as OlCircleGeometry } from 'ol/geom/Circle';\nimport { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport { fromCircle as olPolygonFromCircle } from 'ol/geom/Polygon';\nimport { default as OlVectorLayer } from 'ol/layer/Vector';\nimport { default as OlMap } from 'ol/Map';\nimport { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\nimport { default as OlVectorSource } from 'ol/source/Vector';\nimport { default as OlTileLayer } from 'ol/layer/Tile';\nimport { default as OlCircleStyle } from 'ol/style/Circle';\nimport { default as OlFillStyle } from 'ol/style/Fill';\nimport { default as OlStrokeStyle } from 'ol/style/Stroke';\nimport { default as OlStyle } from 'ol/style/Style';\n\nimport { Config, getUserPlaceColor, getUserPlaceColorName } from '../config';\nimport i18n from '../i18n';\nimport { Place, PlaceGroup } from '../model/place';\nimport { MAP_OBJECTS, MapInteraction } from '../states/controlState';\nimport { newId } from '../util/id';\nimport { GEOGRAPHIC_CRS } from '../model/proj';\nimport ErrorBoundary from './ErrorBoundary';\nimport { Control } from './ol/control/Control';\nimport { ScaleLine } from './ol/control/ScaleLine';\nimport { Draw, DrawEvent } from './ol/interaction/Draw';\nimport { Layers } from './ol/layer/Layers';\nimport { Vector } from './ol/layer/Vector';\nimport { Map, MapElement } from './ol/Map';\nimport { View } from './ol/View';\nimport { setFeatureStyle } from './ol/style';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles({});\n\n// TODO (forman): no good design, store in some state instead:\nconst USER_LAYER_SOURCE = new OlVectorSource();\nconst SELECTION_LAYER_SOURCE = new OlVectorSource();\n\n// TODO (forman): move all map styles into dedicated module, so settings will be easier to find & adjust\n\nconst COLOR_LEGEND_STYLE: React.CSSProperties = {zIndex: 1000, right: 272, top: 10};\n\nconst SELECTION_LAYER_STROKE = new OlStrokeStyle({\n    color: [255, 200, 0, 1.0],\n    width: 3\n});\nconst SELECTION_LAYER_FILL = new OlFillStyle({\n    color: [255, 200, 0, 0.05]\n});\nconst SELECTION_LAYER_STYLE = new OlStyle({\n    stroke: SELECTION_LAYER_STROKE,\n    fill: SELECTION_LAYER_FILL,\n    image: new OlCircleStyle({\n        radius: 10,\n        stroke: SELECTION_LAYER_STROKE,\n        fill: SELECTION_LAYER_FILL,\n    })\n});\n\n\ninterface ViewerProps extends WithStyles<typeof styles> {\n    theme: Theme;\n    mapId: string;\n    mapInteraction: MapInteraction;\n    mapProjection: string;\n    baseMapLayer?: MapElement;\n    rgbLayer?: MapElement;\n    variableLayer?: MapElement;\n    datasetBoundaryLayer?: MapElement;\n    placeGroupLayers?: MapElement;\n    colorBarLegend?: MapElement;\n    addUserPlace?: (id: string, label: string, color: string, geometry: geojson.Geometry, selectPlace: boolean) => void;\n    userPlaceGroup: PlaceGroup;\n    selectPlace?: (placeId: string | null, places: Place[], showInMap: boolean) => void;\n    selectedPlaceId?: string | null;\n    places: Place[];\n    imageSmoothing?: boolean;\n    onMapRef: (map: OlMap | null) => void;\n    addUserPlacesFromText?: (text: string) => any;\n}\n\nconst Viewer: React.FC<ViewerProps> = ({\n                                           theme,\n                                           mapId,\n                                           mapInteraction,\n                                           mapProjection,\n                                           baseMapLayer,\n                                           rgbLayer,\n                                           variableLayer,\n                                           datasetBoundaryLayer,\n                                           placeGroupLayers,\n                                           colorBarLegend,\n                                           addUserPlace,\n                                           addUserPlacesFromText,\n                                           userPlaceGroup,\n                                           selectPlace,\n                                           selectedPlaceId,\n                                           places,\n                                           imageSmoothing,\n                                           onMapRef,\n                                       }) => {\n\n    const [map, setMap] = useState<OlMap | null>(null);\n    const [selectedPlaceIdPrev, setSelectedPlaceIdPrev] = useState<string | null>(selectedPlaceId || null);\n\n    useEffect(() => {\n        if (map) {\n            const selectedPlaceIdCurr = selectedPlaceId || null;\n            if (selectedPlaceIdCurr !== selectedPlaceIdPrev) {\n                SELECTION_LAYER_SOURCE.clear();\n                if (selectedPlaceIdCurr) {\n                    const selectedFeature = findFeatureById(map, selectedPlaceIdCurr);\n                    if (selectedFeature) {\n                        // We clone features, so we can set a new ID and clear the style, so the selection\n                        // layer style is used instead as default.\n                        const displayFeature = selectedFeature.clone();\n                        displayFeature.setId('Select-' + selectedFeature.getId());\n                        displayFeature.setStyle(undefined);\n                        SELECTION_LAYER_SOURCE.addFeature(displayFeature);\n                    }\n                }\n                setSelectedPlaceIdPrev(selectedPlaceIdCurr);\n            }\n        }\n    }, [map, selectedPlaceId, selectedPlaceIdPrev]);\n\n    useEffect(() => {\n        // Force layer source updates after imageSmoothing change\n        if (map) {\n            map.getLayers().forEach(layer => {\n                if (layer instanceof OlTileLayer) {\n                    layer.getSource().changed();\n                } else {\n                    layer.changed();\n                }\n            });\n        }\n    }, [map, imageSmoothing]);\n\n    const handleMapClick = (event: OlMapBrowserEvent) => {\n        if (mapInteraction === 'Select') {\n            const map = event.map;\n            let selectedPlaceId: string | null = null;\n            const features = map.getFeaturesAtPixel(event.pixel);\n            if (features) {\n                for (let f of features) {\n                    if (typeof f['getId'] === 'function') {\n                        selectedPlaceId = f['getId']() + '';\n                        break;\n                    }\n                }\n            }\n            if (selectPlace) {\n                selectPlace(selectedPlaceId, places, false);\n            }\n        }\n    };\n\n    const handleDrawEnd = (event: DrawEvent) => {\n        // TODO (forman): too much logic here! put the following code into an action + reducer.\n        if (map !== null && addUserPlace && mapInteraction !== 'Select') {\n            const feature = event.feature;\n            let geometry = feature.getGeometry();\n            if (!geometry) {\n                return;\n            }\n\n            const placeId = `User-${mapInteraction}-${newId()}`;\n            const projection = map.getView().getProjection();\n\n            if (geometry instanceof OlCircleGeometry) {\n                const polygon = olPolygonFromCircle(geometry as OlCircleGeometry);\n                feature.setGeometry(polygon);\n            }\n\n            // Beware: transform() is an in-place op\n            geometry = feature.clone().getGeometry()!.transform(projection, GEOGRAPHIC_CRS);\n            const geoJSONGeometry = new OlGeoJSONFormat().writeGeometryObject(geometry) as any;\n            feature.setId(placeId);\n            let colorIndex = 0;\n            if (MAP_OBJECTS.userLayer) {\n                const features = USER_LAYER_SOURCE.getFeatures();\n                colorIndex = features.length;\n            }\n            const color = getUserPlaceColorName(colorIndex);\n            const shadedColor = getUserPlaceColor(color, theme.palette.mode);\n            setFeatureStyle(feature, shadedColor, Config.instance.branding.polygonFillOpacity);\n\n            const nameBase = i18n.get(mapInteraction);\n            let label: string = '';\n            for (let index = 1; ; index++) {\n                label = `${nameBase} ${index}`;\n                // eslint-disable-next-line\n                if (!userPlaceGroup.features.find(p => (p.properties || {})['label'] === label)) {\n                    break;\n                }\n            }\n\n            addUserPlace(placeId, label, color, geoJSONGeometry as geojson.Geometry, true);\n        }\n        return true;\n    };\n\n    function handleMapRef(map: OlMap | null) {\n        if (onMapRef) {\n            onMapRef(map);\n        }\n        setMap(map);\n    }\n\n    let colorBarControl = null;\n    if (colorBarLegend) {\n        colorBarControl = (\n            <Control id=\"legend\" style={COLOR_LEGEND_STYLE}>\n                {colorBarLegend}\n            </Control>\n        );\n    }\n\n    // TODO (forman): fix me! this is a workaround to avoid that rgbLayer is never visible.\n    if (rgbLayer !== null) {\n        variableLayer = rgbLayer;\n    }\n\n    const handleDropFiles = (files: File[]) => {\n        if (addUserPlacesFromText) {\n            files.forEach(file => {\n                const reader = new FileReader();\n                reader.onloadend = () => {\n                    if (typeof reader.result === 'string') {\n                        addUserPlacesFromText(reader.result);\n                    }\n                };\n                reader.readAsText(file, \"UTF-8\");\n            });\n        }\n    };\n\n    return (\n        <ErrorBoundary>\n            <Map\n                id={mapId}\n                onClick={(event) => handleMapClick(event)}\n                onMapRef={handleMapRef}\n                mapObjects={MAP_OBJECTS}\n                isStale={true}\n                onDropFiles={handleDropFiles}\n            >\n                <View id=\"view\" projection={mapProjection}/>\n                <Layers>\n                    {baseMapLayer}\n                    {variableLayer}\n                    {datasetBoundaryLayer}\n                    <Vector\n                        id='userLayer'\n                        opacity={1}\n                        zIndex={500}\n                        source={USER_LAYER_SOURCE}\n                    />\n                    <Vector\n                        id='selectionLayer'\n                        opacity={0.7}\n                        zIndex={510}\n                        style={SELECTION_LAYER_STYLE}\n                        source={SELECTION_LAYER_SOURCE}\n                    />\n                </Layers>\n                {placeGroupLayers}\n                {/*<Select id='select' selectedFeaturesIds={selectedFeaturesId} onSelect={handleSelect}/>*/}\n                <Draw\n                    id=\"drawPoint\"\n                    layerId={'userLayer'}\n                    active={mapInteraction === 'Point'}\n                    type={OlGeometryType.POINT}\n                    wrapX={true}\n                    stopClick={true}\n                    onDrawEnd={handleDrawEnd}\n                />\n                <Draw\n                    id=\"drawPolygon\"\n                    layerId={'userLayer'}\n                    active={mapInteraction === 'Polygon'}\n                    type={OlGeometryType.POLYGON}\n                    wrapX={true}\n                    stopClick={true}\n                    onDrawEnd={handleDrawEnd}\n                />\n                <Draw\n                    id=\"drawCircle\"\n                    layerId={'userLayer'}\n                    active={mapInteraction === 'Circle'}\n                    type={OlGeometryType.CIRCLE}\n                    wrapX={true}\n                    stopClick={true}\n                    onDrawEnd={handleDrawEnd}\n                />\n                {colorBarControl}\n                <ScaleLine bar={false}/>\n            </Map>\n        </ErrorBoundary>\n    );\n};\n\nexport default withStyles(styles, {withTheme: true})(Viewer);\n\n\nfunction findFeatureById(map: OlMap, featureId: string | number): OlFeature | null {\n    for (let layer of map.getLayers().getArray()) {\n        if (layer instanceof OlVectorLayer) {\n            const vectorLayer = layer as OlVectorLayer;\n            const feature = vectorLayer.getSource().getFeatureById(featureId);\n            if (feature) {\n                return feature;\n            }\n        }\n    }\n    return null;\n}","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport function getLabelsFromArray(values: number[]): string[] {\n    const min = values[0];\n    const max = values[values.length - 1];\n    const fractionDigits = Math.min(10, Math.max(2, Math.round(-Math.log10(max - min))));\n    function _formatValue(value: number): string {\n        return formatValue(value, fractionDigits);\n    }\n    return values.map(_formatValue);\n}\n\nexport function getLabelsFromRange(minValue: number, maxValue: number, count: number = 5): string[] {\n    return getLabelsFromArray(arange(minValue, maxValue, count));\n}\n\nfunction formatValue(value: number, fractionDigits: number): string {\n    const valueRounded = Math.round(value);\n    if (Math.abs(valueRounded - value) < 1e-8) {\n        return valueRounded + '';\n    } else {\n        return value.toFixed(fractionDigits);\n    }\n}\n\nexport function arange(minValue: number, maxValue: number, count: number): number[] {\n    const delta = (maxValue - minValue) / (count - 1);\n    const ticks = new Array<number>(count);\n    for (let i = 0; i < count; i++) {\n        ticks[i] = minValue + i * delta;\n    }\n    return ticks;\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\n\nimport i18n from '../i18n';\nimport { ColorBar, renderColorBar } from '../model/colorBar';\n\n\ninterface ColorBarCanvasProps {\n    colorBar: ColorBar;\n    opacity: number;\n    width: number | string | undefined;\n    height: number | string | undefined;\n    onOpenEditor: (event: React.MouseEvent<HTMLCanvasElement>) => void;\n}\n\nexport const ColorBarCanvas: React.FC<ColorBarCanvasProps> = (\n    {\n        colorBar,\n        opacity,\n        width,\n        height,\n        onOpenEditor\n    }\n) => {\n    const canvasRef = useRef<HTMLCanvasElement | null>(null);\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (canvas !== null) {\n            renderColorBar(colorBar, opacity, canvas);\n        }\n    }, [colorBar, opacity]);\n\n    return <>\n        {Boolean(colorBar.imageData) ? (\n            <canvas\n                ref={canvasRef}\n                width={width || 240}\n                height={height || 24}\n                onClick={onOpenEditor}\n            />\n        ):(\n            <div>{i18n.get('Unknown color bar') + `: ${colorBar.baseName}`}</div>\n        )}\n    </>;\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { SyntheticEvent } from \"react\";\nimport makeStyles from '@mui/styles/makeStyles';\nimport TextField from '@mui/material/TextField';\nimport Box from '@mui/material/Box';\nimport Checkbox from '@mui/material/Checkbox';\nimport Popover from '@mui/material/Popover';\nimport Slider, { Mark } from '@mui/material/Slider';\nimport Tooltip from '@mui/material/Tooltip';\n\nimport i18n from '../i18n';\nimport { ColorBar, ColorBars, formatColorBar } from '../model/colorBar';\nimport { getLabelsFromArray, getLabelsFromRange } from '../util/label'\nimport { ColorBarCanvas } from \"./ColorBarCanvas\";\n\nconst HOR_SLIDER_MARGIN = 5;\nconst COLOR_BAR_BOX_MARGIN = 1;\nconst COLOR_BAR_ITEM_BOX_MARGIN = 0.2;\n\nconst useStyles = makeStyles(theme => ({\n        title: {\n            fontSize: 'x-small',\n            fontWeight: 'bold',\n            width: '100%',\n            display: 'flex',\n            flexWrap: 'nowrap',\n            justifyContent: 'center',\n            paddingBottom: theme.spacing(0.5),\n        },\n        label: {\n            fontSize: 'x-small',\n            fontWeight: 'bold',\n            width: '100%',\n            display: 'flex',\n            flexWrap: 'nowrap',\n            justifyContent: 'space-between',\n        },\n        container: {\n            paddingLeft: theme.spacing(1.5),\n            paddingRight: theme.spacing(1.5),\n            paddingBottom: theme.spacing(0.5),\n            paddingTop: theme.spacing(0.5),\n            color: 'black',\n        },\n        sliderBox: {\n            marginTop: theme.spacing(1),\n            marginLeft: theme.spacing(HOR_SLIDER_MARGIN),\n            marginRight: theme.spacing(HOR_SLIDER_MARGIN),\n            minWidth: 320,\n            width: `calc(100% - ${theme.spacing(2 * (HOR_SLIDER_MARGIN + 1))}px)`,\n        },\n        colorBarBox: {\n            marginTop: theme.spacing(COLOR_BAR_BOX_MARGIN - 2 * COLOR_BAR_ITEM_BOX_MARGIN),\n            marginLeft: theme.spacing(COLOR_BAR_BOX_MARGIN),\n            marginRight: theme.spacing(COLOR_BAR_BOX_MARGIN),\n            marginBottom: theme.spacing(COLOR_BAR_BOX_MARGIN),\n        },\n        colorBarGroupTitle: {\n            marginTop: theme.spacing(2 * COLOR_BAR_ITEM_BOX_MARGIN),\n            color: theme.palette.grey[400],\n        },\n        colorBarGroupItemBox: {\n            marginTop: theme.spacing(COLOR_BAR_ITEM_BOX_MARGIN),\n        },\n        colorBarMinMaxEditor: {\n            marginTop: theme.spacing(2),\n            marginBottom: theme.spacing(2),\n        },\n        minMaxBox: {\n            display: 'flex',\n            justifyContent: 'center'\n        },\n        minTextField: {\n            maxWidth: '8em',\n            paddingRight: 2,\n        },\n        maxTextField: {\n            maxWidth: '8em',\n            paddingLeft: 2,\n        },\n    }\n));\n\n\ninterface ColorBarLegendProps {\n    variableName: string | null;\n    variableUnits: string;\n    variableColorBarMinMax: [number, number];\n    variableColorBarName: string,\n    variableColorBar: ColorBar,\n    variableOpacity: number;\n    updateVariableColorBar: (colorBarMinMax: [number, number], colorBarName: string, opacity: number) => void;\n    colorBars: ColorBars | null;\n    width?: number | string;\n    height?: number | string;\n    numTicks?: number;\n}\n\nexport default function ColorBarLegend({\n                                           variableName,\n                                           variableUnits,\n                                           variableColorBarMinMax,\n                                           variableColorBarName,\n                                           variableColorBar,\n                                           variableOpacity,\n                                           updateVariableColorBar,\n                                           colorBars,\n                                           width, height,\n                                           numTicks\n                                       }: ColorBarLegendProps) {\n    const classes = useStyles();\n    const [colorBarMinMaxAnchorEl, setColorBarMinMaxAnchorEl] = React.useState<HTMLDivElement | null>(null);\n    const [colorBarNameAnchorEl, setColorBarNameAnchorEl] = React.useState<HTMLCanvasElement | null>(null);\n    const [currentColorBarMinMax, setCurrentColorBarMinMax] = React.useState<[number, number]>(variableColorBarMinMax);\n    const [originalColorBarMinMax, setOriginalColorBarMinMax] = React.useState<[number, number]>(variableColorBarMinMax);\n    const [enteredColorBarMinMax, setEnteredColorBarMinMax] = React.useState<[string, string]>(\n        minMaxToText(variableColorBarMinMax)\n    );\n    const [enteredColorBarMinMaxError, setEnteredColorBarMinMaxError] = React.useState<[boolean, boolean]>(\n        [false, false]\n    );\n\n    React.useEffect(() => {\n        setEnteredColorBarMinMax(minMaxToText(variableColorBarMinMax));\n    }, [variableColorBarMinMax]);\n\n    const colorBarMinMaxEditorOpen = Boolean(colorBarMinMaxAnchorEl);\n    const colorBarNameEditorOpen = Boolean(colorBarNameAnchorEl);\n\n    if (!variableName || !colorBars) {\n        return null;\n    }\n\n    const handleOpenColorBarMinMaxEditor = (event: React.MouseEvent<HTMLDivElement>) => {\n        setColorBarMinMaxAnchorEl(event.currentTarget);\n        setCurrentColorBarMinMax(variableColorBarMinMax);\n        setOriginalColorBarMinMax(variableColorBarMinMax);\n    };\n\n    const handleCloseColorBarMinMaxEditor = () => {\n        setColorBarMinMaxAnchorEl(null);\n    };\n\n    const handleColorBarMinMaxChange = (event: Event, value: number | number[]) => {\n        if (Array.isArray(value)) {\n            setCurrentColorBarMinMax([value[0], value[1]]);\n        }\n    };\n\n    const handleColorBarMinMaxChangeCommitted = (event: Event | SyntheticEvent, value: number | number[]) => {\n        if (Array.isArray(value)) {\n            updateVariableColorBar([value[0], value[1]], variableColorBarName, variableOpacity);\n        }\n    };\n\n    const handleOpenColorBarNameEditor = (event: React.MouseEvent<HTMLCanvasElement>) => {\n        setColorBarNameAnchorEl(event.currentTarget);\n    };\n\n    const handleCloseColorBarNameEditor = () => {\n        setColorBarNameAnchorEl(null);\n    };\n\n    const handleColorBarNameChange = (baseName: string) => {\n        variableColorBarName = formatColorBar({...variableColorBar, baseName});\n        updateVariableColorBar(variableColorBarMinMax, variableColorBarName, variableOpacity);\n    };\n\n    const handleColorBarAlpha = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const isAlpha = event.currentTarget.checked;\n        variableColorBarName = formatColorBar({...variableColorBar, isAlpha});\n        updateVariableColorBar(\n            variableColorBarMinMax,\n            variableColorBarName,\n            variableOpacity\n        );\n    };\n\n    const handleColorBarReversed = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const isReversed = event.currentTarget.checked;\n        variableColorBarName = formatColorBar({...variableColorBar, isReversed});\n        updateVariableColorBar(\n            variableColorBarMinMax,\n            variableColorBarName,\n            variableOpacity\n        );\n    };\n\n    const handleVariableOpacity = (event: Event, value: number | number[]) => {\n        updateVariableColorBar(\n            variableColorBarMinMax,\n            variableColorBarName,\n            value as number\n        );\n    }\n\n    const handleEnteredColorBarMinChange = (event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n        const enteredValue = event.target.value;\n        setEnteredColorBarMinMax([enteredValue, enteredColorBarMinMax[1]]);\n        const minValue = Number.parseFloat(enteredValue);\n        let error = false;\n        if (!Number.isNaN(minValue) && minValue < currentColorBarMinMax[1]) {\n            if (minValue !== currentColorBarMinMax[0]) {\n                const newMinMax: [number, number] = [minValue, currentColorBarMinMax[1]];\n                setCurrentColorBarMinMax(newMinMax);\n                setOriginalColorBarMinMax(newMinMax);\n                updateVariableColorBar(newMinMax, variableColorBarName, variableOpacity);\n            }\n        } else {\n            error = true;\n        }\n        setEnteredColorBarMinMaxError([error, enteredColorBarMinMaxError[1]])\n    }\n\n    const handleEnteredColorBarMaxChange = (event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n        const enteredValue = event.target.value;\n        setEnteredColorBarMinMax([enteredColorBarMinMax[0], enteredValue]);\n        const maxValue = Number.parseFloat(enteredValue);\n        let error = false;\n        if (!Number.isNaN(maxValue) && maxValue > currentColorBarMinMax[0]) {\n            if (maxValue !== currentColorBarMinMax[1]) {\n                const newMinMax: [number, number] = [currentColorBarMinMax[0], maxValue]\n                setCurrentColorBarMinMax(newMinMax);\n                setOriginalColorBarMinMax(newMinMax);\n                updateVariableColorBar(newMinMax, variableColorBarName, variableOpacity);\n            }\n        } else {\n            error = true;\n        }\n        setEnteredColorBarMinMaxError([enteredColorBarMinMaxError[0], error])\n    }\n\n    const title = `${variableName} (${variableUnits || '-'})`;\n\n    let colorBarMinMaxEditor;\n    if (colorBarMinMaxEditorOpen) {\n\n        const [original1, original2] = originalColorBarMinMax;\n        const dist = original1 < original2 ? (original2 - original1) : 1;\n        const distExp = Math.floor(Math.log10(dist));\n        const distNorm = dist * Math.pow(10, -distExp);\n\n        let numStepsInner = null;\n        for (let delta of [0.25, 0.2, 0.15, 0.125, 0.1]) {\n            let numStepsFloat = distNorm / delta;\n            let numStepsInt = Math.floor(numStepsFloat);\n            if (Math.abs(numStepsInt - numStepsFloat) < 1e-10) {\n                numStepsInner = numStepsInt;\n                break;\n            }\n        }\n\n        let numStepsOuter;\n        if (numStepsInner !== null && numStepsInner >= 2) {\n            numStepsOuter = Math.max(2, Math.round(numStepsInner / 2));\n        } else {\n            numStepsOuter = 4;\n            numStepsInner = 8;\n        }\n\n        const delta = original1 < original2 ? dist / numStepsInner : 0.5;\n        const numSteps = numStepsInner + 2 * numStepsOuter;\n        const total1 = original1 - numStepsOuter * delta;\n        const total2 = original2 + numStepsOuter * delta;\n        const step = (total2 - total1) / numSteps;\n\n        const values = [\n            total1,\n            original1,\n            original2,\n            total2,\n        ];\n\n        const marks: Mark[] = getLabelsFromArray(values).map((label, i) => {\n            return {value: values[i], label};\n        });\n\n        colorBarMinMaxEditor = (\n            <div className={classes.colorBarMinMaxEditor}>\n                <span style={{paddingLeft: 14}}>{title}</span>\n                <Box className={classes.sliderBox}>\n                    <Slider\n                        min={total1}\n                        max={total2}\n                        value={currentColorBarMinMax}\n                        marks={marks}\n                        step={step}\n                        onChange={handleColorBarMinMaxChange}\n                        onChangeCommitted={handleColorBarMinMaxChangeCommitted}\n                        valueLabelDisplay=\"auto\"\n                        size=\"small\"\n                    />\n                </Box>\n                <Box component=\"form\" className={classes.minMaxBox}>\n                    <TextField\n                        className={classes.minTextField}\n                        label=\"Minimum\"\n                        variant=\"filled\"\n                        size=\"small\"\n                        value={enteredColorBarMinMax[0]}\n                        error={enteredColorBarMinMaxError[0]}\n                        onChange={evt => handleEnteredColorBarMinChange(evt)}\n                    />\n                    <TextField\n                        className={classes.maxTextField}\n                        label=\"Maximum\"\n                        variant=\"filled\"\n                        size=\"small\"\n                        value={enteredColorBarMinMax[1]}\n                        error={enteredColorBarMinMaxError[1]}\n                        onChange={evt => handleEnteredColorBarMaxChange(evt)}\n                    />\n                </Box>\n            </div>\n        );\n    }\n\n    let colorBarNameEditor;\n    if (colorBarNameEditorOpen) {\n        let key = 0;\n        const entries = [];\n        for (let cbg of colorBars.groups) {\n            if (!cbg.names || cbg.names.length === 0) {\n                continue;\n            }\n            entries.push(\n                <Tooltip arrow key={key++} title={cbg.description} placement=\"left\">\n                    <Box className={classes.colorBarGroupTitle}>\n                        {cbg.title}\n                    </Box>\n                </Tooltip>\n            );\n            for (let name of cbg.names) {\n                entries.push(\n                    <Box\n                        key={key++}\n                        className={classes.colorBarGroupItemBox}\n                        border={1}\n                        borderColor={name === variableColorBar.baseName ? 'orange':'black'}\n                        width={240}\n                        height={20}\n                    >\n                        <Tooltip arrow title={name} placement=\"left\">\n                            <img\n                                src={`data:image/png;base64,${colorBars.images[name]}`}\n                                alt={'Color Bar'}\n                                width={'100%'}\n                                height={'100%'}\n                                onClick={() => {\n                                    handleColorBarNameChange(name);\n                                }}\n                            />\n                        </Tooltip>\n                    </Box>\n                );\n            }\n        }\n        colorBarNameEditor = (\n            <Box className={classes.colorBarBox}>\n                <Box component=\"span\">\n                    <Checkbox color=\"primary\"\n                              checked={variableColorBar.isAlpha}\n                              onChange={handleColorBarAlpha}\n                              size=\"small\"\n                              style={{\n                                  paddingLeft: 0,\n                                  paddingRight: 2,\n                                  paddingTop: 4,\n                                  paddingBottom: 4\n                              }}\n                    />\n                    <Box component=\"span\">{i18n.get('Hide small values')}</Box>\n                    <Checkbox color=\"primary\"\n                              checked={variableColorBar.isReversed}\n                              onChange={handleColorBarReversed}\n                              size=\"small\"\n                              style={{\n                                  paddingLeft: 10,\n                                  paddingRight: 2,\n                                  paddingTop: 4,\n                                  paddingBottom: 4\n                              }}\n                    />\n                    <Box component=\"span\">{i18n.get('Reverse')}</Box>\n                </Box>\n                <Box component=\"div\" style={{display: 'flex', alignItems: 'center'}}>\n                    <span>{i18n.get('Opacity')}</span>\n                    <Slider\n                        min={0}\n                        max={1}\n                        value={variableOpacity}\n                        step={0.01}\n                        style={{flexGrow: 1, marginLeft: 10, marginRight: 10}}\n                        onChange={handleVariableOpacity}\n                        size=\"small\"\n                    />\n                </Box>\n                {entries}\n            </Box>\n        );\n    }\n\n    return (\n            <div className={'ol-control ' + classes.container}>\n                <div className={classes.title}>\n                    <span>{title}</span>\n                </div>\n                <ColorBarCanvas\n                        colorBar={variableColorBar}\n                        opacity={variableOpacity}\n                        width={width}\n                        height={height}\n                        onOpenEditor={handleOpenColorBarNameEditor}\n                />\n                <div\n                        className={classes.label}\n                        onClick={handleOpenColorBarMinMaxEditor}\n                >\n                    <Labels minValue={variableColorBarMinMax[0]} maxValue={variableColorBarMinMax[1]}\n                            count={numTicks || 5}/>\n                </div>\n                <Popover\n                        anchorEl={colorBarMinMaxAnchorEl}\n                        open={colorBarMinMaxEditorOpen}\n                        onClose={handleCloseColorBarMinMaxEditor}\n                        anchorOrigin={{\n                            vertical: 'bottom',\n                            horizontal: 'left',\n                        }}\n                        transformOrigin={{\n                            vertical: 'top',\n                            horizontal: 'center',\n                        }}\n                >\n                    {colorBarMinMaxEditor}\n                </Popover>\n                <Popover\n                        anchorEl={colorBarNameAnchorEl}\n                        open={colorBarNameEditorOpen}\n                        onClose={handleCloseColorBarNameEditor}\n                        anchorOrigin={{\n                            vertical: 'bottom',\n                            horizontal: 'left',\n                        }}\n                        transformOrigin={{\n                            vertical: 'top',\n                            horizontal: 'left',\n                        }}\n                >\n                    {colorBarNameEditor}\n                </Popover>\n            </div>\n    );\n}\n\n\ninterface LabelsProps {\n    minValue: number;\n    maxValue: number;\n    count: number;\n}\n\nfunction Labels({minValue, maxValue, count}: LabelsProps) {\n    return (\n        <React.Fragment>\n            {getLabelsFromRange(minValue, maxValue, count).map((label, i) => <span key={i}>{label}</span>)}\n        </React.Fragment>\n    );\n}\n\nfunction minMaxToText(minMaxValue: [number, number]): [string, string] {\n    return [minMaxValue[0] + '', minMaxValue[1] + ''];\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport {\n    selectedVariableNameSelector,\n    selectedVariableUnitsSelector,\n    selectedVariableColorBarNameSelector,\n    selectedVariableColorBarMinMaxSelector,\n    selectedVariableOpacitySelector,\n    selectedVariableColorBarSelector,\n} from '../selectors/controlSelectors';\nimport { updateVariableColorBar } from '../actions/dataActions';\nimport ColorBarLegend from '../components/ColorBarLegend';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        variableName: selectedVariableNameSelector(state),\n        variableUnits: selectedVariableUnitsSelector(state),\n        variableColorBarMinMax: selectedVariableColorBarMinMaxSelector(state),\n        variableColorBarName: selectedVariableColorBarNameSelector(state),\n        variableColorBar: selectedVariableColorBarSelector(state),\n        variableOpacity: selectedVariableOpacitySelector(state),\n        colorBars: state.dataState.colorBars,\n    }\n};\n\nconst mapDispatchToProps = {\n    updateVariableColorBar,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ColorBarLegend);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport {connect} from 'react-redux';\nimport { default as OlMap } from \"ol/Map\";\n\nimport {AppState} from '../states/appState';\nimport {\n    baseMapLayerSelector,\n    imageSmoothingSelector,\n    mapProjectionSelector,\n    selectedDatasetBoundaryLayerSelector,\n    selectedDatasetPlaceGroupLayersSelector,\n    selectedDatasetRgbLayerSelector,\n    selectedDatasetVariableLayerSelector,\n    selectedPlaceGroupPlacesSelector\n} from '../selectors/controlSelectors';\nimport { addUserPlace, addUserPlacesFromText } from '../actions/dataActions';\nimport Viewer from '../components/Viewer';\nimport {userPlaceGroupSelector} from \"../selectors/dataSelectors\";\nimport {selectPlace} from \"../actions/controlActions\";\nimport ColorBarLegend from \"./ColorBarLegend\";\n\n\ninterface OwnProps {\n    onMapRef?: (map: OlMap | null) => void;\n}\n\nconst mapStateToProps = (state: AppState, ownProps: OwnProps) => {\n    return {\n        locale: state.controlState.locale,\n        variableLayer: selectedDatasetVariableLayerSelector(state),\n        rgbLayer: selectedDatasetRgbLayerSelector(state),\n        datasetBoundaryLayer: selectedDatasetBoundaryLayerSelector(state),\n        placeGroupLayers: selectedDatasetPlaceGroupLayersSelector(state),\n        colorBarLegend: <ColorBarLegend/>,\n        userPlaceGroup: userPlaceGroupSelector(state),\n        mapId: 'map',\n        mapInteraction: state.controlState.mapInteraction,\n        mapProjection: mapProjectionSelector(state),\n        selectedPlaceId: state.controlState.selectedPlaceId,\n        places: selectedPlaceGroupPlacesSelector(state),\n        baseMapLayer: baseMapLayerSelector(state),\n        imageSmoothing: imageSmoothingSelector(state),\n        onMapRef: ownProps.onMapRef,\n    }\n};\n\nconst mapDispatchToProps = {\n    addUserPlace,\n    addUserPlacesFromText,\n    selectPlace,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Viewer);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Box from '@mui/material/Box';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport IconButton from '@mui/material/IconButton';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Typography from '@mui/material/Typography';\nimport AllOutIcon from '@mui/icons-material/AllOut';\nimport CloseIcon from '@mui/icons-material/Close';\nimport * as React from 'react';\nimport { useState } from 'react';\nimport {\n    AxisDomain,\n    CartesianGrid,\n    DotProps,\n    ErrorBar,\n    Legend,\n    Line,\n    LineChart,\n    ReferenceArea,\n    ReferenceLine,\n    ResponsiveContainer,\n    Tooltip,\n    TooltipPayload,\n    TooltipProps,\n    XAxis,\n    YAxis\n} from 'recharts';\nimport { getUserPlaceColor } from '../config';\nimport i18n from '../i18n';\nimport { Place, PlaceInfo } from '../model/place';\n\nimport { equalTimeRanges, Time, TimeRange, TimeSeries, TimeSeriesGroup, TimeSeriesPoint } from '../model/timeSeries';\nimport { WithLocale } from '../util/lang';\nimport { utcTimeToIsoDateString, utcTimeToIsoDateTimeString } from '../util/time';\n\nconst INVISIBLE_LINE_COLOR = '#00000000';\nconst SUBSTITUTE_LABEL_COLOR = '#FAFFDD';\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        chartContainer: {\n            userSelect: 'none',\n            marginTop: theme.spacing(1),\n            width: '99%',\n            height: '32vh',\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'flex-stretch',\n        },\n        responsiveContainer: {\n            flexGrow: 1,\n        },\n        actionButton: {\n            zIndex: 1000,\n            opacity: 0.8,\n        },\n        toolTipContainer: {\n            backgroundColor: 'black',\n            opacity: 0.8,\n            color: 'white',\n            border: '2px solid black',\n            borderRadius: theme.spacing(2),\n            padding: theme.spacing(1.5),\n        },\n        toolTipValue: {\n            fontWeight: 'bold',\n        },\n        toolTipLabel: {\n            fontWeight: 'bold',\n            paddingBottom: theme.spacing(1),\n        },\n        chartTitle: {}\n    });\n\n\ninterface TimeSeriesChartProps extends WithStyles<typeof styles>, WithLocale {\n    theme: Theme;\n    timeSeriesGroup: TimeSeriesGroup;\n    selectedTime?: Time | null;\n    selectTime?: (time: Time | null) => void;\n\n    dataTimeRange?: TimeRange | null;\n    selectedTimeRange?: TimeRange | null;\n    selectTimeRange?: (timeRange: TimeRange | null) => void;\n\n    showPointsOnly: boolean;\n    showErrorBars: boolean;\n\n    selectTimeSeries?: (timeSeriesGroupId: string, timeSeriesIndex: number, timeSeries: TimeSeries) => void;\n\n    removeTimeSeriesGroup?: (id: string) => void;\n    completed: number[];\n\n    placeInfos?: { [placeId: string]: PlaceInfo };\n\n    selectPlace: (placeId: string | null, places: Place[], showInMap: boolean) => void;\n    places: Place[];\n}\n\n\nconst X_AXIS_DOMAIN: [AxisDomain, AxisDomain] = ['dataMin', 'dataMax'];\nconst Y_AXIS_DOMAIN: [AxisDomain, AxisDomain] = ['auto', 'auto'];\n\n\ninterface TimeRangeSelection {\n    firstTime?: number;\n    secondTime?: number;\n}\n\nconst TimeSeriesChart: React.FC<TimeSeriesChartProps> = ({\n                                                             classes,\n                                                             timeSeriesGroup,\n                                                             selectTimeSeries,\n                                                             selectedTime,\n                                                             selectTime,\n                                                             selectedTimeRange,\n                                                             selectTimeRange,\n                                                             places,\n                                                             selectPlace,\n                                                             placeInfos,\n                                                             dataTimeRange,\n                                                             theme,\n                                                             showErrorBars,\n                                                             showPointsOnly,\n                                                             removeTimeSeriesGroup,\n                                                             completed,\n                                                         }) => {\n    const [\n        timeRangeSelection,\n        setTimeRangeSelection\n    ] = useState<TimeRangeSelection>({});\n\n    const clearTimeRangeSelection = () => {\n        setTimeRangeSelection({});\n    };\n\n    const paletteType = theme.palette.mode;\n    const lightStroke = theme.palette.primary.light;\n    const mainStroke = theme.palette.primary.main;\n    const labelTextColor = theme.palette.primary.contrastText;\n\n    let isZoomedIn = false, time1: number | null = null, time2: number | null = null;\n    if (selectedTimeRange) {\n        isZoomedIn = !equalTimeRanges(selectedTimeRange, dataTimeRange || null);\n        [time1, time2] = selectedTimeRange;\n    }\n\n    const tickFormatter = (value: any) => {\n        if (typeof value !== 'number' || !Number.isFinite(value)) {\n            return null;\n        }\n        return utcTimeToIsoDateString(value);\n    };\n\n    const handleClick = (event: any) => {\n        if (event && selectTime && event.activeLabel !== null && Number.isFinite(event.activeLabel)) {\n            selectTime(event.activeLabel!);\n        }\n        clearTimeRangeSelection()\n    };\n\n    const handleTimeSeriesClick = (timeSeriesGroupId: string, timeSeriesIndex: number, timeSeries: TimeSeries) => {\n        if (!!selectTimeSeries) {\n            selectTimeSeries(timeSeriesGroupId, timeSeriesIndex, timeSeries);\n        }\n        selectPlace(timeSeries.source.placeId, places, true);\n    };\n\n    const handleMouseDown = (event: any) => {\n        const firstTime = event && event.activeLabel;\n        setTimeRangeSelection({firstTime});\n    };\n\n    const handleMouseMove = (event: any) => {\n        const firstTime = timeRangeSelection.firstTime;\n        if (firstTime !== undefined) {\n            const secondTime = event && event.activeLabel;\n            setTimeRangeSelection({...timeRangeSelection, secondTime});\n        }\n    };\n\n    const handleMouseUp = (event: any) => {\n        zoomIn();\n    };\n\n    const handleMouseEnter = () => {\n        clearTimeRangeSelection();\n    }\n\n    const handleMouseLeave = () => {\n        clearTimeRangeSelection();\n    }\n\n    const handleZoomOutButtonClick = () => {\n        zoomOut();\n    };\n\n    const handleRemoveTimeSeriesGroupClick = () => {\n        if (removeTimeSeriesGroup) {\n            removeTimeSeriesGroup(timeSeriesGroup.id);\n        }\n    };\n\n    const zoomIn = () => {\n        const {firstTime, secondTime} = timeRangeSelection;\n        if (firstTime === secondTime\n            || firstTime === undefined\n            || secondTime === undefined) {\n            clearTimeRangeSelection();\n            return;\n        }\n        let [minTime, maxTime] = [firstTime, secondTime];\n        if (minTime > maxTime) {\n            [minTime, maxTime] = [maxTime, minTime];\n        }\n        clearTimeRangeSelection();\n        if (selectTimeRange) {\n            selectTimeRange([minTime, maxTime]);\n        }\n    };\n\n    const zoomOut = () => {\n        clearTimeRangeSelection();\n        if (selectTimeRange) {\n            selectTimeRange(dataTimeRange || null);\n        }\n    };\n\n    let commonValueDataKey: keyof TimeSeriesPoint | null = null;\n\n    const lines = timeSeriesGroup.timeSeriesArray.map((ts, i) => {\n        const source = ts.source;\n        const valueDataKey = source.valueDataKey;\n        let lineName = source.variableName;\n        let lineColor = 'yellow';\n        if (placeInfos) {\n            const placeInfo = placeInfos[source.placeId];\n            if (placeInfo) {\n                const {place, label, color} = placeInfo;\n                if (place.geometry.type === 'Point') {\n                    const lon = place.geometry.coordinates[0];\n                    const lat = place.geometry.coordinates[1];\n                    lineName += ` (${label}: ${lat.toFixed(5)},${lon.toFixed(5)})`;\n                } else {\n                    lineName += ` (${label})`;\n                }\n                lineColor = color;\n            }\n        }\n\n        const data: TimeSeriesPoint[] = [];\n        ts.data.forEach(point => {\n            if (point[valueDataKey] !== null) {\n                let time1Ok = true;\n                let time2Ok = true;\n                if (time1 !== null) {\n                    time1Ok = point.time >= time1;\n                }\n                if (time2 !== null) {\n                    time2Ok = point.time <= time2;\n                }\n                if (time1Ok && time2Ok) {\n                    data.push(point);\n                }\n            }\n        });\n        if (commonValueDataKey === null) {\n            commonValueDataKey = valueDataKey;\n        }\n        const shadedLineColor = getUserPlaceColor(lineColor, paletteType);\n        let errorBar;\n        if (valueDataKey && showErrorBars && source.errorDataKey) {\n            errorBar = (\n                <ErrorBar\n                    dataKey={source.errorDataKey}\n                    width={4}\n                    strokeWidth={1}\n                    stroke={shadedLineColor}\n                />\n            );\n        }\n        return (\n            <Line\n                key={i}\n                type=\"monotone\"\n                name={lineName}\n                unit={source.variableUnits}\n                data={data}\n                dataKey={valueDataKey}\n                dot={<CustomizedDot radius={3} stroke={shadedLineColor} fill={'white'} strokeWidth={2}/>}\n                activeDot={<CustomizedDot radius={3} stroke={'white'} fill={shadedLineColor} strokeWidth={2}/>}\n                stroke={shadedLineColor}\n                strokeOpacity={showPointsOnly ? 0 : ts.dataProgress}\n                // strokeWidth={2 * (ts.dataProgress || 1)}\n                // See https://github.com/recharts/recharts/issues/1624#issuecomment-474119055\n                // isAnimationActive={ts.dataProgress === 1.0}\n                isAnimationActive={false}\n                onClick={() => handleTimeSeriesClick(timeSeriesGroup.id, i, ts)}\n            >\n                {errorBar}\n            </Line>\n        );\n    });\n\n    let referenceLine = null;\n    if (selectedTime !== null) {\n        referenceLine =\n            <ReferenceLine\n                isFront={true}\n                x={selectedTime}\n                stroke={mainStroke}\n                strokeWidth={3}\n                strokeOpacity={0.5}\n            />;\n    }\n\n    const {firstTime, secondTime} = timeRangeSelection;\n    let referenceArea = null;\n    if (firstTime !== undefined && secondTime !== undefined) {\n        referenceArea =\n            <ReferenceArea\n                x1={firstTime}\n                x2={secondTime}\n                strokeOpacity={0.3}\n                fill={lightStroke}\n                fillOpacity={0.3}\n            />;\n    }\n\n    const actionButtons = [];\n\n    if (isZoomedIn) {\n        const zoomOutButton = (\n            <IconButton\n                key={'zoomOutButton'}\n                className={classes.actionButton}\n                aria-label=\"Zoom Out\"\n                onClick={handleZoomOutButtonClick}\n                size=\"large\">\n                <AllOutIcon/>\n            </IconButton>\n        );\n        actionButtons.push(zoomOutButton);\n    }\n    const progress = completed.reduce((a: number, b: number) => a + b, 0) / completed.length;\n    const loading = (progress > 0 && progress < 100);\n\n    let removeAllButton;\n    if (loading) {\n        removeAllButton = (\n            <CircularProgress\n                key={'loadingTimeSeriesGroup'}\n                size={24}\n                className={classes.actionButton}\n                color={'secondary'}\n            />\n        );\n    } else {\n        removeAllButton = (\n            <IconButton\n                key={'removeTimeSeriesGroup'}\n                className={classes.actionButton}\n                aria-label=\"Close\"\n                onClick={handleRemoveTimeSeriesGroupClick}\n                size=\"large\">\n                <CloseIcon/>\n            </IconButton>\n        );\n    }\n\n    actionButtons.push(removeAllButton);\n\n    const timeSeriesText = i18n.get('Time-Series');\n    const unitsText = timeSeriesGroup.variableUnits || i18n.get('unknown units');\n    const chartTitle = `${timeSeriesText} (${unitsText})`;\n\n    // 99% per https://github.com/recharts/recharts/issues/172\n    return (\n        <div className={classes.chartContainer}>\n            <Box display='flex' flexDirection='row' alignItems='center' justifyContent='space-between'>\n                <Typography className={classes.chartTitle}>{chartTitle}</Typography>\n                <Box display='flex' flexDirection='row' flexWrap='nowrap' alignItems='center'>\n                    {actionButtons}\n                </Box>\n            </Box>\n            <ResponsiveContainer width=\"99%\" className={classes.responsiveContainer}>\n                <LineChart\n                    onMouseDown={handleMouseDown}\n                    onMouseMove={handleMouseMove}\n                    onMouseUp={handleMouseUp}\n                    onMouseEnter={handleMouseEnter}\n                    onMouseLeave={handleMouseLeave}\n                    onClick={handleClick}\n                    syncId=\"anyId\"\n                    style={{color: labelTextColor}}\n                >\n                    <XAxis\n                        dataKey=\"time\"\n                        type=\"number\"\n                        tickCount={6}\n                        domain={selectedTimeRange || X_AXIS_DOMAIN}\n                        tickFormatter={tickFormatter}\n                        stroke={labelTextColor}\n                        allowDuplicatedCategory={false}\n                    />\n                    <YAxis\n                        dataKey={commonValueDataKey || \"mean\"}\n                        type=\"number\"\n                        domain={Y_AXIS_DOMAIN}\n                        stroke={labelTextColor}\n                    />\n                    <CartesianGrid strokeDasharray=\"3 3\"/>\n                    <Tooltip content={<CustomTooltip/>}/>\n                    <Legend/>\n                    {lines}\n                    {referenceArea}\n                    {referenceLine}\n                </LineChart>\n            </ResponsiveContainer>\n        </div>\n    );\n};\n\nexport default withStyles(styles, {withTheme: true})(TimeSeriesChart);\n\n\ninterface _CustomTooltipProps extends TooltipProps, WithStyles<typeof styles> {\n}\n\nconst _CustomTooltip: React.FC<_CustomTooltipProps> = (\n    {\n        classes,\n        active,\n        label,\n        payload\n    }\n) => {\n    if (!active) {\n        return null;\n    }\n    if (typeof label !== 'number') {\n        return null;\n    }\n    if (!payload || payload.length === 0) {\n        return null;\n    }\n    const items = payload.map((p: TooltipPayload, index: number) => {\n        //console.log(\"payload:\", p);\n        let {name, value, color, unit, dataKey} = p;\n        if (typeof value !== 'number') {\n            return null;\n        }\n        // let valueText;\n        // if (typeof p.std === 'number') {\n        //     valueText = `${value.toFixed(2)} ±${p.std.toFixed(2)} (std)`;\n        // } else {\n        //     valueText = value.toFixed(3);\n        // }\n        const valueText = value.toFixed(3);\n        if (color === INVISIBLE_LINE_COLOR) {\n            color = SUBSTITUTE_LABEL_COLOR;\n        }\n        const isPoint = name.indexOf(':') !== -1;\n        const suffix = isPoint ? '' : ` (${dataKey})`;\n        return (\n            <div key={index}>\n                <span>{name}:&nbsp;</span>\n                <span className={classes.toolTipValue} style={{color}}>{valueText}</span>\n                <span>&nbsp;{`${unit} ${suffix}`}</span>\n            </div>\n        );\n    });\n\n    if (!items) {\n        return null;\n    }\n\n    return (\n        <div className={classes.toolTipContainer}>\n            <span className={classes.toolTipLabel}>{`${utcTimeToIsoDateTimeString(label)} UTC`}</span>\n            {items}\n        </div>\n    );\n};\n\nconst CustomTooltip = withStyles(styles)(_CustomTooltip);\n\ninterface CustomizedDotProps extends DotProps {\n    radius: number;\n    stroke: string;\n    strokeWidth: number;\n    fill: string;\n}\n\n\nconst CustomizedDot = (props: CustomizedDotProps) => {\n\n    const {cx, cy, radius, stroke, fill, strokeWidth} = props;\n\n    const vpSize = 1024;\n    const totalRadius = radius + 0.5 * strokeWidth;\n    const totalDiameter = 2 * totalRadius;\n\n    const r = Math.floor(100 * radius / totalDiameter + 0.5) + '%';\n    const sw = Math.floor(100 * strokeWidth / totalDiameter + 0.5) + '%';\n\n    // noinspection SuspiciousTypeOfGuard\n    if (typeof cx === 'number' && typeof cy === 'number') {\n        return (\n            <svg\n                x={cx - totalRadius}\n                y={cy - totalRadius}\n                width={totalDiameter}\n                height={totalDiameter}\n                viewBox={`0 0 ${vpSize} ${vpSize}`}\n            >\n                <circle\n                    cx='50%'\n                    cy='50%'\n                    r={r}\n                    strokeWidth={sw}\n                    stroke={stroke}\n                    fill={fill}\n                />\n            </svg>\n        );\n    }\n\n    return null;\n};\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport { Theme } from '@mui/material';\nimport Slider, { Mark } from '@mui/material/Slider';\nimport Box from '@mui/material/Box';\n\nimport { TimeRange, UNIT } from '../model/timeSeries';\nimport { utcTimeToIsoDateString, utcTimeToIsoDateTimeString } from '../util/time';\n\nconst HOR_MARGIN = 5;\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        box: {\n            marginTop: theme.spacing(1),\n            marginLeft: theme.spacing(HOR_MARGIN),\n            marginRight: theme.spacing(HOR_MARGIN),\n            width: `calc(100% - ${theme.spacing(3 * (HOR_MARGIN + 1))})`,\n            height: '5em',\n            display: \"flex\",\n            alignItems: \"flex-end\"\n        },\n    }\n);\n\ninterface TimeRangeSliderProps extends WithStyles<typeof styles> {\n    dataTimeRange?: TimeRange | null;\n    selectedTimeRange?: TimeRange | null;\n    selectTimeRange?: (timeRange: TimeRange | null) => void;\n    updateVisibleTimeRange?: (timeRange: TimeRange | null) => void;\n}\n\nconst TimeRangeSlider: React.FC<TimeRangeSliderProps> = ({classes, dataTimeRange, selectedTimeRange, selectTimeRange}) => {\n    const [selectedTimeRange_, setSelectedTimeRange_] = useState(selectedTimeRange);\n\n    useEffect(() => {\n        setSelectedTimeRange_(selectedTimeRange);\n    }, [selectedTimeRange]);\n\n    const handleChange = (event: Event, value: number | number[]) => {\n        if (Array.isArray(value)) {\n            setSelectedTimeRange_([value[0], value[1]]);\n        }\n    };\n\n    const handleChangeCommitted = (event: React.SyntheticEvent | Event, value: number | number[]) => {\n        if (selectTimeRange && Array.isArray(value)) {\n            selectTimeRange([value[0], value[1]]);\n        }\n    };\n\n    function valueLabelFormat(value: number) {\n        return utcTimeToIsoDateTimeString(value);\n    }\n\n    const dataTimeRangeValid = Array.isArray(dataTimeRange);\n    if (!dataTimeRangeValid) {\n        dataTimeRange = [Date.now() - 2 * UNIT.years, Date.now()];\n    }\n\n    const marks: Mark[] = [\n        {value: dataTimeRange![0], label: utcTimeToIsoDateString(dataTimeRange![0])},\n        {value: dataTimeRange![1], label: utcTimeToIsoDateString(dataTimeRange![1])},\n    ];\n\n    return (\n        <Box className={classes.box}>\n            <Slider\n                disabled={!dataTimeRangeValid}\n                min={dataTimeRange![0]}\n                max={dataTimeRange![1]}\n                value={selectedTimeRange_!}\n                marks={marks}\n                onChange={handleChange}\n                onChangeCommitted={handleChangeCommitted}\n                size=\"small\"\n                valueLabelDisplay=\"on\"\n                valueLabelFormat={valueLabelFormat}\n            />\n        </Box>\n    );\n};\n\nexport default withStyles(styles)(TimeRangeSlider);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport { Theme } from '@mui/material';\n\nimport { WithLocale } from '../util/lang';\nimport TimeSeriesChart from './TimeSeriesChart';\nimport { Time, TimeRange, TimeSeriesGroup } from '../model/timeSeries';\nimport { Place, PlaceInfo } from '../model/place';\nimport TimeRangeSlider from './TimeRangeSlider';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        chartContainer: {\n            display: 'flex',\n            flexDirection: 'column',\n            flexWrap: 'wrap',\n            flexFlow: 'flex-start',\n            alignItems: 'center',\n        },\n        noChartsCard: {\n            width: '20em',\n        },\n        noChartsTitle: {\n            fontSize: 14,\n        },\n    });\n\n\ninterface TimeSeriesChartsProps extends WithStyles<typeof styles>, WithLocale {\n    theme: Theme;\n    timeSeriesGroups: TimeSeriesGroup[];\n    selectedTime?: Time | null;\n    selectTime?: (time: Time | null) => void;\n\n    showPointsOnly: boolean;\n    showErrorBars: boolean;\n\n    dataTimeRange?: TimeRange | null;\n    selectedTimeRange?: TimeRange | null;\n    selectTimeRange?: (timeRange: TimeRange | null) => void;\n\n    removeTimeSeriesGroup?: (id: string) => void;\n    placeInfos?: { [placeId: string]: PlaceInfo };\n    selectPlace: (placeId: string | null, places: Place[], showInMap: boolean) => void;\n    places: Place[];\n}\n\nconst TimeSeriesCharts: React.FC<TimeSeriesChartsProps> = ({\n                                                               classes, locale,\n                                                               timeSeriesGroups,\n                                                               selectedTime, selectedTimeRange,\n                                                               dataTimeRange, selectTime, selectTimeRange,\n                                                               removeTimeSeriesGroup, showPointsOnly, showErrorBars,\n                                                               placeInfos, places, selectPlace\n                                                           }) => {\n\n\n    const charts = timeSeriesGroups.map((timeSeriesGroup: TimeSeriesGroup) => {\n        const completed = timeSeriesGroup.timeSeriesArray.map(item => (\n            item.dataProgress ? 100 * item.dataProgress : 0\n        ));\n\n        return (\n            <TimeSeriesChart\n                key={timeSeriesGroup.id}\n                locale={locale}\n                timeSeriesGroup={timeSeriesGroup}\n                selectedTime={selectedTime}\n                selectedTimeRange={selectedTimeRange}\n                dataTimeRange={dataTimeRange}\n                selectTime={selectTime}\n                selectTimeRange={selectTimeRange}\n                removeTimeSeriesGroup={removeTimeSeriesGroup}\n                completed={completed}\n                showPointsOnly={showPointsOnly}\n                showErrorBars={showErrorBars}\n                placeInfos={placeInfos}\n                places={places}\n                selectPlace={selectPlace}\n            />\n        );\n    });\n\n    if (charts.length === 0) {\n        return null;\n    }\n\n    return (\n        <div className={classes.chartContainer}>\n            <TimeRangeSlider\n                selectedTimeRange={selectedTimeRange}\n                dataTimeRange={dataTimeRange}\n                selectTimeRange={selectTimeRange}\n            />\n            {charts}\n        </div>\n    );\n};\n\nexport default withStyles(styles, {withTheme: true})(TimeSeriesCharts);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport TimeSeriesCharts from '../components/TimeSeriesCharts';\nimport { removeTimeSeriesGroup } from \"../actions/dataActions\";\nimport { selectPlace, selectTime, selectTimeRange } from \"../actions/controlActions\";\nimport {\n    selectedDatasetTimeRangeSelector,\n    selectedPlaceGroupPlacesSelector,\n    timeSeriesPlaceInfosSelector\n} from '../selectors/controlSelectors';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        timeSeriesGroups: state.dataState.timeSeriesGroups,\n        selectedTime: state.controlState.selectedTime,\n        selectedTimeRange: state.controlState.selectedTimeRange,\n        dataTimeRange: selectedDatasetTimeRangeSelector(state),\n        showPointsOnly: state.controlState.showTimeSeriesPointsOnly,\n        showErrorBars: state.controlState.showTimeSeriesErrorBars,\n        placeInfos: timeSeriesPlaceInfosSelector(state),\n        places: selectedPlaceGroupPlacesSelector(state),\n    }\n};\n\nconst mapDispatchToProps = {\n    selectTime,\n    selectTimeRange,\n    removeTimeSeriesGroup,\n    selectPlace,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TimeSeriesCharts);\n","import { EventDispatcher, MOUSE, Quaternion, Spherical, TOUCH, Vector2, Vector3 } from 'three';\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nconst _changeEvent = {type: 'change'};\nconst _startEvent = {type: 'start'};\nconst _endEvent = {type: 'end'};\n\nclass OrbitControls extends EventDispatcher {\n\n    constructor(object, domElement) {\n        super();\n\n        this.object = object;\n        this.domElement = domElement;\n        this.domElement.style.touchAction = 'none'; // disable touch scroll\n\n        // Set to false to disable this control\n        this.enabled = true;\n\n        // \"target\" sets the location of focus, where the object orbits around\n        this.target = new Vector3();\n\n        // How far you can dolly in and out ( PerspectiveCamera only )\n        this.minDistance = 0;\n        this.maxDistance = Infinity;\n\n        // How far you can zoom in and out ( OrthographicCamera only )\n        this.minZoom = 0;\n        this.maxZoom = Infinity;\n\n        // How far you can orbit vertically, upper and lower limits.\n        // Range is 0 to Math.PI radians.\n        this.minPolarAngle = 0; // radians\n        this.maxPolarAngle = Math.PI; // radians\n\n        // How far you can orbit horizontally, upper and lower limits.\n        // If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\n        this.minAzimuthAngle = -Infinity; // radians\n        this.maxAzimuthAngle = Infinity; // radians\n\n        // Set to true to enable damping (inertia)\n        // If damping is enabled, you must call controls.update() in your animation loop\n        this.enableDamping = false;\n        this.dampingFactor = 0.05;\n\n        // This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n        // Set to false to disable zooming\n        this.enableZoom = true;\n        this.zoomSpeed = 1.0;\n\n        // Set to false to disable rotating\n        this.enableRotate = true;\n        this.rotateSpeed = 1.0;\n\n        // Set to false to disable panning\n        this.enablePan = true;\n        this.panSpeed = 1.0;\n        this.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\n        this.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n        // Set to true to automatically rotate around the target\n        // If auto-rotate is enabled, you must call controls.update() in your animation loop\n        this.autoRotate = false;\n        this.autoRotateSpeed = 2.0; // 30 seconds per orbit when fps is 60\n\n        // The four arrow keys\n        this.keys = {LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown'};\n\n        // Mouse buttons\n        this.mouseButtons = {LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN};\n\n        // Touch fingers\n        this.touches = {ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN};\n\n        // for reset\n        this.target0 = this.target.clone();\n        this.position0 = this.object.position.clone();\n        this.zoom0 = this.object.zoom;\n\n        // the target DOM element for key events\n        this._domElementKeyEvents = null;\n\n        //\n        // public methods\n        //\n\n        this.getPolarAngle = function () {\n            return spherical.phi;\n        };\n\n        this.getAzimuthalAngle = function () {\n            return spherical.theta;\n        };\n\n        this.getDistance = function () {\n            return this.object.position.distanceTo(this.target);\n        };\n\n        this.listenToKeyEvents = function (domElement) {\n            domElement.addEventListener('keydown', onKeyDown);\n            this._domElementKeyEvents = domElement;\n        };\n\n        this.saveState = function () {\n            scope.target0.copy(scope.target);\n            scope.position0.copy(scope.object.position);\n            scope.zoom0 = scope.object.zoom;\n        };\n\n        this.reset = function () {\n            scope.target.copy(scope.target0);\n            scope.object.position.copy(scope.position0);\n            scope.object.zoom = scope.zoom0;\n\n            scope.object.updateProjectionMatrix();\n            scope.dispatchEvent(_changeEvent);\n\n            scope.update();\n\n            state = STATE.NONE;\n        };\n\n        // this method is exposed, but perhaps it would be better if we can make it private...\n        this.update = function () {\n            const offset = new Vector3();\n\n            // so camera.up is the orbit axis\n            const quat = new Quaternion().setFromUnitVectors(object.up, new Vector3(0, 1, 0));\n            const quatInverse = quat.clone().invert();\n\n            const lastPosition = new Vector3();\n            const lastQuaternion = new Quaternion();\n\n            const twoPI = 2 * Math.PI;\n\n            return function update() {\n                const position = scope.object.position;\n\n                offset.copy(position).sub(scope.target);\n\n                // rotate offset to \"y-axis-is-up\" space\n                offset.applyQuaternion(quat);\n\n                // angle from z-axis around y-axis\n                spherical.setFromVector3(offset);\n\n                if (scope.autoRotate && state === STATE.NONE) {\n                    rotateLeft(getAutoRotationAngle());\n                }\n\n                if (scope.enableDamping) {\n                    spherical.theta += sphericalDelta.theta * scope.dampingFactor;\n                    spherical.phi += sphericalDelta.phi * scope.dampingFactor;\n                } else {\n                    spherical.theta += sphericalDelta.theta;\n                    spherical.phi += sphericalDelta.phi;\n                }\n\n                // restrict theta to be between desired limits\n\n                let min = scope.minAzimuthAngle;\n                let max = scope.maxAzimuthAngle;\n\n                if (isFinite(min) && isFinite(max)) {\n                    if (min < -Math.PI) min += twoPI; else if (min > Math.PI) min -= twoPI;\n                    if (max < -Math.PI) max += twoPI; else if (max > Math.PI) max -= twoPI;\n                    if (min <= max) {\n                        spherical.theta = Math.max(min, Math.min(max, spherical.theta));\n                    } else {\n                        spherical.theta = (spherical.theta > (min + max) / 2) ?\n                            Math.max(min, spherical.theta) :\n                            Math.min(max, spherical.theta);\n                    }\n                }\n\n                // restrict phi to be between desired limits\n                spherical.phi = Math.max(scope.minPolarAngle, Math.min(scope.maxPolarAngle, spherical.phi));\n\n                spherical.makeSafe();\n\n                spherical.radius *= scale;\n\n                // restrict radius to be between desired limits\n                spherical.radius = Math.max(scope.minDistance, Math.min(scope.maxDistance, spherical.radius));\n\n                // move target to panned location\n                if (scope.enableDamping === true) {\n                    scope.target.addScaledVector(panOffset, scope.dampingFactor);\n                } else {\n                    scope.target.add(panOffset);\n                }\n\n                offset.setFromSpherical(spherical);\n\n                // rotate offset back to \"camera-up-vector-is-up\" space\n                offset.applyQuaternion(quatInverse);\n                position.copy(scope.target).add(offset);\n                scope.object.lookAt(scope.target);\n\n                if (scope.enableDamping === true) {\n                    sphericalDelta.theta *= (1 - scope.dampingFactor);\n                    sphericalDelta.phi *= (1 - scope.dampingFactor);\n                    panOffset.multiplyScalar(1 - scope.dampingFactor);\n                } else {\n                    sphericalDelta.set(0, 0, 0);\n                    panOffset.set(0, 0, 0);\n                }\n\n                scale = 1;\n\n                // update condition is:\n                // min(camera displacement, camera rotation in radians)^2 > EPS\n                // using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n                if (zoomChanged ||\n                    lastPosition.distanceToSquared(scope.object.position) > EPS ||\n                    8 * (1 - lastQuaternion.dot(scope.object.quaternion)) > EPS) {\n                    scope.dispatchEvent(_changeEvent);\n                    lastPosition.copy(scope.object.position);\n                    lastQuaternion.copy(scope.object.quaternion);\n                    zoomChanged = false;\n                    return true;\n                }\n\n                return false;\n            };\n\n        }();\n\n        this.dispose = function () {\n            scope.domElement.removeEventListener('contextmenu', onContextMenu);\n\n            scope.domElement.removeEventListener('pointerdown', onPointerDown);\n            scope.domElement.removeEventListener('pointercancel', onPointerCancel);\n            scope.domElement.removeEventListener('wheel', onMouseWheel);\n\n            scope.domElement.removeEventListener('pointermove', onPointerMove);\n            scope.domElement.removeEventListener('pointerup', onPointerUp);\n\n            if (scope._domElementKeyEvents !== null) {\n                scope._domElementKeyEvents.removeEventListener('keydown', onKeyDown);\n            }\n            //scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n        };\n\n        //\n        // internals\n        //\n\n        const scope = this;\n\n        const STATE = {\n            NONE: -1,\n            ROTATE: 0,\n            DOLLY: 1,\n            PAN: 2,\n            TOUCH_ROTATE: 3,\n            TOUCH_PAN: 4,\n            TOUCH_DOLLY_PAN: 5,\n            TOUCH_DOLLY_ROTATE: 6\n        };\n\n        let state = STATE.NONE;\n\n        const EPS = 0.000001;\n\n        // current position in spherical coordinates\n        const spherical = new Spherical();\n        const sphericalDelta = new Spherical();\n\n        let scale = 1;\n        const panOffset = new Vector3();\n        let zoomChanged = false;\n\n        const rotateStart = new Vector2();\n        const rotateEnd = new Vector2();\n        const rotateDelta = new Vector2();\n\n        const panStart = new Vector2();\n        const panEnd = new Vector2();\n        const panDelta = new Vector2();\n\n        const dollyStart = new Vector2();\n        const dollyEnd = new Vector2();\n        const dollyDelta = new Vector2();\n\n        const pointers = [];\n        const pointerPositions = {};\n\n        function getAutoRotationAngle() {\n            return 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n        }\n\n        function getZoomScale() {\n            return Math.pow(0.95, scope.zoomSpeed);\n        }\n\n        function rotateLeft(angle) {\n            sphericalDelta.theta -= angle;\n        }\n\n        function rotateUp(angle) {\n            sphericalDelta.phi -= angle;\n        }\n\n        const panLeft = function () {\n            const v = new Vector3();\n\n            return function panLeft(distance, objectMatrix) {\n\n                v.setFromMatrixColumn(objectMatrix, 0); // get X column of objectMatrix\n                v.multiplyScalar(-distance);\n\n                panOffset.add(v);\n            };\n        }();\n\n        const panUp = function () {\n\n            const v = new Vector3();\n\n            return function panUp(distance, objectMatrix) {\n\n                if (scope.screenSpacePanning === true) {\n\n                    v.setFromMatrixColumn(objectMatrix, 1);\n\n                } else {\n\n                    v.setFromMatrixColumn(objectMatrix, 0);\n                    v.crossVectors(scope.object.up, v);\n\n                }\n\n                v.multiplyScalar(distance);\n\n                panOffset.add(v);\n\n            };\n\n        }();\n\n        // deltaX and deltaY are in pixels; right and down are positive\n        const pan = function () {\n\n            const offset = new Vector3();\n\n            return function pan(deltaX, deltaY) {\n\n                const element = scope.domElement;\n\n                if (scope.object.isPerspectiveCamera) {\n\n                    // perspective\n                    const position = scope.object.position;\n                    offset.copy(position).sub(scope.target);\n                    let targetDistance = offset.length();\n\n                    // half of the fov is center to top of screen\n                    targetDistance *= Math.tan((scope.object.fov / 2) * Math.PI / 180.0);\n\n                    // we use only clientHeight here so aspect ratio does not distort speed\n                    panLeft(2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix);\n                    panUp(2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix);\n\n                } else if (scope.object.isOrthographicCamera) {\n\n                    // orthographic\n                    panLeft(deltaX * (scope.object.right - scope.object.left) / scope.object.zoom / element.clientWidth, scope.object.matrix);\n                    panUp(deltaY * (scope.object.top - scope.object.bottom) / scope.object.zoom / element.clientHeight, scope.object.matrix);\n\n                } else {\n\n                    // camera neither orthographic nor perspective\n                    console.warn('WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.');\n                    scope.enablePan = false;\n\n                }\n\n            };\n\n        }();\n\n        function dollyOut(dollyScale) {\n\n            if (scope.object.isPerspectiveCamera) {\n\n                scale /= dollyScale;\n\n            } else if (scope.object.isOrthographicCamera) {\n\n                scope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom * dollyScale));\n                scope.object.updateProjectionMatrix();\n                zoomChanged = true;\n\n            } else {\n\n                console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\n                scope.enableZoom = false;\n\n            }\n\n        }\n\n        function dollyIn(dollyScale) {\n\n            if (scope.object.isPerspectiveCamera) {\n\n                scale *= dollyScale;\n\n            } else if (scope.object.isOrthographicCamera) {\n\n                scope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom / dollyScale));\n                scope.object.updateProjectionMatrix();\n                zoomChanged = true;\n\n            } else {\n\n                console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\n                scope.enableZoom = false;\n\n            }\n\n        }\n\n        //\n        // event callbacks - update the object state\n        //\n\n        function handleMouseDownRotate(event) {\n\n            rotateStart.set(event.clientX, event.clientY);\n\n        }\n\n        function handleMouseDownDolly(event) {\n\n            dollyStart.set(event.clientX, event.clientY);\n\n        }\n\n        function handleMouseDownPan(event) {\n\n            panStart.set(event.clientX, event.clientY);\n\n        }\n\n        function handleMouseMoveRotate(event) {\n\n            rotateEnd.set(event.clientX, event.clientY);\n\n            rotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed);\n\n            const element = scope.domElement;\n\n            rotateLeft(2 * Math.PI * rotateDelta.x / element.clientHeight); // yes, height\n\n            rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight);\n\n            rotateStart.copy(rotateEnd);\n\n            scope.update();\n\n        }\n\n        function handleMouseMoveDolly(event) {\n\n            dollyEnd.set(event.clientX, event.clientY);\n\n            dollyDelta.subVectors(dollyEnd, dollyStart);\n\n            if (dollyDelta.y > 0) {\n\n                dollyOut(getZoomScale());\n\n            } else if (dollyDelta.y < 0) {\n\n                dollyIn(getZoomScale());\n\n            }\n\n            dollyStart.copy(dollyEnd);\n\n            scope.update();\n\n        }\n\n        function handleMouseMovePan(event) {\n\n            panEnd.set(event.clientX, event.clientY);\n\n            panDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed);\n\n            pan(panDelta.x, panDelta.y);\n\n            panStart.copy(panEnd);\n\n            scope.update();\n\n        }\n\n        function handleMouseWheel(event) {\n\n            if (event.deltaY < 0) {\n\n                dollyIn(getZoomScale());\n\n            } else if (event.deltaY > 0) {\n\n                dollyOut(getZoomScale());\n\n            }\n\n            scope.update();\n\n        }\n\n        function handleKeyDown(event) {\n\n            let needsUpdate = false;\n\n            switch (event.code) {\n\n                case scope.keys.UP:\n                    pan(0, scope.keyPanSpeed);\n                    needsUpdate = true;\n                    break;\n\n                case scope.keys.BOTTOM:\n                    pan(0, -scope.keyPanSpeed);\n                    needsUpdate = true;\n                    break;\n\n                case scope.keys.LEFT:\n                    pan(scope.keyPanSpeed, 0);\n                    needsUpdate = true;\n                    break;\n\n                case scope.keys.RIGHT:\n                    pan(-scope.keyPanSpeed, 0);\n                    needsUpdate = true;\n                    break;\n\n            }\n\n            if (needsUpdate) {\n\n                // prevent the browser from scrolling on cursor keys\n                event.preventDefault();\n\n                scope.update();\n\n            }\n\n\n        }\n\n        function handleTouchStartRotate() {\n\n            if (pointers.length === 1) {\n\n                rotateStart.set(pointers[0].pageX, pointers[0].pageY);\n\n            } else {\n\n                const x = 0.5 * (pointers[0].pageX + pointers[1].pageX);\n                const y = 0.5 * (pointers[0].pageY + pointers[1].pageY);\n\n                rotateStart.set(x, y);\n\n            }\n\n        }\n\n        function handleTouchStartPan() {\n\n            if (pointers.length === 1) {\n\n                panStart.set(pointers[0].pageX, pointers[0].pageY);\n\n            } else {\n\n                const x = 0.5 * (pointers[0].pageX + pointers[1].pageX);\n                const y = 0.5 * (pointers[0].pageY + pointers[1].pageY);\n\n                panStart.set(x, y);\n\n            }\n\n        }\n\n        function handleTouchStartDolly() {\n\n            const dx = pointers[0].pageX - pointers[1].pageX;\n            const dy = pointers[0].pageY - pointers[1].pageY;\n\n            const distance = Math.sqrt(dx * dx + dy * dy);\n\n            dollyStart.set(0, distance);\n\n        }\n\n        function handleTouchStartDollyPan() {\n\n            if (scope.enableZoom) handleTouchStartDolly();\n\n            if (scope.enablePan) handleTouchStartPan();\n\n        }\n\n        function handleTouchStartDollyRotate() {\n\n            if (scope.enableZoom) handleTouchStartDolly();\n\n            if (scope.enableRotate) handleTouchStartRotate();\n\n        }\n\n        function handleTouchMoveRotate(event) {\n\n            if (pointers.length === 1) {\n\n                rotateEnd.set(event.pageX, event.pageY);\n\n            } else {\n\n                const position = getSecondPointerPosition(event);\n\n                const x = 0.5 * (event.pageX + position.x);\n                const y = 0.5 * (event.pageY + position.y);\n\n                rotateEnd.set(x, y);\n\n            }\n\n            rotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed);\n\n            const element = scope.domElement;\n\n            rotateLeft(2 * Math.PI * rotateDelta.x / element.clientHeight); // yes, height\n\n            rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight);\n\n            rotateStart.copy(rotateEnd);\n\n        }\n\n        function handleTouchMovePan(event) {\n\n            if (pointers.length === 1) {\n\n                panEnd.set(event.pageX, event.pageY);\n\n            } else {\n\n                const position = getSecondPointerPosition(event);\n\n                const x = 0.5 * (event.pageX + position.x);\n                const y = 0.5 * (event.pageY + position.y);\n\n                panEnd.set(x, y);\n\n            }\n\n            panDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed);\n\n            pan(panDelta.x, panDelta.y);\n\n            panStart.copy(panEnd);\n\n        }\n\n        function handleTouchMoveDolly(event) {\n\n            const position = getSecondPointerPosition(event);\n\n            const dx = event.pageX - position.x;\n            const dy = event.pageY - position.y;\n\n            const distance = Math.sqrt(dx * dx + dy * dy);\n\n            dollyEnd.set(0, distance);\n\n            dollyDelta.set(0, Math.pow(dollyEnd.y / dollyStart.y, scope.zoomSpeed));\n\n            dollyOut(dollyDelta.y);\n\n            dollyStart.copy(dollyEnd);\n\n        }\n\n        function handleTouchMoveDollyPan(event) {\n\n            if (scope.enableZoom) handleTouchMoveDolly(event);\n\n            if (scope.enablePan) handleTouchMovePan(event);\n\n        }\n\n        function handleTouchMoveDollyRotate(event) {\n\n            if (scope.enableZoom) handleTouchMoveDolly(event);\n\n            if (scope.enableRotate) handleTouchMoveRotate(event);\n\n        }\n\n        //\n        // event handlers - FSM: listen for events and reset state\n        //\n\n        function onPointerDown(event) {\n\n            if (scope.enabled === false) return;\n\n            if (pointers.length === 0) {\n\n                scope.domElement.setPointerCapture(event.pointerId);\n\n                scope.domElement.addEventListener('pointermove', onPointerMove);\n                scope.domElement.addEventListener('pointerup', onPointerUp);\n\n            }\n\n            //\n\n            addPointer(event);\n\n            if (event.pointerType === 'touch') {\n\n                onTouchStart(event);\n\n            } else {\n\n                onMouseDown(event);\n\n            }\n\n        }\n\n        function onPointerMove(event) {\n\n            if (scope.enabled === false) return;\n\n            if (event.pointerType === 'touch') {\n\n                onTouchMove(event);\n\n            } else {\n\n                onMouseMove(event);\n\n            }\n\n        }\n\n        function onPointerUp(event) {\n\n            removePointer(event);\n\n            if (pointers.length === 0) {\n\n                scope.domElement.releasePointerCapture(event.pointerId);\n\n                scope.domElement.removeEventListener('pointermove', onPointerMove);\n                scope.domElement.removeEventListener('pointerup', onPointerUp);\n\n            }\n\n            scope.dispatchEvent(_endEvent);\n\n            state = STATE.NONE;\n\n        }\n\n        function onPointerCancel(event) {\n\n            removePointer(event);\n\n        }\n\n        function onMouseDown(event) {\n\n            let mouseAction;\n\n            switch (event.button) {\n\n                case 0:\n\n                    mouseAction = scope.mouseButtons.LEFT;\n                    break;\n\n                case 1:\n\n                    mouseAction = scope.mouseButtons.MIDDLE;\n                    break;\n\n                case 2:\n\n                    mouseAction = scope.mouseButtons.RIGHT;\n                    break;\n\n                default:\n\n                    mouseAction = -1;\n\n            }\n\n            switch (mouseAction) {\n\n                case MOUSE.DOLLY:\n\n                    if (scope.enableZoom === false) return;\n\n                    handleMouseDownDolly(event);\n\n                    state = STATE.DOLLY;\n\n                    break;\n\n                case MOUSE.ROTATE:\n\n                    if (event.ctrlKey || event.metaKey || event.shiftKey) {\n\n                        if (scope.enablePan === false) return;\n\n                        handleMouseDownPan(event);\n\n                        state = STATE.PAN;\n\n                    } else {\n\n                        if (scope.enableRotate === false) return;\n\n                        handleMouseDownRotate(event);\n\n                        state = STATE.ROTATE;\n\n                    }\n\n                    break;\n\n                case MOUSE.PAN:\n\n                    if (event.ctrlKey || event.metaKey || event.shiftKey) {\n\n                        if (scope.enableRotate === false) return;\n\n                        handleMouseDownRotate(event);\n\n                        state = STATE.ROTATE;\n\n                    } else {\n\n                        if (scope.enablePan === false) return;\n\n                        handleMouseDownPan(event);\n\n                        state = STATE.PAN;\n\n                    }\n\n                    break;\n\n                default:\n\n                    state = STATE.NONE;\n\n            }\n\n            if (state !== STATE.NONE) {\n\n                scope.dispatchEvent(_startEvent);\n\n            }\n\n        }\n\n        function onMouseMove(event) {\n\n            switch (state) {\n\n                case STATE.ROTATE:\n\n                    if (scope.enableRotate === false) return;\n\n                    handleMouseMoveRotate(event);\n\n                    break;\n\n                case STATE.DOLLY:\n\n                    if (scope.enableZoom === false) return;\n\n                    handleMouseMoveDolly(event);\n\n                    break;\n\n                case STATE.PAN:\n\n                    if (scope.enablePan === false) return;\n\n                    handleMouseMovePan(event);\n\n                    break;\n\n            }\n\n        }\n\n        function onMouseWheel(event) {\n\n            if (scope.enabled === false || scope.enableZoom === false || state !== STATE.NONE) return;\n\n            event.preventDefault();\n\n            scope.dispatchEvent(_startEvent);\n\n            handleMouseWheel(event);\n\n            scope.dispatchEvent(_endEvent);\n\n        }\n\n        function onKeyDown(event) {\n\n            if (scope.enabled === false || scope.enablePan === false) return;\n\n            handleKeyDown(event);\n\n        }\n\n        function onTouchStart(event) {\n\n            trackPointer(event);\n\n            switch (pointers.length) {\n\n                case 1:\n\n                    switch (scope.touches.ONE) {\n\n                        case TOUCH.ROTATE:\n\n                            if (scope.enableRotate === false) return;\n\n                            handleTouchStartRotate();\n\n                            state = STATE.TOUCH_ROTATE;\n\n                            break;\n\n                        case TOUCH.PAN:\n\n                            if (scope.enablePan === false) return;\n\n                            handleTouchStartPan();\n\n                            state = STATE.TOUCH_PAN;\n\n                            break;\n\n                        default:\n\n                            state = STATE.NONE;\n\n                    }\n\n                    break;\n\n                case 2:\n\n                    switch (scope.touches.TWO) {\n\n                        case TOUCH.DOLLY_PAN:\n\n                            if (scope.enableZoom === false && scope.enablePan === false) return;\n\n                            handleTouchStartDollyPan();\n\n                            state = STATE.TOUCH_DOLLY_PAN;\n\n                            break;\n\n                        case TOUCH.DOLLY_ROTATE:\n\n                            if (scope.enableZoom === false && scope.enableRotate === false) return;\n\n                            handleTouchStartDollyRotate();\n\n                            state = STATE.TOUCH_DOLLY_ROTATE;\n\n                            break;\n\n                        default:\n\n                            state = STATE.NONE;\n\n                    }\n\n                    break;\n\n                default:\n\n                    state = STATE.NONE;\n\n            }\n\n            if (state !== STATE.NONE) {\n\n                scope.dispatchEvent(_startEvent);\n\n            }\n\n        }\n\n        function onTouchMove(event) {\n\n            trackPointer(event);\n\n            switch (state) {\n\n                case STATE.TOUCH_ROTATE:\n\n                    if (scope.enableRotate === false) return;\n\n                    handleTouchMoveRotate(event);\n\n                    scope.update();\n\n                    break;\n\n                case STATE.TOUCH_PAN:\n\n                    if (scope.enablePan === false) return;\n\n                    handleTouchMovePan(event);\n\n                    scope.update();\n\n                    break;\n\n                case STATE.TOUCH_DOLLY_PAN:\n\n                    if (scope.enableZoom === false && scope.enablePan === false) return;\n\n                    handleTouchMoveDollyPan(event);\n\n                    scope.update();\n\n                    break;\n\n                case STATE.TOUCH_DOLLY_ROTATE:\n\n                    if (scope.enableZoom === false && scope.enableRotate === false) return;\n\n                    handleTouchMoveDollyRotate(event);\n\n                    scope.update();\n\n                    break;\n\n                default:\n\n                    state = STATE.NONE;\n\n            }\n\n        }\n\n        function onContextMenu(event) {\n\n            if (scope.enabled === false) return;\n\n            event.preventDefault();\n\n        }\n\n        function addPointer(event) {\n\n            pointers.push(event);\n\n        }\n\n        function removePointer(event) {\n\n            delete pointerPositions[event.pointerId];\n\n            for (let i = 0; i < pointers.length; i++) {\n\n                if (pointers[i].pointerId === event.pointerId) {\n\n                    pointers.splice(i, 1);\n                    return;\n\n                }\n\n            }\n\n        }\n\n        function trackPointer(event) {\n\n            let position = pointerPositions[event.pointerId];\n\n            if (position === undefined) {\n\n                position = new Vector2();\n                pointerPositions[event.pointerId] = position;\n\n            }\n\n            position.set(event.pageX, event.pageY);\n\n        }\n\n        function getSecondPointerPosition(event) {\n\n            const pointer = (event.pointerId === pointers[0].pointerId) ? pointers[1] : pointers[0];\n\n            return pointerPositions[pointer.pointerId];\n\n        }\n\n        //\n\n        scope.domElement.addEventListener('contextmenu', onContextMenu);\n\n        scope.domElement.addEventListener('pointerdown', onPointerDown);\n        scope.domElement.addEventListener('pointercancel', onPointerCancel);\n        scope.domElement.addEventListener('wheel', onMouseWheel, {passive: false});\n\n        // force an update at start\n\n        this.update();\n\n    }\n\n}\n\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n// This is very similar to OrbitControls, another set of touch behavior\n//\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - left mouse, or arrow keys / touch: one-finger move\n\nclass MapControls extends OrbitControls {\n\n    constructor(object, domElement) {\n\n        super(object, domElement);\n\n        this.screenSpacePanning = false; // pan orthogonal to world-space direction camera.up\n\n        this.mouseButtons.LEFT = MOUSE.PAN;\n        this.mouseButtons.RIGHT = MOUSE.ROTATE;\n\n        this.touches.ONE = TOUCH.PAN;\n        this.touches.TWO = TOUCH.DOLLY_ROTATE;\n\n    }\n\n}\n\nexport { OrbitControls, MapControls };\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Vector2, Vector3 } from 'three';\n\n/**\n * Shaders to render 3D volumes using raycasting.\n * The applied techniques are based on similar implementations in the Visvis and Vispy projects.\n */\n\nconst VolumeShader = {\n\n    uniforms: {\n        'u_size': {value: new Vector3(1, 1, 1)},\n        'u_renderstyle': {value: 0},\n        'u_renderthreshold': {value: 0.5},\n        'u_clim': {value: new Vector2(0, 1)},\n        'u_data': {value: null},\n        'u_cmdata': {value: null}\n    },\n\n    vertexShader: /* glsl */`\n\n        varying vec4 v_nearpos;\n        varying vec4 v_farpos;\n        varying vec3 v_position;\n\n        void main() {\n            // Prepare transforms to map to \"camera view\". See also:\n            // https://threejs.org/docs/#api/renderers/webgl/WebGLProgram\n            mat4 viewModelMatrix = inverse(modelViewMatrix);\n\n            // Project local vertex coordinate to camera position. Then do a step\n            // backward (in cam coords) to the near clipping plane, and project back. Do\n            // the same for the far clipping plane. This gives us all the information we\n            // need to calculate the ray and truncate it to the viewing cone.\n            vec4 position4 = vec4(position, 1.0);\n            vec4 pos_in_cam = modelViewMatrix * position4;\n\n            // Intersection of ray and near clipping plane (z = -1 in clip coords)\n            pos_in_cam.z = -pos_in_cam.w;\n            // pos_in_cam.w = 1.0;\n            // pos_in_cam.z = -1.0;\n            v_nearpos = viewModelMatrix * pos_in_cam;\n\n            // Intersection of ray and far clipping plane (z = +1 in clip coords)\n            pos_in_cam.z = pos_in_cam.w;\n            // pos_in_cam.z = 1.0;\n            v_farpos = viewModelMatrix * pos_in_cam;\n\n            // Set varyings and output pos\n            v_position = position;\n            gl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;\n        }`,\n\n    fragmentShader: /* glsl */`\n\n        precision highp float;\n        precision mediump sampler3D;\n\n        uniform vec3 u_size;\n        uniform int u_renderstyle;\n        uniform float u_renderthreshold;\n        uniform vec2 u_clim;\n\n        uniform sampler3D u_data;\n        uniform sampler2D u_cmdata;\n\n        varying vec3 v_position;\n        varying vec4 v_nearpos;\n        varying vec4 v_farpos;\n\n        // The maximum distance through our rendering volume is sqrt(3).\n        const int MAX_STEPS = 2000; // 887; // 887 for 512^3, 1774 for 1024^3\n        const int REFINEMENT_STEPS = 8; // 4;\n        const float relative_step_size = 1.0;\n        const vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);\n        const vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);\n        const vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);\n        const float shininess = 40.0;\n\n        void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);\n        void cast_aip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);\n        void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);\n\n        float sample1(vec3 texcoords);\n        vec4 apply_colormap(float val);\n        vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);\n\n        void main() {\n            // Normalize clipping plane info\n            vec3 farpos = v_farpos.xyz / v_farpos.w;\n            vec3 nearpos = v_nearpos.xyz / v_nearpos.w;\n\n            // Calculate unit vector pointing in the view direction through this fragment.\n            vec3 view_ray = normalize(nearpos.xyz - farpos.xyz);\n\n            // Compute the (negative) distance to the front surface or near clipping plane.\n            // v_position is the back face of the cuboid, so the initial distance calculated in the dot\n            // product below is the distance from near clip plane to the back of the cuboid\n            float distance = dot(nearpos - v_position, view_ray);\n            distance = max(distance, min((-0.5 - v_position.x) / view_ray.x,\n                                         (u_size.x - 0.5 - v_position.x) / view_ray.x));\n            distance = max(distance, min((-0.5 - v_position.y) / view_ray.y,\n                                         (u_size.y - 0.5 - v_position.y) / view_ray.y));\n            distance = max(distance, min((-0.5 - v_position.z) / view_ray.z,\n                                         (u_size.z - 0.5 - v_position.z) / view_ray.z));\n\n            // Now we have the starting position on the front surface\n            vec3 front = v_position + view_ray * distance;\n\n            // Decide how many steps to take\n            int nsteps = int(-distance / relative_step_size + 0.5);\n            if ( nsteps < 1 )\n                discard;\n\n            // Get starting location and step vector in texture coordinates\n            vec3 step = ((v_position - front) / u_size) / float(nsteps);\n            vec3 start_loc = front / u_size;\n\n            // For testing: show the number of steps. This helps to establish\n            // whether the rays are correctly oriented\n            //'gl_FragColor = vec4(0.0, float(nsteps) / 1.0 / u_size.x, 1.0, 1.0);\n            //'return;\n\n            if (u_renderstyle == 0)\n                cast_mip(start_loc, step, nsteps, view_ray);\n            else if (u_renderstyle == 1)\n                cast_aip(start_loc, step, nsteps, view_ray);\n            else if (u_renderstyle == 2)\n                cast_iso(start_loc, step, nsteps, view_ray);\n\n            if (gl_FragColor.a < 0.05)\n                discard;\n        }\n\n        float sample1(vec3 texcoords) {\n            /* Sample float value from a 3D texture. Assumes intensity data. */\n            return texture(u_data, texcoords.xyz).r;\n        }\n\n        vec4 apply_colormap(float val) {\n            val = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);\n            return texture2D(u_cmdata, vec2(val, 0.5));\n        }\n\n        void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {\n\n            float max_val = -1e6;\n            vec3 loc = start_loc;\n\n            // Enter the raycasting loop. In WebGL 1 the loop index cannot be compared with\n            // non-constant expression. So we use a hard-coded max, and an additional condition\n            // inside the loop.\n            for (int iter = 0; iter < MAX_STEPS; iter++) {\n                if (iter >= nsteps) {\n                    break;\n                }\n                // Sample from the 3D texture\n                float val = sample1(loc);\n                // Apply MIP operation\n                if (val > max_val) {\n                    max_val = val;\n                }\n                // Advance location deeper into the volume\n                loc += step;\n            }\n\n            // Resolve final color\n            gl_FragColor = apply_colormap(max_val);\n        }\n\n        void cast_aip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {\n\n            float avg_val = 0.0;\n            int count = 0;\n            vec3 loc = start_loc;\n            float eps = 0.02;\n\n            // Enter the raycasting loop. In WebGL 1 the loop index cannot be compared with\n            // non-constant expression. So we use a hard-coded max, and an additional condition\n            // inside the loop.\n            for (int iter = 0; iter < MAX_STEPS; iter++) {\n                if (iter >= nsteps) {\n                    break;\n                }\n                // Sample from the 3D texture\n                float val = sample1(loc);\n                // Apply SUM operation   \n                if (abs(loc.x - 0.5) < eps \n                    || abs(loc.y - 0.5) < eps \n                    || abs(loc.z - 0.5) < eps) {\n                    avg_val += val;\n                    count += 1;\n                }          \n                // Advance location deeper into the volume\n                loc += step;\n            }\n\n            // Resolve final color\n            if (count > 0) {\n                gl_FragColor = apply_colormap(avg_val / float(count));\n            } else {\n                gl_FragColor = vec4(0.0);\n            }\n        }\n\n        void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {\n\n            gl_FragColor = vec4(0.0);    // init transparent\n            vec4 color3 = vec4(0.0);    // final color\n            vec3 dstep = 1.5 / u_size;    // step to sample derivative\n            vec3 loc = start_loc;\n\n            float low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);\n\n            // Enter the raycasting loop. In WebGL 1 the loop index cannot be compared with\n            // non-constant expression. So we use a hard-coded max, and an additional condition\n            // inside the loop.\n            for (int iter=0; iter<MAX_STEPS; iter++) {\n                if (iter >= nsteps)\n                    break;\n\n                // Sample from the 3D texture\n                float val = sample1(loc);\n\n                if (val > low_threshold) {\n                    // Take the last interval in smaller steps\n                    vec3 iloc = loc - 0.5 * step;\n                    vec3 istep = step / float(REFINEMENT_STEPS);\n                    for (int i=0; i<REFINEMENT_STEPS; i++) {\n                        val = sample1(iloc);\n                        if (val > u_renderthreshold) {\n                            gl_FragColor = add_lighting(val, iloc, dstep, view_ray);\n                            return;\n                        }\n                        iloc += istep;\n                    }\n                }\n\n                // Advance location deeper into the volume\n                loc += step;\n            }\n        }\n\n        vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray) {\n            // Calculate color by incorporating lighting\n\n            // View direction\n            vec3 V = normalize(view_ray);\n\n            // calculate normal vector from gradient\n            vec3 N;\n            float val1, val2;\n            val1 = sample1(loc + vec3(-step[0], 0.0, 0.0));\n            val2 = sample1(loc + vec3(+step[0], 0.0, 0.0));\n            N[0] = val1 - val2;\n            val = max(max(val1, val2), val);\n            val1 = sample1(loc + vec3(0.0, -step[1], 0.0));\n            val2 = sample1(loc + vec3(0.0, +step[1], 0.0));\n            N[1] = val1 - val2;\n            val = max(max(val1, val2), val);\n            val1 = sample1(loc + vec3(0.0, 0.0, -step[2]));\n            val2 = sample1(loc + vec3(0.0, 0.0, +step[2]));\n            N[2] = val1 - val2;\n            val = max(max(val1, val2), val);\n\n            float gm = length(N); // gradient magnitude\n            N = normalize(N);\n\n            // Flip normal so it points towards viewer\n            float Nselect = float(dot(N, V) > 0.0);\n            N = (2.0 * Nselect - 1.0) * N;    // ==    Nselect * N - (1.0-Nselect)*N;\n\n            // Init colors\n            vec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);\n            vec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);\n            vec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);\n\n            // note: could allow multiple lights\n            for (int i=0; i<1; i++) {\n                 // Get light direction (make sure to prevent zero devision)\n                vec3 L = normalize(view_ray);    //lightDirs[i];\n                float lightEnabled = float( length(L) > 0.0 );\n                L = normalize(L + (1.0 - lightEnabled));\n\n                // Calculate lighting properties\n                float lambertTerm = clamp(dot(N, L), 0.0, 1.0);\n                vec3 H = normalize(L+V); // Halfway vector\n                float specularTerm = pow(max(dot(H, N), 0.0), shininess);\n\n                // Calculate mask\n                float mask1 = lightEnabled;\n\n                // Calculate colors\n                ambient_color +=    mask1 * ambient_color;    // * gl_LightSource[i].ambient;\n                diffuse_color +=    mask1 * lambertTerm;\n                specular_color += mask1 * specularTerm * specular_color;\n            }\n\n            // Calculate final color by componing different components\n            vec4 final_color;\n            vec4 color = apply_colormap(val);\n            final_color = color * (ambient_color + diffuse_color) + specular_color;\n            final_color.a = color.a;\n            return final_color;\n        }`\n};\n\nexport { VolumeShader };\n\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as THREE from \"three\";\nimport { ColorBar, formatColorBar } from \"../model/colorBar\";\n\nclass ColorBarTextures {\n\n    private readonly textures: { [cmName: string]: THREE.Texture };\n\n    constructor() {\n        this.textures = {};\n    }\n\n    get(colorBar: ColorBar, onLoad?: () => any): THREE.Texture {\n        const key = formatColorBar(colorBar);\n        let texture = this.textures[key];\n        if (!texture) {\n            // const image = new Image();\n            // loadColorBarImage(colorBar, image).then();\n            // texture = new THREE.Texture(image);\n            texture = new THREE.TextureLoader().load(`data:image/png;base64,${colorBar.imageData}`, onLoad);\n            this.textures[key] = texture;\n        }\n        return texture;\n    }\n}\n\nexport const colorBarTextures = new ColorBarTextures();","import * as THREE from \"three\";\nimport { OrbitControls } from './OrbitControls';\nimport { Volume } from './Volume';\nimport { VolumeShader } from './VolumeShader';\nimport { isWebGL2Available } from './webgl-utils';\nimport { ColorBar } from \"../model/colorBar\";\nimport { colorBarTextures } from \"./ColorBarTextures\";\n\n\nexport interface VolumeOptions {\n    value1: number;\n    value2: number;\n    isoThreshold: number;\n    renderMode: \"mip\" | \"aip\" | \"iso\";\n    colorBar: ColorBar;\n}\n\nexport class VolumeScene {\n\n    readonly canvas: HTMLCanvasElement;\n    private readonly camera: THREE.OrthographicCamera;\n    private readonly controls: THREE.EventDispatcher;\n    private readonly renderer: THREE.WebGLRenderer;\n    // private readonly cmTextures: { [cmName: string]: THREE.Texture };\n\n    // Instantiated after volume is set\n    private scene: THREE.Scene | null;\n    private texture: THREE.Data3DTexture | null;\n    private material: THREE.ShaderMaterial | null;\n\n    constructor(canvas: HTMLCanvasElement) {\n\n        if (!isWebGL2Available()) {\n            throw new Error(\"Missing WebGL2\");\n        }\n\n        this.render = this.render.bind(this);\n\n        // Create renderer\n        const renderer = new THREE.WebGLRenderer({canvas});\n        renderer.setPixelRatio(window.devicePixelRatio);\n        renderer.setSize(canvas.clientWidth, canvas.clientHeight);\n        // document.body.appendChild(renderer.domElement);\n\n        // Create camera (The volume renderer does not work very well with perspective yet)\n        const h = 100; // frustum height\n        const aspect = canvas.clientWidth / canvas.clientHeight;\n        const camera = new THREE.OrthographicCamera(\n            -h * aspect,\n            h * aspect,\n            h,\n            -h,\n            -1000,\n            1000\n        );\n        camera.position.set(0, 0, 100);\n        camera.up.set(0, 1, 0);\n\n        // Create controls\n        const controls = new OrbitControls(camera, renderer.domElement);\n        controls.target.set(100, 50, 0);\n        controls.minZoom = 0.1;\n        controls.maxZoom = 500;\n        controls.enablePan = true;\n        controls.update();\n\n        // scene.add( new AxesHelper( 128 ) );\n\n        // Lighting is baked into the shader a.t.m.\n        // let dirLight = new DirectionalLight( 0xffffff );\n\n        this.canvas = canvas;\n        this.renderer = renderer;\n        this.camera = camera;\n        this.controls = controls;\n\n        this.scene = null;\n        this.texture = null;\n        this.material = null;\n\n        // Colormap textures\n        // this.cmTextures = {\n        //     viridis: new THREE.TextureLoader().load('images/textures/cm_viridis.png', this.render),\n        //     gray: new THREE.TextureLoader().load('images/textures/cm_gray.png', this.render)\n        // };\n\n        controls.addEventListener('change', this.render);\n        canvas.addEventListener('resize', this.onCanvasResize);\n    }\n\n    setVolume(volume: Volume, options: VolumeOptions) {\n\n        // Texture to hold the volume. We have scalars, so we put our data in the red channel.\n        // THREEJS will select R32F (33326) based on the THREE.RedFormat and THREE.FloatType.\n        // Also see https://www.khronos.org/registry/webgl/specs/latest/2.0/#TEXTURE_TYPES_FORMATS_FROM_DOM_ELEMENTS_TABLE\n        // TODO: look the dtype up in the volume metadata\n\n        const texture = new THREE.Data3DTexture(volume.data, volume.xLength, volume.yLength, volume.zLength);\n        texture.format = THREE.RedFormat;\n        texture.type = THREE.FloatType;\n        texture.minFilter = texture.magFilter = THREE.LinearFilter;\n        texture.unpackAlignment = 1;\n        texture.needsUpdate = true;\n\n        const shader = VolumeShader;\n\n        const uniforms = THREE.UniformsUtils.clone(shader.uniforms);\n\n        const [sx, sy, sz] = volume.spacing;\n        const sizeX = Math.floor(sx * volume.xLength);\n        const sizeY = Math.floor(sy * volume.yLength);\n        const sizeZ = Math.floor(sz * volume.zLength);\n\n        uniforms['u_data'].value = texture;\n        uniforms['u_size'].value.set(sizeX, sizeY, sizeZ);\n\n        const material = new THREE.ShaderMaterial({\n            uniforms: uniforms,\n            vertexShader: shader.vertexShader,\n            fragmentShader: shader.fragmentShader,\n            side: THREE.BackSide // The volume shader uses the backface as its \"reference point\"\n        });\n\n        // THREE.Mesh\n        // const geometry = new THREE.BoxGeometry(\n        //     volume.xLength,\n        //     volume.yLength,\n        //     volume.zLength\n        // );\n        // geometry.translate(\n        //     volume.xLength / 2 - 0.5,\n        //     volume.yLength / 2 - 0.5,\n        //     volume.zLength / 2 - 0.5\n        // );\n\n        const geometry = new THREE.BoxGeometry(\n            sizeX,\n            sizeY,\n            sizeZ\n        );\n\n        geometry.translate(\n            sizeX / 2,\n            sizeY / 2,\n            sizeZ / 2\n        );\n\n        const mesh = new THREE.Mesh(geometry, material);\n        const scene = new THREE.Scene();\n        scene.add(mesh);\n        scene.add(new THREE.BoxHelper(mesh));\n\n        // const gridXZ = new THREE.GridHelper(1, 10, 0xffffff, 0xff3333);\n        // gridXZ.scale.set(sizeX, 1, sizeZ);\n        // gridXZ.position.set(-sizeX / 2, 0, -sizeZ / 2);\n        //\n        // const gridXY = new THREE.GridHelper(1, 10, 0xffffff, 0x33ff33);\n        // gridXY.scale.set(sizeX, 1, sizeY);\n        // gridXY.rotateX(-Math.PI / 2);\n        // gridXZ.position.set(sizeX / 2, sizeY / 2, 0);\n\n        // const gridZY = new THREE.GridHelper(1, 10, 0xffffff, 0x3333ff);\n        // gridZY.scale.set(sizeZ , 1, sizeY);\n        // gridZY.rotateY(Math.PI / 2);\n        // gridZY.rotateZ(Math.PI / 2);\n        // gridZY.translateY(sizeY / 2);\n        // gridZY.translateZ(sizeZ / 2);\n\n        // scene.add(gridXZ);\n        // scene.add(gridXY);\n        // scene.add(gridZY);\n\n        this.scene = scene;\n        this.material = material;\n        this.texture = texture;\n\n        this.setVolumeOptions(options);\n    }\n\n    setVolumeOptions(options: VolumeOptions) {\n        const material = this.material;\n        if (material !== null) {\n            const {value1, value2, isoThreshold, renderMode, colorBar} = options;\n            const uniforms = material.uniforms;\n            uniforms['u_clim'].value.set(value1, value2);\n            uniforms['u_renderthreshold'].value = isoThreshold;\n            uniforms['u_renderstyle'].value = (renderMode === 'mip') ? 0:(renderMode === 'aip') ? 1:2;\n            uniforms['u_cmdata'].value = colorBarTextures.get(colorBar, this.render);\n            this.render();\n        }\n    }\n\n    getMaterial(): THREE.ShaderMaterial {\n        if (this.material === null) {\n            throw new Error(\"Volume not set!\");\n        }\n        return this.material!;\n    }\n\n    onCanvasResize() {\n        console.warn(\"Alarm: Canvas resize!\")\n        const canvas = this.renderer.domElement;\n        this.renderer.setSize(canvas.clientWidth, canvas.clientHeight);\n        const aspect = canvas.clientWidth / canvas.clientHeight;\n        const frustumHeight = this.camera.top - this.camera.bottom;\n        this.camera.left = -frustumHeight * aspect / 2;\n        this.camera.right = frustumHeight * aspect / 2;\n        this.camera.updateProjectionMatrix();\n        this.render();\n    }\n\n    render() {\n        if (this.scene !== null) {\n            this.renderer.render(this.scene, this.camera);\n        }\n    }\n}","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport function isWebGL2Available(): boolean {\n    try {\n        const canvas = document.createElement('canvas');\n        return !!(window.WebGL2RenderingContext && canvas.getContext('webgl2'));\n    } catch (e) {\n        return false;\n    }\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { ClampToEdgeWrapping, DoubleSide, LinearFilter, Mesh, MeshBasicMaterial, PlaneGeometry, Texture } from 'three';\n\n/**\n * This class has been made to hold a slice of a volume data\n * @class\n * @param   {Volume} volume    The associated volume\n * @param   {number}       [index=0] The index of the slice\n * @param   {string}       [axis='z']      For now only 'x', 'y' or 'z' but later it will change to a normal vector\n * @see Volume\n */\nclass VolumeSlice {\n\n    constructor(volume, index, axis) {\n        const slice = this;\n        /**\n         * @member {Volume} volume The associated volume\n         */\n        this.volume = volume;\n        /**\n         * @member {Number} index The index of the slice, if changed, will automatically call updateGeometry at the next repaint\n         */\n        index = index || 0;\n        Object.defineProperty(this, 'index', {\n            get: function () {\n                return index;\n            },\n            set: function (value) {\n                index = value;\n                slice.geometryNeedsUpdate = true;\n                return index;\n            }\n        });\n        /**\n         * @member {String} axis The normal axis\n         */\n        this.axis = axis || 'z';\n\n        /**\n         * @member {HTMLCanvasElement} canvas The final canvas used for the texture\n         */\n        this.canvas = document.createElement('canvas');\n        /**\n         * @member {HTMLCanvasElement} canvasBuffer The intermediary canvas used to paint the data\n         */\n        this.canvasBuffer = document.createElement('canvas');\n        this.updateGeometry();\n\n\n        const canvasMap = new Texture(this.canvas);\n        canvasMap.minFilter = LinearFilter;\n        canvasMap.wrapS = canvasMap.wrapT = ClampToEdgeWrapping;\n        const material = new MeshBasicMaterial({map: canvasMap, side: DoubleSide, transparent: true});\n        /**\n         * @member {Mesh} mesh The mesh ready to get used in the scene\n         */\n        this.mesh = new Mesh(this.geometry, material);\n        this.mesh.matrixAutoUpdate = false;\n        /**\n         * @member {Boolean} geometryNeedsUpdate If set to true, updateGeometry will be triggered at the next repaint\n         */\n        this.geometryNeedsUpdate = true;\n        this.repaint();\n\n        /**\n         * @member {Number} iLength Width of slice in the original coordinate system, corresponds to the width of the buffer canvas\n         */\n\n        /**\n         * @member {Number} jLength Height of slice in the original coordinate system, corresponds to the height of the buffer canvas\n         */\n\n        /**\n         * @member {Function} sliceAccess Function that allow the slice to access right data\n         * @see Volume.extractPerpendicularPlane\n         * @param {Number} i The first coordinate\n         * @param {Number} j The second coordinate\n         * @returns {Number} the index corresponding to the voxel in volume.data of the given position in the slice\n         */\n    }\n\n    /**\n     * @member {Function} repaint Refresh the texture and the geometry if geometryNeedsUpdate is set to true\n     * @memberof VolumeSlice\n     */\n    repaint() {\n        if (this.geometryNeedsUpdate) {\n            this.updateGeometry();\n        }\n\n        const iLength = this.iLength,\n            jLength = this.jLength,\n            sliceAccess = this.sliceAccess,\n            volume = this.volume,\n            canvas = this.canvasBuffer,\n            ctx = this.ctxBuffer;\n\n\n        // get the imageData and pixel array from the canvas\n        const imgData = ctx.getImageData(0, 0, iLength, jLength);\n        const data = imgData.data;\n        const volumeData = volume.data;\n        const upperThreshold = volume.upperThreshold;\n        const lowerThreshold = volume.lowerThreshold;\n        const windowLow = volume.windowLow;\n        const windowHigh = volume.windowHigh;\n\n        // manipulate some pixel elements\n        let pixelCount = 0;\n\n        if (volume.dataType === 'label') {\n            //this part is currently useless but will be used when colortables will be handled\n            for (let j = 0; j < jLength; j++) {\n                for (let i = 0; i < iLength; i++) {\n                    let label = volumeData[sliceAccess(i, j)];\n                    label = label >= this.colorMap.length ? (label % this.colorMap.length) + 1 : label;\n                    const color = this.colorMap[label];\n                    data[4 * pixelCount] = (color >> 24) & 0xff;\n                    data[4 * pixelCount + 1] = (color >> 16) & 0xff;\n                    data[4 * pixelCount + 2] = (color >> 8) & 0xff;\n                    data[4 * pixelCount + 3] = color & 0xff;\n                    pixelCount++;\n                }\n            }\n        } else {\n            for (let j = 0; j < jLength; j++) {\n                for (let i = 0; i < iLength; i++) {\n                    let value = volumeData[sliceAccess(i, j)];\n                    let alpha = 0xff;\n                    //apply threshold\n                    alpha = upperThreshold >= value ? (lowerThreshold <= value ? alpha : 0) : 0;\n                    //apply window level\n                    value = Math.floor(255 * (value - windowLow) / (windowHigh - windowLow));\n                    value = value > 255 ? 255 : (value < 0 ? 0 : value | 0);\n\n                    data[4 * pixelCount] = value;\n                    data[4 * pixelCount + 1] = value;\n                    data[4 * pixelCount + 2] = value;\n                    data[4 * pixelCount + 3] = alpha;\n                    pixelCount++;\n                }\n            }\n\n        }\n\n        ctx.putImageData(imgData, 0, 0);\n        this.ctx.drawImage(canvas, 0, 0, iLength, jLength, 0, 0, this.canvas.width, this.canvas.height);\n\n        this.mesh.material.map.needsUpdate = true;\n    }\n\n    /**\n     * @member {Function} Refresh the geometry according to axis and index\n     * @see Volume.extractPerpendicularPlane\n     * @memberof VolumeSlice\n     */\n    updateGeometry() {\n        const extracted = this.volume.extractPerpendicularPlane(this.axis, this.index);\n        this.sliceAccess = extracted.sliceAccess;\n        this.jLength = extracted.jLength;\n        this.iLength = extracted.iLength;\n        this.matrix = extracted.matrix;\n\n        this.canvas.width = extracted.planeWidth;\n        this.canvas.height = extracted.planeHeight;\n        this.canvasBuffer.width = this.iLength;\n        this.canvasBuffer.height = this.jLength;\n        this.ctx = this.canvas.getContext('2d');\n        this.ctxBuffer = this.canvasBuffer.getContext('2d');\n\n        if (this.geometry) this.geometry.dispose(); // dispose existing geometry\n\n        this.geometry = new PlaneGeometry(extracted.planeWidth, extracted.planeHeight);\n\n        if (this.mesh) {\n            this.mesh.geometry = this.geometry;\n            //reset mesh matrix\n            this.mesh.matrix.identity();\n            this.mesh.applyMatrix4(this.matrix);\n        }\n\n        this.geometryNeedsUpdate = false;\n    }\n\n}\n\nexport { VolumeSlice };\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Matrix3, Matrix4, Vector3 } from 'three';\nimport { VolumeSlice } from './VolumeSlice';\n\n/**\n * This class had been written to handle the output of the NRRD loader.\n * It contains a volume of data and informations about it.\n * For now it only handles 3 dimensional data.\n * See the webgl_loader_nrrd.html example and the loaderNRRD.js file to see how to use this class.\n * @class\n * @param   {number}        xLength         Width of the volume\n * @param   {number}        yLength         Length of the volume\n * @param   {number}        zLength         Depth of the volume\n * @param   {string}        type            The type of data (uint8, uint16, ...)\n * @param   {ArrayBuffer}   arrayBuffer     The buffer with volume data\n */\nclass Volume {\n\n    constructor(xLength, yLength, zLength, type, arrayBuffer) {\n        if (xLength !== undefined) {\n            /**\n             * @member {number} xLength Width of the volume in the IJK coordinate system\n             */\n            this.xLength = Number(xLength) || 1;\n            /**\n             * @member {number} yLength Height of the volume in the IJK coordinate system\n             */\n            this.yLength = Number(yLength) || 1;\n            /**\n             * @member {number} zLength Depth of the volume in the IJK coordinate system\n             */\n            this.zLength = Number(zLength) || 1;\n            /**\n             * @member {Array<string>} The order of the Axis dictated by the NRRD header\n             */\n            this.axisOrder = ['x', 'y', 'z'];\n            /**\n             * @member {TypedArray} data Data of the volume\n             */\n\n            switch (type) {\n\n                case 'Uint8' :\n                case 'uint8' :\n                case 'uchar' :\n                case 'unsigned char' :\n                case 'uint8_t' :\n                    this.data = new Uint8Array(arrayBuffer);\n                    break;\n                case 'Int8' :\n                case 'int8' :\n                case 'signed char' :\n                case 'int8_t' :\n                    this.data = new Int8Array(arrayBuffer);\n                    break;\n                case 'Int16' :\n                case 'int16' :\n                case 'short' :\n                case 'short int' :\n                case 'signed short' :\n                case 'signed short int' :\n                case 'int16_t' :\n                    this.data = new Int16Array(arrayBuffer);\n                    break;\n                case 'Uint16' :\n                case 'uint16' :\n                case 'ushort' :\n                case 'unsigned short' :\n                case 'unsigned short int' :\n                case 'uint16_t' :\n                    this.data = new Uint16Array(arrayBuffer);\n                    break;\n                case 'Int32' :\n                case 'int32' :\n                case 'int' :\n                case 'signed int' :\n                case 'int32_t' :\n                    this.data = new Int32Array(arrayBuffer);\n                    break;\n                case 'Uint32' :\n                case 'uint32' :\n                case 'uint' :\n                case 'unsigned int' :\n                case 'uint32_t' :\n                    this.data = new Uint32Array(arrayBuffer);\n                    break;\n                case 'longlong' :\n                case 'long long' :\n                case 'long long int' :\n                case 'signed long long' :\n                case 'signed long long int' :\n                case 'int64' :\n                case 'int64_t' :\n                case 'ulonglong' :\n                case 'unsigned long long' :\n                case 'unsigned long long int' :\n                case 'uint64' :\n                case 'uint64_t' :\n                    throw new Error('Error in Volume constructor : this type is not supported in JavaScript');\n                case 'Float32' :\n                case 'float32' :\n                case 'float' :\n                    this.data = new Float32Array(arrayBuffer);\n                    break;\n                case 'Float64' :\n                case 'float64' :\n                case 'double' :\n                    this.data = new Float64Array(arrayBuffer);\n                    break;\n                default :\n                    this.data = new Uint8Array(arrayBuffer);\n\n            }\n\n            if (this.data.length !== this.xLength * this.yLength * this.zLength) {\n                throw new Error('Error in Volume constructor, lengths are not matching arrayBuffer size');\n            }\n        }\n\n        /**\n         * @member {Array}  spacing Spacing to apply to the volume from IJK to RAS coordinate system\n         */\n        this.spacing = [1, 1, 1];\n        /**\n         * @member {Array}  offset Offset of the volume in the RAS coordinate system\n         */\n        this.offset = [0, 0, 0];\n        /**\n         * @member {Martrix3} matrix The IJK to RAS matrix\n         */\n        this.matrix = new Matrix3();\n        this.matrix.identity();\n        /**\n         * @member {Martrix3} inverseMatrix The RAS to IJK matrix\n         */\n        /**\n         * @member {number} lowerThreshold The voxels with values under this threshold won't appear in the slices.\n         *                      If changed, geometryNeedsUpdate is automatically set to true on all the slices associated to this volume\n         */\n        let lowerThreshold = -Infinity;\n        Object.defineProperty(this, 'lowerThreshold', {\n            get: function () {\n                return lowerThreshold;\n            },\n            set: function (value) {\n                lowerThreshold = value;\n                this.sliceList.forEach(function (slice) {\n                    slice.geometryNeedsUpdate = true;\n                });\n            }\n        });\n        /**\n         * @member {number} upperThreshold The voxels with values over this threshold won't appear in the slices.\n         *                      If changed, geometryNeedsUpdate is automatically set to true on all the slices associated to this volume\n         */\n        let upperThreshold = Infinity;\n        Object.defineProperty(this, 'upperThreshold', {\n            get: function () {\n                return upperThreshold;\n            },\n            set: function (value) {\n                upperThreshold = value;\n                this.sliceList.forEach(function (slice) {\n                    slice.geometryNeedsUpdate = true;\n                });\n            }\n        });\n\n        /**\n         * @member {Array} sliceList The list of all the slices associated to this volume\n         */\n        this.sliceList = [];\n    }\n\n    /**\n     * @member {Function} getData Shortcut for data[access(i,j,k)]\n     * @memberof Volume\n     * @param {number} i    First coordinate\n     * @param {number} j    Second coordinate\n     * @param {number} k    Third coordinate\n     * @returns {number}  value in the data array\n     */\n    getData(i, j, k) {\n        return this.data[k * this.xLength * this.yLength + j * this.xLength + i];\n    }\n\n    /**\n     * @member {Function} access compute the index in the data array corresponding to the given coordinates in IJK system\n     * @memberof Volume\n     * @param {number} i    First coordinate\n     * @param {number} j    Second coordinate\n     * @param {number} k    Third coordinate\n     * @returns {number}  index\n     */\n    access(i, j, k) {\n        return k * this.xLength * this.yLength + j * this.xLength + i;\n    }\n\n    /**\n     * @member {Function} reverseAccess Retrieve the IJK coordinates of the voxel corresponding of the given index in the data\n     * @memberof Volume\n     * @param {number} index index of the voxel\n     * @returns {Array}  [x,y,z]\n     */\n    reverseAccess(index) {\n        const z = Math.floor(index / (this.yLength * this.xLength));\n        const y = Math.floor((index - z * this.yLength * this.xLength) / this.xLength);\n        const x = index - z * this.yLength * this.xLength - y * this.xLength;\n        return [x, y, z];\n    }\n\n    /**\n     * @member {Function} map Apply a function to all the voxels, be careful, the value will be replaced\n     * @memberof Volume\n     * @param {Function} functionToMap A function to apply to every voxel, will be called with the following parameters :\n     *                                 value of the voxel\n     *                                 index of the voxel\n     *                                 the data (TypedArray)\n     * @param {Object}   context    You can specify a context in which call the function, default if this Volume\n     * @returns {Volume}   this\n     */\n    map(functionToMap, context) {\n        const length = this.data.length;\n        context = context || this;\n\n        for (let i = 0; i < length; i++) {\n            this.data[i] = functionToMap.call(context, this.data[i], i, this.data);\n        }\n        return this;\n    }\n\n    /**\n     * @member {Function} extractPerpendicularPlane Compute the orientation of the slice and returns all the information relative to the geometry such as sliceAccess, the plane matrix (orientation and position in RAS coordinate) and the dimensions of the plane in both coordinate system.\n     * @memberof Volume\n     * @param {string}            axis  the normal axis to the slice 'x' 'y' or 'z'\n     * @param {number}            index the index of the slice\n     * @returns {Object} an object containing all the usefull information on the geometry of the slice\n     */\n    extractPerpendicularPlane(axis, RASIndex) {\n        let firstSpacing,\n            secondSpacing,\n            positionOffset,\n            IJKIndex;\n\n        const axisInIJK = new Vector3(),\n            firstDirection = new Vector3(),\n            secondDirection = new Vector3(),\n            planeMatrix = (new Matrix4()).identity(),\n            volume = this;\n\n        const dimensions = new Vector3(this.xLength, this.yLength, this.zLength);\n\n        switch (axis) {\n            case 'x' :\n                axisInIJK.set(1, 0, 0);\n                firstDirection.set(0, 0, -1);\n                secondDirection.set(0, -1, 0);\n                firstSpacing = this.spacing[this.axisOrder.indexOf('z')];\n                secondSpacing = this.spacing[this.axisOrder.indexOf('y')];\n                IJKIndex = new Vector3(RASIndex, 0, 0);\n\n                planeMatrix.multiply((new Matrix4()).makeRotationY(Math.PI / 2));\n                positionOffset = (volume.RASDimensions[0] - 1) / 2;\n                planeMatrix.setPosition(new Vector3(RASIndex - positionOffset, 0, 0));\n                break;\n            case 'y' :\n                axisInIJK.set(0, 1, 0);\n                firstDirection.set(1, 0, 0);\n                secondDirection.set(0, 0, 1);\n                firstSpacing = this.spacing[this.axisOrder.indexOf('x')];\n                secondSpacing = this.spacing[this.axisOrder.indexOf('z')];\n                IJKIndex = new Vector3(0, RASIndex, 0);\n\n                planeMatrix.multiply((new Matrix4()).makeRotationX(-Math.PI / 2));\n                positionOffset = (volume.RASDimensions[1] - 1) / 2;\n                planeMatrix.setPosition(new Vector3(0, RASIndex - positionOffset, 0));\n                break;\n            case 'z' :\n            default :\n                axisInIJK.set(0, 0, 1);\n                firstDirection.set(1, 0, 0);\n                secondDirection.set(0, -1, 0);\n                firstSpacing = this.spacing[this.axisOrder.indexOf('x')];\n                secondSpacing = this.spacing[this.axisOrder.indexOf('y')];\n                IJKIndex = new Vector3(0, 0, RASIndex);\n\n                positionOffset = (volume.RASDimensions[2] - 1) / 2;\n                planeMatrix.setPosition(new Vector3(0, 0, RASIndex - positionOffset));\n                break;\n        }\n\n        firstDirection.applyMatrix4(volume.inverseMatrix).normalize();\n        firstDirection.arglet = 'i';\n        secondDirection.applyMatrix4(volume.inverseMatrix).normalize();\n        secondDirection.arglet = 'j';\n        axisInIJK.applyMatrix4(volume.inverseMatrix).normalize();\n        const iLength = Math.floor(Math.abs(firstDirection.dot(dimensions)));\n        const jLength = Math.floor(Math.abs(secondDirection.dot(dimensions)));\n        const planeWidth = Math.abs(iLength * firstSpacing);\n        const planeHeight = Math.abs(jLength * secondSpacing);\n\n        IJKIndex = Math.abs(Math.round(IJKIndex.applyMatrix4(volume.inverseMatrix).dot(axisInIJK)));\n        const base = [new Vector3(1, 0, 0), new Vector3(0, 1, 0), new Vector3(0, 0, 1)];\n        const iDirection = [firstDirection, secondDirection, axisInIJK].find(function (x) {\n            return Math.abs(x.dot(base[0])) > 0.9;\n        });\n        const jDirection = [firstDirection, secondDirection, axisInIJK].find(function (x) {\n            return Math.abs(x.dot(base[1])) > 0.9;\n        });\n        const kDirection = [firstDirection, secondDirection, axisInIJK].find(function (x) {\n            return Math.abs(x.dot(base[2])) > 0.9;\n        });\n\n        function sliceAccess(i, j) {\n            const si = (iDirection === axisInIJK) ? IJKIndex : (iDirection.arglet === 'i' ? i : j);\n            const sj = (jDirection === axisInIJK) ? IJKIndex : (jDirection.arglet === 'i' ? i : j);\n            const sk = (kDirection === axisInIJK) ? IJKIndex : (kDirection.arglet === 'i' ? i : j);\n\n            // invert indices if necessary\n\n            const accessI = (iDirection.dot(base[0]) > 0) ? si : (volume.xLength - 1) - si;\n            const accessJ = (jDirection.dot(base[1]) > 0) ? sj : (volume.yLength - 1) - sj;\n            const accessK = (kDirection.dot(base[2]) > 0) ? sk : (volume.zLength - 1) - sk;\n\n            return volume.access(accessI, accessJ, accessK);\n        }\n\n        return {\n            iLength: iLength,\n            jLength: jLength,\n            sliceAccess: sliceAccess,\n            matrix: planeMatrix,\n            planeWidth: planeWidth,\n            planeHeight: planeHeight\n        };\n\n    }\n\n    /**\n     * @member {Function} extractSlice Returns a slice corresponding to the given axis and index\n     *                        The coordinate are given in the Right Anterior Superior coordinate format\n     * @memberof Volume\n     * @param {string}            axis  the normal axis to the slice 'x' 'y' or 'z'\n     * @param {number}            index the index of the slice\n     * @returns {VolumeSlice} the extracted slice\n     */\n    extractSlice(axis, index) {\n        const slice = new VolumeSlice(this, index, axis);\n        this.sliceList.push(slice);\n        return slice;\n    }\n\n    /**\n     * @member {Function} repaintAllSlices Call repaint on all the slices extracted from this volume\n     * @see VolumeSlice.repaint\n     * @memberof Volume\n     * @returns {Volume} this\n     */\n    repaintAllSlices() {\n        this.sliceList.forEach(function (slice) {\n            slice.repaint();\n        });\n        return this;\n    }\n\n    /**\n     * @member {Function} computeMinMax Compute the minimum and the maximum of the data in the volume\n     * @memberof Volume\n     * @returns {Array} [min,max]\n     */\n    computeMinMax() {\n        let min = Infinity;\n        let max = -Infinity;\n\n        // buffer the length\n        const datasize = this.data.length;\n\n        let i = 0;\n        for (i = 0; i < datasize; i++) {\n            if (!isNaN(this.data[i])) {\n                const value = this.data[i];\n                min = Math.min(min, value);\n                max = Math.max(max, value);\n            }\n        }\n\n        this.min = min;\n        this.max = max;\n\n        return [min, max];\n    }\n}\n\nexport { Volume };\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { FileLoader, Loader, Matrix4, Vector3 } from 'three';\nimport * as fflate from 'fflate';\nimport { Volume } from './Volume';\n\nclass NRRDLoader extends Loader {\n\n    constructor(manager) {\n\n        super(manager);\n\n    }\n\n    load(url, onLoad, onProgress, onError) {\n\n        const scope = this;\n\n        const loader = new FileLoader(scope.manager);\n        loader.setPath(scope.path);\n        loader.setResponseType('arraybuffer');\n        loader.setRequestHeader(scope.requestHeader);\n        loader.setWithCredentials(scope.withCredentials);\n        loader.load(url, function (data) {\n\n            try {\n\n                onLoad(scope.parse(data));\n\n            } catch (e) {\n\n                if (onError) {\n\n                    onError(e);\n\n                } else {\n\n                    console.error(e);\n\n                }\n\n                scope.manager.itemError(url);\n\n            }\n\n        }, onProgress, onError);\n\n    }\n\n    parse(data) {\n\n        // this parser is largely inspired from the XTK NRRD parser : https://github.com/xtk/X\n\n        let _data = data;\n\n        let _dataPointer = 0;\n\n        const _nativeLittleEndian = new Int8Array(new Int16Array([1]).buffer)[0] > 0;\n\n        const _littleEndian = true;\n\n        const headerObject = {};\n\n        function scan(type, chunks) {\n\n            if (chunks === undefined || chunks === null) {\n\n                chunks = 1;\n\n            }\n\n            let _chunkSize = 1;\n            let _array_type = Uint8Array;\n\n            switch (type) {\n\n                // 1 byte data types\n                case 'uchar':\n                    break;\n                case 'schar':\n                    _array_type = Int8Array;\n                    break;\n                // 2 byte data types\n                case 'ushort':\n                    _array_type = Uint16Array;\n                    _chunkSize = 2;\n                    break;\n                case 'sshort':\n                    _array_type = Int16Array;\n                    _chunkSize = 2;\n                    break;\n                // 4 byte data types\n                case 'uint':\n                    _array_type = Uint32Array;\n                    _chunkSize = 4;\n                    break;\n                case 'sint':\n                    _array_type = Int32Array;\n                    _chunkSize = 4;\n                    break;\n                case 'float':\n                    _array_type = Float32Array;\n                    _chunkSize = 4;\n                    break;\n                case 'complex':\n                    _array_type = Float64Array;\n                    _chunkSize = 8;\n                    break;\n                case 'double':\n                    _array_type = Float64Array;\n                    _chunkSize = 8;\n                    break;\n\n            }\n\n            // increase the data pointer in-place\n            let _bytes = new _array_type(_data.slice(_dataPointer,\n                _dataPointer += chunks * _chunkSize));\n\n            // if required, flip the endianness of the bytes\n            if (_nativeLittleEndian !== _littleEndian) {\n\n                // we need to flip here since the format doesn't match the native endianness\n                _bytes = flipEndianness(_bytes, _chunkSize);\n\n            }\n\n            if (chunks === 1) {\n\n                // if only one chunk was requested, just return one value\n                return _bytes[0];\n\n            }\n\n            // return the byte array\n            return _bytes;\n\n        }\n\n        //Flips typed array endianness in-place. Based on https://github.com/kig/DataStream.js/blob/master/DataStream.js.\n\n        function flipEndianness(array, chunkSize) {\n\n            const u8 = new Uint8Array(array.buffer, array.byteOffset, array.byteLength);\n            for (let i = 0; i < array.byteLength; i += chunkSize) {\n\n                for (let j = i + chunkSize - 1, k = i; j > k; j--, k++) {\n\n                    const tmp = u8[k];\n                    u8[k] = u8[j];\n                    u8[j] = tmp;\n\n                }\n\n            }\n\n            return array;\n\n        }\n\n        //parse the header\n        function parseHeader(header) {\n\n            let data, field, fn, i, l, m, _i, _len;\n            const lines = header.split(/\\r?\\n/);\n            for (_i = 0, _len = lines.length; _i < _len; _i++) {\n\n                l = lines[_i];\n                if (l.match(/NRRD\\d+/)) {\n\n                    headerObject.isNrrd = true;\n\n                } else if (!l.match(/^#/) && (m = l.match(/(.*):(.*)/))) {\n\n                    field = m[1].trim();\n                    data = m[2].trim();\n                    fn = _fieldFunctions[field];\n                    if (fn) {\n\n                        fn.call(headerObject, data);\n\n                    } else {\n\n                        headerObject[field] = data;\n\n                    }\n\n                }\n\n            }\n\n            if (!headerObject.isNrrd) {\n\n                throw new Error('Not an NRRD file');\n\n            }\n\n            if (headerObject.encoding === 'bz2' || headerObject.encoding === 'bzip2') {\n\n                throw new Error('Bzip is not supported');\n\n            }\n\n            if (!headerObject.vectors) {\n\n                //if no space direction is set, let's use the identity\n                headerObject.vectors = [];\n                headerObject.vectors.push([1, 0, 0]);\n                headerObject.vectors.push([0, 1, 0]);\n                headerObject.vectors.push([0, 0, 1]);\n\n                //apply spacing if defined\n                if (headerObject.spacings) {\n\n                    for (i = 0; i <= 2; i++) {\n\n                        if (!isNaN(headerObject.spacings[i])) {\n\n                            for (let j = 0; j <= 2; j++) {\n\n                                headerObject.vectors[i][j] *= headerObject.spacings[i];\n\n                            }\n\n                        }\n\n                    }\n\n                }\n\n            }\n\n        }\n\n        //parse the data when registred as one of this type : 'text', 'ascii', 'txt'\n        function parseDataAsText(data, start, end) {\n\n            let number = '';\n            start = start || 0;\n            end = end || data.length;\n            let value;\n            //length of the result is the product of the sizes\n            const lengthOfTheResult = headerObject.sizes.reduce(function (previous, current) {\n\n                return previous * current;\n\n            }, 1);\n\n            let base = 10;\n            if (headerObject.encoding === 'hex') {\n\n                base = 16;\n\n            }\n\n            const result = new headerObject.__array(lengthOfTheResult);\n            let resultIndex = 0;\n            let parsingFunction = parseInt;\n            if (headerObject.__array === Float32Array || headerObject.__array === Float64Array) {\n\n                parsingFunction = parseFloat;\n\n            }\n\n            for (let i = start; i < end; i++) {\n\n                value = data[i];\n                //if value is not a space\n                if ((value < 9 || value > 13) && value !== 32) {\n\n                    number += String.fromCharCode(value);\n\n                } else {\n\n                    if (number !== '') {\n\n                        result[resultIndex] = parsingFunction(number, base);\n                        resultIndex++;\n\n                    }\n\n                    number = '';\n\n                }\n\n            }\n\n            if (number !== '') {\n\n                result[resultIndex] = parsingFunction(number, base);\n                resultIndex++;\n\n            }\n\n            return result;\n\n        }\n\n        const _bytes = scan('uchar', data.byteLength);\n        const _length = _bytes.length;\n        let _header = null;\n        let _data_start = 0;\n        let i;\n        for (i = 1; i < _length; i++) {\n\n            if (_bytes[i - 1] === 10 && _bytes[i] === 10) {\n\n                // we found two line breaks in a row\n                // now we know what the header is\n                _header = this.parseChars(_bytes, 0, i - 2);\n                // this is were the data starts\n                _data_start = i + 1;\n                break;\n\n            }\n\n        }\n\n        // parse the header\n        parseHeader(_header);\n\n        _data = _bytes.subarray(_data_start); // the data without header\n        if (headerObject.encoding.substring(0, 2) === 'gz') {\n\n            // we need to decompress the datastream\n            // here we start the unzipping and get a typed Uint8Array back\n            _data = fflate.gunzipSync(new Uint8Array(_data));// eslint-disable-line no-undef\n\n        } else if (headerObject.encoding === 'ascii' || headerObject.encoding === 'text' || headerObject.encoding === 'txt' || headerObject.encoding === 'hex') {\n\n            _data = parseDataAsText(_data);\n\n        } else if (headerObject.encoding === 'raw') {\n\n            //we need to copy the array to create a new array buffer, else we retrieve the original arraybuffer with the header\n            const _copy = new Uint8Array(_data.length);\n\n            for (let i = 0; i < _data.length; i++) {\n\n                _copy[i] = _data[i];\n\n            }\n\n            _data = _copy;\n\n        }\n\n        // .. let's use the underlying array buffer\n        _data = _data.buffer;\n\n        const volume = new Volume();\n        volume.header = headerObject;\n        //\n        // parse the (unzipped) data to a datastream of the correct type\n        //\n        volume.data = new headerObject.__array(_data);\n        // get the min and max intensities\n        const min_max = volume.computeMinMax();\n        const min = min_max[0];\n        const max = min_max[1];\n        // attach the scalar range to the volume\n        volume.windowLow = min;\n        volume.windowHigh = max;\n\n        // get the image dimensions\n        volume.dimensions = [headerObject.sizes[0], headerObject.sizes[1], headerObject.sizes[2]];\n        volume.xLength = volume.dimensions[0];\n        volume.yLength = volume.dimensions[1];\n        volume.zLength = volume.dimensions[2];\n\n        // Identify axis order in the space-directions matrix from the header if possible.\n        if (headerObject.vectors) {\n\n            const xIndex = headerObject.vectors.findIndex(vector => vector[0] !== 0);\n            const yIndex = headerObject.vectors.findIndex(vector => vector[1] !== 0);\n            const zIndex = headerObject.vectors.findIndex(vector => vector[2] !== 0);\n\n            const axisOrder = [];\n            axisOrder[xIndex] = 'x';\n            axisOrder[yIndex] = 'y';\n            axisOrder[zIndex] = 'z';\n            volume.axisOrder = axisOrder;\n\n        } else {\n\n            volume.axisOrder = ['x', 'y', 'z'];\n\n        }\n\n        // spacing\n        const spacingX = new Vector3().fromArray(headerObject.vectors[0]).length();\n        const spacingY = new Vector3().fromArray(headerObject.vectors[1]).length();\n        const spacingZ = new Vector3().fromArray(headerObject.vectors[2]).length();\n        volume.spacing = [spacingX, spacingY, spacingZ];\n\n\n        // Create IJKtoRAS matrix\n        volume.matrix = new Matrix4();\n\n        const transitionMatrix = new Matrix4();\n\n        if (headerObject.space === 'left-posterior-superior') {\n\n            transitionMatrix.set(\n                -1, 0, 0, 0,\n                0, -1, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1\n            );\n\n        } else if (headerObject.space === 'left-anterior-superior') {\n\n            transitionMatrix.set(\n                1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, -1, 0,\n                0, 0, 0, 1\n            );\n\n        }\n\n\n        if (!headerObject.vectors) {\n\n            volume.matrix.set(\n                1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1);\n\n        } else {\n\n            const v = headerObject.vectors;\n\n            const ijk_to_transition = new Matrix4().set(\n                v[0][0], v[1][0], v[2][0], 0,\n                v[0][1], v[1][1], v[2][1], 0,\n                v[0][2], v[1][2], v[2][2], 0,\n                0, 0, 0, 1\n            );\n\n            volume.matrix = new Matrix4().multiplyMatrices(ijk_to_transition, transitionMatrix);\n\n        }\n\n        volume.inverseMatrix = new Matrix4();\n        volume.inverseMatrix.copy(volume.matrix).invert();\n        volume.RASDimensions = new Vector3(volume.xLength, volume.yLength, volume.zLength).applyMatrix4(volume.matrix).round().toArray().map(Math.abs);\n\n        // .. and set the default threshold\n        // only if the threshold was not already set\n        if (volume.lowerThreshold === -Infinity) {\n\n            volume.lowerThreshold = min;\n\n        }\n\n        if (volume.upperThreshold === Infinity) {\n\n            volume.upperThreshold = max;\n\n        }\n\n        return volume;\n\n    }\n\n    parseChars(array, start, end) {\n\n        // without borders, use the whole array\n        if (start === undefined) {\n\n            start = 0;\n\n        }\n\n        if (end === undefined) {\n\n            end = array.length;\n\n        }\n\n        let output = '';\n        // create and append the chars\n        let i;\n        for (i = start; i < end; ++i) {\n\n            output += String.fromCharCode(array[i]);\n\n        }\n\n        return output;\n\n    }\n\n}\n\nconst _fieldFunctions = {\n\n    type: function (data) {\n\n        switch (data) {\n\n            case 'uchar':\n            case 'unsigned char':\n            case 'uint8':\n            case 'uint8_t':\n                this.__array = Uint8Array;\n                break;\n            case 'signed char':\n            case 'int8':\n            case 'int8_t':\n                this.__array = Int8Array;\n                break;\n            case 'short':\n            case 'short int':\n            case 'signed short':\n            case 'signed short int':\n            case 'int16':\n            case 'int16_t':\n                this.__array = Int16Array;\n                break;\n            case 'ushort':\n            case 'unsigned short':\n            case 'unsigned short int':\n            case 'uint16':\n            case 'uint16_t':\n                this.__array = Uint16Array;\n                break;\n            case 'int':\n            case 'signed int':\n            case 'int32':\n            case 'int32_t':\n                this.__array = Int32Array;\n                break;\n            case 'uint':\n            case 'unsigned int':\n            case 'uint32':\n            case 'uint32_t':\n                this.__array = Uint32Array;\n                break;\n            case 'float':\n                this.__array = Float32Array;\n                break;\n            case 'double':\n                this.__array = Float64Array;\n                break;\n            default:\n                throw new Error('Unsupported NRRD data type: ' + data);\n\n        }\n\n        return this.type = data;\n\n    },\n\n    endian: function (data) {\n\n        return this.endian = data;\n\n    },\n\n    encoding: function (data) {\n\n        return this.encoding = data;\n\n    },\n\n    dimension: function (data) {\n\n        return this.dim = parseInt(data, 10);\n\n    },\n\n    sizes: function (data) {\n\n        let i;\n        return this.sizes = (function () {\n\n            const _ref = data.split(/\\s+/);\n            const _results = [];\n\n            for (let _i = 0, _len = _ref.length; _i < _len; _i++) {\n\n                i = _ref[_i];\n                _results.push(parseInt(i, 10));\n\n            }\n\n            return _results;\n\n        })();\n\n    },\n\n    space: function (data) {\n\n        return this.space = data;\n\n    },\n\n    'space origin': function (data) {\n\n        return this.space_origin = data.split('(')[1].split(')')[0].split(',');\n\n    },\n\n    'space directions': function (data) {\n\n        let f, v;\n        const parts = data.match(/\\(.*?\\)/g);\n        return this.vectors = (function () {\n\n            const _results = [];\n\n            for (let _i = 0, _len = parts.length; _i < _len; _i++) {\n\n                v = parts[_i];\n                _results.push((function () {\n\n                    const _ref = v.slice(1, -1).split(/,/);\n                    const _results2 = [];\n\n                    for (let _j = 0, _len2 = _ref.length; _j < _len2; _j++) {\n\n                        f = _ref[_j];\n                        _results2.push(parseFloat(f));\n\n                    }\n\n                    return _results2;\n\n                })());\n\n            }\n\n            return _results;\n\n        })();\n\n    },\n\n    spacings: function (data) {\n\n        let f;\n        const parts = data.split(/\\s+/);\n        return this.spacings = (function () {\n\n            const _results = [];\n\n            for (let _i = 0, _len = parts.length; _i < _len; _i++) {\n\n                f = parts[_i];\n                _results.push(parseFloat(f));\n\n            }\n\n            return _results;\n\n        })();\n\n    }\n\n};\n\nexport { NRRDLoader };\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport Button from '@mui/material/Button';\nimport Typography from '@mui/material/Typography';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport { BBox, Position } from 'geojson';\n\n// import i18n from '../i18n';\nimport { Dataset } from '../model/dataset';\nimport { PlaceInfo } from '../model/place';\nimport { Variable } from '../model/variable';\nimport { WithLocale } from '../util/lang';\nimport { VolumeRenderMode, VolumeState, VolumeStates } from '../states/controlState';\nimport { VolumeOptions, VolumeScene } from '../volume/VolumeScene';\nimport { Volume } from '../volume/Volume';\nimport { NRRDLoader } from '../volume/NRRDLoader';\nimport { ColorBar } from '../model/colorBar';\n\nimport \"./VolumeCanvas.css\"\n\n\ninterface VolumeCanvasProps extends WithLocale {\n    selectedDataset: Dataset | null;\n    selectedVariable: Variable | null;\n    selectedPlaceInfo: PlaceInfo | null;\n    variableColorBar: ColorBar;\n    volumeId: string | null;\n    volumeRenderMode: VolumeRenderMode;\n    volumeIsoThreshold: number;\n    volumeStates: VolumeStates;\n    updateVolumeState: (volumeId: string, volumeState: VolumeState) => any;\n    serverUrl: string;\n}\n\nconst CANVAS_STYLE: React.CSSProperties = {\n    width: '100%',\n    height: '680px'\n};\n\nconst MESSAGE_STYLE: React.CSSProperties = {\n    width: '100%',\n    display: 'flex',\n    justifyContent: 'center',\n    margin: '1em',\n    flexDirection: 'column',\n    alignItems: 'center'\n};\n\nconst HINT_STYLE: React.CSSProperties = {\n    color: \"orange\",\n    position: \"absolute\",\n    bottom: 8,\n    right: 8,\n    zIndex: 10\n};\n\n/*TODO: I18N*/\nconst HINT_ELEMENT = (\n        <Typography variant=\"body2\" style={HINT_STYLE} className=\"hint_wrap\">\n            Press LMB to rotate, plus CTRL-key to shift.\n        </Typography>\n);\n\nconst DIV_STYLE: React.CSSProperties = {position: \"relative\"};\n\nconst volumeCache: { [volumeId: string]: Volume } = {};\n\n\nexport class VolumeCanvas extends React.PureComponent<VolumeCanvasProps> {\n    // static volumeCache: { [volumeId: string]: Volume } = {};\n    private volumeScene: VolumeScene | null;\n    private readonly canvasRef: React.RefObject<HTMLCanvasElement>;\n\n    constructor(props: VolumeCanvasProps) {\n        super(props);\n        this.canvasRef = React.createRef<HTMLCanvasElement>();\n        this.volumeScene = null;\n        this.handleLoadVolume = this.handleLoadVolume.bind(this);\n    }\n\n    private static getVolumeOptions(props: Readonly<VolumeCanvasProps>): VolumeOptions {\n        const {selectedVariable, variableColorBar, volumeIsoThreshold, volumeRenderMode} = props;\n        return {\n            value1: !!selectedVariable ? selectedVariable.colorBarMin : 0,\n            value2: !!selectedVariable ? selectedVariable.colorBarMax : 1,\n            renderMode: volumeRenderMode,\n            isoThreshold: volumeIsoThreshold,\n            colorBar: variableColorBar,\n        };\n    }\n\n    componentDidMount(): void {\n        this.updateVolumeScene();\n    }\n\n    componentDidUpdate(prevProps: Readonly<VolumeCanvasProps>): void {\n        this.updateVolumeScene();\n    }\n\n    componentWillUnmount(): void {\n        this.volumeScene = null;\n    }\n\n    handleLoadVolume() {\n        const volumeScene = this.volumeScene;\n        if (volumeScene !== null) {\n            const {selectedDataset, selectedVariable, selectedPlaceInfo, volumeId, updateVolumeState} = this.props;\n            if (selectedDataset && selectedVariable && volumeId) {\n                updateVolumeState(volumeId, {status: 'loading'});\n                let bboxArg = '';\n                if (selectedPlaceInfo) {\n                    let bBox: BBox | null = null;\n                    if (selectedPlaceInfo.place.geometry.type === 'Polygon') {\n                        bBox = getBBoxFromPolygon(selectedPlaceInfo.place.geometry.coordinates[0]);\n                    } else if (selectedPlaceInfo.place.geometry.type === 'MultiPolygon') {\n                        const bBoxes: BBox[] = [];\n                        for (let i = 0; i < selectedPlaceInfo.place.geometry.coordinates.length; i++) {\n                            bBoxes.push(getBBoxFromPolygon(selectedPlaceInfo.place.geometry.coordinates[i][0]));\n                        }\n                        bBox = getBBoxFromBBoxes(bBoxes);\n                    }\n                    if (bBox !== null) {\n                        bboxArg = `&bbox=${bBox[0]},${bBox[1]},${bBox[2]},${bBox[3]}`;\n                    }\n                }\n                const noCacheArg = `dummy=${new Date().toLocaleTimeString()}`;\n                const url = `${this.props.serverUrl}/volumes/`\n                            + `${selectedDataset.id}/${selectedVariable.name}`\n                            + `?${noCacheArg}${bboxArg}`;\n                new NRRDLoader().load(\n                        url,\n                        (volume: Volume) => {\n                            volumeScene.setVolume(volume, VolumeCanvas.getVolumeOptions(this.props));\n                            volumeCache[volumeId] = volume;\n                            updateVolumeState(volumeId, {status: 'ok'});\n                        },\n                        () => {\n                        },\n                        (e: any) => {\n                            if (e.response instanceof Response) {\n                                e.response.json().then((responseObject: {[k: string]: any}) => {\n                                    const errorObject = responseObject.error;\n                                    const message = !!errorObject && errorObject.message;\n                                    if (errorObject && errorObject.exception) {\n                                        console.debug(\"exception:\", errorObject.exception);\n                                    }\n                                    updateVolumeState(volumeId, {\n                                        status: 'error',\n                                        message: message || `${e}`\n                                    });\n                                });\n                            } else {\n                                updateVolumeState(volumeId, {\n                                    status: 'error',\n                                    message: `${e}`\n                                });\n                            }\n                        }\n                );\n            }\n        }\n    }\n\n    render(): React.ReactNode {\n        // console.debug('VolumeCanvas.render-1:', this.canvasRef.current);\n        const {volumeId} = this.props;\n\n        let messageComp;\n        let loadComp;\n        if (!volumeId) {\n            /*TODO: I18N*/\n            messageComp = [\n                <Typography variant={'subtitle2'}>\n                    {'Cannot display 3D volume'}\n                </Typography>,\n                <Typography variant=\"body2\">\n                    {'To display a volume, a variable and a place that represents an area must be selected. ' +\n                     'Please note that the 3D volume rendering is still an experimental feature.'}\n                </Typography>\n            ];\n        } else {\n            const volumeState = this.props.volumeStates[volumeId];\n            console.log('volumeState:', volumeState, volumeCache)\n\n            if (!volumeState || volumeState.status === 'error' || !volumeCache[volumeId]) {\n                /*TODO: I18N*/\n                loadComp = [\n                    <Button\n                            onClick={this.handleLoadVolume}\n                            color=\"primary\"\n                            disabled={!!volumeState && volumeState.status === 'loading'}\n                    >\n                        {'Load Volume Data'}\n                    </Button>,\n                    <Typography variant=\"body2\">\n                        {'Please note that the 3D volume rendering is still an experimental feature.'}\n                    </Typography>\n                ];\n            }\n\n            if (volumeState) {\n                if (volumeState.status === 'loading') {\n                    messageComp = (<CircularProgress style={{margin: 10}}/>);\n                } else if (volumeState.status === 'error') {\n                    /*TODO: I18N*/\n                    messageComp = (\n                            <Typography variant=\"body2\" color=\"red\">\n                                {`Failed loading volume: ${volumeState.message}`}\n                            </Typography>\n                    );\n                }\n            }\n        }\n\n        if (messageComp) {\n            messageComp = (<div style={MESSAGE_STYLE}>{messageComp}</div>);\n        }\n        if (loadComp) {\n            loadComp = (<div style={MESSAGE_STYLE}>{loadComp}</div>);\n        }\n\n        // Note, it is important to always have the canvas element\n        // rendered here, so it is not remounted.\n        return (\n                <div style={DIV_STYLE}>\n                    {loadComp}\n                    {messageComp}\n                    <canvas\n                            id={'VolumeCanvas-canvas'}\n                            ref={this.canvasRef}\n                            style={CANVAS_STYLE}\n                    />\n                    {!messageComp && !loadComp && HINT_ELEMENT}\n                </div>\n        );\n    }\n\n    private updateVolumeScene() {\n        const canvas = this.canvasRef.current;\n        if (canvas === null) {\n            this.volumeScene = null;\n            return;\n        }\n        let volume;\n        if (this.props.volumeId) {\n            volume = volumeCache[this.props.volumeId];\n        }\n        let isNewScene = false;\n        if (this.volumeScene === null || this.volumeScene.canvas !== canvas) {\n            this.volumeScene = new VolumeScene(canvas);\n            isNewScene = true;\n        }\n        if (isNewScene && !!volume) {\n            this.volumeScene.setVolume(volume, VolumeCanvas.getVolumeOptions(this.props));\n        } else {\n            this.volumeScene.setVolumeOptions(VolumeCanvas.getVolumeOptions(this.props));\n        }\n    }\n}\n\nexport default VolumeCanvas;\n\n///////////////////////////////////////////////////////////////////////\n// BBox helpers\n// Move into model/places.ts or so\n\nfunction getBBoxFromPolygon(coordinates: Position[]): BBox {\n    let xMin: number = Number.POSITIVE_INFINITY;\n    let yMin: number = Number.POSITIVE_INFINITY;\n    let xMax: number = Number.NEGATIVE_INFINITY;\n    let yMax: number = Number.NEGATIVE_INFINITY;\n    for (const pos of coordinates) {\n        const x = pos[0];\n        const y = pos[1];\n        xMin = Math.min(xMin, x);\n        yMin = Math.min(yMin, y);\n        xMax = Math.max(xMax, x);\n        yMax = Math.max(yMax, y);\n    }\n    return [xMin, yMin, xMax, yMax];\n}\n\nfunction getBBoxFromBBoxes(bBoxes: BBox[]): BBox {\n    let [xMin, yMin, xMax, yMax] = bBoxes[0];\n    for (const bBox of bBoxes.slice(1)) {\n        xMin = Math.min(xMin, bBox[0]);\n        yMin = Math.min(yMin, bBox[1]);\n        xMax = Math.max(xMax, bBox[2]);\n        yMax = Math.max(yMax, bBox[3]);\n    }\n    return [xMin, yMin, xMax, yMax];\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React, { SyntheticEvent } from 'react';\nimport { Theme } from '@mui/material/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport makeStyles from '@mui/styles/makeStyles';\nimport Card from '@mui/material/Card';\nimport CardActions from '@mui/material/CardActions';\nimport CardContent from '@mui/material/CardContent';\nimport IconButton from '@mui/material/IconButton';\nimport Tooltip from '@mui/material/Tooltip';\nimport CloseIcon from '@mui/icons-material/Close';\nimport VolumeIcon from '@mui/icons-material/ThreeDRotation';\nimport ToggleButton from '@mui/material/ToggleButton';\nimport ToggleButtonGroup from '@mui/material/ToggleButtonGroup';\n\nimport { Dataset } from '../model/dataset';\nimport { PlaceInfo } from '../model/place';\nimport { Variable } from '../model/variable';\nimport { WithLocale } from '../util/lang';\nimport { VolumeRenderMode, VolumeState, VolumeStates } from '../states/controlState';\nimport VolumeCanvas from './VolumeCanvas';\nimport TextField from '@mui/material/TextField';\nimport Slider from '@mui/material/Slider';\nimport { ColorBar } from '../model/colorBar';\n// import i18n from '../i18n';\n\n\nconst useStyles = makeStyles((theme: Theme) => createStyles(\n        {\n            card: {\n                maxWidth: '100%',\n                marginBottom: theme.spacing(1),\n                marginRight: theme.spacing(1),\n            },\n            info: {\n                marginRight: theme.spacing(1),\n            },\n            close: {\n                marginLeft: 'auto',\n            },\n            cardContent: {\n                padding: 8,\n            },\n            isoEditor: {\n                display: 'flex',\n                flexDirection: 'row'\n            },\n            isoTextField: {\n                minWidth: '16em',\n                marginLeft: '1em'\n            },\n            isoSlider: {\n                minWidth: 200,\n            },\n        }\n));\n\n\ninterface VolumeCardProps extends WithLocale {\n    volumeCardOpen: boolean;\n    showVolumeCard: (infoCardOpen: boolean) => void;\n    selectedDataset: Dataset | null;\n    selectedVariable: Variable | null;\n    selectedPlaceInfo: PlaceInfo | null;\n    variableColorBar: ColorBar;\n    volumeId: string | null;\n    volumeRenderMode: VolumeRenderMode;\n    setVolumeRenderMode: (volumeRenderMode: VolumeRenderMode) => any;\n    volumeStates: VolumeStates;\n    updateVolumeState: (volumeId: string, volumeState: VolumeState) => any;\n    updateVariableVolume: (\n            datasetId: string,\n            variableName: string,\n            variableColorBar: ColorBar,\n            volumeRenderMode: VolumeRenderMode,\n            volumeIsoThreshold: number,\n    ) => any;\n    serverUrl: string;\n}\n\nconst VolumeCard: React.FC<VolumeCardProps> = ({\n                                                   volumeCardOpen,\n                                                   showVolumeCard,\n                                                   selectedDataset,\n                                                   selectedVariable,\n                                                   selectedPlaceInfo,\n                                                   variableColorBar,\n                                                   volumeId,\n                                                   volumeRenderMode,\n                                                   setVolumeRenderMode,\n                                                   volumeStates,\n                                                   updateVolumeState,\n                                                   updateVariableVolume,\n                                                   serverUrl\n                                               }) => {\n\n    const classes = useStyles();\n\n    if (!volumeCardOpen) {\n        return null;\n    }\n\n    let volumeIsoThreshold = 0.5;\n    if (selectedVariable) {\n        // Move in to selector\n        if (typeof selectedVariable.volumeIsoThreshold === 'number') {\n            volumeIsoThreshold = selectedVariable.volumeIsoThreshold;\n        } else {\n            volumeIsoThreshold = 0.5 * (selectedVariable.colorBarMin + selectedVariable.colorBarMax);\n        }\n        if (typeof selectedVariable.volumeRenderMode === 'string') {\n            volumeRenderMode = selectedVariable.volumeRenderMode;\n        }\n    }\n\n    const setVolumeIsoThreshold = (volumeIsoThreshold: number) => {\n        updateVariableVolume(\n                selectedDataset!.id,\n                selectedVariable!.name,\n                variableColorBar,\n                volumeRenderMode,\n                volumeIsoThreshold,\n        );\n    }\n\n    const handleVolumeRenderModeChange = (event: React.MouseEvent<HTMLElement>,\n                                          volumeRenderMode: VolumeRenderMode) => {\n        if (volumeRenderMode !== null) {\n            setVolumeRenderMode(volumeRenderMode);\n            if (selectedVariable) {\n                updateVariableVolume(\n                        selectedDataset!.id,\n                        selectedVariable!.name,\n                        variableColorBar,\n                        volumeRenderMode,\n                        volumeIsoThreshold\n                );\n            }\n        }\n    };\n\n    const handleVolumeCardClose = () => {\n        showVolumeCard(false);\n    };\n\n    return (\n            <Card className={classes.card}>\n                <CardActions disableSpacing>\n                    <VolumeIcon fontSize={'large'} className={classes.info}/>\n                    {selectedVariable && (\n                            <>\n                                <ToggleButtonGroup\n                                        key={0}\n                                        size=\"small\"\n                                        exclusive={true}\n                                        value={volumeRenderMode}\n                                        onChange={handleVolumeRenderModeChange}\n                                >\n                                    <ToggleButton\n                                            key=\"mip\"\n                                            value=\"mip\"\n                                    >\n                                        {/*TODO: I18N*/}\n                                        <Tooltip arrow title={'Maximum intensity projection'}>\n                                            <span>MIP</span>\n                                        </Tooltip>\n                                    </ToggleButton>\n                                    <ToggleButton\n                                            key=\"aip\"\n                                            value=\"aip\"\n                                    >\n                                        {/*TODO: I18N*/}\n                                        <Tooltip arrow title={'Average intensity projection'}>\n                                            <span>AIP</span>\n                                        </Tooltip>\n                                    </ToggleButton>\n                                    <ToggleButton\n                                            key=\"iso\"\n                                            value=\"iso\"\n                                    >\n                                        {/*TODO: I18N*/}\n                                        <Tooltip arrow title={'Iso-surface extraction'}>\n                                            <span>ISO</span>\n                                        </Tooltip>\n                                    </ToggleButton>\n                                </ToggleButtonGroup>\n                                {volumeRenderMode === 'iso' && (\n                                        <IsoThresholdEditor\n                                                minValue={selectedVariable.colorBarMin}\n                                                maxValue={selectedVariable.colorBarMax}\n                                                value={volumeIsoThreshold}\n                                                setValue={setVolumeIsoThreshold}\n                                        />\n                                )}\n                            </>\n                    )}\n                    <IconButton key={1} onClick={handleVolumeCardClose} className={classes.close}>\n                        {<CloseIcon/>}\n                    </IconButton>\n                </CardActions>\n                <CardContent className={classes.cardContent}>\n                    <VolumeCanvas\n                            selectedDataset={selectedDataset}\n                            selectedVariable={selectedVariable}\n                            selectedPlaceInfo={selectedPlaceInfo}\n                            variableColorBar={variableColorBar}\n                            volumeRenderMode={volumeRenderMode}\n                            volumeIsoThreshold={volumeIsoThreshold}\n                            volumeId={volumeId}\n                            volumeStates={volumeStates}\n                            updateVolumeState={updateVolumeState}\n                            serverUrl={serverUrl}\n                    />\n                </CardContent>\n            </Card>\n    );\n};\n\nexport default VolumeCard;\n\n\n/////////////////////////////////////////////////////////\n\ninterface IsoThresholdEditorProps {\n    value: number;\n    minValue: number;\n    maxValue: number;\n    setValue: (value: number) => any;\n    disabled?: boolean;\n}\n\nconst IsoThresholdEditor: React.FC<IsoThresholdEditorProps> = (\n        {\n            value,\n            minValue,\n            maxValue,\n            setValue,\n            disabled\n        }\n) => {\n    const classes = useStyles();\n    const [sliderValue, setSliderValue] = React.useState<number>(value);\n    const [textValue, setTextValue] = React.useState<string>('' + value);\n    const [error, setError] = React.useState<string | null>(null);\n\n    function handleTextValueChange(evt: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) {\n        const textValue = evt.target.value || '';\n        setTextValue(textValue);\n\n        const value = parseFloat(textValue);\n        if (Number.isNaN(value)) {\n            setError('Not a number')\n        } else if (value < minValue || value > maxValue) {\n            setError('Out of range');\n        } else {\n            setError(null);\n        }\n    }\n\n    function handleTextFieldKeyPress(evt: React.KeyboardEvent<HTMLDivElement>) {\n        console.log('key', evt.key)\n        if (evt.key === 'Enter' && !error) {\n            const value = parseFloat(textValue);\n            setSliderValue(value);\n            setValue(value);\n        }\n    }\n\n    function handleSliderValueChanged(evt: Event, value: number | number[]) {\n        setSliderValue(value as number);\n        setTextValue((value as number).toFixed(2));\n    }\n\n    function handleSliderValueCommitted(evt: Event | SyntheticEvent, value: number | number[]) {\n        setValue(value as number);\n    }\n\n    return (\n            <TextField\n                    className={classes.isoTextField}\n                    disabled={disabled}\n                    label=\"Iso-Threshold\"\n                    variant=\"filled\"\n                    size=\"small\"\n                    value={textValue}\n                    error={error !== null}\n                    onChange={handleTextValueChange}\n                    onKeyPress={handleTextFieldKeyPress}\n                    InputProps={{\n                        endAdornment: (\n                                <Slider\n                                        size={'small'}\n                                        className={classes.isoSlider}\n                                        min={minValue}\n                                        max={maxValue}\n                                        value={sliderValue}\n                                        step={(maxValue - minValue) / 20}\n                                        onChange={handleSliderValueChanged}\n                                        onChangeCommitted={handleSliderValueCommitted}\n                                />\n                        )\n                    }}\n            />\n    );\n};\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\nimport {\n    selectedDatasetSelector,\n    selectedPlaceInfoSelector, selectedServerSelector,\n    selectedVariableColorBarSelector,\n    selectedVariableSelector,\n    selectedVolumeIdSelector,\n} from '../selectors/controlSelectors';\n\nimport { AppState } from '../states/appState';\nimport { setVolumeRenderMode, showVolumeCard, updateVolumeState } from '../actions/controlActions';\nimport { updateVariableVolume } from \"../actions/dataActions\";\nimport VolumeCard from '../components/VolumeCard';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        volumeCardOpen: state.controlState.volumeCardOpen,\n        selectedDataset: selectedDatasetSelector(state),\n        selectedVariable: selectedVariableSelector(state),\n        selectedPlaceInfo: selectedPlaceInfoSelector(state),\n        variableColorBar: selectedVariableColorBarSelector(state),\n        volumeRenderMode: state.controlState.volumeRenderMode,\n        volumeId: selectedVolumeIdSelector(state),\n        volumeStates: state.controlState.volumeStates,\n        serverUrl: selectedServerSelector(state).url\n    }\n};\n\nconst mapDispatchToProps = {\n    showVolumeCard,\n    setVolumeRenderMode,\n    updateVolumeState,\n    updateVariableVolume,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(VolumeCard);\n","export default __webpack_public_path__ + \"static/media/python-bw.071ec04f.png\";","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport Card from '@mui/material/Card';\nimport CardActions from '@mui/material/CardActions';\nimport CardContent from '@mui/material/CardContent';\nimport CardHeader from '@mui/material/CardHeader';\nimport CardMedia from '@mui/material/CardMedia';\nimport Collapse from '@mui/material/Collapse';\nimport IconButton from '@mui/material/IconButton';\nimport Link from '@mui/material/Link';\nimport Paper from '@mui/material/Paper';\nimport { Theme } from '@mui/material/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport makeStyles from '@mui/styles/makeStyles';\nimport Table from '@mui/material/Table';\nimport TableBody from '@mui/material/TableBody';\nimport TableCell from '@mui/material/TableCell';\nimport TableContainer from '@mui/material/TableContainer';\nimport TableRow from '@mui/material/TableRow';\nimport Tooltip from '@mui/material/Tooltip';\nimport Typography from '@mui/material/Typography';\nimport CloseIcon from '@mui/icons-material/Close';\nimport JsonIcon from '@mui/icons-material/DataObject';\nimport InfoIcon from '@mui/icons-material/Info';\nimport LayersIcon from '@mui/icons-material/Layers';\nimport ListAltIcon from '@mui/icons-material/ListAlt';\nimport PlaceIcon from '@mui/icons-material/Place';\nimport TextFieldsIcon from '@mui/icons-material/TextFields';\nimport WidgetsIcon from '@mui/icons-material/Widgets';\nimport ToggleButton from '@mui/material/ToggleButton';\nimport ToggleButtonGroup from '@mui/material/ToggleButtonGroup';\nimport CodeMirror from '@uiw/react-codemirror';\nimport { json } from '@codemirror/lang-json';\nimport { python } from '@codemirror/lang-python';\nimport i18n from '../i18n';\nimport { Dataset } from '../model/dataset';\nimport { PlaceInfo } from '../model/place';\nimport { Variable } from '../model/variable';\nimport { WithLocale } from '../util/lang';\nimport pythonLogo from '../resources/python-bw.png'\nimport { ApiServerConfig } from \"../model/apiServer\";\nimport { Config } from \"../config\";\nimport { Extension } from \"@codemirror/state\";\nimport { Time } from \"../model/timeSeries\";\nimport { utcTimeToIsoDateTimeString } from '../util/time';\n\ntype ViewMode = 'text' | 'list' | 'code' | 'python';\n\nconst useStyles = makeStyles((theme: Theme) => createStyles(\n    {\n        card: {\n            maxWidth: '100%',\n            marginBottom: theme.spacing(1),\n            marginRight: theme.spacing(1),\n        },\n        info: {\n            marginRight: theme.spacing(1),\n        },\n        close: {\n            marginLeft: 'auto',\n        },\n        table: {},\n        keyValueTableContainer: {\n            background: theme.palette.divider,\n        },\n        variableHtmlReprContainer: {\n            background: theme.palette.divider,\n            padding: theme.spacing(1),\n            marginTop: theme.spacing(1),\n            marginBottom: theme.spacing(1),\n        },\n        media: {\n            height: 200,\n        },\n        cardContent: {\n            padding: 8,\n        },\n        code: {\n            fontFamily: 'Monospace'\n        },\n    }\n));\n\n\ninterface InfoCardProps extends WithLocale {\n    infoCardOpen: boolean;\n    showInfoCard: (infoCardOpen: boolean) => void;\n    visibleInfoCardElements: string[];\n    setVisibleInfoCardElements: (visibleInfoCardElements: string[]) => void;\n    infoCardElementViewModes: { [elementType: string]: ViewMode };\n    updateInfoCardElementViewMode: (elementType: string, viewMode: ViewMode) => void;\n    selectedDataset: Dataset | null;\n    selectedVariable: Variable | null;\n    selectedPlaceInfo: PlaceInfo | null;\n    selectedTime: Time | null;\n    serverConfig: ApiServerConfig;\n    allowViewModePython: boolean;\n}\n\nconst InfoCard: React.FC<InfoCardProps> = ({\n                                               infoCardOpen,\n                                               showInfoCard,\n                                               visibleInfoCardElements,\n                                               setVisibleInfoCardElements,\n                                               infoCardElementViewModes,\n                                               updateInfoCardElementViewMode,\n                                               selectedDataset,\n                                               selectedVariable,\n                                               selectedPlaceInfo,\n                                               selectedTime,\n                                               serverConfig,\n                                               allowViewModePython\n                                           }) => {\n    const classes = useStyles();\n\n    if (!infoCardOpen) {\n        return null;\n    }\n\n    const handleInfoElementsChanges = (event: React.MouseEvent<HTMLElement>, visibleElementTypes: string[]) => {\n        setVisibleInfoCardElements(visibleElementTypes);\n    };\n\n    const handleInfoCardClose = () => {\n        showInfoCard(false);\n    };\n\n    // TODO (forman): fix ugly code duplication below!\n    let datasetInfoContent;\n    let variableInfoContent;\n    let placeInfoContent;\n    if (selectedDataset) {\n        const elementType = 'dataset';\n        const viewMode = infoCardElementViewModes[elementType];\n        const setViewMode = (viewMode: ViewMode) => updateInfoCardElementViewMode(elementType, viewMode);\n        const isVisible = visibleInfoCardElements.includes(elementType);\n        datasetInfoContent = (\n            <DatasetInfoContent\n                isIn={isVisible}\n                viewMode={viewMode}\n                setViewMode={setViewMode}\n                dataset={selectedDataset}\n                serverConfig={serverConfig}\n                hasPython={allowViewModePython}\n            />\n        );\n    }\n    if (selectedDataset && selectedVariable) {\n        const elementType = 'variable';\n        const viewMode = infoCardElementViewModes[elementType];\n        const setViewMode = (viewMode: ViewMode) => updateInfoCardElementViewMode(elementType, viewMode);\n        const isVisible = visibleInfoCardElements.includes(elementType);\n        variableInfoContent = (\n            <VariableInfoContent\n                isIn={isVisible}\n                viewMode={viewMode}\n                setViewMode={setViewMode}\n                variable={selectedVariable}\n                time={selectedTime}\n                serverConfig={serverConfig}\n                hasPython={allowViewModePython}\n            />\n        );\n    }\n    if (selectedPlaceInfo) {\n        const elementType = 'place';\n        const viewMode = infoCardElementViewModes[elementType];\n        const setViewMode = (viewMode: ViewMode) => updateInfoCardElementViewMode(elementType, viewMode);\n        const isVisible = visibleInfoCardElements.includes(elementType);\n        placeInfoContent = (\n            <PlaceInfoContent\n                isIn={isVisible}\n                viewMode={viewMode}\n                setViewMode={setViewMode}\n                placeInfo={selectedPlaceInfo}\n            />\n        );\n    }\n\n    return (\n        <Card className={classes.card}>\n            <CardActions disableSpacing>\n                <InfoIcon fontSize={'large'} className={classes.info}/>\n                <ToggleButtonGroup key={0} size=\"small\" value={visibleInfoCardElements}\n                                   onChange={handleInfoElementsChanges}>\n                    <ToggleButton key={0} value=\"dataset\" disabled={selectedDataset === null}>\n                        <Tooltip arrow title={i18n.get('Dataset information')}>\n                            <WidgetsIcon/>\n                        </Tooltip>\n                    </ToggleButton>\n                    <ToggleButton key={1} value=\"variable\" disabled={selectedVariable === null}>\n                        <Tooltip arrow title={i18n.get('Variable information')}>\n                            <LayersIcon/>\n                        </Tooltip>\n                    </ToggleButton>\n                    <ToggleButton key={2} value=\"place\" disabled={selectedPlaceInfo === null}>\n                        <Tooltip arrow title={i18n.get('Place information')}>\n                            <PlaceIcon/>\n                        </Tooltip>\n                    </ToggleButton>\n                </ToggleButtonGroup>\n                <IconButton\n                    key={1}\n                    onClick={handleInfoCardClose}\n                    className={classes.close}\n                    size=\"large\">\n                    {<CloseIcon/>}\n                </IconButton>\n            </CardActions>\n            {datasetInfoContent}\n            {variableInfoContent}\n            {placeInfoContent}\n        </Card>\n    );\n};\n\nexport default InfoCard;\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ninterface DatasetInfoContentProps {\n    isIn: boolean;\n    viewMode: ViewMode;\n    setViewMode: (viewMode: ViewMode) => void;\n    dataset: Dataset;\n    serverConfig: ApiServerConfig;\n    hasPython: boolean;\n}\n\nconst DatasetInfoContent: React.FC<DatasetInfoContentProps> = (\n    {\n        isIn,\n        viewMode,\n        setViewMode,\n        dataset,\n        serverConfig,\n        hasPython\n    }\n) => {\n    // const classes = useStyles();\n    let content;\n    if (viewMode === 'code') {\n        const jsonDimensions = selectObj(dataset.dimensions, ['name', 'size', 'dtype']);\n        const jsonDataset = selectObj(dataset, ['id', 'title', 'bbox', 'attrs']);\n        jsonDataset['dimensions'] = jsonDimensions;\n        content = (\n            <JsonCodeContent code={JSON.stringify(jsonDataset, null, 2)}/>\n        );\n    } else if (viewMode === 'list') {\n        content = (\n            <CardContent2>\n                <KeyValueTable\n                    data={Object.getOwnPropertyNames(dataset.attrs || {}).map(name => [name, dataset.attrs[name]])}\n                />\n            </CardContent2>\n        );\n    } else if (viewMode === 'text') {\n        const data: KeyValue[] = [\n            [i18n.get('Dimension names'), dataset.dimensions.map(d => d.name).join(', ')],\n            [i18n.get('Dimension data types'), dataset.dimensions.map(d => d.dtype).join(', ')],\n            [i18n.get('Dimension lengths'), dataset.dimensions.map(d => d.size).join(', ')],\n            [i18n.get('Geographical extent') + ' (x1, y1, x2, y2)', dataset.bbox.map(x => x + '').join(', ')],\n            [i18n.get('Spatial reference system'), dataset.spatialRef],\n        ];\n        content = (\n            <CardContent2>\n                <KeyValueTable data={data}/>\n            </CardContent2>\n        );\n    } else if (viewMode === 'python') {\n        content = (\n            <PythonCodeContent code={getDatasetPythonCode(serverConfig, dataset)}/>\n        );\n    }\n    return (\n        <InfoCardContent\n            title={dataset.title || '?'}\n            subheader={dataset.title && `ID: ${dataset.id}`}\n            isIn={isIn}\n            viewMode={viewMode}\n            setViewMode={setViewMode}\n            hasPython={hasPython}\n        >\n            {content}\n        </InfoCardContent>\n    );\n};\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ninterface VariableInfoContentProps {\n    isIn: boolean;\n    viewMode: ViewMode;\n    setViewMode: (viewMode: ViewMode) => void;\n    variable: Variable;\n    time: Time | null,\n    serverConfig: ApiServerConfig;\n    hasPython: boolean;\n}\n\nconst VariableInfoContent: React.FC<VariableInfoContentProps> = (\n    {\n        isIn,\n        viewMode,\n        setViewMode,\n        variable,\n        time,\n        serverConfig,\n        hasPython\n    }\n) => {\n    const classes = useStyles();\n    let content;\n    let htmlReprPaper;\n    if (viewMode === 'code') {\n        const jsonVariable = selectObj(variable, [\n            'id', 'name', 'title', 'units', 'shape', 'dtype', 'shape',\n            'timeChunkSize',\n            'colorBarMin',\n            'colorBarMax',\n            'colorBarName',\n            'attrs'\n        ]);\n        content = (\n            <JsonCodeContent code={JSON.stringify(jsonVariable, null, 2)}/>\n        );\n    } else if (viewMode === 'list') {\n        content = (\n            <CardContent2>\n                <KeyValueTable\n                    data={Object.getOwnPropertyNames(variable.attrs || {}).map(name => [name, variable.attrs[name]])}\n                />\n            </CardContent2>\n        );\n        if (variable.htmlRepr) {\n            const handleRef = (element: HTMLDivElement | null) => {\n                if (element && variable.htmlRepr) {\n                    element.innerHTML = variable.htmlRepr;\n                }\n            };\n            htmlReprPaper = (\n                <CardContent2>\n                    <Paper ref={handleRef} className={classes.variableHtmlReprContainer}/>\n                </CardContent2>\n            );\n        }\n    } else if (viewMode === 'text') {\n        const data: KeyValue[] = [\n            [i18n.get('Title'), variable.title],\n            [i18n.get('Name'), variable.name],\n            [i18n.get('Units'), variable.units],\n            [i18n.get('Data type'), variable.dtype],\n            [i18n.get('Dimension names'), variable.dims.join(', ')],\n            [i18n.get('Dimension lengths'), variable.shape.map(s => s + '').join(', ')],\n            [i18n.get('Time chunk size'), variable.timeChunkSize],\n        ];\n        content = (\n            <CardContent2>\n                <KeyValueTable data={data}/>\n            </CardContent2>\n        );\n    } else if (viewMode === 'python') {\n        content = (\n            <PythonCodeContent code={getVariablePythonCode(serverConfig, variable, time)}/>\n        );\n    }\n    return (\n        <InfoCardContent\n            title={variable.title || variable.name}\n            subheader={`${i18n.get('Name')}: ${variable.name}`}\n            isIn={isIn}\n            viewMode={viewMode}\n            setViewMode={setViewMode}\n            hasPython={hasPython}\n        >\n            {htmlReprPaper}\n            {content}\n        </InfoCardContent>\n    );\n};\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ninterface PlaceInfoContentProps {\n    isIn: boolean;\n    viewMode: ViewMode;\n    setViewMode: (viewMode: ViewMode) => void;\n    placeInfo: PlaceInfo;\n}\n\nconst PlaceInfoContent: React.FC<PlaceInfoContentProps> = (\n    {\n        isIn,\n        viewMode,\n        setViewMode,\n        placeInfo\n    }\n) => {\n    const classes = useStyles();\n    const place = placeInfo.place;\n    let content;\n    let image;\n    let description;\n    if (viewMode === 'code') {\n        content = (\n            <JsonCodeContent code={JSON.stringify(place, null, 2)}/>\n        );\n    } else if (viewMode === 'list') {\n        if (!!place.properties) {\n            const data: KeyValue[] = Object.getOwnPropertyNames(place.properties).map(\n                (name: any) => [name, place.properties![name]]\n            );\n            content = (\n                <CardContent2>\n                    <KeyValueTable data={data}/>\n                </CardContent2>\n            );\n        } else {\n            content = (\n                <CardContent2>\n                    <Typography>{i18n.get('There is no information available for this location.')}</Typography>\n                </CardContent2>\n            );\n        }\n    } else {\n        if (placeInfo.image && placeInfo.image.startsWith('http')) {\n            image = (\n                <CardMedia className={classes.media} image={placeInfo.image} title={placeInfo.label}/>\n            );\n        }\n        if (placeInfo.description) {\n            description = (\n                <CardContent2>\n                    <Typography>{placeInfo.description}</Typography>\n                </CardContent2>\n            );\n        }\n    }\n    return (\n        <InfoCardContent\n            title={placeInfo.label}\n            subheader={`${i18n.get('Geometry type')}: ${i18n.get(place.geometry.type)}`}\n            isIn={isIn}\n            viewMode={viewMode}\n            setViewMode={setViewMode}\n        >\n            {image}\n            {description}\n            {content}\n        </InfoCardContent>\n    );\n};\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ninterface InfoCardContentProps {\n    isIn: boolean;\n    title: React.ReactNode;\n    subheader?: React.ReactNode;\n    viewMode: ViewMode;\n    setViewMode: (viewMode: ViewMode) => void;\n    hasPython?: boolean;\n}\n\nconst InfoCardContent: React.FC<InfoCardContentProps> = ({\n                                                             isIn,\n                                                             title,\n                                                             subheader,\n                                                             viewMode,\n                                                             setViewMode,\n                                                             hasPython,\n                                                             children,\n                                                         }) => {\n\n    const handleViewModeChange = (event: React.MouseEvent<HTMLElement>, viewMode: ViewMode) => {\n        setViewMode(viewMode);\n    };\n\n    return (\n        <Collapse in={isIn} timeout=\"auto\" unmountOnExit>\n            <CardHeader\n                title={title}\n                subheader={subheader}\n                action={\n                    <ToggleButtonGroup\n                        key={0}\n                        size=\"small\"\n                        value={viewMode}\n                        exclusive={true}\n                        onChange={handleViewModeChange}\n                    >\n                        <ToggleButton key={0} value=\"text\">\n                            <TextFieldsIcon/>\n                        </ToggleButton>\n                        <ToggleButton key={1} value=\"list\">\n                            <ListAltIcon/>\n                        </ToggleButton>\n                        <ToggleButton key={2} value=\"code\">\n                            <JsonIcon/>\n                        </ToggleButton>\n                        {\n                            hasPython && (\n                                <ToggleButton key={3} value=\"python\">\n                                    <img src={pythonLogo} width={24} alt=\"python logo\"/>\n                                </ToggleButton>\n                            )\n                        }\n                    </ToggleButtonGroup>\n                }\n            />\n            {children}\n        </Collapse>\n    );\n};\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ntype KeyValue = [any, any];\n\ninterface KeyValueTableProps {\n    data: KeyValue[];\n}\n\nconst KeyValueTable: React.FC<KeyValueTableProps> = ({data}) => {\n    const classes = useStyles();\n    return (\n        <TableContainer component={Paper} className={classes.keyValueTableContainer}>\n            <Table className={classes.table} size=\"small\">\n                <TableBody>\n                    {\n                        data.map((kv, index) => {\n                            const [key, value] = kv;\n                            let renderedValue = value;\n                            if (typeof value === 'string'\n                                && (value.startsWith('http://')\n                                    || value.startsWith('https://'))) {\n                                renderedValue = (\n                                    <Link\n                                        href={value}\n                                        target='_blank'\n                                        rel='noreferrer'\n                                    >\n                                        {value}\n                                    </Link>);\n                            } else if (Array.isArray(value)) {\n                                renderedValue = '[' + value.map(v => v + '').join(', ') + ']';\n                            }\n                            return (\n                                <TableRow key={index}>\n                                    <TableCell>{key}</TableCell>\n                                    <TableCell align=\"right\">{renderedValue}</TableCell>\n                                </TableRow>\n                            );\n                        })\n                    }\n                </TableBody>\n            </Table>\n        </TableContainer>\n    );\n};\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst CardContent2: React.FC = ({children}) => {\n    const classes = useStyles();\n    return <CardContent className={classes.cardContent}>{children}</CardContent>\n};\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ninterface CodeContentBaseProps {\n    code: string;\n}\n\ninterface CodeContentProps extends CodeContentBaseProps {\n    extension: Extension;\n}\n\nconst CodeContent: React.FC<CodeContentProps> = ({code, extension}) => {\n    return (\n        <CardContent2>\n            <CodeMirror\n                theme={Config.instance.branding.themeName || 'light'}\n                height=\"320px\"\n                extensions={[extension]}\n                value={code}\n                readOnly={true}\n            />\n        </CardContent2>\n    );\n};\n\nconst JsonCodeContent: React.FC<CodeContentBaseProps> = ({code}) => {\n    return (\n        <CodeContent code={code} extension={json()}/>\n    );\n};\n\nconst PythonCodeContent: React.FC<CodeContentBaseProps> = ({code}) => {\n    return (\n        <CodeContent code={code} extension={python()}/>\n    );\n};\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction selectObj(obj: any, keys: string[]): any {\n    const newObj: { [name: string]: any } = {};\n    for (let key of keys) {\n        if (key in obj) {\n            newObj[key] = obj[key];\n        }\n    }\n    return newObj;\n}\n\nfunction getDatasetPythonCode(serverConfig: ApiServerConfig,\n                              dataset: Dataset) {\n    const datasetId = getS3DataId(dataset.id);\n    return [\n        'from xcube.core.store import new_data_store',\n        '',\n        'store = new_data_store(',\n        '    \"s3\",',\n        '    root=\"datasets\",  # can also use \"pyramids\" here',\n        '    storage_options={',\n        '        \"anon\": True,',\n        '        \"client_kwargs\": {',\n        `            \"endpoint_url\": \"${serverConfig.url}/s3\"`,\n        '        }',\n        '    }',\n        ')',\n        `# store.list_data_ids()`,\n        `dataset = store.open_data(data_id=\"${datasetId}\")`,\n    ].join(\"\\n\");\n}\n\n\nfunction getVariablePythonCode(serverConfig: ApiServerConfig,\n                               variable: Variable,\n                               time: Time | null) {\n    const name = variable.name;\n    const vmin = variable.colorBarMin;\n    const vmax = variable.colorBarMax;\n    const cmap = variable.colorBarName;\n    let timeSel = '';\n    if (time !== null) {\n        timeSel = `.sel(time=\"${utcTimeToIsoDateTimeString(time)}\", method=\"nearest\")`;\n    }\n    return [\n        `var = dataset.${name}${timeSel}`,\n        `var.plot.imshow(vmin=${vmin}, vmax=${vmax}, cmap=\"${cmap}\")`,\n    ].join(\"\\n\");\n}\n\n\nfunction getS3DataId(originalId: string): string {\n    return splitExt(originalId)[0] + \".zarr\";\n}\n\n\nfunction splitExt(name: string): [string, string] {\n    const index = name.lastIndexOf(\".\");\n    if (index >= 0) {\n        return [name.substring(0, index), name.substring(index)];\n    } else {\n        return [name, \"\"];\n    }\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\nimport {\n    infoCardElementViewModesSelector,\n    selectedDatasetSelector,\n    selectedPlaceInfoSelector, selectedServerSelector, selectedTimeSelector,\n    selectedVariableSelector,\n    visibleInfoCardElementsSelector\n} from '../selectors/controlSelectors';\n\nimport { AppState } from '../states/appState';\nimport {\n    setVisibleInfoCardElements,\n    showInfoCard,\n    updateInfoCardElementViewMode,\n} from '../actions/controlActions';\nimport InfoCard from '../components/InfoCard';\nimport { Config } from \"../config\";\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        infoCardOpen: state.controlState.infoCardOpen,\n        visibleInfoCardElements: visibleInfoCardElementsSelector(state),\n        infoCardElementViewModes: infoCardElementViewModesSelector(state),\n        selectedDataset: selectedDatasetSelector(state),\n        selectedVariable: selectedVariableSelector(state),\n        selectedPlaceInfo: selectedPlaceInfoSelector(state),\n        selectedTime: selectedTimeSelector(state),\n        serverConfig: selectedServerSelector(state),\n        allowViewModePython: Config.instance.branding.allowViewModePython,\n    }\n};\n\nconst mapDispatchToProps = {\n    showInfoCard,\n    setVisibleInfoCardElements,\n    updateInfoCardElementViewMode,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(InfoCard);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react'\nimport { Theme } from \"@mui/material/styles\";\n\n\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        hor: {\n            flex: \"none\",\n            border: \"none\",\n            outline: \"none\",\n            width: \"8px\",\n            minHeight: \"100%\",\n            maxHeight: \"100%\",\n            cursor: \"col-resize\",\n\n            backgroundColor: theme.palette.mode === \"dark\" ? \"white\" : \"black\",\n            opacity: 0.0,\n        },\n        ver: {\n            flex: \"none\",\n            border: \"none\",\n            outline: \"none\",\n            height: \"8px\",\n            minWidth: \"100%\",\n            maxWidth: \"100%\",\n            cursor: \"row-resize\",\n\n            backgroundColor: theme.palette.mode === \"dark\" ? \"white\" : \"black\",\n            opacity: 0.0,\n        }\n    });\n\nexport type SplitDir = 'hor' | 'ver';\n\ninterface ISplitterProps extends WithStyles<typeof styles> {\n    dir?: SplitDir;\n    onChange: (delta: number) => any;\n}\n\ninterface IButtonEvent {\n    button: number;\n    buttons: number;\n}\n\ninterface IScreenEvent {\n    screenX: number;\n    screenY: number;\n}\n\ntype EventListenerItem = [string, (e: any) => any];\n\n\n/**\n * A splitter component.\n * In order to work properly, clients must provide the onChange which is a callback that receives the delta position\n * either in x-direction if direction is \"hor\" or y-direction if direction is \"ver\". The callback must then\n * adjust either a container's width if direction is \"hor\" or its height if direction is \"ver\".\n */\nclass Splitter extends React.PureComponent<ISplitterProps, any> {\n    private lastPosition: null | number = null;\n    private bodyEventListeners: Array<EventListenerItem>;\n\n    constructor(props: ISplitterProps) {\n        super(props);\n        if (!props.onChange) {\n            throw Error('onChange property must be provided');\n        }\n        this.onMouseDown = this.onMouseDown.bind(this);\n        this.bodyEventListeners = [\n            ['mousemove', this.onBodyMouseMove.bind(this)],\n            ['mouseup', this.onBodyMouseUp.bind(this)],\n            ['onmouseenter', this.onBodyMouseEnter.bind(this)],\n            ['onmouseleave', this.onBodyMouseLeave.bind(this)],\n        ];\n    }\n\n    componentWillUnmount() {\n        this.removeBodyMouseListeners();\n    }\n\n    render() {\n        return (\n            <div\n                className={this.props.dir === 'hor' ? this.props.classes.hor : this.props.classes.ver}\n                onMouseDown={this.onMouseDown}\n            />\n        );\n    }\n\n    private onMouseDown(event: React.MouseEvent<HTMLDivElement>) {\n        if (this.isButton1Pressed(event)) {\n            this.lastPosition = this.getCurrentPosition(event);\n            this.removeBodyMouseListeners();\n            this.addBodyMouseListeners();\n        } else {\n            this.lastPosition = null;\n        }\n    }\n\n    private onBodyMouseMove(event: MouseEvent) {\n        if (this.lastPosition === null || !this.isButton1Pressed(event)) {\n            return;\n        }\n        const currentPosition = this.getCurrentPosition(event);\n        const positionDelta = currentPosition - this.lastPosition;\n        this.lastPosition = currentPosition;\n        if (positionDelta !== 0) {\n            this.props.onChange(positionDelta);\n        }\n    }\n\n    //noinspection JSUnusedLocalSymbols\n    private onBodyMouseUp(event: MouseEvent) {\n        // console.log(\"onBodyMouseUp: \", event, this);\n        this.endDragging();\n    }\n\n    //noinspection JSUnusedLocalSymbols\n    private onBodyMouseEnter(event: MouseEvent) {\n        // console.log(\"onBodyMouseEnter: \", event, this);\n        this.endDragging();\n    }\n\n    //noinspection JSUnusedLocalSymbols\n    private onBodyMouseLeave(event: MouseEvent) {\n        // console.log(\"onBodyMouseLeave: \", event, this);\n        this.endDragging();\n    }\n\n    //noinspection JSMethodCanBeStatic\n    private isButton1Pressed(event: IButtonEvent) {\n        return event.button === 0 && event.buttons === 1;\n    }\n\n    private getCurrentPosition(event: IScreenEvent) {\n        return this.props.dir === 'hor' ? event.screenX:event.screenY;\n    }\n\n    private endDragging() {\n        this.removeBodyMouseListeners();\n        this.lastPosition = null;\n    }\n\n    private addBodyMouseListeners() {\n        this.bodyEventListeners.forEach((pair: EventListenerItem) =>\n            document.body.addEventListener(pair[0], pair[1]));\n    }\n\n    private removeBodyMouseListeners() {\n        this.bodyEventListeners.forEach((pair: EventListenerItem) =>\n            document.body.removeEventListener(pair[0], pair[1]));\n    }\n}\n\nexport default withStyles(styles)(Splitter);","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react'\nimport Splitter, { SplitDir } from './Splitter';\nimport { Theme } from \"@mui/material/styles\";\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport classNames from 'classnames';\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        hor: {\n            display: \"flex\",\n            flexFlow: \"row nowrap\",\n            flex: \"auto\",  // same as \"flex: 1 1 auto;\"\n        },\n        ver: {\n            // width: \"100%\",\n            height: \"100%\",\n            display: \"flex\",\n            flexFlow: \"column nowrap\",\n            flex: \"auto\",  // same as \"flex: 1 1 auto;\"\n        },\n        childHor: {\n            flex: \"none\",\n        },\n        childVer: {\n            flex: \"none\",\n        },\n    });\n\nexport interface ISplitPaneProps extends WithStyles<typeof styles> {\n    dir: SplitDir;\n    initialSize?: number;\n    onChange?: (newSize: number, oldSize: number) => void;\n    style?: React.CSSProperties;\n    child1Style?: React.CSSProperties;\n    child2Style?: React.CSSProperties;\n    className?: string;\n    child1ClassName?: string;\n    child2ClassName?: string;\n}\n\nexport interface ISplitPaneState {\n    size: number;\n}\n\n/**\n * A simple SplitPane component which must have exactly two child elements.\n *\n * Properties:\n * - dir: the split direction, either \"hor\" or \"ver\"\n * - initialSize: the initial width (\"hor\") or height (\"ver\") of the first child's container\n */\nclass SplitPane extends React.PureComponent<ISplitPaneProps, ISplitPaneState> {\n\n    constructor(props: ISplitPaneProps) {\n        super(props);\n        this.handleSplitDelta = this.handleSplitDelta.bind(this);\n        this.state = {size: props.initialSize || 50};\n    }\n\n    private handleSplitDelta(delta: number) {\n        this.setState((state: ISplitPaneState) => {\n            const oldSize = state.size;\n            const newSize = oldSize + delta;\n            if (this.props.onChange) {\n                this.props.onChange(newSize, oldSize);\n            }\n            return {size: newSize};\n        });\n    }\n\n    render() {\n        const children = this.props.children;\n        if (!children || !Array.isArray(children)) {\n            return children;\n        }\n        if (children.length === 1) {\n            return children[0];\n        }\n        if (children.length > 2) {\n            throw new Error(\"SplitPane expects not more than two children\");\n        }\n        let className;\n        let childClassName;\n        let child1Style;\n        let child2Style;\n        if (this.props.dir === 'hor') {\n            const width1 = this.state.size;\n            className = this.props.classes.hor;\n            childClassName = this.props.classes.childVer;\n            child1Style = {width: width1, ...this.props.child1Style};\n            child2Style = this.props.child2Style;\n        } else {\n            const height1 = this.state.size;\n            className = this.props.classes.ver;\n            childClassName = this.props.classes.childVer;\n            child1Style = {height: height1, ...this.props.child1Style};\n            child2Style = this.props.child2Style;\n        }\n        return (\n            <div\n                    id='SplitPane'\n                    className={classNames(className, this.props.className)}\n                    style={this.props.style}\n            >\n                <div\n                        id='SplitPane-Child-1'\n                        className={classNames(childClassName, this.props.child1ClassName)}\n                        style={child1Style}\n                >\n                    {children[0]}\n                </div>\n                <Splitter\n                        dir={this.props.dir}\n                        onChange={this.handleSplitDelta}\n                />\n                <div\n                        id='SplitPane-Child-2'\n                        className={classNames(childClassName, this.props.child2ClassName)}\n                        style={child2Style}\n                >\n                    {children[1]}\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default withStyles(styles)(SplitPane);","// noinspection JSUnusedLocalSymbols\n\n/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { Theme } from '@mui/material';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport { default as OlMap } from 'ol/Map';\n\nimport { AppState } from '../states/appState';\nimport Viewer from './Viewer';\nimport TimeSeriesCharts from './TimeSeriesCharts';\nimport VolumeCard from './VolumeCard';\nimport InfoCard from './InfoCard';\nimport SplitPane from '../components/SplitPane';\n\n\n// Adjust for debugging split pane style\nconst mapExtraStyle: React.CSSProperties = {padding: 0};\n\nconst styles = (theme: Theme) => createStyles(\n        {\n\n            splitPaneHor: {\n                flexGrow: 1,\n                overflow: 'hidden',\n            },\n            splitPaneVer: {\n                flexGrow: 1,\n                overflowX: 'hidden',\n                overflowY: 'auto'\n            },\n\n            mapPaneHor: {\n                height: '100%',\n                overflow: 'hidden',\n                ...mapExtraStyle\n            },\n            mapPaneVer: {\n                width: '100%',\n                overflow: 'hidden',\n                ...mapExtraStyle\n            },\n\n            detailsPaneHor: {\n                flex: 'auto',\n                overflowX: 'hidden',\n                overflowY: 'auto',\n            },\n            detailsPaneVer: {\n                width: '100%',\n                overflow: 'hidden',\n            },\n\n            viewerContainer: {\n                overflow: 'hidden',\n                width: '100%',\n                height: '100%',\n            },\n        });\n\ninterface WorkspaceProps extends WithStyles<typeof styles> {\n    hasInfoCard: boolean;\n    hasVolumeCard: boolean;\n    hasTimeseries: boolean;\n}\n\n// noinspection JSUnusedLocalSymbols\nconst mapStateToProps = (state: AppState) => {\n    const hasDatasets = state.controlState.selectedDatasetId !== null\n                        && state.dataState.datasets.length > 0;\n    return {\n        hasInfoCard: state.controlState.infoCardOpen && hasDatasets,\n        hasVolumeCard: state.controlState.volumeCardOpen && hasDatasets,\n        hasTimeseries: state.dataState.timeSeriesGroups.length > 0,\n    };\n};\n\nconst mapDispatchToProps = {};\n\n\ntype Layout = 'hor' | 'ver';\nconst getLayout = (): Layout => {\n    return window.innerWidth / window.innerHeight >= 1 ? 'hor' : 'ver';\n};\n\nconst Workspace: React.FC<WorkspaceProps> = ({\n                                                 classes,\n                                                 hasInfoCard,\n                                                 hasVolumeCard,\n                                                 hasTimeseries\n                                             }) => {\n    const [map, setMap] = React.useState<OlMap | null>(null);\n    const [layout, setLayout] = React.useState<Layout>(getLayout());\n\n    React.useEffect(() => {\n        updateLayout();\n        window.onresize = updateLayout;\n    }, []);\n\n    const updateLayout = () => {\n        setLayout(getLayout());\n    };\n\n    function handleResize(size: number) {\n        if (map) {\n            map.updateSize();\n        }\n    }\n\n    if (hasInfoCard || hasVolumeCard || hasTimeseries) {\n        const splitPaneClassName = layout === 'hor' ? classes.splitPaneHor : classes.splitPaneVer;\n        const mapPaneClassName = layout === 'hor' ? classes.mapPaneHor : classes.mapPaneVer;\n        const detailsPaneClassName = layout === 'hor' ? classes.detailsPaneHor : classes.detailsPaneVer;\n        return (\n                <SplitPane\n                        dir={layout}\n                        initialSize={Math.max(window.innerWidth, window.innerHeight) / 2}\n                        onChange={handleResize}\n                        className={splitPaneClassName}\n                        child1ClassName={mapPaneClassName}\n                        child2ClassName={detailsPaneClassName}\n                >\n                    <Viewer onMapRef={setMap}/>\n                    <div>\n                        <InfoCard/>\n                        <VolumeCard/>\n                        <TimeSeriesCharts/>\n                    </div>\n                </SplitPane>\n        );\n    } else {\n        return (\n                <div className={classes.viewerContainer}>\n                    <Viewer onMapRef={setMap}/>\n                </div>\n        );\n    }\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(Workspace));","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { Theme, Toolbar } from '@mui/material';\n\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\n\nimport { AppState } from '../states/appState';\nimport ControlBar from './ControlBar';\nimport Workspace from './Workspace';\nimport { Config } from \"../config\";\n\n\ninterface AppPaneProps extends WithStyles<typeof styles> {\n    hasConsent: boolean;\n    compact: boolean;\n}\n\n// noinspection JSUnusedLocalSymbols\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        hasConsent: state.controlState.privacyNoticeAccepted,\n        compact: Config.instance.branding.compact\n    };\n};\n\nconst mapDispatchToProps = {};\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        main: {\n            padding: 0,\n            width: '100vw',\n            height: '100vh',\n            overflow: 'hidden',\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'stretch',\n            [theme.breakpoints.up('md')]: {\n                overflow: 'hidden',\n            },\n        },\n    });\n\nconst AppPane: React.FC<AppPaneProps> = ({classes, hasConsent, compact}) => {\n    // <Toolbar/>: Empty toolbar is a spacer, see docs https://material-ui.com/components/app-bar/\n    return (\n        <main className={classes.main}>\n            {!compact && <Toolbar variant=\"dense\"/>}\n            {\n                hasConsent && (\n                    <>\n                        <ControlBar/>\n                        <Workspace/>\n                    </>\n                )\n            }\n        </main>\n    );\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(AppPane));","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport Markdown from 'react-markdown';\nimport Button from '@mui/material/Button';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogContentText from '@mui/material/DialogContentText';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport makeStyles from '@mui/styles/makeStyles';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport CheckIcon from '@mui/icons-material/Check';\n\nimport i18n from '../i18n';\nimport { ControlState } from '../states/controlState';\n\n\nconst useStyles = makeStyles(theme => ({\n        icon: {\n            marginRight: theme.spacing(2),\n        },\n    }\n));\n\ninterface LegalAgreementDialogProps {\n    open: boolean;\n    settings: ControlState;\n    updateSettings: (settings: ControlState) => void;\n    syncWithServer: () => void;\n}\n\nexport default function LegalAgreementDialog(\n    {\n        open,\n        settings,\n        updateSettings,\n        syncWithServer\n    }: LegalAgreementDialogProps) {\n    const [markdownText, setMarkdownText] = useState<string | null>(null);\n\n    useEffect(() => {\n        const href = i18n.get(\"legal/privacy-note.en.md\")\n        // fetch(window.location.href + href)\n        fetch(href)\n            .then(response => response.text())\n            .then(text => setMarkdownText(text));\n    });\n\n    const classes = useStyles();\n\n    if (!open) {\n        return null;\n    }\n\n    function handleConfirm() {\n        updateSettings({...settings, privacyNoticeAccepted: true});\n        syncWithServer();\n    }\n\n    function handleLeave() {\n        try {\n            if (window.history.length > 0) {\n                window.history.back();\n            } else if (typeof (window as any).home === 'function') {\n                (window as any).home();\n            } else {\n                window.location.href = 'about:home';\n            }\n        } catch (e) {\n            console.error(e);\n        }\n    }\n\n    return (\n        <Dialog\n            open={open}\n            disableEscapeKeyDown={true}\n            keepMounted={true}\n            scroll='body'\n        >\n            <DialogTitle>{i18n.get(\"Privacy Notice\")}</DialogTitle>\n            <DialogContent>\n                <DialogContentText>\n                    {\n                        markdownText === null\n                            ? <CircularProgress/>\n                            :<Markdown children={markdownText} linkTarget=\"_blank\"/>\n                    }\n                </DialogContentText>\n            </DialogContent>\n\n            <DialogActions>\n                <Button onClick={handleConfirm} color=\"primary\">\n                    <CheckIcon className={classes.icon}/>\n                    {i18n.get('Accept and continue')}\n                </Button>\n                <Button onClick={handleLeave}>\n                    {i18n.get('Leave')}\n                </Button>\n            </DialogActions>\n\n        </Dialog>\n    );\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport LegalAgreementDialog from '../components/LegalAgreementDialog';\nimport { updateSettings } from '../actions/controlActions';\nimport { syncWithServer } from '../actions/dataActions';\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        open: !state.controlState.privacyNoticeAccepted,\n        settings: state.controlState,\n    };\n};\n\nconst mapDispatchToProps = {\n    updateSettings,\n    syncWithServer\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(LegalAgreementDialog);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport CircularProgress from '@mui/material/CircularProgress';\nimport Dialog from '@mui/material/Dialog';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Typography from '@mui/material/Typography';\nimport * as React from 'react';\nimport i18n from '../i18n';\n\nimport { WithLocale } from '../util/lang';\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        progress: {\n            margin: theme.spacing(2),\n        },\n        message: {\n            margin: theme.spacing(1),\n        },\n        contentContainer: {\n            margin: theme.spacing(1),\n            textAlign: 'center',\n            display: 'flex',\n            alignItems: 'center',\n            flexDirection: 'column',\n        },\n    });\n\ninterface LoadingDialogProps extends WithStyles<typeof styles>, WithLocale {\n    messages: string[];\n}\n\nconst LoadingDialog: React.FC<LoadingDialogProps> = ({classes, messages}) => {\n\n    if (messages.length === 0) {\n        return null;\n    }\n\n    return (\n        <Dialog open={true} aria-labelledby=\"loading\">\n            <DialogTitle id=\"loading\">{i18n.get('Please wait...')}</DialogTitle>\n            <div className={classes.contentContainer}>\n                <CircularProgress className={classes.progress}/>\n                {messages.map((message, i) => (\n                    <Typography component=\"div\" key={i}\n                                className={classes.message}>{message}</Typography>\n                ))}\n            </div>\n        </Dialog>\n    );\n};\n\nexport default withStyles(styles)(LoadingDialog);\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport LoadingDialog from \"../components/LoadingDialog\";\nimport { activityMessagesSelector } from \"../selectors/controlSelectors\";\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        messages: activityMessagesSelector(state),\n    };\n};\n\nconst mapDispatchToProps = {};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(LoadingDialog);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Snackbar from '@mui/material/Snackbar';\nimport { SnackbarOrigin } from '@mui/material/Snackbar/Snackbar';\nimport SnackbarContent from '@mui/material/SnackbarContent';\nimport IconButton from '@mui/material/IconButton';\nimport CloseIcon from '@mui/icons-material/Close';\nimport ErrorIcon from '@mui/icons-material/Error';\nimport WarningIcon from '@mui/icons-material/Warning';\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\nimport InfoIcon from '@mui/icons-material/Info';\n\nimport { MessageLogEntry } from '../states/messageLogState';\n\n\nimport { green, amber } from '@mui/material/colors';\n\n\nconst variantIcon = {\n    success: CheckCircleIcon,\n    warning: WarningIcon,\n    error: ErrorIcon,\n    info: InfoIcon,\n};\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        close: {\n            padding: theme.spacing(0.5),\n        },\n        success: {\n            color: theme.palette.error.contrastText,\n            backgroundColor: green[600],\n        },\n        error: {\n            color: theme.palette.error.contrastText,\n            backgroundColor: theme.palette.error.dark,\n        },\n        info: {\n            color: theme.palette.error.contrastText,\n            backgroundColor: theme.palette.primary.dark,\n        },\n        warning: {\n            color: theme.palette.error.contrastText,\n            backgroundColor: amber[700],\n        },\n        icon: {\n            fontSize: 20,\n        },\n        iconVariant: {\n            opacity: 0.9,\n            marginRight: theme.spacing(1),\n        },\n        message: {\n            display: 'flex',\n            alignItems: 'center',\n        },\n    });\n\ninterface MessageLogProps extends WithStyles<typeof styles> {\n    message: MessageLogEntry | null;\n    hideMessage: (messageId: number) => void;\n    className?: string;\n}\n\nconst SNACKBAR_ANCHOR_ORIGIN: SnackbarOrigin = {\n    vertical: 'bottom',\n    horizontal: 'center',\n};\n\n\nconst MessageLog: React.FC<MessageLogProps> = ({classes, className, message, hideMessage}) => {\n\n    const handleClose = () => {\n        hideMessage(message!.id);\n    };\n\n    if (!message) {\n        return null;\n    }\n\n    const MessageIcon = variantIcon[message.type];\n\n    return (\n        <Snackbar\n            key={message.type + ':' + message.text}\n            open={true}\n            anchorOrigin={SNACKBAR_ANCHOR_ORIGIN}\n            autoHideDuration={5000}\n            onClose={handleClose}>\n            <SnackbarContent\n                className={classNames(classes[message.type], className)}\n                aria-describedby=\"client-snackbar\"\n                message={\n                    <span id=\"client-snackbar\" className={classes.message}>\n                            <MessageIcon className={classNames(classes.icon, classes.iconVariant)}/>\n                        {message.text}\n                        </span>\n                }\n                action={[\n                    <IconButton\n                        key=\"close\"\n                        aria-label=\"Close\"\n                        color=\"inherit\"\n                        className={classes.close}\n                        onClick={handleClose}\n                        size=\"large\">\n                        <CloseIcon className={classes.icon}/>\n                    </IconButton>,\n                ]}\n            />\n        </Snackbar>\n    );\n};\n\nexport default withStyles(styles)(MessageLog);","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport MessageLog from '../components/MessageLog';\nimport { hideMessage } from '../actions/messageLogActions';\n\n\nconst mapStateToProps = (state: AppState) => {\n    let newEntries = state.messageLogState.newEntries;\n    return {\n        locale: state.controlState.locale,\n        message: newEntries.length > 0 ? newEntries[0] : null,\n    };\n};\n\nconst mapDispatchToProps = {\n    hideMessage,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MessageLog);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from \"react\";\nimport { AuthProvider } from \"react-oidc-context\";\nimport { User } from \"oidc-client-ts\";\nimport { Config } from '../config';\nimport ErrorBoundary from \"./ErrorBoundary\";\n\n\ninterface AuthWrapperProps {\n}\n\nconst AuthWrapper: React.FC<React.PropsWithChildren<AuthWrapperProps>> = ({children}) => {\n    const authClient = Config.instance.authClient;\n    if (!authClient) {\n        return <>{children}</>;\n    }\n\n    const handleSigninCallback = (_user: User | void): void => {\n        console.info(\"handleSigninCallback:\", _user);\n        window.history.replaceState(\n                {},\n                document.title,\n                window.location.pathname\n        )\n    }\n\n    const handleRemoveUser = (): void => {\n        console.info(\"handleRemoveUser\");\n        // go home after logout\n        window.location.pathname = \"/\";\n    }\n\n    // TODO (forman): check whether we can (should?) use\n    //   baseUrl.href (from util/baseurl.ts) here\n    // const redirectUri = baseUrl.href;\n    const redirectUri = window.location.origin;\n\n    return (\n            <ErrorBoundary>\n                <AuthProvider\n                        {...authClient}\n                        loadUserInfo={true}\n                        scope=\"openid email profile\"\n                        automaticSilentRenew={true}\n                        redirect_uri={redirectUri}\n                        post_logout_redirect_uri={redirectUri}\n                        popup_post_logout_redirect_uri={redirectUri}\n                        onSigninCallback={handleSigninCallback}\n                        onRemoveUser={handleRemoveUser}\n                >\n                    {children}\n                </AuthProvider>\n            </ErrorBoundary>\n    );\n}\n\nexport default AuthWrapper;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Theme } from '@mui/material';\nimport { WithStyles } from '@mui/styles';\nimport Button from '@mui/material/Button';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport FormControl from '@mui/material/FormControl';\nimport FormHelperText from '@mui/material/FormHelperText';\nimport IconButton from '@mui/material/IconButton';\nimport InputLabel from '@mui/material/InputLabel/InputLabel';\nimport MenuItem from '@mui/material/MenuItem';\nimport Select from '@mui/material/Select';\nimport withStyles from '@mui/styles/withStyles';\nimport createStyles from '@mui/styles/createStyles';\nimport TextField from '@mui/material/TextField';\nimport AddIcon from '@mui/icons-material/Add';\nimport DeleteIcon from '@mui/icons-material/Delete';\nimport EditIcon from '@mui/icons-material/Edit';\nimport * as React from 'react';\nimport { useEffect, useRef, useState } from 'react';\nimport i18n from '../i18n';\nimport { ApiServerConfig } from '../model/apiServer';\nimport { newId } from '../util/id';\n\nimport { WithLocale } from '../util/lang';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        formControl: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            width: 200,\n        },\n        textField: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            width: 200,\n        },\n        textField2: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            width: 400,\n        },\n        button: {\n            margin: 0.1 * theme.spacing(1),\n        },\n    });\n\n\ninterface ServerDialogProps extends WithStyles<typeof styles>, WithLocale {\n    open: boolean;\n    servers: ApiServerConfig[];\n    selectedServer: ApiServerConfig;\n    configureServers: (servers: ApiServerConfig[], selectedServerId: string) => void;\n    closeDialog: (dialogId: string) => void;\n}\n\nconst ServerDialog: React.FC<ServerDialogProps> = ({classes, open, servers, selectedServer, closeDialog, configureServers}) => {\n    const ref = useRef(false);\n    const [servers_, setServers_] = useState(servers);\n    const [selectedServer_, setSelectedServer_] = useState(selectedServer);\n    const [dialogMode, setDialogMode] = useState('select');\n\n    useEffect(() => {\n        if (ref.current) {\n            setServers_(servers);\n            setSelectedServer_(selectedServer);\n        }\n        ref.current = true;\n    }, [servers, selectedServer]);\n\n    const handleConfirm = () => {\n        if (dialogMode === 'select') {\n            closeDialog('server');\n            configureServers(servers_, selectedServer_.id);\n        } else if (dialogMode === 'add') {\n            doAddServer();\n        } else if (dialogMode === 'edit') {\n            doEditServer();\n        }\n    };\n\n    const handleCancel = () => {\n        if (dialogMode === 'select') {\n            doClose();\n        } else {\n            cancelAddOrEditMode();\n        }\n    };\n\n    const handleClose = () => {\n        doClose();\n    };\n\n    const handleSelectServer = (event: React.ChangeEvent<{ name?: string; value: any; }>) => {\n        const selectedServerId = event.target.value;\n        const selectedServer = servers_.find(server => server.id === selectedServerId)!;\n        setSelectedServer_(selectedServer);\n    };\n\n    const handleServerNameChange = (event: any) => {\n        const selectedServerName = event.target.value;\n        const selectedServer = {...selectedServer_, name: selectedServerName};\n        setSelectedServer_(selectedServer);\n    };\n\n    const handleServerURLChange = (event: any) => {\n        const selectedServerURL = event.target.value;\n        const selectedServer = {...selectedServer_, url: selectedServerURL};\n        setSelectedServer_(selectedServer);\n    };\n\n    const handleAddMode = () => {\n        setDialogMode('add');\n    };\n\n    const handleEditMode = () => {\n        setDialogMode('edit');\n    };\n\n    const handleRemoveServer = () => {\n        doRemoveServer();\n    };\n\n    const doClose = () => {\n        closeDialog('server');\n    };\n\n    const getSelectedServerIndex = (): number => {\n        const selectedServerId = selectedServer_.id;\n        return servers_.findIndex(server => server.id === selectedServerId)!;\n    };\n\n    const setSelectedServer = (selectedServerIndex: number, selectedServer: ApiServerConfig) => {\n        const servers = [...servers_];\n        servers[selectedServerIndex] = selectedServer;\n        setServers_(servers);\n        setSelectedServer_(selectedServer);\n        setDialogMode('select');\n    };\n\n    const setServers = (servers: ApiServerConfig[], selectedServer: ApiServerConfig) => {\n        setServers_(servers);\n        setSelectedServer_(selectedServer);\n        setDialogMode('select');\n    };\n\n    const doAddServer = () => {\n        const selectedServer = {...selectedServer_, id: newId()};\n        const servers = [...servers_, selectedServer];\n        setServers(servers, selectedServer);\n    };\n\n    const doEditServer = () => {\n        setSelectedServer(getSelectedServerIndex(), {...selectedServer_});\n    };\n\n    const cancelAddOrEditMode = () => {\n        const selectedServerIndex = getSelectedServerIndex();\n        setSelectedServer(getSelectedServerIndex(), servers_[selectedServerIndex]);\n    };\n\n    const doRemoveServer = () => {\n        const servers = [...servers_];\n        if (servers.length < 2) {\n            throw new Error('internal error: server list cannot be emptied');\n        }\n        const selectedServerIndex = getSelectedServerIndex();\n        const selectedServer = servers[selectedServerIndex + (selectedServerIndex > 0 ? -1 : 1)];\n        servers.splice(selectedServerIndex, 1);\n        setServers(servers, selectedServer);\n    };\n\n    const menuItems = servers_.map((server, index) => (\n        <MenuItem key={index} value={server.id}>{server.name}</MenuItem>\n    ));\n\n    let okButtonName;\n    if (dialogMode === 'add') {\n        okButtonName = i18n.get('Add');\n    } else if (dialogMode === 'edit') {\n        okButtonName = i18n.get('Save');\n    } else {\n        okButtonName = i18n.get('OK');\n    }\n\n    let dialogTitle;\n    if (dialogMode === 'add') {\n        dialogTitle = i18n.get('Add Server');\n    } else if (dialogMode === 'edit') {\n        dialogTitle = i18n.get('Edit Server');\n    } else {\n        dialogTitle = i18n.get('Select Server');\n    }\n\n    let dialogContent;\n    if (dialogMode === 'add' || dialogMode === 'edit') {\n        dialogContent = (\n            <DialogContent dividers>\n                <TextField\n                    variant=\"standard\"\n                    required\n                    id=\"server-name\"\n                    label=\"Name\"\n                    className={classes.textField}\n                    margin=\"normal\"\n                    value={selectedServer_.name}\n                    onChange={handleServerNameChange} />\n                <br/>\n                <TextField\n                    variant=\"standard\"\n                    required\n                    id=\"server-url\"\n                    label=\"URL\"\n                    className={classes.textField2}\n                    margin=\"normal\"\n                    value={selectedServer_.url}\n                    onChange={handleServerURLChange} />\n            </DialogContent>\n        );\n    } else {\n        dialogContent = (\n            <DialogContent dividers>\n                <div>\n                    <FormControl variant=\"standard\" className={classes.formControl}>\n                        <InputLabel htmlFor=\"server-name\">Name</InputLabel>\n                        <Select\n                            variant=\"standard\"\n                            value={selectedServer_.id}\n                            onChange={handleSelectServer}\n                            inputProps={{\n                                name: 'server-name',\n                                id: 'server-name',\n                            }}>\n                            {menuItems}\n                        </Select>\n                        <FormHelperText>{selectedServer_.url}</FormHelperText>\n                    </FormControl>\n                    <IconButton\n                        className={classes.button}\n                        aria-label=\"Add\"\n                        color=\"primary\"\n                        onClick={handleAddMode}\n                        size=\"large\">\n                        <AddIcon fontSize=\"small\"/>\n                    </IconButton>\n                    <IconButton\n                        className={classes.button}\n                        aria-label=\"Edit\"\n                        onClick={handleEditMode}\n                        size=\"large\">\n                        <EditIcon fontSize=\"small\"/>\n                    </IconButton>\n                    <IconButton\n                        className={classes.button}\n                        aria-label=\"Delete\"\n                        disabled={servers_.length < 2}\n                        onClick={handleRemoveServer}\n                        size=\"large\">\n                        <DeleteIcon fontSize=\"small\"/>\n                    </IconButton>\n                </div>\n            </DialogContent>\n        );\n    }\n\n    return (\n        <Dialog\n            open={open}\n            onClose={handleClose}\n            aria-labelledby=\"server-dialog-title\"\n        >\n            <DialogTitle id=\"server-dialog-title\">{dialogTitle}</DialogTitle>\n            {dialogContent}\n            <DialogActions>\n                <Button onClick={handleCancel}>{i18n.get('Cancel')}</Button>\n                <Button onClick={handleConfirm} autoFocus color=\"primary\">{okButtonName}</Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n\nexport default withStyles(styles)(ServerDialog);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport ServerDialog from '../components/ServerDialog';\nimport { closeDialog } from \"../actions/controlActions\";\nimport { configureServers } from \"../actions/dataActions\";\nimport { selectedServerSelector } from \"../selectors/controlSelectors\";\nimport { userServersSelector } from \"../selectors/dataSelectors\";\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        open: !!state.controlState.dialogOpen[\"server\"],\n        servers: userServersSelector(state),\n        selectedServer: selectedServerSelector(state),\n    };\n};\n\nconst mapDispatchToProps = {\n    closeDialog,\n    configureServers,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ServerDialog);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport Typography from '@mui/material/Typography';\nimport { darken, lighten } from '@mui/material/styles';\nimport makeStyles from '@mui/styles/makeStyles';\nimport Divider from '@mui/material/Divider';\nimport List from '@mui/material/List';\nimport Paper from '@mui/material/Paper';\nimport Box from '@mui/material/Box';\n\n\nconst useStyles = makeStyles(theme => ({\n        settingsPanelTitle: {\n            marginBottom: theme.spacing(1),\n        },\n        settingsPanelPaper: {\n            backgroundColor: (theme.palette.mode === 'dark' ? lighten : darken)(theme.palette.background.paper, 0.1),\n            marginBottom: theme.spacing(2),\n        },\n        settingsPanelList: {\n            margin: 0,\n        },\n    }\n));\n\ninterface SettingsPanelProps {\n    title?: string;\n}\n\nexport const SettingsPanel: React.FC<SettingsPanelProps> = (\n    {\n        title,\n        children\n    }\n) => {\n    const classes = useStyles();\n\n    const childCount = React.Children.count(children);\n\n    const listItems: React.ReactNode[] = [];\n    React.Children.forEach(children, (child: React.ReactNode, index: number) => {\n        listItems.push(child);\n        if (index < childCount - 1) {\n            listItems.push(<Divider key={childCount + index} variant=\"fullWidth\" component=\"li\"/>);\n        }\n    });\n\n    return (\n        <Box>\n            {title && title !== '' && (\n                <Typography variant='body1' className={classes.settingsPanelTitle}>\n                    {title}\n                </Typography>\n            )}\n            <Paper elevation={4} className={classes.settingsPanelPaper}>\n                <List component=\"nav\" dense={true} className={classes.settingsPanelList}>\n                    {listItems}\n                </List>\n            </Paper>\n        </Box>\n    );\n};\n\nexport default SettingsPanel;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport ListItemText from '@mui/material/ListItemText';\nimport ListItem from '@mui/material/ListItem';\nimport ListItemSecondaryAction from '@mui/material/ListItemSecondaryAction';\n\n\ninterface SettingsSubPanelProps {\n    label: string;\n    value?: string | number;\n    onClick?: (event: any) => void;\n}\n\nconst SettingsSubPanel: React.FC<SettingsSubPanelProps> = (\n    {\n        label,\n        value,\n        onClick,\n        children,\n    }\n) => {\n\n    let listItemStyle;\n    if (!value) {\n        listItemStyle = {marginBottom: 10};\n    }\n\n    const listItemText = (<ListItemText primary={label} secondary={value}/>);\n\n    let listItemSecondaryAction;\n    if (children) {\n        listItemSecondaryAction = (\n            <ListItemSecondaryAction>\n                {children}\n            </ListItemSecondaryAction>\n        );\n    }\n\n    if (!!onClick) {\n        return (\n            <ListItem style={listItemStyle} button onClick={onClick}>\n                {listItemText}\n                {listItemSecondaryAction}\n            </ListItem>\n        );\n    }\n\n    return (\n        <ListItem style={listItemStyle}>\n            {listItemText}\n            {listItemSecondaryAction}\n        </ListItem>\n    );\n};\n\nexport default SettingsSubPanel;","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport Switch from '@mui/material/Switch';\n\nimport { ControlState } from '../states/controlState';\n\n\ninterface ToggleSettingProps {\n    propertyName: keyof ControlState;\n    settings: ControlState;\n    updateSettings: (settings: ControlState) => void;\n    disabled?: boolean;\n}\n\nconst ToggleSetting: React.FC<ToggleSettingProps> = (\n    {\n        propertyName,\n        settings,\n        updateSettings,\n        disabled\n    }\n) => {\n    return (\n        <Switch\n            checked={!!settings[propertyName]}\n            onChange={() => updateSettings({...settings, [propertyName]: !settings[propertyName]})}\n            disabled={disabled}\n        />\n    );\n};\n\nexport default ToggleSetting;","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport Radio from '@mui/material/Radio';\nimport RadioGroup from '@mui/material/RadioGroup';\n\nimport {ControlState} from '../states/controlState';\nimport {FormControlLabel} from \"@mui/material\";\n\n\ninterface RadioSettingProps {\n    propertyName: keyof ControlState;\n    settings: ControlState;\n    updateSettings: (settings: ControlState) => void;\n    options: Array<[string, string | number]>;\n    disabled?: boolean;\n}\n\nconst RadioSetting: React.FC<RadioSettingProps> = (\n    {\n        propertyName,\n        settings,\n        updateSettings,\n        options,\n        disabled,\n    }\n) => {\n    const handleChange = (event: React.ChangeEvent<HTMLInputElement>, value: string) => {\n        updateSettings({...settings, [propertyName]: value});\n    };\n    return (\n        <RadioGroup\n            row\n            value={settings[propertyName]}\n            onChange={handleChange}\n        >\n            {\n                options.map(([label, value]) => (\n                    <FormControlLabel\n                        key={label}\n                        control={<Radio/>}\n                        value={value}\n                        label={label}\n                        disabled={disabled}\n                    />\n                ))\n            }\n        </RadioGroup>\n    );\n};\n\nexport default RadioSetting;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React, { ChangeEvent } from 'react';\nimport Dialog from '@mui/material/Dialog';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport ListItemText from '@mui/material/ListItemText';\nimport ListSubheader from \"@mui/material/ListSubheader\";\nimport Menu from '@mui/material/Menu';\nimport MenuItem from '@mui/material/MenuItem';\nimport makeStyles from '@mui/styles/makeStyles';\nimport TextField from '@mui/material/TextField';\nimport Button from '@mui/material/Button';\n\nimport i18n from '../i18n';\nimport { ApiServerConfig, ApiServerInfo } from '../model/apiServer';\nimport { ControlState, TIME_ANIMATION_INTERVALS, TimeAnimationInterval } from '../states/controlState';\nimport { MapGroup, maps, MapSource } from '../util/maps';\nimport SettingsPanel from './SettingsPanel';\nimport SettingsSubPanel from './SettingsSubPanel';\nimport ToggleSetting from './ToggleSetting';\nimport RadioSetting from './RadioSetting';\nimport { GEOGRAPHIC_CRS, WEB_MERCATOR_CRS } from '../model/proj';\n\n\nconst useStyles = makeStyles(theme => ({\n        textField: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            fontSize: theme.typography.fontSize / 2\n        },\n        intTextField: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            fontSize: theme.typography.fontSize / 2,\n            width: theme.spacing(6),\n        },\n        localeAvatar: {\n            margin: 10,\n        }\n    }\n));\n\ninterface SettingsDialogProps {\n    open: boolean;\n    closeDialog: (dialogId: string) => void;\n\n    settings: ControlState;\n    selectedServer: ApiServerConfig;\n    viewerVersion: string;\n    updateSettings: (settings: Partial<ControlState>) => void;\n    changeLocale: (locale: string) => void;\n    openDialog: (dialogId: string) => void;\n    serverInfo: ApiServerInfo | null;\n}\n\n\nconst SettingsDialog: React.FC<SettingsDialogProps> = ({\n                                                           open,\n                                                           closeDialog,\n                                                           settings,\n                                                           selectedServer,\n                                                           updateSettings,\n                                                           changeLocale,\n                                                           openDialog,\n                                                           viewerVersion,\n                                                           serverInfo\n                                                       }) => {\n    const [languageMenuAnchor, setLanguageMenuAnchor] = React.useState(null);\n    const [baseMapMenuAnchor, setBaseMapMenuAnchor] = React.useState(null);\n    const [timeChunkSize, setTimeChunkSize] = React.useState(settings.timeChunkSize + '');\n    const classes = useStyles();\n\n    React.useEffect(() => {\n        const newTimeChunkSize = parseInt(timeChunkSize);\n        if (!Number.isNaN(newTimeChunkSize) && newTimeChunkSize !== settings.timeChunkSize) {\n            updateSettings({timeChunkSize: newTimeChunkSize});\n        }\n    }, [timeChunkSize, settings, updateSettings]);\n\n    if (!open) {\n        return null;\n    }\n\n    function handleCloseDialog() {\n        closeDialog('settings');\n    }\n\n    function handleOpenServerDialog() {\n        openDialog('server');\n    }\n\n    function handleTimeAnimationIntervalChange(event: ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) {\n        updateSettings({timeAnimationInterval: parseInt(event.target.value) as TimeAnimationInterval});\n    }\n\n    function handleTimeChunkSizeChange(event: ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) {\n        setTimeChunkSize(event.target.value);\n    }\n\n    let localeMenuItems = null;\n    if (Boolean(languageMenuAnchor)) {\n        localeMenuItems = Object.getOwnPropertyNames(i18n.languages).map(langLocale => {\n            const langName = i18n.languages[langLocale];\n            return (\n                <MenuItem\n                    key={langLocale}\n                    selected={langLocale === settings.locale}\n                    onClick={() => changeLocale(langLocale)}\n                >\n                    <ListItemText primary={langName}/>\n                </MenuItem>\n            );\n        });\n    }\n\n    function handleLanguageMenuOpen(event: any) {\n        setLanguageMenuAnchor(event.currentTarget);\n    }\n\n    function handleLanguageMenuClose() {\n        setLanguageMenuAnchor(null);\n    }\n\n    let baseMapMenuItems: null | React.ReactElement[] = null;\n    if (Boolean(baseMapMenuAnchor)) {\n        baseMapMenuItems = [];\n        maps.forEach((mapGroup: MapGroup, i: number) => {\n            baseMapMenuItems!.push(<ListSubheader key={i} disableSticky={true}>{mapGroup.name}</ListSubheader>);\n            mapGroup.datasets.forEach((mapSource: MapSource, j: number) => {\n                baseMapMenuItems!.push(\n                    <MenuItem\n                        key={i + '.' + j}\n                        selected={settings.baseMapUrl === mapSource.endpoint}\n                        onClick={() => updateSettings({baseMapUrl: mapSource.endpoint})}>\n                        <ListItemText primary={mapSource.name}/>\n                    </MenuItem>\n                );\n            });\n        });\n    }\n\n    function handleBaseMapMenuOpen(event: any) {\n        setBaseMapMenuAnchor(event.currentTarget);\n    }\n\n    function handleBaseMapMenuClose() {\n        setBaseMapMenuAnchor(null);\n    }\n\n    let baseMapLabel = settings.baseMapUrl;\n    maps.forEach((mapGroup: MapGroup) => {\n        mapGroup.datasets.forEach((mapSource: MapSource) => {\n            if (mapSource.endpoint === settings.baseMapUrl) {\n                baseMapLabel = `${mapGroup.name} / ${mapSource.name}`;\n            }\n        });\n    });\n\n    return (\n        <div>\n            <Dialog\n                open={open}\n                fullWidth\n                maxWidth={'sm'}\n                onClose={handleCloseDialog}\n                scroll=\"body\"\n            >\n                <DialogTitle>{i18n.get('Settings')}</DialogTitle>\n                <DialogContent>\n\n                    <SettingsPanel title={i18n.get('General')}>\n                        <SettingsSubPanel\n                            label={i18n.get('Server')}\n                            value={selectedServer.name}\n                            onClick={handleOpenServerDialog}>\n                        </SettingsSubPanel>\n                        <SettingsSubPanel\n                            label={i18n.get('Language')}\n                            value={i18n.languages[settings.locale]}\n                            onClick={handleLanguageMenuOpen}>\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Time interval of the player')}>\n                            <TextField\n                                variant=\"standard\"\n                                select\n                                className={classes.textField}\n                                value={settings.timeAnimationInterval}\n                                onChange={handleTimeAnimationIntervalChange}\n                                margin=\"normal\">\n                                {TIME_ANIMATION_INTERVALS.map((value, i) => (\n                                    <MenuItem key={i} value={value}>{value + ' ms'}</MenuItem>\n                                ))}\n                            </TextField>\n                        </SettingsSubPanel>\n                    </SettingsPanel>\n\n                    <SettingsPanel title={i18n.get('Time-Series')}>\n                        <SettingsSubPanel label={i18n.get('Show graph after adding a place')}\n                                          value={getOnOff(settings.autoShowTimeSeries)}>\n                            <ToggleSetting\n                                propertyName={'autoShowTimeSeries'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Show dots only, hide lines')}\n                                          value={getOnOff(settings.showTimeSeriesPointsOnly)}>\n                            <ToggleSetting\n                                propertyName={'showTimeSeriesPointsOnly'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Show error bars')}\n                                          value={getOnOff(settings.showTimeSeriesErrorBars)}>\n                            <ToggleSetting\n                                propertyName={'showTimeSeriesErrorBars'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Show median instead of mean (disables error bars)')}\n                                          value={getOnOff(settings.showTimeSeriesMedian)}>\n                            <ToggleSetting\n                                propertyName={'showTimeSeriesMedian'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Minimal number of data points in a time series update')}>\n                            <TextField\n                                variant=\"standard\"\n                                className={classes.intTextField}\n                                value={timeChunkSize}\n                                onChange={handleTimeChunkSizeChange}\n                                margin=\"normal\"\n                                size={'small'}/>\n                        </SettingsSubPanel>\n                    </SettingsPanel>\n\n                    <SettingsPanel title={i18n.get('Map')}>\n                        <SettingsSubPanel\n                            label={i18n.get('Base map')}\n                            value={baseMapLabel}\n                            onClick={handleBaseMapMenuOpen}>\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Projection')}>\n                            <RadioSetting\n                                propertyName={'mapProjection'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                                options={[\n                                    [i18n.get('Geographic'), GEOGRAPHIC_CRS],\n                                    [i18n.get('Mercator'), WEB_MERCATOR_CRS],\n                                ]}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Image smoothing')}\n                                          value={getOnOff(settings.imageSmoothingEnabled)}>\n                            <ToggleSetting\n                                propertyName={'imageSmoothingEnabled'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Show dataset boundaries')}\n                                          value={getOnOff(settings.showDatasetBoundaries)}>\n                            <ToggleSetting\n                                propertyName={'showDatasetBoundaries'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                    </SettingsPanel>\n\n                    <SettingsPanel title={i18n.get(\"Legal Agreement\")}>\n                        <Button\n                            onClick={() => {\n                                updateSettings({privacyNoticeAccepted: false});\n                                window.location.reload();\n                            }}\n                        >\n                            {i18n.get(\"Revoke consent\")}\n                        </Button>\n                    </SettingsPanel>\n\n                    <SettingsPanel title={i18n.get('System Information')}>\n                        <SettingsSubPanel\n                            label={`xcube Viewer ${i18n.get('version')}`}\n                            value={viewerVersion}\n                        />\n                        <SettingsSubPanel\n                            label={`xcube Server ${i18n.get('version')}`}\n                            value={serverInfo ? serverInfo.version:i18n.get('Cannot reach server')}\n                        />\n                    </SettingsPanel>\n                </DialogContent>\n            </Dialog>\n\n            <Menu\n                anchorEl={languageMenuAnchor}\n                keepMounted\n                open={Boolean(languageMenuAnchor)}\n                onClose={handleLanguageMenuClose}\n            >\n                {localeMenuItems}\n            </Menu>\n\n            <Menu\n                anchorEl={baseMapMenuAnchor}\n                keepMounted\n                open={Boolean(baseMapMenuAnchor)}\n                onClose={handleBaseMapMenuClose}\n            >\n                {baseMapMenuItems}\n            </Menu>\n\n        </div>\n    );\n};\n\nexport default SettingsDialog;\n\nconst getOnOff = (state: boolean): string => {\n    return state ? i18n.get('On'):i18n.get('Off');\n};\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\nimport { changeLocale, closeDialog, openDialog, updateSettings } from '../actions/controlActions';\nimport SettingsDialog from '../components/SettingsDialog';\nimport { selectedServerSelector } from \"../selectors/controlSelectors\";\n\nimport { AppState } from '../states/appState';\nimport version from '../version';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        open: state.controlState.dialogOpen['settings'],\n        settings: state.controlState,\n        selectedServer: selectedServerSelector(state),\n        viewerVersion: version,\n        serverInfo: state.dataState.serverInfo,\n    };\n};\n\nconst mapDispatchToProps = {\n    closeDialog,\n    updateSettings,\n    changeLocale,\n    openDialog,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SettingsDialog);\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nconst version = '0.13.0-dev.2';\r\n\r\nexport default version;\r\n\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Button from '@mui/material/Button';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport makeStyles from '@mui/styles/makeStyles';\nimport TextField from '@mui/material/TextField';\nimport React, { ChangeEvent } from 'react';\nimport i18n from '../i18n';\nimport { ControlState } from '../states/controlState';\nimport SettingsPanel from './SettingsPanel';\nimport SettingsSubPanel from './SettingsSubPanel';\nimport ToggleSetting from './ToggleSetting';\n\nconst useStyles = makeStyles(theme => ({\n        separatorTextField: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            fontSize: theme.typography.fontSize / 2,\n            maxWidth: '6em',\n        },\n        fileNameTextField: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            fontSize: theme.typography.fontSize / 2\n        },\n    }\n));\n\ninterface ExportDialogProps {\n    open: boolean;\n    closeDialog: (dialogId: string) => any;\n    settings: ControlState;\n    updateSettings: (settings: Partial<ControlState>) => any;\n    downloadTimeSeries: () => any;\n}\n\nconst ExportDialog: React.FC<ExportDialogProps> = ({\n                                                       open,\n                                                       closeDialog,\n                                                       settings,\n                                                       updateSettings,\n                                                       downloadTimeSeries,\n                                                   }) => {\n    const classes = useStyles();\n\n    const handleCloseDialog = () => {\n        closeDialog('export');\n    }\n\n    function handleFileNameChange(event: ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) {\n        updateSettings({exportFileName: event.target.value});\n    }\n\n    function handleSeparatorChange(event: ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) {\n        updateSettings({exportTimeSeriesSeparator: event.target.value});\n    }\n\n    const handleDoExport = () => {\n        handleCloseDialog();\n        downloadTimeSeries();\n    }\n\n    return (\n        <div>\n            <Dialog\n                open={open}\n                fullWidth\n                maxWidth={'xs'}\n                onClose={handleCloseDialog}\n                scroll='body'\n            >\n                <DialogContent>\n                    <SettingsPanel title={i18n.get('Export Settings')}>\n                        <SettingsSubPanel\n                            label={i18n.get('Include time-series data') + ' (*.txt)'}\n                            value={getOnOff(settings.exportTimeSeries)}\n                        >\n                            <ToggleSetting\n                                propertyName={'exportTimeSeries'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel\n                            label={i18n.get('Separator for time-series data')}\n                        >\n                            <TextField\n                                variant=\"standard\"\n                                className={classes.separatorTextField}\n                                value={settings.exportTimeSeriesSeparator}\n                                onChange={handleSeparatorChange}\n                                disabled={!settings.exportTimeSeries}\n                                margin=\"normal\"\n                                size={'small'} />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel\n                            label={i18n.get('Include places data') + ' (*.geojson)'}\n                            value={getOnOff(settings.exportPlaces)}\n                        >\n                            <ToggleSetting\n                                propertyName={'exportPlaces'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel\n                            label={i18n.get('Combine place data in one file')}\n                            value={getOnOff(settings.exportPlacesAsCollection)}\n                        >\n                            <ToggleSetting\n                                propertyName={'exportPlacesAsCollection'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                                disabled={!settings.exportPlaces}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel\n                            label={i18n.get('As ZIP archive')}\n                            value={getOnOff(settings.exportZipArchive)}\n                        >\n                            <ToggleSetting\n                                propertyName={'exportZipArchive'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('File name')}>\n                            <TextField\n                                variant=\"standard\"\n                                className={classes.fileNameTextField}\n                                value={settings.exportFileName}\n                                onChange={handleFileNameChange}\n                                margin=\"normal\"\n                                size={'small'} />\n                        </SettingsSubPanel>\n                    </SettingsPanel>\n                </DialogContent>\n\n                <DialogActions>\n                    <Button\n                        onClick={handleDoExport}\n                        color={'primary'}\n                        disabled={!canDownload(settings)}\n                    >\n                        {i18n.get('Download')}\n                    </Button>\n                </DialogActions>\n\n            </Dialog>\n\n\n        </div>\n    );\n}\n\nexport default ExportDialog;\n\n\nconst getOnOff = (state: boolean): string => {\n    return state ? i18n.get('On') : i18n.get('Off');\n};\n\nconst isValidFileName = (fileName: string) => {\n    return /^[0-9a-zA-Z_-]+$/.test(fileName);\n}\n\nconst isValidSeparator = (separator: string) => {\n    return separator.toUpperCase() === 'TAB' || separator.length === 1;\n}\n\nconst canDownload = (settings: ControlState) => {\n    return (settings.exportTimeSeries || settings.exportPlaces)\n           && isValidFileName(settings.exportFileName)\n           && (!settings.exportTimeSeries || isValidSeparator(settings.exportTimeSeriesSeparator));\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport ExportDialog from '../components/ExportDialog';\nimport { closeDialog, updateSettings } from '../actions/controlActions';\nimport { exportData } from '../actions/dataActions';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        open: Boolean(state.controlState.dialogOpen['export']),\n        settings: state.controlState,\n    };\n};\n\nconst mapDispatchToProps = {\n    closeDialog,\n    updateSettings,\n    downloadTimeSeries: exportData,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ExportDialog);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from \"react\";\nimport Button from '@mui/material/Button';\n\n\ninterface FileUploadProps {\n    title: string;\n    accept?: string;\n    multiple?: boolean;\n    disabled?: boolean;\n    onSelect: (selection: File[]) => any;\n    className?: string;\n}\n\nexport const FileUpload: React.FC<FileUploadProps> = (\n    {\n        title,\n        accept,\n        multiple,\n        disabled,\n        onSelect,\n        className\n    }\n) => {\n    const fileInput = React.useRef<HTMLInputElement | null>(null)\n\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (e.target.files !== null && e.target.files.length) {\n            const files: File[] = [];\n            for (let i = 0; i < e.target.files.length; i++) {\n                files.push(e.target.files[i]);\n            }\n            onSelect(files);\n        }\n    }\n\n    const handleButtonClick = () => {\n        if (fileInput.current !== null) {\n            fileInput.current.click();\n        }\n    }\n\n    return (\n        <>\n            <input\n                type=\"file\"\n                accept={accept}\n                multiple={multiple}\n                ref={fileInput}\n                hidden\n                onChange={handleFileChange}\n                disabled={disabled}\n            />\n            <Button\n                onClick={handleButtonClick}\n                disabled={disabled}\n                className={className}\n                variant=\"outlined\"\n                size=\"small\"\n            >\n                {title}\n            </Button>\n        </>\n    );\n}","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport TextField from '@mui/material/TextField';\n\nimport i18n from '../../i18n';\nimport { GeoJsonOptions } from '../../model/user-place/geojson';\n\n\ninterface GeoJsonOptionsEditorProps {\n    options: GeoJsonOptions;\n    updateOptions: (options: Partial<GeoJsonOptions>) => any;\n    className: string;\n}\n\nconst GeoJsonOptionsEditor: React.FC<GeoJsonOptionsEditorProps> = (\n        {\n            options,\n            updateOptions,\n            className\n        }\n) => {\n    function handleLabelNamesChange(e: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) {\n        updateOptions({labelNames: e.target.value});\n    }\n\n    function handleFallbackNamePrefixChange(e: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) {\n        updateOptions({labelPrefix: e.target.value});\n    }\n\n    return (\n            <div className={className}>\n                <TextField\n                        label={i18n.get('Label property names')}\n                        value={options.labelNames}\n                        onChange={handleLabelNamesChange}\n                        size=\"small\"\n                        variant=\"standard\"\n                        style={{flexGrow: 1, marginRight: 10}}\n                />\n                <TextField\n                        label={i18n.get('Label prefix (used as fallback)')}\n                        value={options.labelPrefix}\n                        onChange={handleFallbackNamePrefixChange}\n                        size=\"small\"\n                        variant=\"standard\"\n                        style={{flexGrow: 1}}\n                />\n            </div>\n    );\n}\n\nexport default GeoJsonOptionsEditor;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport TextField from '@mui/material/TextField';\n\nimport i18n from '../../i18n';\nimport { CsvOptions } from '../../model/user-place/csv';\n\n\ninterface CsvOptionsEditorProps {\n    options: CsvOptions;\n    updateOptions: (options: Partial<CsvOptions>) => any;\n    optionName: keyof CsvOptions;\n    label: string;\n}\n\nconst CsvTextFieldEditor: React.FC<CsvOptionsEditorProps> = (\n    {\n        options,\n        updateOptions,\n        optionName,\n        label\n    }\n) => {\n    return (\n        <TextField\n            label={i18n.get(label)}\n            value={options[optionName]}\n            onChange={e => updateOptions({[optionName]: e.target.value})}\n            size=\"small\"\n            variant=\"standard\"\n        />\n    );\n}\n\nexport default CsvTextFieldEditor;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport Checkbox from \"@mui/material/Checkbox\";\n\nimport { CsvOptions } from '../../model/user-place/csv';\nimport CsvTextFieldEditor from \"./CsvTextFieldEditor\";\n\n\ninterface CsvOptionsEditorProps {\n    options: CsvOptions;\n    updateOptions: (options: Partial<CsvOptions>) => any;\n    className: string;\n}\n\nconst CsvOptionsEditor: React.FC<CsvOptionsEditorProps> = (\n    {\n        options,\n        updateOptions,\n        className\n    }\n) => {\n\n    return (\n        <div>\n            <div style={{display: \"grid\", gap: 12, paddingTop: 12, gridTemplateColumns: \"auto auto\"}}>\n                <CsvTextFieldEditor\n                    optionName={'xName'}\n                    label={'X/longitude column name'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'yName'}\n                    label={'Y/latitude column name'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <span>\n                    <Checkbox\n                        checked={options.forceGeometry}\n                        onChange={e => updateOptions({forceGeometry: e.target.checked})}\n                        size=\"small\"\n                    />\n                    <span>{'Use geometry column'}</span>\n                </span>\n                <CsvTextFieldEditor\n                    optionName={'geometryName'}\n                    label={'Geometry column name'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'labelName'}\n                    label={'Label column name'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'labelPrefix'}\n                    label={'Label prefix (used as fallback)'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n            </div>\n            <div style={{display: \"grid\", gap: 12, paddingTop: 12,\n                gridTemplateColumns: \"auto auto auto\"}}>\n                <CsvTextFieldEditor\n                    optionName={'separator'}\n                    label={'Separator character'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'comment'}\n                    label={'Comment character'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'quote'}\n                    label={'Quote character'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'escape'}\n                    label={'Escape character'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <div/>\n                <span>\n                    <Checkbox\n                        checked={options.trim}\n                        onChange={e => updateOptions({trim: e.target.checked})}\n                        size=\"small\"\n                    />\n                    <span>Remove whitespaces</span>\n                </span>\n                <CsvTextFieldEditor\n                    optionName={'nanToken'}\n                    label={'Not-a-number token'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'trueToken'}\n                    label={'True token'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'falseToken'}\n                    label={'False token'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n            </div>\n        </div>\n    );\n}\n\nexport default CsvOptionsEditor;","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport TextField from '@mui/material/TextField';\n\nimport { WktOptions } from '../../model/user-place/wkt';\nimport i18n from '../../i18n';\n\n\ninterface WktOptionsEditorProps {\n    options: WktOptions;\n    updateOptions: (options: Partial<WktOptions>) => any;\n    className: string;\n}\n\nconst WktOptionsEditor: React.FC<WktOptionsEditorProps> = (\n        {\n            options,\n            updateOptions,\n            className\n        }\n) => {\n    function handleLabelChange(e: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) {\n        updateOptions({label: e.target.value});\n    }\n\n    function handleLabelPrefixChange(e: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) {\n        updateOptions({labelPrefix: e.target.value});\n    }\n\n    return (\n            <div className={className}>\n                <TextField\n                        label={i18n.get('Label')}\n                        value={options.label}\n                        onChange={handleLabelChange}\n                        size=\"small\"\n                        variant=\"standard\"\n                        style={{flexGrow: 1, marginRight: 10}}\n                />\n                <TextField\n                        label={i18n.get('Label prefix (used as fallback)')}\n                        value={options.labelPrefix}\n                        onChange={handleLabelPrefixChange}\n                        size=\"small\"\n                        variant=\"standard\"\n                        style={{flexGrow: 1}}\n                />\n            </div>\n    );\n}\n\nexport default WktOptionsEditor;","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n\nexport interface Format {\n    name: string;\n    fileExt: string;\n    checkError: (text: string) => string | null;\n}\n\n\nconst WKT_GEOM_NAMES = [\n    \"Point\",\n    \"LineString\",\n    \"Polygon\",\n    \"MultiPoint\",\n    \"MultiLineString\",\n    \"MultiPolygon\",\n    \"GeometryCollection\",\n].map(k => k.toLowerCase());\n\n\nexport function detectFormatName(text: string): \"csv\" | \"geojson\" | \"wkt\" {\n    text = text.trim();\n    if (text === \"\") {\n        return \"csv\";\n    }\n\n    if (text[0] === \"{\") {\n        return \"geojson\";\n    }\n\n    const marker = text.substr(0, 20).toLowerCase();\n    const geomName = WKT_GEOM_NAMES.find(\n        geomName => marker.startsWith(geomName)\n            && (marker.length === geomName.length\n                || \"\\n\\t (\".indexOf(marker[geomName.length]) >= 0)\n    );\n    if (geomName) {\n        return \"wkt\";\n    }\n\n    return \"csv\";\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport makeStyles from '@mui/styles/makeStyles';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport Box from '@mui/material/Box';\nimport Dialog from '@mui/material/Dialog';\nimport Button from '@mui/material/Button';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport Radio from '@mui/material/Radio';\nimport RadioGroup from '@mui/material/RadioGroup';\nimport Collapse from '@mui/material/Collapse';\nimport Typography from '@mui/material/Typography';\nimport FormControlLabel from '@mui/material/FormControlLabel';\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\nimport ExpandLessIcon from '@mui/icons-material/ExpandLess';\nimport CodeMirror from '@uiw/react-codemirror';\nimport { Extension } from '@codemirror/state';\nimport { json } from '@codemirror/lang-json';\n\nimport { WithLocale } from '../util/lang';\nimport i18n from '../i18n';\nimport { Config } from '../config';\nimport { FileUpload } from './FileUpload';\nimport { ControlState, MapInteraction, UserPlacesFormatName, UserPlacesFormatOptions } from '../states/controlState';\nimport GeoJsonOptionsEditor from './user-place/GeoJsonOptionsEditor';\nimport CsvOptionsEditor from './user-place/CsvOptionsEditor';\nimport WktOptionsEditor from './user-place/WktOptionsEditor';\nimport { csvFormat, CsvOptions } from '../model/user-place/csv';\nimport { geoJsonFormat, GeoJsonOptions } from '../model/user-place/geojson';\nimport { wktFormat, WktOptions } from '../model/user-place/wkt';\nimport { detectFormatName, Format } from '../model/user-place/common';\n\n\ninterface FormatWithCodeExt extends Format {\n    codeExt: Extension[];\n}\n\nconst formats: { [k: string]: FormatWithCodeExt } = {\n    csv: {...csvFormat, codeExt: []},\n    geojson: {...geoJsonFormat, codeExt: [json()]},\n    wkt: {...wktFormat, codeExt: []}\n};\n\n\n// noinspection JSUnusedLocalSymbols\nconst useStyles = makeStyles(theme => (\n    {\n        spacer: {\n            flexGrow: 1.0,\n        },\n        actionBox: {\n            paddingTop: theme.spacing(0.5),\n            display: 'flex',\n            flexDirection: 'row',\n            alignItems: 'center',\n        },\n        actionButton: {\n            marginRight: theme.spacing(1),\n        },\n        error: {\n            fontSize: 'small'\n        }\n    }\n));\n\ninterface UserPlacesDialogProps extends WithLocale {\n    open: boolean;\n    closeDialog: (dialogId: string) => void;\n    userPlacesFormatName: UserPlacesFormatName,\n    userPlacesFormatOptions: UserPlacesFormatOptions;\n    updateSettings: (settings: Partial<ControlState>) => void;\n    addUserPlacesFromText: (userPlacesText: string) => void;\n    nextMapInteraction: MapInteraction;\n    setMapInteraction: (mapInteraction: MapInteraction) => any;\n}\n\nconst UserPlacesDialog: React.FC<UserPlacesDialogProps> = (\n    {\n        open,\n        closeDialog,\n        userPlacesFormatName,\n        userPlacesFormatOptions,\n        updateSettings,\n        addUserPlacesFromText,\n        nextMapInteraction,\n        setMapInteraction\n    }) => {\n\n    const [text, setText] = React.useState('');\n    const [error, setError] = React.useState<string | null>(null);\n    const [loading, setLoading] = React.useState(false);\n    const [expanded, setExpanded] = React.useState(false);\n    const [_userPlacesFormatName, setUserPlacesFormatName] = React.useState(userPlacesFormatName);\n    const [_userPlacesFormatOptions, setUserPlacesFormatOptions] = React.useState(userPlacesFormatOptions);\n    const classes = useStyles();\n\n    React.useEffect(() => {\n        setUserPlacesFormatName(userPlacesFormatName);\n    }, [userPlacesFormatName]);\n\n    React.useEffect(() => {\n        setUserPlacesFormatOptions(userPlacesFormatOptions);\n    }, [userPlacesFormatOptions]);\n\n    if (!open) {\n        return null;\n    }\n\n    const handleConfirm = () => {\n        setMapInteraction('Select');\n        closeDialog('addUserPlacesFromText');\n        updateSettings({\n            userPlacesFormatName: _userPlacesFormatName,\n            userPlacesFormatOptions: _userPlacesFormatOptions,\n        });\n        addUserPlacesFromText(text);\n    };\n\n    const handleClose = () => {\n        setMapInteraction(nextMapInteraction);\n        closeDialog('addUserPlacesFromText');\n    };\n\n    const handleClearText = () => {\n        setText('');\n    };\n\n    const handleFileSelect = (selection: File[]) => {\n        const file = selection[0];\n        setLoading(true);\n        const reader = new FileReader();\n        reader.onloadend = () => {\n            const text = reader.result as string;\n            setUserPlacesFormatName(detectFormatName(text));\n            setText(text);\n            setLoading(false);\n        };\n        reader.onabort = reader.onerror = () => {\n            setLoading(false);\n        };\n        reader.readAsText(file, 'UTF-8');\n    };\n\n    const handleCodeDrop = () => {\n        setText('');\n    };\n\n    const handleCodePaste = () => {\n        console.info(\"PASTE!\", text);\n    };\n\n    const handleCodeChange = (value: string) => {\n        let formatName = _userPlacesFormatName;\n        if (text === \"\" && value.length > 10) {\n            // Pasted some text\n            formatName = detectFormatName(value);\n            setUserPlacesFormatName(formatName);\n        }\n        setText(value);\n        setError(formats[formatName].checkError(value));\n    };\n\n    function handleFormatNameChange(e: React.ChangeEvent<HTMLInputElement>) {\n        setUserPlacesFormatName(e.target.value as UserPlacesFormatName);\n    }\n\n    function updateCsvOptions(options: Partial<CsvOptions>) {\n        setUserPlacesFormatOptions({\n            ..._userPlacesFormatOptions,\n            csv: {\n                ..._userPlacesFormatOptions.csv,\n                ...options\n            }\n        });\n    }\n\n    function updateGeoJsonOptions(options: Partial<GeoJsonOptions>) {\n        setUserPlacesFormatOptions({\n            ..._userPlacesFormatOptions,\n            geojson: {\n                ..._userPlacesFormatOptions.geojson,\n                ...options\n            }\n        });\n    }\n\n    function updateWktOptions(options: Partial<WktOptions>) {\n        setUserPlacesFormatOptions({\n            ..._userPlacesFormatOptions,\n            wkt: {\n                ..._userPlacesFormatOptions.wkt,\n                ...options\n            }\n        });\n    }\n\n    let formatOptionsEditor;\n    if (_userPlacesFormatName === 'csv') {\n        formatOptionsEditor = (\n            <CsvOptionsEditor\n                options={_userPlacesFormatOptions.csv}\n                updateOptions={updateCsvOptions}\n                className={classes.actionBox}\n            />\n        );\n    } else if (_userPlacesFormatName === 'geojson') {\n        formatOptionsEditor = (\n            <GeoJsonOptionsEditor\n                options={_userPlacesFormatOptions.geojson}\n                updateOptions={updateGeoJsonOptions}\n                className={classes.actionBox}\n            />\n        );\n    } else {\n        formatOptionsEditor = (\n            <WktOptionsEditor\n                options={_userPlacesFormatOptions.wkt}\n                updateOptions={updateWktOptions}\n                className={classes.actionBox}\n            />\n        );\n    }\n\n    return (\n        <Dialog\n            fullWidth\n            open={open}\n            onClose={handleClose}\n            aria-labelledby=\"server-dialog-title\"\n        >\n            <DialogTitle id=\"server-dialog-title\">{i18n.get('Add Places')}</DialogTitle>\n            <DialogContent dividers>\n                <RadioGroup\n                    row\n                    value={_userPlacesFormatName}\n                    onChange={e => handleFormatNameChange(e)}\n                >\n                    <FormControlLabel\n                        key={'csv'}\n                        value={'csv'}\n                        label={i18n.get(csvFormat.name)}\n                        control={<Radio/>}\n                    />\n                    <FormControlLabel\n                        key={'geojson'}\n                        value={'geojson'}\n                        label={i18n.get(geoJsonFormat.name)}\n                        control={<Radio/>}\n                    />\n                    <FormControlLabel\n                        key={'wkt'}\n                        value={'wkt'}\n                        label={i18n.get(wktFormat.name)}\n                        control={<Radio/>}\n                    />\n                </RadioGroup>\n                <CodeMirror\n                    theme={Config.instance.branding.themeName || 'light'}\n                    placeholder={i18n.get('Enter text or drag & drop a text file.')}\n                    autoFocus\n                    height=\"400px\"\n                    extensions={formats[_userPlacesFormatName].codeExt}\n                    value={text}\n                    onChange={handleCodeChange}\n                    onDrop={handleCodeDrop}\n                    onPaste={handleCodePaste}\n                    onPasteCapture={handleCodePaste}\n                />\n                {error && <Typography color=\"error\" className={classes.error}>{error}</Typography>}\n                <div className={classes.actionBox}>\n                    <FileUpload\n                        title={i18n.get('From File') + '...'}\n                        accept={formats[_userPlacesFormatName].fileExt}\n                        multiple={false}\n                        onSelect={handleFileSelect}\n                        disabled={loading}\n                        className={classes.actionButton}\n                    />\n                    <Button\n                        onClick={handleClearText}\n                        disabled={text.trim() === '' || loading}\n                        className={classes.actionButton}\n                        variant=\"outlined\"\n                        size=\"small\"\n                    >\n                        {i18n.get('Clear')}\n                    </Button>\n                    <Box className={classes.spacer}/>\n                    <Button\n                        onClick={() => setExpanded(!expanded)}\n                        endIcon={expanded ? <ExpandLessIcon/>:<ExpandMoreIcon/>}\n                        variant=\"outlined\"\n                        size=\"small\"\n                    >\n                        {i18n.get('Options')}\n                    </Button>\n                </div>\n                <Collapse in={expanded} timeout=\"auto\" unmountOnExit>\n                    {formatOptionsEditor}\n                </Collapse>\n            </DialogContent>\n            <DialogActions>\n                <Button\n                    onClick={handleClose}\n                    variant=\"text\"\n                >\n                    {i18n.get('Cancel')}\n                </Button>\n                <Button\n                    onClick={handleConfirm}\n                    disabled={text.trim() === '' || error !== null || loading}\n                    color=\"primary\"\n                    variant=\"text\"\n                >\n                    {i18n.get('OK')}\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n}\n\n\nexport default UserPlacesDialog;\n","import { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport UserPlacesDialog from '../components/UserPlacesDialog';\nimport { closeDialog, updateSettings, setMapInteraction } from '../actions/controlActions';\nimport { addUserPlacesFromText } from '../actions/dataActions';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        open: !!state.controlState.dialogOpen['addUserPlacesFromText'],\n        userPlacesFormatName: state.controlState.userPlacesFormatName,\n        userPlacesFormatOptions: state.controlState.userPlacesFormatOptions,\n        nextMapInteraction: state.controlState.lastMapInteraction,\n    };\n};\n\nconst mapDispatchToProps = {\n    closeDialog,\n    updateSettings,\n    setMapInteraction,\n    addUserPlacesFromText,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(UserPlacesDialog);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { adaptV4Theme, createTheme, CssBaseline, StyledEngineProvider, ThemeProvider, } from '@mui/material';\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { Config } from '../config';\n\nimport { AppState } from '../states/appState';\nimport AppBar from './AppBar';\nimport AppPane from './AppPane';\nimport LegalAgreementDialog from './LegalAgreementDialog';\nimport LoadingDialog from './LoadingDialog';\nimport MessageLog from './MessageLog';\nimport AuthWrapper from \"../components/AuthWrapper\";\nimport ServerDialog from \"./ServerDialog\";\nimport SettingsDialog from \"./SettingsDialog\";\nimport ExportDialog from \"./ExportDialog\";\nimport AddPlaceDialog from \"./UserPlacesDialog\";\n\n\ninterface AppProps {\n    compact: boolean;\n}\n\n// noinspection JSUnusedLocalSymbols\nconst mapStateToProps = (state: AppState) => {\n    return {\n        compact: Config.instance.branding.compact\n    };\n};\n\nconst mapDispatchToProps = {};\n\nconst newTheme = () => createTheme(\n    adaptV4Theme({\n        typography: {\n            fontSize: 12,\n            htmlFontSize: 14,\n        },\n        palette: {\n            mode: Config.instance.branding.themeName,\n            primary: Config.instance.branding.primaryColor,\n            secondary: Config.instance.branding.secondaryColor,\n        },\n    }));\n\nconst App: React.FC<AppProps> = ({compact}) => {\n    return (\n        <AuthWrapper>\n            <StyledEngineProvider injectFirst>\n                <ThemeProvider theme={newTheme()}>\n                    <CssBaseline/>\n                    {!compact && <AppBar/>}\n                    <AppPane/>\n                    <>\n                        <LoadingDialog/>\n                        <ServerDialog/>\n                        <SettingsDialog/>\n                        <ExportDialog/>\n                        <AddPlaceDialog/>\n                        <LegalAgreementDialog/>\n                        <MessageLog/>\n                    </>\n                </ThemeProvider>\n            </StyledEngineProvider>\n        </AuthWrapper>\n    );\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Config } from '../config';\nimport i18n from '../i18n';\nimport { ApiServerConfig, ApiServerInfo } from \"../model/apiServer\";\nimport { ColorBars } from '../model/colorBar';\nimport { Dataset } from '../model/dataset';\nimport { Place, PlaceGroup, } from '../model/place';\nimport { TimeSeriesGroup } from '../model/timeSeries';\nimport { loadUserServers } from './userSettings';\n\nexport interface DataState {\n    serverInfo: ApiServerInfo | null;\n    datasets: Dataset[];\n    colorBars: ColorBars | null;\n    timeSeriesGroups: TimeSeriesGroup[];\n    userPlaceGroup: PlaceGroup;\n    userServers: ApiServerConfig[];\n}\n\nexport function newDataState(): DataState {\n    const extraUserServers = loadUserServers();\n    const userServers = [\n        {...Config.instance.server},\n    ];\n    extraUserServers.forEach(extraUserServer => {\n        if (!userServers.find(userServer => userServer.id === extraUserServer.id)) {\n            userServers.push(extraUserServer);\n        }\n    });\n    return {\n        serverInfo: null,\n        datasets: [],\n        colorBars: null,\n        timeSeriesGroups: [],\n        userPlaceGroup: {\n            id: 'user',\n            title: i18n.get('My places'),\n            type: \"FeatureCollection\",\n            features: [] as Array<Place>\n        },\n        userServers,\n    };\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { default as OlVectorLayer } from 'ol/layer/Vector';\nimport { default as OlGeoJSONFormat } from 'ol/format/GeoJSON';\n\nimport { DataState, newDataState } from '../states/dataState';\nimport { storeUserServers } from '../states/userSettings';\nimport {\n    DataAction,\n    ADD_USER_PLACE,\n    ADD_USER_PLACES,\n    CONFIGURE_SERVERS,\n    REMOVE_ALL_TIME_SERIES,\n    REMOVE_TIME_SERIES_GROUP,\n    UPDATE_COLOR_BARS,\n    UPDATE_DATASET_PLACE_GROUP,\n    UPDATE_DATASETS,\n    UPDATE_TIME_SERIES,\n    REMOVE_USER_PLACE,\n    REMOVE_ALL_USER_PLACES,\n    UPDATE_SERVER_INFO,\n    UPDATE_VARIABLE_COLOR_BAR,\n    UPDATE_VARIABLE_VOLUME\n} from '../actions/dataActions';\nimport { MAP_OBJECTS } from '../states/controlState';\nimport { newId } from '../util/id';\nimport { Variable } from \"../model/variable\";\nimport { Place } from '../model/place';\nimport { TimeSeries, TimeSeriesGroup } from '../model/timeSeries';\nimport { setFeatureStyle } from \"../components/ol/style\";\nimport { Config } from \"../config\";\n\n\nexport function dataReducer(state: DataState | undefined, action: DataAction): DataState {\n    if (state === undefined) {\n        state = newDataState();\n    }\n    switch (action.type) {\n        case UPDATE_SERVER_INFO: {\n            return {...state, serverInfo: action.serverInfo};\n        }\n        case UPDATE_DATASETS: {\n            return {...state, datasets: action.datasets};\n        }\n        case UPDATE_VARIABLE_COLOR_BAR: {\n            const {datasetId, variableName, colorBarMinMax, colorBarName, opacity} = action;\n            const variableProps = {\n                colorBarMin: colorBarMinMax[0],\n                colorBarMax: colorBarMinMax[1],\n                colorBarName,\n                opacity,\n            };\n            return updateVariableProps(state, datasetId, variableName, variableProps);\n        }\n        case UPDATE_VARIABLE_VOLUME: {\n            const {datasetId, variableName, volumeRenderMode, volumeIsoThreshold} = action;\n            const variableProps = {\n                volumeRenderMode,\n                volumeIsoThreshold,\n            };\n            return updateVariableProps(state, datasetId, variableName, variableProps);\n        }\n        case UPDATE_DATASET_PLACE_GROUP: {\n            // Issue #208:\n            // We no longer set individual dataset place groups.\n            // That's why action.datasetId is no longer used here.\n            // Instead, we update all datasets that refer to the\n            // place group with the given ID.\n            const placeGroup = action.placeGroup;\n            const datasets = state.datasets.map(dataset => {\n                if (dataset.placeGroups) {\n                    const placeGroupIndex = dataset.placeGroups.findIndex(pg => pg.id === placeGroup.id);\n                    if (placeGroupIndex >= 0) {\n                        const placeGroups = [...dataset.placeGroups];\n                        placeGroups[placeGroupIndex] = placeGroup;\n                        return {...dataset, placeGroups};\n                    }\n                }\n                return dataset;\n            });\n            return {...state, datasets};\n        }\n        case ADD_USER_PLACE: {\n            const {id, label, color, geometry} = action;\n            const place: Place = {\n                type: 'Feature',\n                id,\n                geometry,\n                properties: {label, color},\n            };\n            const features = [...state.userPlaceGroup.features, place];\n            const userPlaceGroup = {...state.userPlaceGroup, features};\n            return {\n                ...state,\n                userPlaceGroup,\n            };\n        }\n        case ADD_USER_PLACES: {\n            const {places, mapProjection} = action;\n            places.forEach(place => addUserPlaceToLayer(place, mapProjection));\n            const features = [...state.userPlaceGroup.features, ...places];\n            const userPlaceGroup = {...state.userPlaceGroup, features};\n            return {\n                ...state,\n                userPlaceGroup,\n            };\n        }\n        case REMOVE_USER_PLACE: {\n            const {id} = action;\n            const index = state.userPlaceGroup.features.findIndex(p => p.id === id);\n            if (index >= 0) {\n                removeUserPlacesFromLayer([id]);\n                const features = [...state.userPlaceGroup.features];\n                features.splice(index, 1);\n                const userPlaceGroup = {...state.userPlaceGroup, features};\n                const timeSeriesArray = getTimeSeriesArray(state.timeSeriesGroups, [id]);\n                let timeSeriesGroups = state.timeSeriesGroups;\n                timeSeriesArray.forEach(ts => {\n                    timeSeriesGroups = updateTimeSeriesGroups(timeSeriesGroups,\n                        ts, 'remove', 'append');\n                });\n                return {\n                    ...state,\n                    userPlaceGroup,\n                    timeSeriesGroups\n                };\n            }\n            return state;\n        }\n        case REMOVE_ALL_USER_PLACES: {\n            const userPlaces = state.userPlaceGroup.features as Place[];\n            const userPlaceIds = userPlaces.map(p => p.id);\n            removeUserPlacesFromLayer(userPlaceIds);\n            const userPlaceGroup = {...state.userPlaceGroup, features: []};\n            const timeSeriesArray = getTimeSeriesArray(state.timeSeriesGroups, userPlaceIds);\n            let timeSeriesGroups = state.timeSeriesGroups;\n            timeSeriesArray.forEach(ts => {\n                timeSeriesGroups = updateTimeSeriesGroups(timeSeriesGroups,\n                    ts, 'remove', 'append');\n            });\n            return {\n                ...state,\n                userPlaceGroup,\n                timeSeriesGroups,\n            };\n        }\n        case UPDATE_COLOR_BARS: {\n            return {...state, colorBars: action.colorBars};\n        }\n        case UPDATE_TIME_SERIES: {\n            const {timeSeries, updateMode, dataMode} = action;\n            const timeSeriesGroups = updateTimeSeriesGroups(state.timeSeriesGroups,\n                timeSeries, updateMode, dataMode);\n            if (timeSeriesGroups !== state.timeSeriesGroups) {\n                return {...state, timeSeriesGroups};\n            }\n            return state;\n        }\n        case REMOVE_TIME_SERIES_GROUP: {\n            let tsgIndex = state.timeSeriesGroups.findIndex(tsg => tsg.id === action.id);\n            if (tsgIndex >= 0) {\n                const timeSeriesGroups = [...state.timeSeriesGroups];\n                timeSeriesGroups.splice(tsgIndex, 1);\n                return {...state, timeSeriesGroups};\n            }\n            return state;\n        }\n        case REMOVE_ALL_TIME_SERIES: {\n            return {...state, timeSeriesGroups: []};\n        }\n        case CONFIGURE_SERVERS: {\n            if (state.userServers !== action.servers) {\n                storeUserServers(action.servers);\n                return {...state, userServers: action.servers};\n            }\n            return state;\n        }\n    }\n\n    return state!;\n}\n\nfunction addUserPlaceToLayer(place: Place, mapProjection: string) {\n    if (MAP_OBJECTS.userLayer) {\n        const userLayer = MAP_OBJECTS.userLayer as OlVectorLayer;\n        const source = userLayer.getSource();\n        const feature = new OlGeoJSONFormat().readFeature(place,\n            {\n                dataProjection: 'EPSG:4326',\n                featureProjection: mapProjection\n            });\n        const color = (place.properties || {}).color || 'red';\n        setFeatureStyle(feature, color, Config.instance.branding.polygonFillOpacity);\n        source.addFeature(feature);\n        userLayer.changed();\n    }\n}\n\nfunction removeUserPlacesFromLayer(userPlaceIds: string[]) {\n    if (MAP_OBJECTS.userLayer) {\n        const userLayer = MAP_OBJECTS.userLayer as OlVectorLayer;\n        const source = userLayer.getSource();\n        userPlaceIds.forEach(placeId => {\n            const feature = source.getFeatureById(placeId);\n            if (feature) {\n                source.removeFeature(feature);\n            }\n        });\n    }\n}\n\nfunction updateVariableProps(state: DataState,\n                             datasetId: string,\n                             variableName: string,\n                             variableProps: Partial<Variable>) {\n    const datasetIndex = state.datasets.findIndex(ds => ds.id === datasetId);\n    if (datasetIndex >= 0) {\n        let dataset = state.datasets[datasetIndex];\n        const variableIndex = dataset.variables.findIndex(v => v.name === variableName);\n        if (variableIndex >= 0) {\n            let variable = dataset.variables[variableIndex];\n            let datasets = state.datasets.slice();\n            let variables = dataset.variables.slice();\n            variables[variableIndex] = {...variable, ...variableProps};\n            datasets[datasetIndex] = {...dataset, variables};\n            return {...state, datasets};\n        }\n    }\n    return state;\n}\n\nfunction updateTimeSeriesGroups(timeSeriesGroups: TimeSeriesGroup[],\n                                timeSeries: TimeSeries,\n                                updateMode: 'add' | 'replace' | 'remove',\n                                dataMode: 'append' | 'new'): TimeSeriesGroup[] {\n    let currentTimeSeries = timeSeries;\n\n    let newTimeSeriesGroups;\n    const tsgIndex = timeSeriesGroups.findIndex(tsg => tsg.variableUnits === currentTimeSeries.source.variableUnits);\n    if (tsgIndex >= 0) {\n        const timeSeriesGroup = timeSeriesGroups[tsgIndex];\n        const timeSeriesArray = timeSeriesGroup.timeSeriesArray;\n        const tsIndex = timeSeriesArray.findIndex(ts => ts.source.datasetId === currentTimeSeries.source.datasetId\n            && ts.source.variableName === currentTimeSeries.source.variableName\n            && ts.source.placeId === currentTimeSeries.source.placeId);\n        let newTimeSeriesArray;\n        if (tsIndex >= 0) {\n            const oldTimeSeries = timeSeriesArray[tsIndex];\n            if (dataMode === 'append') {\n                currentTimeSeries = {\n                    ...currentTimeSeries,\n                    data: [...currentTimeSeries.data, ...oldTimeSeries.data]\n                };\n            }\n            if (updateMode === 'replace') {\n                newTimeSeriesArray = [currentTimeSeries];\n            } else if (updateMode === 'add') {\n                newTimeSeriesArray = timeSeriesArray.slice();\n                newTimeSeriesArray[tsIndex] = currentTimeSeries;\n            } else /*if (action.updateMode === 'remove')*/ {\n                newTimeSeriesArray = timeSeriesArray.slice();\n                newTimeSeriesArray.splice(tsIndex, 1);\n            }\n        } else {\n            if (updateMode === 'replace') {\n                newTimeSeriesArray = [currentTimeSeries];\n            } else if (updateMode === 'add') {\n                newTimeSeriesArray = [currentTimeSeries, ...timeSeriesArray];\n            } else /*if (action.updateMode === 'remove')*/ {\n                // Nothing to do here.\n                newTimeSeriesArray = timeSeriesArray;\n            }\n        }\n        if (updateMode === 'replace') {\n            newTimeSeriesGroups = [{...timeSeriesGroup, timeSeriesArray: newTimeSeriesArray}];\n        } else if (updateMode === 'add') {\n            newTimeSeriesGroups = timeSeriesGroups.slice();\n            newTimeSeriesGroups[tsgIndex] = {...timeSeriesGroup, timeSeriesArray: newTimeSeriesArray};\n        } else /*if (action.updateMode === 'remove')*/ {\n            if (newTimeSeriesArray.length >= 0) {\n                newTimeSeriesGroups = timeSeriesGroups.slice();\n                newTimeSeriesGroups[tsgIndex] = {...timeSeriesGroup, timeSeriesArray: newTimeSeriesArray};\n            } else {\n                newTimeSeriesGroups = timeSeriesGroups.slice();\n                newTimeSeriesGroups.splice(tsgIndex, 1)\n            }\n        }\n    } else {\n        if (updateMode === 'replace') {\n            const newTimeSeriesGroup = {\n                id: newId(),\n                variableUnits: currentTimeSeries.source.variableUnits,\n                timeSeriesArray: [currentTimeSeries],\n            };\n            newTimeSeriesGroups = [newTimeSeriesGroup];\n        } else if (updateMode === 'add') {\n            const newTimeSeriesGroup = {\n                id: newId(),\n                variableUnits: currentTimeSeries.source.variableUnits,\n                timeSeriesArray: [currentTimeSeries],\n            };\n            newTimeSeriesGroups = [newTimeSeriesGroup, ...timeSeriesGroups];\n        } else /*if (action.updateMode === 'remove')*/ {\n            // Nothing to do here.\n            newTimeSeriesGroups = timeSeriesGroups;\n        }\n    }\n\n    return newTimeSeriesGroups;\n}\n\n\nfunction getTimeSeriesArray(timeSeriesGroups: TimeSeriesGroup[], placeIds: string[]): TimeSeries[] {\n    const timeSeriesArray: TimeSeries[] = [];\n    timeSeriesGroups.forEach(tsg => {\n        tsg.timeSeriesArray.forEach(ts => {\n            placeIds.forEach(placeId => {\n                if (ts.source.placeId === placeId) {\n                    timeSeriesArray.push(ts);\n                }\n            });\n        })\n    });\n    return timeSeriesArray;\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { default as OlSimpleGeometry } from 'ol/geom/SimpleGeometry';\nimport { default as OlMap } from 'ol/Map';\nimport { transformExtent as olProjTransformExtent } from 'ol/proj';\nimport {\n    ADD_ACTIVITY,\n    CHANGE_LOCALE,\n    CLOSE_DIALOG,\n    ControlAction,\n    FLY_TO,\n    INC_SELECTED_TIME,\n    OPEN_DIALOG,\n    REMOVE_ACTIVITY,\n    SELECT_DATASET,\n    SELECT_PLACE,\n    SELECT_PLACE_GROUPS,\n    SELECT_TIME,\n    SELECT_TIME_RANGE,\n    SELECT_TIME_SERIES_UPDATE_MODE,\n    SELECT_VARIABLE,\n    SET_MAP_INTERACTION,\n    SET_RGB_LAYER_VISIBILITY,\n    SET_VISIBLE_INFO_CARD_ELEMENTS,\n    SET_VOLUME_RENDER_MODE,\n    SHOW_INFO_CARD,\n    SHOW_VOLUME_CARD,\n    UPDATE_INFO_CARD_ELEMENT_VIEW_MODE,\n    UPDATE_SETTINGS,\n    UPDATE_TIME_ANIMATION, UPDATE_VOLUME_STATE,\n} from '../actions/controlActions';\nimport {\n    ADD_USER_PLACE,\n    ADD_USER_PLACES,\n    CONFIGURE_SERVERS,\n    DataAction,\n    REMOVE_USER_PLACE,\n    UPDATE_DATASETS\n} from '../actions/dataActions';\nimport i18n from '../i18n';\n\nimport { findDataset, findDatasetVariable, getDatasetTimeRange } from '../model/dataset';\nimport { selectedTimeIndexSelector, timeCoordinatesSelector } from '../selectors/controlSelectors';\nimport { AppState } from '../states/appState';\nimport { ControlState, MAP_OBJECTS, newControlState } from '../states/controlState';\nimport { storeUserSettings } from '../states/userSettings';\nimport { findIndexCloseTo } from '../util/find';\nimport { GEOGRAPHIC_CRS } from \"../model/proj\";\nimport { appParams } from \"../config\";\n\n// TODO (forman): Refactor reducers for UPDATE_DATASETS, SELECT_DATASET, SELECT_PLACE, SELECT_VARIABLE\n//                so they produce a consistent state. E.g. on selected dataset change, ensure selected\n//                places and variables are still valid. Write tests for that.\n//                We currently still receiving error logs from Material-UI, e.g.:\n//                  SelectInput.js:304 Material-UI: you have provided an out-of-range value `local`\n//                  for the select (name=\"dataset\") component.\n//                  Consider providing a value that matches one of the available options or ''.\n//                  The available values are \"\".\n\nexport function controlReducer(state: ControlState | undefined,\n                               action: ControlAction | DataAction,\n                               appState: AppState | undefined): ControlState {\n    if (state === undefined) {\n        state = newControlState();\n    }\n    switch (action.type) {\n        case UPDATE_SETTINGS: {\n            const settings = {...state, ...action.settings};\n            storeUserSettings(settings);\n            return settings;\n        }\n        case UPDATE_DATASETS: {\n            let selectedDatasetId = state!.selectedDatasetId || appParams.get(\"dataset\");\n            let selectedVariableName = state!.selectedVariableName || appParams.get(\"variable\");\n            let mapInteraction = state!.mapInteraction;\n            let selectedDataset = findDataset(action.datasets, selectedDatasetId);\n            const selectedVariable = (selectedDataset\n                    && findDatasetVariable(selectedDataset, selectedVariableName))\n                || null;\n            if (selectedDataset) {\n                if (!selectedVariable) {\n                    selectedVariableName = selectedDataset.variables.length ? selectedDataset.variables[0].name : null;\n                }\n            } else {\n                selectedDatasetId = null;\n                selectedVariableName = null;\n                selectedDataset = action.datasets.length ? action.datasets[0] : null;\n                if (selectedDataset) {\n                    selectedDatasetId = selectedDataset.id;\n                    if (selectedDataset.variables.length > 0) {\n                        selectedVariableName = selectedDataset.variables[0].name;\n                    }\n                }\n            }\n            if (!selectedDatasetId) {\n                mapInteraction = 'Select';\n            }\n            return {...state, selectedDatasetId, selectedVariableName, mapInteraction};\n        }\n        case SELECT_DATASET: {\n            let selectedVariableName = state.selectedVariableName;\n            const selectedDataset = findDataset(action.datasets, action.selectedDatasetId)!;\n            const selectedVariable = findDatasetVariable(selectedDataset, selectedVariableName);\n            if (!selectedVariable && selectedDataset.variables.length > 0) {\n                selectedVariableName = selectedDataset.variables[0].name;\n            }\n            const selectedDatasetId = action.selectedDatasetId;\n            const selectedTimeRange = getDatasetTimeRange(selectedDataset);\n            const selectedTime = selectedTimeRange ? selectedTimeRange[1] : null;\n            return {\n                ...state,\n                selectedDatasetId,\n                selectedVariableName,\n                selectedTimeRange,\n                selectedTime,\n            };\n        }\n        case FLY_TO: {\n            const mapObject = MAP_OBJECTS[action.mapId];\n            const flyToCurr = action.location;\n            if (mapObject instanceof OlMap && flyToCurr !== null) {\n                const map = mapObject;\n                const projection = map.getView().getProjection();\n                let flyToTarget;\n                // noinspection JSDeprecatedSymbols\n                if (Array.isArray(flyToCurr)) {\n                    // Fly to extent (bounding box)\n                    flyToTarget = olProjTransformExtent(flyToCurr, GEOGRAPHIC_CRS, projection);\n                    map.getView().fit(flyToTarget, {size: map.getSize()});\n                } else {\n                    // Transform Geometry object\n                    flyToTarget = flyToCurr.transform(GEOGRAPHIC_CRS, projection) as OlSimpleGeometry;\n                    if (flyToTarget.getType() === 'Point') {\n                        // Points don't fly. Just reset map center. Not ideal, but better than zooming in too deep (see #54)\n                        map.getView().setCenter(flyToTarget.getFirstCoordinate());\n                    } else {\n                        // Fly to shape\n                        map.getView().fit(flyToTarget, {size: map.getSize()});\n                    }\n                }\n            }\n            if (state.flyTo !== action.location) {\n                return {\n                    ...state,\n                    flyTo: action.location,\n                };\n            }\n            return state;\n        }\n        case SELECT_PLACE_GROUPS: {\n            const selectedPlaceGroupIds = action.selectedPlaceGroupIds;\n            const selectedPlaceId = null;\n            return {\n                ...state,\n                selectedPlaceGroupIds,\n                selectedPlaceId,\n            };\n        }\n        case SELECT_PLACE: {\n            const selectedPlaceId = action.selectedPlaceId;\n            return {\n                ...state,\n                selectedPlaceId,\n            };\n        }\n        case SELECT_VARIABLE: {\n            return {\n                ...state,\n                selectedVariableName: action.selectedVariableName,\n            };\n        }\n        case SET_RGB_LAYER_VISIBILITY: {\n            return {\n                ...state,\n                showRgbLayer: action.showRgbLayer,\n            };\n        }\n        case SELECT_TIME: {\n            let {selectedTime} = action;\n            if (selectedTime !== null && appState) {\n                const timeCoordinates = timeCoordinatesSelector(appState)!;\n                const index = timeCoordinates ? findIndexCloseTo(timeCoordinates, selectedTime) : -1;\n                if (index >= 0) {\n                    selectedTime = timeCoordinates[index];\n                }\n            }\n            if (state.selectedTime !== selectedTime) {\n                return {\n                    ...state,\n                    selectedTime,\n                };\n            }\n            return state;\n        }\n        case INC_SELECTED_TIME: {\n            if (appState) {\n                let index = selectedTimeIndexSelector(appState);\n                if (index >= 0) {\n                    const timeCoordinates = timeCoordinatesSelector(appState)!;\n                    index += action.increment;\n                    if (index < 0) {\n                        index = timeCoordinates.length - 1;\n                    }\n                    if (index > timeCoordinates.length - 1) {\n                        index = 0;\n                    }\n                    let selectedTime = timeCoordinates[index];\n                    let selectedTimeRange = state.selectedTimeRange;\n                    if (selectedTimeRange !== null) {\n                        if (selectedTime < selectedTimeRange[0]) {\n                            selectedTime = selectedTimeRange[0];\n                        }\n                        if (selectedTime > selectedTimeRange[1]) {\n                            selectedTime = selectedTimeRange[1];\n                        }\n                    }\n                    if (state.selectedTime !== selectedTime) {\n                        return {\n                            ...state,\n                            selectedTime,\n                        };\n                    }\n                }\n            }\n            return state;\n        }\n        case SELECT_TIME_RANGE: {\n            return {\n                ...state,\n                selectedTimeRange: action.selectedTimeRange,\n            };\n        }\n        case SELECT_TIME_SERIES_UPDATE_MODE: {\n            return {\n                ...state,\n                timeSeriesUpdateMode: action.timeSeriesUpdateMode,\n            };\n        }\n        case UPDATE_TIME_ANIMATION: {\n            return {\n                ...state,\n                timeAnimationActive: action.timeAnimationActive,\n                timeAnimationInterval: action.timeAnimationInterval,\n            };\n        }\n        case ADD_USER_PLACE: {\n            if (action.selectPlace) {\n                return selectPlace(state, action.id);\n            }\n            return state;\n        }\n        case ADD_USER_PLACES: {\n            if (action.selectPlace && action.places.length) {\n                return selectPlace(state, action.places[0].id);\n            }\n            return state;\n        }\n        case REMOVE_USER_PLACE: {\n            const {id, places} = action;\n            if (id === state.selectedPlaceId) {\n                let selectedPlaceId = null;\n                const index = places.findIndex(p => p.id === id);\n                if (index >= 0) {\n                    if (index < places.length - 1) {\n                        selectedPlaceId = places[index + 1].id;\n                    } else if (index > 0) {\n                        selectedPlaceId = places[index - 1].id;\n                    }\n                }\n                return {\n                    ...state,\n                    selectedPlaceId\n                };\n            }\n            return state;\n        }\n        case SET_MAP_INTERACTION: {\n            let newState = {\n                ...state,\n                mapInteraction: action.mapInteraction,\n                lastMapInteraction: state.mapInteraction,\n            };\n            if (action.mapInteraction === 'Geometry') {\n                newState = {\n                    ...newState,\n                    dialogOpen: {\n                        ...state.dialogOpen,\n                        addUserPlacesFromText: true\n                    },\n                };\n            }\n            return newState;\n        }\n        case SHOW_VOLUME_CARD: {\n            state = {\n                ...state,\n                volumeCardOpen: action.volumeCardOpen,\n            };\n            storeUserSettings(state);\n            return state;\n        }\n        case SET_VOLUME_RENDER_MODE: {\n            state = {\n                ...state,\n                volumeRenderMode: action.volumeRenderMode,\n            };\n            storeUserSettings(state);\n            return state;\n        }\n        case UPDATE_VOLUME_STATE: {\n            const {volumeId, volumeState} = action;\n            state = {\n                ...state,\n                volumeStates: {...state.volumeStates, [volumeId]: volumeState}\n            };\n            return state;\n        }\n        case SHOW_INFO_CARD: {\n            state = {\n                ...state,\n                infoCardOpen: action.infoCardOpen,\n            };\n            storeUserSettings(state);\n            return state;\n        }\n        case SET_VISIBLE_INFO_CARD_ELEMENTS: {\n            const infoCardElementStates = {...state.infoCardElementStates};\n            Object.getOwnPropertyNames(infoCardElementStates).forEach(e => {\n                infoCardElementStates[e] = {...infoCardElementStates[e], visible: action.visibleElements.includes(e)};\n            });\n            state = {\n                ...state,\n                infoCardElementStates,\n            };\n            storeUserSettings(state);\n            return state;\n        }\n        case UPDATE_INFO_CARD_ELEMENT_VIEW_MODE: {\n            state = {\n                ...state,\n                infoCardElementStates: {\n                    ...state.infoCardElementStates,\n                    [action.elementType]: {\n                        ...state.infoCardElementStates[action.elementType],\n                        viewMode: action.viewMode\n                    }\n                },\n            };\n            storeUserSettings(state);\n            return state;\n        }\n        case ADD_ACTIVITY: {\n            return {\n                ...state,\n                activities: {...state.activities, [action.id]: action.message},\n            };\n        }\n        case REMOVE_ACTIVITY: {\n            const activities = {...state.activities};\n            delete activities[action.id];\n            return {\n                ...state,\n                activities,\n            };\n        }\n        case CHANGE_LOCALE: {\n            const locale = action.locale;\n            i18n.locale = locale;\n            if (locale !== state.locale) {\n                state = {...state, locale};\n                storeUserSettings(state);\n            }\n            return state;\n        }\n        case OPEN_DIALOG: {\n            const dialogId = action.dialogId;\n            return {\n                ...state,\n                dialogOpen: {...state.dialogOpen, [dialogId]: true},\n            };\n        }\n        case CLOSE_DIALOG: {\n            const dialogId = action.dialogId;\n            return {\n                ...state,\n                dialogOpen: {...state.dialogOpen, [dialogId]: false},\n            };\n        }\n        case CONFIGURE_SERVERS: {\n            if (state.selectedServerId !== action.selectedServerId) {\n                return {...state, selectedServerId: action.selectedServerId};\n            }\n        }\n    }\n    return state;\n}\n\nfunction selectPlace(state: ControlState, selectedPlaceId: string): ControlState {\n    let selectedPlaceGroupIds;\n    if (!state.selectedPlaceGroupIds || state.selectedPlaceGroupIds.length === 0) {\n        selectedPlaceGroupIds = ['user'];\n    } else if (state.selectedPlaceGroupIds.find(id => id === 'user')) {\n        selectedPlaceGroupIds = state.selectedPlaceGroupIds;\n    } else {\n        selectedPlaceGroupIds = [...state.selectedPlaceGroupIds, 'user']\n    }\n    return {\n        ...state,\n        selectedPlaceGroupIds,\n        selectedPlaceId,\n    };\n}","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { MessageLogState, newMessageLogState } from '../states/messageLogState';\n\nimport { HIDE_MESSAGE, MessageLogAction, POST_MESSAGE } from \"../actions/messageLogActions\";\n\nlet numMessages = 0;\n\nexport function messageLogReducer(state: MessageLogState | undefined, action: MessageLogAction): MessageLogState  {\n    if (state === undefined) {\n        state = newMessageLogState();\n    }\n    const newMessageLogEntries = state.newEntries;\n    switch (action.type) {\n        case POST_MESSAGE: {\n            const type = action.messageType;\n            const text = action.messageText;\n            let latestEntry = newMessageLogEntries.length ? newMessageLogEntries[0] : null;\n            if (latestEntry && type === latestEntry.type && text === latestEntry.text) {\n                return state;\n            }\n            latestEntry = {id: ++numMessages, type, text};\n            return {...state, newEntries: [latestEntry, ...newMessageLogEntries]}\n        }\n        case HIDE_MESSAGE: {\n            const i = newMessageLogEntries.findIndex(e => e.id === action.messageId);\n            if (i >= 0) {\n                const hiddenEntry = newMessageLogEntries[i];\n                const newEntries = [...newMessageLogEntries];\n                newEntries.splice(i, 1);\n                const oldEntries = [hiddenEntry, ...state.oldEntries];\n                return {...state, newEntries, oldEntries}\n            }\n        }\n    }\n    return state;\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport type MessageType = \"error\" | \"warning\" | \"info\" | \"success\";\n\nexport interface MessageLogEntry {\n    id: number;\n    type: MessageType;\n    text: string;\n}\n\nexport interface MessageLogState {\n    newEntries: MessageLogEntry[];\n    oldEntries: MessageLogEntry[];\n}\n\nexport function newMessageLogState() {\n    return {\n        newEntries: [],\n        oldEntries: [],\n    }\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { UPDATE_ACCESS_TOKEN, UserAuthAction } from '../actions/userAuthActions';\nimport { newUserAuthState, UserAuthState } from '../states/userAuthState';\n\n\nexport function userAuthReducer(state: UserAuthState | undefined, action: UserAuthAction): UserAuthState {\n    if (state === undefined) {\n        state = newUserAuthState();\n    }\n    switch (action.type) {\n        case UPDATE_ACCESS_TOKEN:\n            return {\n                ...state,\n                accessToken: action.accessToken,\n            };\n    }\n    return state!;\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport interface UserAuthState {\n    accessToken: string | null;\n}\n\nexport function newUserAuthState(): UserAuthState {\n    return {\n        accessToken: null,\n    }\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { AppState } from '../states/appState';\n\nimport { dataReducer } from './dataReducer';\nimport { DataAction } from \"../actions/dataActions\";\n\nimport { controlReducer } from './controlReducer';\nimport { ControlAction } from \"../actions/controlActions\";\n\nimport { messageLogReducer } from './messageLogReducer';\nimport { MessageLogAction } from \"../actions/messageLogActions\";\n\nimport { userAuthReducer } from './userAuthReducer';\nimport { UserAuthAction } from '../actions/userAuthActions';\n\n\nexport function appReducer(state: AppState | undefined,\n                           action: DataAction\n                               & ControlAction\n                               & MessageLogAction\n                               & UserAuthAction): AppState {\n    // Not using redux.combineReducers(), because we need to pass app state into controlReducer()\n    return {\n        dataState: dataReducer(state && state.dataState, action),\n        controlState: controlReducer(state && state.controlState, action, state),\n        messageLogState: messageLogReducer(state && state.messageLogState, action),\n        userAuthState: userAuthReducer(state && state.userAuthState, action),\n    };\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker === null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport * as Redux from 'redux';\nimport * as ReduxLogger from 'redux-logger';\nimport thunk from 'redux-thunk';\n\nimport './index.css';\nimport { changeLocale } from './actions/controlActions';\nimport { syncWithServer } from './actions/dataActions';\nimport { Config } from './config';\nimport App from './connected/App';\nimport { appReducer } from './reducers/appReducer';\nimport * as serviceWorker from './serviceWorker';\n\n\nConfig.load().then(() => {\n    const logger = ReduxLogger.createLogger({collapsed: true, diff: false});\n    const store = Redux.createStore(appReducer, Redux.applyMiddleware(thunk, logger));\n\n    store.dispatch(changeLocale(store.getState().controlState.locale) as any);\n\n    if (store.getState().controlState.privacyNoticeAccepted) {\n        store.dispatch(syncWithServer() as any);\n    }\n\n    ReactDOM.render(\n        <Provider store={store}>{<App/>}</Provider>,\n        document.getElementById('root') as HTMLElement\n    );\n\n    // If you want your app to work offline and load faster, you can change\n    // unregister() to register() below. Note this comes with some pitfalls.\n    // Learn more about service workers: https://bit.ly/CRA-PWA\n    serviceWorker.unregister();\n});\n"],"sourceRoot":""}