{"version":3,"sources":["util/lang.ts","i18n.ts","api/errors.ts","api/callApi.ts","api/getColorBars.ts","api/getDatasets.ts","api/getDatasetPlaceGroup.ts","util/assert.ts","model/dataset.ts","util/csv.ts","model/user-place/csv.ts","model/user-place/geojson.ts","model/user-place/wkt.ts","util/id.ts","util/baseurl.ts","util/path.ts","util/branding.ts","config.ts","model/place.ts","components/ol/layer/Layers.tsx","model/proj.ts","components/ol/Map.tsx","components/ol/MapComponent.tsx","components/ol/layer/Tile.tsx","components/ol/layer/Vector.tsx","util/find.ts","util/maps.ts","selectors/dataSelectors.tsx","util/storage.ts","states/userSettings.ts","states/controlState.ts","selectors/controlSelectors.tsx","util/time.ts","model/timeSeries.ts","actions/messageLogActions.ts","actions/dataActions.tsx","api/getServerInfo.ts","api/updateResources.ts","api/getTimeSeries.ts","actions/controlActions.tsx","components/UserProfile.tsx","components/UserControl.tsx","actions/userAuthActions.ts","connected/UserControl.tsx","components/MarkdownPage.tsx","connected/AppBar.tsx","components/ControlBar.tsx","components/ControlBarItem.tsx","components/DatasetSelect.tsx","connected/DatasetSelect.tsx","components/VariableSelect.tsx","connected/VariableSelect.tsx","components/RgbSwitch.tsx","connected/RgbSwitch.tsx","components/PlaceGroupsSelect.tsx","connected/PlaceGroupsSelect.tsx","components/PlaceSelect.tsx","connected/PlaceSelect.tsx","components/MapInteractionsBar.tsx","connected/MapInteractionsBar.tsx","components/TimeSelect.tsx","connected/TimeSelect.tsx","components/TimeSlider.tsx","connected/TimeSlider.tsx","components/TimePlayer.tsx","connected/TimePlayer.tsx","components/ControlBarActions.tsx","connected/ControlBarActions.tsx","connected/ControlBar.tsx","components/ErrorBoundary.tsx","components/ol/control/Control.tsx","components/ol/control/ScaleLine.tsx","components/ol/interaction/Draw.tsx","components/ol/View.tsx","components/ol/style.ts","components/Viewer.tsx","model/colorBar.ts","util/label.ts","components/bg.png","components/ColorBarCanvas.tsx","components/ColorBarLegend.tsx","connected/ColorBarLegend.tsx","connected/Viewer.tsx","components/TimeSeriesChart.tsx","components/TimeRangeSlider.tsx","components/TimeSeriesCharts.tsx","connected/TimeSeriesCharts.tsx","resources/python-bw.png","components/InfoCard.tsx","connected/InfoCard.tsx","components/Splitter.tsx","components/SplitPane.tsx","connected/Workspace.tsx","connected/AppPane.tsx","components/LegalAgreementDialog.tsx","connected/LegalAgreementDialog.tsx","components/LoadingDialog.tsx","connected/LoadingDialog.tsx","components/MessageLog.tsx","connected/MessageLog.tsx","components/AuthWrapper.tsx","components/ServerDialog.tsx","connected/ServerDialog.tsx","components/SettingsPanel.tsx","components/SettingsSubPanel.tsx","components/ToggleSetting.tsx","components/RadioSetting.tsx","components/SettingsDialog.tsx","connected/SettingsDialog.tsx","version.ts","components/ExportDialog.tsx","connected/ExportDialog.tsx","components/FileUpload.tsx","components/user-place/GeoJsonOptionsEditor.tsx","components/user-place/CsvTextFieldEditor.tsx","components/user-place/CsvOptionsEditor.tsx","components/user-place/WktOptionsEditor.tsx","model/user-place/common.ts","components/UserPlacesDialog.tsx","connected/UserPlacesDialog.tsx","connected/App.tsx","states/dataState.ts","reducers/dataReducer.ts","reducers/controlReducer.ts","reducers/messageLogReducer.ts","states/messageLogState.ts","reducers/userAuthReducer.ts","states/userAuthState.ts","reducers/appReducer.ts","serviceWorker.ts","index.tsx"],"names":["LanguageDictionary","json","_languages","_content","_locale","locales","Object","getOwnPropertyNames","languages","findIndex","locale","Error","content","dictionary","forEach","entry","index","phraseKey","getPhraseKey","console","warn","this","value","baseValue","split","error","phrase","values","translatedPhrase","key","keys","name","replace","toLowerCase","i18n","navigator","length","language","userLanguage","browserLanguage","HTTPError","statusCode","statusMessage","makeRequestInit","accessToken","headers","makeRequestUrl","url","query","queryString","map","kv","encodeURIComponent","join","includes","endsWith","callJsonApi","init","fetch","then","response","ok","status","statusText","catch","TypeError","get","callApi","parseColorBars","colorBarGroups","groups","images","colorBarGroup","title","description","names","colorBar","image","push","adjustTimeDimensionsForDatasets","datasets","adjustTimeDimensionsForDataset","dataset","dimensions","dimension","timeDimension","timeCoordinates","coordinates","labels","label","Date","getTime","getDatasetPlaceGroup","apiServerUrl","datasetId","placeGroupId","dsId","pgId","DeveloperError","assertDefinedAndNotNull","object","objectName","assertNotNull","assertDefined","assertArrayNotEmpty","array","arrayName","Array","isArray","assertArray","findDataset","selectedDatasetId","find","id","findDatasetVariable","variableName","variables","variable","getDatasetTimeDimension","getDatasetTimeRange","ParseError","defaultParseOptions","separator","comment","quote","escape","trim","nanToken","trueToken","falseToken","parseCsv","text","options","Parser","parse","parseLine","bind","parseText","line","filter","startsWith","message","colIndex","quoteSeen","start","end","char","collectValue","token","slice","parseToken","substring","Number","NaN","parseFloat","isNaN","indexOf","token2","unescapeString","csvFormat","fileExt","checkError","e","defaultCsvOptions","xName","yName","forceGeometry","geometryName","labelName","labelPrefix","geoJsonFormat","JSON","defaultGeoJsonOptions","labelNames","wktFormat","defaultWktOptions","newId","Math","random","toString","substr","now","toUpperCase","baseUrl","URL","window","location","href","pathComponents","pathname","numPathComponents","origin","_getBaseUrl","buildPath","base","path","components","c","log","COLORS","amber","blue","blueGrey","brown","cyan","deepOrange","deepPurple","green","grey","indigo","lightBlue","lightGreen","lime","orange","pink","purple","red","teal","yellow","setBrandingColor","brandingConfig","colorName","color","parseBranding","configPath","imagePath","setBrandingImage","appParams","URLSearchParams","search","Config","server","branding","authClient","configUrl","rawConfig","rawDefaultConfig","compact","parseInt","_instance","windowTitle","changeWindowTitle","windowIcon","changeWindowIcon","assertConfigLoaded","document","iconUrl","favicon","querySelector","createElement","rel","head","appendChild","userPlaceColorsArray","userPlaceColors","obj","userPlaceColorNames","getUserPlaceColorName","getUserPlaceColor","paletteType","shade","getStrokeShade","tileAccess","param","DEFAULT_LABEL_PROPERTY_NAMES","mkCases","DEFAULT_DESCRIPTION_PROPERTY_NAMES","DEFAULT_COLOR_PROPERTY_NAMES","DEFAULT_IMAGE_PROPERTY_NAMES","getPlaceInfo","defaultMemoize","placeGroup","place","infoObj","updatePlaceInfo","i","hash","charCodeAt","getPlaceHash","propertyName","defaultValue","defaultPropertyNames","propertyValue","mappedPropertyValue","propertyMapping","interpolatedValue","properties","placeHolder","getInterpolatedPropertyValue","getPropertyValue","undefined","container","propertyNames","nameCases","concat","forEachPlace","placeGroups","callback","isValidPlaceGroup","features","findPlaceInPlaceGroup","placeId","subPlaceGroups","parentPlaceId","findPlaceInPlaceGroups","LAST_PLACE_LABEL_ID_CSV","LAST_PLACE_LABEL_ID_GEOJSON","LAST_PLACE_LABEL_ID_WKT","newGeoJsonFeature","geometry","type","OlGeoJSONFormat","writeGeometryObject","Layers","props","children","GEOGRAPHIC_CRS","WEB_MERCATOR_CRS","DEFAULT_MAP_CRS","MapContextType","React","mapObjects","DEFAULT_CONTAINER_STYLE","width","height","Map","contextValue","clickEventsKey","handleClick","event","onClick","handleDrop","onDropFiles","preventDefault","files","dataTransfer","items","item","kind","file","getAsFile","handleDragOver","handleRef","mapDiv","handleResize","updateSize","view","getView","minZoom","getMinZoom","setMinZoom","target","size","clientWidth","LOG2E","isStale","mapObject","OlMap","setTarget","un","listener","initialZoom","OlView","projection","center","zoom","getMapOptions","on","forceUpdate","addEventListener","onMapRef","prevProps","mapOptions","setProperties","removeEventListener","childrenWithContext","Provider","ref","style","onDragOver","onDrop","MapComponent","context","_updateMapObject","addMapObject","updateMapObject","removeMapObject","set","contextType","trace","Tile","layer","OlTileLayer","getLayers","oldSource","getSource","newSource","source","replaceSource","OlUrlTileSource","oldUrlTileSource","newUrlTileSource","oldTileGrid","newTileGrid","getMaxZoom","oldExtent","getExtent","newExtent","oldResolutions","getResolutions","newResolutions","numLevels","z","oldResolution","getResolution","newResolution","oldOrigin","getOrigin","newOrigin","oldTileSize","getTileSize","newTileSize","oldTileRange","getFullTileRange","newTileRange","getWidth","getHeight","equalTileGrids","getTileGrid","oldUrls","getUrls","newUrls","setUrls","oldTileLoadFunction","getTileLoadFunction","newTileLoadFunction","setTileLoadFunction","oldTileUrlFunction","getTileUrlFunction","newTileUrlFunction","setTileUrlFunction","oldContextOptions","getContextOptions","newContextOptions","imageSmoothing","setSource","visible","setVisible","opacity","setOpacity","zIndex","setZIndex","minResolution","setMinResolution","maxResolution","setMaxResolution","remove","OlXYZSource","attributions","OlOSMSource","Vector","OlVectorLayer","findIndexCloseTo","n","i1","i3","otherValue","i2","floor","abs","maps","datasetsSelector","state","dataState","timeSeriesGroupsSelector","timeSeriesGroups","userPlaceGroupSelector","userPlaceGroup","userServersSelector","userServers","placeGroupsSelector","createSelector","placeGroupsArray","getLocalStorage","brandingName","_getStorage","storage","x","setItem","removeItem","Storage","nativeStorage","parser","getItem","makeKey","defaultObj","getProperty","formatter","formattedValue","stringify","setObjectItem","storeUserSettings","settings","instance","setPrimitiveProperty","setObjectProperty","TIME_ANIMATION_INTERVALS","newControlState","defaultSettings","getStringProperty","getBooleanProperty","getIntProperty","getObjectProperty","loadUserSettings","selectedVariableName","selectedPlaceGroupIds","selectedPlaceId","selectedUserPlaceId","selectedServerId","selectedTime","selectedTimeRange","timeSeriesUpdateMode","timeAnimationActive","timeAnimationInterval","timeChunkSize","autoShowTimeSeries","showTimeSeriesPointsOnly","showTimeSeriesErrorBars","showTimeSeriesMedian","defaultAgg","userPlacesFormatName","userPlacesFormatOptions","geojson","csv","wkt","flyTo","activities","dialogOpen","privacyNoticeAccepted","mapInteraction","lastMapInteraction","showRgbLayer","infoCardOpen","infoCardElementStates","viewMode","mapProjection","imageSmoothingEnabled","showDatasetBoundaries","baseMapUrl","exportTimeSeries","exportTimeSeriesSeparator","exportPlaces","exportPlacesAsCollection","exportZipArchive","exportFileName","MAP_OBJECTS","selectedDatasetIdSelector","controlState","selectedVariableNameSelector","selectedPlaceGroupIdsSelector","selectedPlaceIdSelector","selectedTimeSelector","timeAnimationActiveSelector","imageSmoothingSelector","infoCardElementStatesSelector","mapProjectionSelector","selectedDatasetSelector","selectedDatasetVariablesSelector","selectedVariableSelector","varName","v","selectedVariableUnitsSelector","units","selectedVariableColorBarMinMaxSelector","colorBarMin","colorBarMax","selectedVariableColorBarNameSelector","colorBarName","selectedVariableOpacitySelector","selectedDatasetTimeRangeSelector","selectedDatasetRgbSchemaSelector","rgbSchema","selectedDatasetPlaceGroupsSelector","selectPlaceGroups","placeGroupIds","selectedPlaceGroups","selectedDatasetSelectedPlaceGroupsSelector","selectedPlaceGroupsSelector","selectedPlaceGroupsTitleSelector","selectedPlaceGroupPlacesSelector","args","selectedPlaceSelector","places","selectedPlaceInfoSelector","predicate","findPlaceInfo","canAddTimeSeriesSelector","timeSeriesGroup","timeSeriesArray","timeSeriesPlaceInfosSelector","placeInfos","ts","selectedPlaceGroupPlaceLabelsSelector","placeLabels","selectedDatasetVariableSelector","selectedTimeChunkSizeSelector","minTimeChunkSize","varTimeChunkSize","ceil","selectedDatasetTimeDimensionSelector","selectedDatasetAttributionsSelector","timeCoordinatesSelector","selectedTimeIndexSelector","time","_getLoadTileOnlyAfterMove","memoize","tile","src","getInteracting","once","getImage","serializer","getTarget","getTileLayer","layerId","tileUrl","tileLevelMin","tileLevelMax","queryParams","timeString","timeIndex","toISOString","tileGrid","tileLoadFunction","transition","maxZoom","getOlXYZSource","OlTileGrid","tileSize","extent","resolutions","from","_","pow","getOlTileGrid","selectedDatasetBoundaryLayerSelector","bbox","x1","y1","x2","y2","OlVectorSource","dataProjection","featureProjection","readFeatures","OlStyle","stroke","OlStrokeStyle","lineDash","selectedDatasetVariableLayerSelector","colorBarMinMax","selectedDatasetRgbLayerSelector","getDefaultStrokeStyle","getDefaultFillStyle","OlFillStyle","polygonFillOpacity","selectedDatasetPlaceGroupLayersSelector","layers","OlCircle","fill","radius","visibleInfoCardElementsSelector","visibleInfoCardElements","infoCardElementViewModesSelector","infoCardElementCodeModes","activityMessagesSelector","k","selectedServerSelector","serverId","baseMapLayerSelector","groupName","endpoint","group","findMap","access","link","LOCAL_OFFSET","utcTimeToIsoDate","utcTime","local","utcTimeToIsoDateString","utcTimeToIsoDateTimeString","skipSeconds","UNIT","POST_MESSAGE","postMessage","messageType","messageText","HIDE_MESSAGE","saveAs","require","UPDATE_SERVER_INFO","updateServerInfo","dispatch","getState","apiServer","addActivity","serverInfo","_updateServerInfo","removeActivity","UPDATE_RESOURCES","updateResources","Promise","resolve","api","userAuthState","reload","finally","UPDATE_DATASETS","updateDatasets","result","_updateDatasets","selectDataset","UPDATE_DATASET_PLACE_GROUP","updateDatasetPlaceGroup","ADD_USER_PLACE","ADD_USER_PLACES","addUserPlacesFromText","formatName","userPlacesFormatOptionsCsvSelector","table","headerRow","headerRowLC","numColumns","labelNameLC","xNameLC","yNameLC","geometryNameLC","labelNameIndex","xNameIndex","yNameIndex","geometryNameIndex","OlWktFormat","rowIndex","dataRow","readGeometry","y","isFinite","OlGeomPoint","geoJsonProps","labelId","getUserPlacesFromCsv","userPlacesFormatOptionsGeoJsonSelector","labelNamesSet","Set","OlFeature","feature","getProperties","getGeometry","has","getUserPlacesFromGeoJson","userPlacesFormatOptionsWktSelector","getUserPlacesFromWkt","openDialog","selectPlace","addUserPlaces","addTimeSeries","REMOVE_USER_PLACE","REMOVE_ALL_USER_PLACES","selectedDatasetTimeDim","selectedVariable","selectedPlace","useMedian","inclStDev","timeLabels","numTimeLabels","endTimeIndex","startTimeIndex","getTimeSeriesChunk","startDateLabel","endDateLabel","startDate","endDate","valueDataKey","errorDataKey","method","body","data","variableUnits","successAction","timeSeries","isValidPlace","hasMore","dataProgress","updateMode","dataMode","UPDATE_TIME_SERIES","updateTimeSeries","REMOVE_TIME_SERIES_GROUP","REMOVE_ALL_TIME_SERIES","CONFIGURE_SERVERS","_configureServers","servers","syncWithServer","colorBars","UPDATE_COLOR_BARS","_updateColorBars","UPDATE_VARIABLE_COLOR_BAR","Exporter","ZipExporter","fileName","zipArchive","JSZip","generateAsync","FileExporter","blob","Blob","SELECT_DATASET","showInMap","_selectDataset","flyToDataset","SIMPLE_GEOMETRY_TYPES","flyToPlace","FLY_TO","mapId","SELECT_PLACE_GROUPS","_selectPlaceGroups","activityId","SELECT_PLACE","_selectPlace","SET_RGB_LAYER_VISIBILITY","SELECT_VARIABLE","SELECT_TIME","selectTime","INC_SELECTED_TIME","SELECT_TIME_RANGE","selectTimeRange","SELECT_TIME_SERIES_UPDATE_MODE","UPDATE_TIME_ANIMATION","SET_MAP_INTERACTION","setMapInteraction","SHOW_INFO_CARD","showInfoCard","SET_VISIBLE_INFO_CARD_ELEMENTS","UPDATE_INFO_CARD_ELEMENT_VIEW_MODE","ADD_ACTIVITY","REMOVE_ACTIVITY","CHANGE_LOCALE","changeLocale","OPEN_DIALOG","dialogId","CLOSE_DIALOG","closeDialog","UPDATE_SETTINGS","updateSettings","UserProfile","userInfo","Grid","justifyContent","spacing","picture","alt","Paper","elevation","List","ListItem","ListItemText","primary","secondary","Divider","light","email","email_verified","nickname","UserControlContent","classes","updateAccessToken","auth","useAuth","userMenuAnchorEl","setUserMenuAnchorEl","profileDialogOpen","setProfileDialogOpen","user","access_token","handleUserProfileDialogClose","handleUserMenuClose","avatar","profile","avatarContent","Avatar","className","imageAvatar","name1","given_name","name2","family_name","letters","letterAvatar","IconButton","currentTarget","aria-controls","aria-haspopup","iconButton","Menu","anchorEl","keepMounted","open","Boolean","onClose","MenuItem","signoutRedirect","Dialog","TransitionComponent","Transition","aria-labelledby","aria-describedby","DialogTitle","DialogContent","DialogActions","Button","userButton","isLoading","signinRedirect","signInWrapper","CircularProgress","signInProgress","withStyles","theme","createStyles","backgroundColor","margin","position","top","left","marginTop","marginLeft","padding","UPDATE_ACCESS_TOKEN","mapDispatchToProps","prevAccessToken","_updateAccessToken","connect","UserControl","useStyles","makeStyles","dialog","palette","appBar","flex","marginRight","forwardRef","Slide","direction","MarkdownPage","useState","markdownText","setMarkdownText","useEffect","fullScreen","AppBar","Toolbar","edge","aria-label","Typography","variant","linkTarget","appName","appBarTitle","allowRefresh","toolbar","headerBackgroundColor","paddingRight","drawer","transitions","create","easing","sharp","duration","leavingScreen","logoAnchor","display","alignItems","logo","flexGrow","headerTitleStyle","headerIconStyle","helpMenuAnchorEl","setHelpMenuAnchorEl","imprintOpen","setImprintOpen","manualOpen","setManualOpen","handleCloseHelpMenu","classNames","disableGutters","organisationUrl","logoImage","logoWidth","component","noWrap","Tooltip","arrow","getContentAnchorEl","anchorOrigin","vertical","horizontal","transformOrigin","form","flexWrap","paddingTop","paddingLeft","autoComplete","formControl","control","actions","FormControl","Box","marginBottom","minWidth","selectEmpty","datasetSelectLabel","InputLabel","shrink","htmlFor","datasetSelect","Select","onChange","input","Input","displayEmpty","selected","DatasetSelect","button","canAddTimeSeries","selectVariable","variableSelectLabel","variableSelect","timeSeriesButton","disabled","VariableSelect","setRgbLayerVisibility","FormControlLabel","Switch","checked","RgbSwitch","select","selectedPlaceGroupsTitle","removeAllUserPlaces","placeGroupsSelectLabel","placeGroupsSelect","multiple","renderValue","Checkbox","removeEnabled","placeGroupRemoveButton","PlaceGroupsSelect","removeUserPlace","placeSelectLabel","placeSelect","placeRemoveButton","PlaceSelect","ToggleButtonGroup","exclusive","ToggleButton","minTimeValue","maxTimeValue","hasTimeDimension","timeInputLabel","timeValue","timeInput","LocalizationProvider","dateAdapter","AdapterDateFns","DateTimePicker","emptyLabel","inputFormat","minDateTime","maxDateTime","date","ampm","renderInput","TextField","TimeSelect","box","fontSize","selectedTime_","setSelectedTime_","selectedTimeRangeValid","marks","Slider","min","max","valueLabelDisplay","valueLabelFormat","onChangeCommitted","TimeSlider","updateTimeAnimation","incSelectedTime","intervalId","useRef","playOrNot","uninstallTimer","handlePlayEvent","installTimer","current","setInterval","clearInterval","isValid","playToolTip","playIcon","playButton","firstTimeStepButton","prevTimeStepButton","nextTimeStepButton","lastTimeStepButton","increment","TimePlayer","flyToSelectedObject","downloadButton","canDownload","allowDownloads","refreshButton","settingsButton","flyToButton","infoButton","ControlBarActions","show","ErrorBoundary","errorInfo","componentStack","whiteSpace","Control","divRef","handleDivRef","OlControl","element","addControl","getControls","getArray","removeControl","_className","ScaleLine","OlScaleLineControl","getOptions","Draw","draw","OlDrawInteraction","active","setActive","addInteraction","listen","unlisten","removeInteraction","vectorLayer","getMapObject","onDrawStart","onDrawEnd","View","updateView","newProjection","oldProjection","getProjection","getCode","oldView","newView","olTransform","getCenter","getZoom","forEachFeature","transform","setView","setFeatureStyle","fillOpacity","OlPoint","setStyle","fillColor","strokeColor","strokeWidth","OlCircleStyle","createPointGeometryStyle","fillColorRgba","rgba","createGeometryStyle","USER_LAYER_SOURCE","SELECTION_LAYER_SOURCE","COLOR_LEGEND_STYLE","right","SELECTION_LAYER_STROKE","SELECTION_LAYER_FILL","SELECTION_LAYER_STYLE","withTheme","baseMapLayer","rgbLayer","variableLayer","datasetBoundaryLayer","placeGroupLayers","colorBarLegend","addUserPlace","setMap","selectedPlaceIdPrev","setSelectedPlaceIdPrev","selectedPlaceIdCurr","clear","selectedFeature","featureId","getFeatureById","findFeatureById","displayFeature","clone","setId","getId","addFeature","changed","handleDrawEnd","OlCircleGeometry","polygon","olPolygonFromCircle","setGeometry","geoJSONGeometry","colorIndex","userLayer","getFeatures","mode","nameBase","p","colorBarControl","getFeaturesAtPixel","pixel","f","handleMapClick","reader","FileReader","onloadend","readAsText","OlGeometryType","POINT","wrapX","stopClick","POLYGON","CIRCLE","bar","CB_ALPHA_SUFFIX","CB_REVERSE_SUFFIX","formatColorBar","baseName","isReversed","isAlpha","getLabelsFromArray","fractionDigits","round","log10","valueRounded","toFixed","formatValue","getLabelsFromRange","minValue","maxValue","count","arange","delta","ticks","bgImage","Image","ColorBarCanvas","imageData","onOpenEditor","canvasRef","canvas","onload","offscreenCanvas","ctx","getContext","drawImage","rgbaArray","getImageData","reversedRgbaArray","Uint8ClampedArray","j","factor","createImageBitmap","ImageData","imageBitmap","pattern","createPattern","fillStyle","fillRect","renderColorBar","fontWeight","paddingBottom","sliderBox","colorBarBox","COLOR_BAR_BOX_MARGIN","colorBarGroupTitle","colorBarGroupItemBox","colorBarMinMaxEditor","minMaxBox","minTextField","maxWidth","maxTextField","Labels","minMaxToText","minMaxValue","updateVariableColorBar","_updateVariableColorBar","variableColorBarMinMax","variableColorBarName","variableOpacity","numTicks","colorBarMinMaxAnchorEl","setColorBarMinMaxAnchorEl","colorBarNameAnchorEl","setColorBarNameAnchorEl","currentColorBarMinMax","setCurrentColorBarMinMax","originalColorBarMinMax","setOriginalColorBarMinMax","enteredColorBarMinMax","setEnteredColorBarMinMax","enteredColorBarMinMaxError","setEnteredColorBarMinMaxError","colorBarMinMaxEditorOpen","colorBarNameEditorOpen","colorBarNameEditor","variableColorBar","parseColorBar","numStepsOuter","original1","original2","dist","distExp","distNorm","numStepsInner","numStepsFloat","numStepsInt","total1","total2","step","evt","enteredValue","newMinMax","handleEnteredColorBarMinChange","handleEnteredColorBarMaxChange","entries","cbg","placement","border","borderColor","Popover","_addUserPlace","ownProps","Viewer","styles","chartContainer","userSelect","flexDirection","responsiveContainer","actionButton","toolTipContainer","borderRadius","toolTipValue","toolTipLabel","chartTitle","X_AXIS_DOMAIN","Y_AXIS_DOMAIN","t1","t2","selectTimeSeries","dataTimeRange","showErrorBars","showPointsOnly","removeTimeSeriesGroup","completed","timeRangeSelection","setTimeRangeSelection","clearTimeRangeSelection","lightStroke","mainStroke","main","labelTextColor","contrastText","isZoomedIn","time1","time2","zoomIn","firstTime","secondTime","minTime","maxTime","zoomOut","commonValueDataKey","lines","lineName","lineColor","placeInfo","lon","lat","point","time1Ok","time2Ok","errorBar","shadedLineColor","ErrorBar","dataKey","Line","unit","dot","activeDot","strokeOpacity","isAnimationActive","timeSeriesGroupId","timeSeriesIndex","referenceLine","ReferenceLine","isFront","referenceArea","ReferenceArea","actionButtons","zoomOutButton","removeAllButton","progress","reduce","a","b","timeSeriesText","unitsText","ResponsiveContainer","LineChart","onMouseDown","activeLabel","onMouseMove","onMouseUp","onMouseEnter","onMouseLeave","syncId","XAxis","tickCount","domain","tickFormatter","allowDuplicatedCategory","YAxis","CartesianGrid","strokeDasharray","CustomTooltip","Legend","payload","valueText","suffix","CustomizedDot","cx","cy","totalRadius","totalDiameter","r","sw","viewBox","selectedTimeRange_","setSelectedTimeRange_","dataTimeRangeValid","flexFlow","noChartsCard","noChartsTitle","charts","TimeSeriesCharts","card","info","close","keyValueTableContainer","background","divider","variableHtmlReprContainer","media","cardContent","code","fontFamily","InfoCard","setVisibleInfoCardElements","infoCardElementViewModes","updateInfoCardElementViewMode","selectedDataset","selectedPlaceInfo","serverConfig","allowViewModePython","datasetInfoContent","variableInfoContent","placeInfoContent","elementType","isVisible","isIn","setViewMode","hasPython","Card","CardActions","disableSpacing","visibleElementTypes","DatasetInfoContent","jsonDimensions","selectObj","jsonDataset","attrs","d","dtype","spatialRef","getDatasetPythonCode","subheader","VariableInfoContent","htmlReprPaper","jsonVariable","htmlRepr","innerHTML","dims","shape","s","getVariablePythonCode","PlaceInfoContent","CardMedia","InfoCardContent","Collapse","in","timeout","unmountOnExit","CardHeader","action","pythonLogo","KeyValueTable","TableContainer","Table","TableBody","renderedValue","Link","TableRow","TableCell","align","CardContent2","CardContent","CodeContent","extension","themeName","extensions","readOnly","JsonCodeContent","PythonCodeContent","python","newObj","vmin","vmax","cmap","timeSel","visibleElements","Splitter","lastPosition","bodyEventListeners","onBodyMouseMove","onBodyMouseUp","onBodyMouseEnter","onBodyMouseLeave","removeBodyMouseListeners","dir","hor","ver","isButton1Pressed","getCurrentPosition","addBodyMouseListeners","currentPosition","positionDelta","endDragging","buttons","screenX","screenY","pair","outline","minHeight","maxHeight","cursor","SplitPane","handleSplitDelta","initialSize","setState","oldSize","newSize","childClassName","child1Style","child2Style","width1","childVer","height1","child1ClassName","child2ClassName","childHor","mapExtraStyle","getLayout","innerWidth","innerHeight","hasInfoCard","hasTimeseries","splitPaneHor","overflow","splitPaneVer","overflowX","overflowY","mapPaneHor","mapPaneVer","detailsPaneHor","detailsPaneVer","viewerContainer","layout","setLayout","updateLayout","onresize","splitPaneClassName","mapPaneClassName","detailsPaneClassName","hasConsent","breakpoints","up","icon","disableEscapeKeyDown","scroll","DialogContentText","history","back","home","contentContainer","textAlign","messages","LoadingDialog","variantIcon","success","CheckCircleIcon","warning","WarningIcon","ErrorIcon","InfoIcon","SNACKBAR_ANCHOR_ORIGIN","dark","iconVariant","hideMessage","handleClose","MessageIcon","Snackbar","autoHideDuration","SnackbarContent","messageId","newEntries","messageLogState","MessageLog","AuthWrapper","redirectUri","loadUserInfo","scope","automaticSilentRenew","redirect_uri","post_logout_redirect_uri","popup_post_logout_redirect_uri","onSigninCallback","_user","replaceState","onRemoveUser","textField","textField2","selectedServer","configureServers","servers_","setServers_","selectedServer_","setSelectedServer_","dialogMode","setDialogMode","okButtonName","dialogTitle","dialogContent","doClose","getSelectedServerIndex","setSelectedServer","selectedServerIndex","setServers","doAddServer","doEditServer","cancelAddOrEditMode","doRemoveServer","splice","menuItems","dividers","required","selectedServerName","selectedServerURL","inputProps","FormHelperText","autoFocus","ServerDialog","settingsPanelTitle","settingsPanelPaper","lighten","darken","paper","settingsPanelList","SettingsPanel","childCount","Children","listItems","child","dense","SettingsSubPanel","listItemStyle","listItemSecondaryAction","listItemText","ListItemSecondaryAction","ToggleSetting","RadioSetting","RadioGroup","row","Radio","typography","intTextField","localeAvatar","SettingsDialog","viewerVersion","languageMenuAnchor","setLanguageMenuAnchor","baseMapMenuAnchor","setBaseMapMenuAnchor","setTimeChunkSize","newTimeChunkSize","localeMenuItems","langLocale","langName","baseMapMenuItems","mapGroup","ListSubheader","disableSticky","mapSource","baseMapLabel","fullWidth","getOnOff","version","separatorTextField","fileNameTextField","ExportDialog","downloadTimeSeries","handleCloseDialog","test","exporter","placesToExport","includeTimeSeries","includePlaces","placesAsCollection","zip","dataColNames","placeIds","timePlaceRows","add","valueColName","errorColName","timePlaceId","timePlaceRow","colNames","sort","dataRows","rowData","colName","row1","row2","timeDelta","localeCompare","placeId1","placeId2","referencedPlaces","timeSeriesGroupsToTable","validTypes","number","string","csvHeaderRow","csvDataRows","csvText","write","collection","_exportData","FileUpload","accept","onSelect","fileInput","hidden","click","GeoJsonOptionsEditor","updateOptions","CsvTextFieldEditor","optionName","CsvOptionsEditor","gap","gridTemplateColumns","WktOptionsEditor","WKT_GEOM_NAMES","detectFormatName","marker","geomName","formats","codeExt","spacer","actionBox","UserPlacesDialog","nextMapInteraction","setText","setError","loading","setLoading","expanded","setExpanded","_userPlacesFormatName","setUserPlacesFormatName","_userPlacesFormatOptions","setUserPlacesFormatOptions","formatOptionsEditor","handleCodePaste","handleFormatNameChange","placeholder","onPaste","onPasteCapture","selection","onabort","onerror","endIcon","StyledEngineProvider","injectFirst","ThemeProvider","createTheme","adaptV4Theme","htmlFontSize","primaryColor","secondaryColor","CssBaseline","newDataState","extraUserServers","getObjectItem","loadUserServers","extraUserServer","userServer","dataReducer","datasetIndex","ds","variableIndex","placeGroupIndex","pg","readFeature","addUserPlaceToLayer","removeUserPlacesFromLayer","getTimeSeriesArray","updateTimeSeriesGroups","userPlaceIds","tsgIndex","tsg","storeUserServers","removeFeature","newTimeSeriesGroups","currentTimeSeries","newTimeSeriesArray","tsIndex","oldTimeSeries","controlReducer","appState","flyToCurr","flyToTarget","olProjTransformExtent","fit","getSize","getType","setCenter","getFirstCoordinate","newState","numMessages","messageLogReducer","oldEntries","newMessageLogEntries","latestEntry","hiddenEntry","userAuthReducer","appReducer","hostname","match","load","logger","ReduxLogger","collapsed","diff","store","Redux","thunk","ReactDOM","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"gmmBAqCaA,EAAb,WAKI,WAAYC,GAA+B,yBAJ1BC,gBAIyB,OAHzBC,cAGyB,OAFlCC,aAEkC,EAEtC,IAAMC,EAAUC,OAAOC,oBAAoBN,EAAKO,WAChD,GAAIH,EAAQI,WAAU,SAAAC,GAAM,MAAe,OAAXA,KAAmB,EAC/C,MAAM,IAAIC,MAAJ,uEAGV,IAAMC,EAAe,GACrBX,EAAKY,WAAWC,SAAQ,SAACC,EAAOC,GAC5BX,EAAQS,SAAQ,SAAAJ,GACZ,IAAKK,EAAML,GACP,MAAM,IAAIC,MAAM,iDAA0CK,EAA1C,4EACqCN,EADrC,cACiDK,OAGzE,IAAME,EAAYC,EAAaH,EAAK,IAChCH,EAAQK,IACRE,QAAQC,KAAR,2CAAiDL,EAAK,GAAtD,OAEJH,EAAQK,GAAaF,KAGzBM,KAAKnB,WAAaD,EAAKO,UACvBa,KAAKlB,SAAWS,EAChBS,KAAKjB,QAAU,KA7BvB,2CAgCI,WACI,OAAOiB,KAAKnB,aAjCpB,kBAoCI,WACI,OAAOmB,KAAKjB,SArCpB,IAwCI,SAAWkB,GACP,IAAMjB,EAAUC,OAAOC,oBAAoBc,KAAKnB,YAChD,GAAIG,EAAQI,WAAU,SAAAC,GAAM,OAAIA,IAAWY,KAAS,EAAG,CACnD,IAAMC,EAAYD,EAAME,MAAM,KAAK,GACnC,GAAInB,EAAQI,WAAU,SAAAC,GAAM,OAAIA,IAAWa,KAAa,EAEpD,YADAJ,QAAQM,MAAR,2CAAkDH,EAAlD,4BAA2ED,KAAKjB,QAAhF,OAGAe,QAAQC,KAAR,2CAAiDE,EAAjD,+BAA6EC,EAA7E,OACAD,EAAQC,EAIhBF,KAAKjB,QAAUkB,IArDvB,iBAwDI,SAAII,EAAgBC,GAChB,IAEIC,EAFEC,EAAMX,EAAaQ,GACnBX,EAAQM,KAAKlB,SAAS0B,GAiB5B,OAfKd,GAIDa,EAAmBb,EAAMM,KAAKjB,YAE1Be,QAAQC,KAAR,yCAA+CM,EAA/C,yBAAsEL,KAAKjB,QAA3E,MACAwB,EAAmBF,IANvBP,QAAQC,KAAR,0CAAgDM,EAAhD,MACAE,EAAmBF,GAQnBC,GACArB,OAAOwB,KAAKH,GAAQb,SAAQ,SAAAiB,GACxBH,EAAmBA,EAAiBI,QAAQ,KAAOD,EAAO,IAAvC,UAA+CJ,EAAOI,QAG1EH,MA3Ef,KA0FMV,EAAe,SAACQ,GAAD,OAAoBA,EAAOO,eCpG1CC,EAAO,IAAIlC,E,QACjBkC,EAAKxB,QD0FGyB,UAAU3B,WAAa2B,UAAU3B,UAAU4B,OAAS,EAC3CD,UAAU3B,UAAU,GAEpB2B,UAAUE,UAAaF,UAAkBG,cAAiBH,UAAkBI,iBAAmB,MAE9Ff,MAAM,KAAK,GC7FdU,Q,yBCNFM,EAAb,kDAGI,WAAYC,EAAoBC,GAAwB,IAAD,8BACnD,cAAMA,IAHDD,gBAE8C,EAEnD,EAAKA,WAAaA,EAFiC,EAH3D,sBAA+B9B,QCMxB,SAASgC,EAAgBC,GAC5B,OAAIA,EACO,CACHC,QAAS,CAAC,CAAC,gBAAD,iBAA4BD,MAGvC,GAGJ,SAASE,EAAeC,EAAaC,GACxC,GAAIA,EAAMZ,OAAS,EAAG,CAClB,IAAMa,EAAcD,EAAME,KAAI,SAAAC,GAAE,OAAIA,EAAGD,IAAIE,oBAAoBC,KAAK,QAAMA,KAAK,KAC/E,OAAKN,EAAIO,SAAS,KAENP,EAAIQ,SAAS,KAGdR,EAAOE,EAFPF,EAAO,IAAME,EAFbF,EAAM,IAAME,EAO3B,OAAOF,EA4BJ,SAASS,EAAeT,EAAaU,GACxC,OA1BG,SAAiBV,EAAaU,GAMjC,OAAOC,MAAMX,EAAKU,GACbE,MAAK,SAAAC,GACF,IAAKA,EAASC,GACV,MAAM,IAAIrB,EAAUoB,EAASE,OAAQF,EAASG,YAElD,OAAOH,KAEVI,OAAM,SAAAvC,GACH,MAAIA,aAAiBwC,WACjB9C,QAAQM,MAAM,qCAA8BsB,EAA9B,MACG,oEAAqEtB,GAChF,IAAId,MAAMuB,EAAKgC,IAAI,0BAEzB/C,QAAQM,MAAMA,GACRA,MAMX0C,CAAQpB,EAAKU,GAAME,MAAK,SAAAC,GAAQ,OAAIA,EAAS3D,UC9CxD,SAASmE,EAAeC,GACpB,IAAMC,EAA0B,GAC1BC,EAAc,GAapB,OAZAF,EAAevD,SAAQ,SAAC0D,GACpB,IAAMC,EAAQD,EAAc,GACtBE,EAAcF,EAAc,GAC5BG,EAAkB,GACxBH,EAAc,GAAG1D,SAAQ,SAAC8D,GACtB,IAAM7C,EAAO6C,EAAS,GAChBC,EAAQD,EAAS,GACvBD,EAAMG,KAAK/C,GACXwC,EAAOxC,GAAQ8C,KAEnBP,EAAOQ,KAAK,CAACL,QAAOC,cAAaC,aAE9B,CAACL,SAAQC,U,mBCZpB,SAASQ,EAAgCC,GACrC,OAAOA,EAAS9B,IAAI+B,GAGxB,SAASA,EAA+BC,GACpC,GAAIA,EAAQC,YAAcD,EAAQC,WAAW/C,OAAQ,CACjD,IAAI+C,EAAaD,EAAQC,WACnBnE,EAAQmE,EAAW1E,WAAU,SAAC2E,GAAD,MAA6C,SAAnBA,EAAUrD,QACvE,GAAIf,GAAS,EAAG,CACZ,IAAMqE,EAAgBF,EAAWnE,GAC7BsE,EAAuBD,EAAcE,YACzC,GAAID,GAAmBA,EAAgBlD,QAAwC,kBAAvBkD,EAAgB,GAAiB,CACrF,IAAIE,EAASF,EACTC,EAAcC,EAAOtC,KAAI,SAACuC,GAAD,OAAmB,IAAIC,KAAKD,GAAOE,aAGhE,OAFAR,EAAU,YAAOA,IACNnE,GAAX,2BAAwBqE,GAAxB,IAAuCE,cAAaC,WAC7C,2BAAIN,GAAX,IAAoBC,iBAIhC,OAAOD,EC5BJ,SAASU,EACZC,EACAC,EACAC,EACAnD,GAEA,IAAMa,EAAOd,EAAgBC,GACvBoD,EAAO5C,mBAAmB0C,GAC1BG,EAAO7C,mBAAmB2C,GAChC,OAAOvC,EAAW,UACXqC,EADW,qBACcG,EADd,mBAC6BC,GAC3CxC,GCfD,IAAMyC,EAAb,wIAAoCvF,QAqB7B,SAASwF,EAAwBC,EAAaC,IAZ9C,SAAuBD,EAAaC,GACvC,GAAe,OAAXD,EACA,MAAM,IAAIF,EAAJ,4BAAwCG,EAAxC,sBAWVC,CAAcF,EAAQC,GAPnB,SAAuBD,EAAaC,GACvC,GAAsB,qBAAXD,EACP,MAAM,IAAIF,EAAJ,4BAAwCG,EAAxC,2BAMVE,CAAcH,EAAQC,GASnB,SAASG,EAAoBC,EAAYC,GAE5C,GARG,SAAqBD,EAAYC,GACpC,IAAKC,MAAMC,QAAQH,GACf,MAAM,IAAIP,EAAJ,4BAAwCQ,EAAxC,sBAKVG,CAAYJ,EAAOC,GACE,IAAjBD,EAAMrE,OACN,MAAM,IAAI8D,EAAJ,4BAAwCQ,EAAxC,+BC0BP,SAASI,EAAY9B,EAAqB+B,GAC7C,OAAQA,GAAqB/B,EAASgC,MAAK,SAAA9B,GAAO,OAAIA,EAAQ+B,KAAOF,MAAuB,KAGzF,SAASG,EAAoBhC,EAAkBiC,GAClD,OAAQA,GAAgBjC,EAAQkC,UAAUJ,MAAK,SAAAK,GAAQ,OAAIA,EAAStF,OAASoF,MAAkB,KAG5F,SAASG,EAAwBpC,GACpCiB,EAAwBjB,EAAS,WACjCsB,EAAoBtB,EAAQC,WAAY,sBACxC,IAAMC,EAAiBF,EAAQC,WAAW6B,MAAK,SAAA5B,GAAS,MAAuB,SAAnBA,EAAUrD,QACtE,OAAKqD,GAGLoB,EAAoBpB,EAAWG,YAAa,6BAC5CiB,EAAoBpB,EAAWI,OAAQ,wBAChCJ,GAJI,KAOR,SAASmC,EAAoBrC,GAChC,IAAMG,EAAgBiC,EAAwBpC,GAC9C,IAAKG,EACD,OAAO,KAEX,IAAME,EAAcF,EAAcE,YAClC,MAAO,CAACA,EAAY,GAAIA,EAAYA,EAAYnD,OAAS,I,6CCvFhDoF,EAAb,wIAAgC7G,QAcnB8G,EAAoC,CAC7CC,UAAW,IACXC,QAAS,IACTC,MAAO,IACPC,OAAQ,KACRC,MAAM,EACNC,SAAU,MACVC,UAAW,OACXC,WAAY,SAMT,SAASC,EAASC,EAAcC,GACnC,OAAO,IAAIC,EAAOD,GAASE,MAAMH,G,IAG/BE,E,WAGF,WAAYD,GAAkC,yBAFrCA,aAEoC,EACzC/G,KAAK+G,QAAL,2BACOX,GACAW,GAEP/G,KAAKkH,UAAYlH,KAAKkH,UAAUC,KAAKnH,M,yCAGzC,SAAM8G,GACF,OAAO9G,KAAKoH,UAAUN,GAAMjF,IAAI7B,KAAKkH,a,uBAGzC,SAAUJ,GAAuB,IAAD,EACJ9G,KAAK+G,QAAtBT,EADqB,EACrBA,QAASG,EADY,EACZA,KAChB,OAAOK,EACF3G,MAAM,MACN0B,KAAI,SAACwF,EAAM1H,GAIR,OAHI8G,IACAY,EAAOA,EAAKZ,QAET,CAACY,EAAM1H,MAEjB2H,QAAO,YAA6B,IAAD,mBAA1BD,EAA0B,UAChC,MAAuB,KAAhBA,EAAKZ,SAAkBY,EAAKE,WAAWjB,Q,uBAI1D,YAMI,IANqC,IA8D9BkB,EAAoCC,EA9DP,mBAA7BJ,EAA6B,KAAvB1H,EAAuB,OACDK,KAAK+G,QAAjCV,EAD6B,EAC7BA,UAAWE,EADkB,EAClBA,MAAOC,EADW,EACXA,OACrBkB,GAAY,EACZpH,EAAkB,GAClBqH,EAAQ,EACRC,EAAM,EACHA,EAAMP,EAAKtG,OAAQ6G,IAAO,CAC7B,IAAMC,EAAOR,EAAKO,GACdC,IAASrB,EACToB,IACOF,EACHG,IAAStB,IACTmB,GAAY,GAETG,IAAStB,EAChBmB,GAAY,EACLG,IAASxB,IAChBrG,KAAK8H,aAAaT,EAAMM,EAAOC,EAAKtH,GACpCqH,EAAQC,EAAM,GAGtB,GAAIF,EACA,MAwCGF,EAxCS,4BAAD,OAA6BxH,KAAK+G,QAAQR,MAA1C,KAwC4BkB,EAxC+BE,EAyCvE,IAAIxB,EAAJ,eAzCgExG,EAyC7B,EAAnC,oBAAgD8H,EAAW,EAA3D,aAAiED,IAtCpE,OADAxH,KAAK8H,aAAaT,EAAMM,EAAOC,EAAKtH,GAC7BA,I,0BAGX,SAAa+G,EAAcM,EAAeC,EAAatH,GACnD,IAAMyH,EAAQV,EAAKW,MAAML,EAAOC,GAChCtH,EAAOmD,KAAKzD,KAAKiI,WAAWF,M,wBAGhC,SAAWA,GACP,IAAMhB,EAAU/G,KAAK+G,QAIrB,GAHIA,EAAQN,OACRsB,EAAQA,EAAMtB,QAEJ,KAAVsB,EACA,OAAO,KAEX,GAAIA,EAAMR,WAAWR,EAAQR,OACzBwB,EAAQA,EAAMG,UAAU,EAAGH,EAAMhH,OAAS,OACvC,CACH,GAAIgH,IAAUhB,EAAQJ,UAClB,OAAO,EAEX,GAAIoB,IAAUhB,EAAQH,WAClB,OAAO,EAEX,GAAImB,IAAUhB,EAAQL,SAClB,OAAOyB,OAAOC,IAElB,IAAMnI,EAAQoI,WAAWN,GACzB,IAAKI,OAAOG,MAAMrI,GACd,OAAOA,EAGf,OAQR,SAAwB8H,EAAevB,GACnC,IAAIoB,EAAMG,EAAMQ,QAAQ/B,GACxB,GAAIoB,EAAM,EACN,OAAOG,EAIX,IAFA,IAAIJ,EAAQ,EACRa,EAAS,GACNZ,EAAMG,EAAMhH,OAAQ6G,IACnBG,EAAMH,KAASpB,IACfgC,GAAUT,EAAMG,UAAUP,EAAOC,GAAOG,EAAMG,UAAUN,EAAM,EAAGA,EAAM,GAEvED,EADAC,GAAO,GAKf,OADAY,GAAUT,EAAMG,UAAUP,EAAOI,EAAMhH,QAtB5B0H,CAAeV,EAAOhB,EAAQP,Y,KCpH7C,IAYakC,EAAoB,CAC7BhI,KAAM,WACNiI,QAAS,YACTC,WAfe,SAAC9B,GAChB,GAAoB,KAAhBA,EAAKL,OACL,IACII,EAASC,GACX,MAAO+B,GAEL,OADA/I,QAAQM,MAAMyI,GACR,GAAN,OAAUA,GAGlB,OAAO,OAkBEC,EAA6B,2BACnC1C,GADmC,IAEtC2C,MAAO,YACPC,MAAO,WACPC,eAAe,EACfC,aAAc,WACdC,UAAW,OACXC,YAAa,SCvBJC,EAAwB,CACjC3I,KAAM,UACNiI,QAAS,iBACTC,WAfe,SAAC9B,GAChB,GAAoB,KAAhBA,EAAKL,OACL,IACI6C,KAAKrC,MAAMH,GACb,MAAO+B,GAEL,OADA/I,QAAQM,MAAMyI,GACR,GAAN,OAAUA,GAGlB,OAAO,OAcEU,EAAwC,CACjDC,WAAY,yBACZJ,YAAa,YCpBJK,EAAoB,CAC7B/I,KAAM,MACNiI,QAAS,YACTC,WARe,SAAC9B,GAEhB,OAAO,OAcE4C,EAAgC,CACzCtF,MAAO,GACPgF,YAAa,QCrBV,SAASO,IACZ,OAAQC,KAAKC,SAASC,SAAS,IAAIC,OAAO,GAAK,IAAM1F,KAAK2F,MAAMF,SAAS,KAAKG,c,2OCclF,IAAMC,GAfN,WACI,IAAMxI,EAAM,IAAIyI,IAAIC,OAAOC,SAASC,MAC9BC,EAAiB7I,EAAI8I,SAASrK,MAAM,KACpCsK,EAAoBF,EAAexJ,OACzC,OAAI0J,EAAoB,EAEE,eADAF,EAAeE,EAAoB,GAE9C,IAAIN,IAAII,EAAevC,MAAM,EAAGyC,EAAoB,GAAGzI,KAAK,KAAMoI,OAAOC,SAASK,QAElF,IAAIP,IAAIzI,EAAI8I,SAAUJ,OAAOC,SAASK,QAG9C,IAAIP,IAAIC,OAAOC,SAASK,QAGnBC,GAEDT,MCRR,SAASU,GAAUC,GAA+C,IACrE,IAAIC,EAAOD,EAD0D,mBAA9BE,EAA8B,iCAA9BA,EAA8B,kBAErE,cAAcA,EAAd,eAA0B,CAArB,IAAIC,EAAC,KACI,KAANA,IACIF,EAAK5I,SAAS,KACV8I,EAAEzD,WAAW,KACbuD,GAAQE,EAAEjB,OAAO,GAEjBe,GAAQE,EAGRA,EAAEzD,WAAW,KACbuD,GAAQE,EAERF,GAAQ,IAAME,GAK9B,OAAOF,EDTXhL,QAAQmL,IAAI,aAAcf,GAAQI,MEUlC,IAAMY,GAA6C,CAC/CC,WACAC,UACAC,cACAC,WACAC,UACAC,gBACAC,gBACAC,WACAC,UACAC,YACAC,eACAC,gBACAC,UACAC,YACAC,UACAC,YACAC,SACAC,UACAC,aA8BJ,SAASC,GAAiBC,EAAqB/L,GAC3C,IAAMgM,EAAYD,EAAe/L,GACjC,GAAyB,kBAAdgM,EAAwB,CAC/B,IAAMC,EAAQvB,GAAOsB,GACrB,IAAIC,EAGA,MAAM,IAAInN,MAAJ,mBAAsBkB,EAAtB,aAA8BgM,EAA9B,iBAFND,EAAe/L,GAAOiM,GAc3B,SAASC,GAAcH,EAAqBI,GAK/C,OAHAL,GADAC,EAAc,eAAOA,GACY,gBACjCD,GAAiBC,EAAgB,kBAVrC,SAA0BA,EAAqB/L,EAAqBmM,GAChE,IAAMC,EAAYL,EAAe/L,GACR,kBAAdoM,IACPL,EAAe/L,GAAOoK,GAAUV,GAAQI,KAAMqC,EAAYC,IAQ9DC,CAAiBN,EAAgB,YAAaI,GACvCJ,EChFJ,IAAMO,GAAY,IAAIC,gBAAgB3C,OAAOC,SAAS2C,QAKhDC,GAAb,WAOI,WACIvM,EACAwM,EACAC,EACAC,GACD,yBAXM1M,UAWP,OAVOwM,YAUP,OATOC,cASP,OAROC,gBAQP,EACEpN,KAAKU,KAAOA,EACZV,KAAKkN,OAASA,EACdlN,KAAKmN,SAAWA,EAChBnN,KAAKoN,WAAaA,EAhB1B,sFAmBI,0GACQT,EAAaG,GAAUjK,IAAI,eAAiB,SAE1CwK,EAAYzC,GAAUV,GAAQI,KAAMqC,EAAY,eAH1D,kBAK0BtK,MAAMgL,GALhC,cAKQC,EALR,gBAM0BA,EAAU1O,OANpC,OAMQ0O,EANR,yDAWQX,EAAa,GACbW,EAAYC,GAZpB,eAmBU7M,EAAO4M,EAAU5M,MAAQ,UACzB0M,EAAaE,EAAUF,YAAV,eAA4BE,EAAUF,aACnDF,EArBV,2BAqBuBK,GAAiBL,QAAWI,EAAUJ,SAClDtH,GAAKkH,GAAUjK,IAAI,aAAeqK,EAAOtH,GAChDsH,EAAOxM,KAAOoM,GAAUjK,IAAI,eAAiBqK,EAAOxM,KACpDwM,EAAOxL,IAAMoL,GAAUjK,IAAI,cAAgBqK,EAAOxL,IAC5C8L,EAAuD,GAA7CC,SAASX,GAAUjK,IAAI,YAAc,KAC/CsK,EAAWT,GAAc,uCAEpBa,GAAiBJ,UACjBG,EAAUH,UAHS,IAItBK,QAASA,KAAaF,EAAUH,SAASK,UAE7Cb,GAEJM,EAAOS,UAAY,IAAIT,EAAOvM,EAAMwM,EAAQC,EAAUC,GAIlDD,EAASQ,aACT3N,KAAK4N,kBAAkBT,EAASQ,aAEhCR,EAASU,YACT7N,KAAK8N,iBAAiBX,EAASU,YA1CvC,kBA4CWZ,EAAOS,WA5ClB,0DAnBJ,0EAkEI,WAEI,OADAT,EAAOc,qBACAd,EAAOS,YApEtB,gCAuEI,WACI,IAAKT,EAAOS,UACR,MAAM,IAAIpO,MAAM,qDAzE5B,+BA6EI,SAAiC8D,GAC7B4K,SAAS5K,MAAQA,IA9EzB,8BAiFI,SAAgC6K,GAC5B,IAAIC,EAAUF,SAASG,cAA+B,oBACtC,OAAZD,EACAA,EAAQ5D,KAAO2D,IAEfC,EAAUF,SAASI,cAAc,SACzBC,IAAM,OACdH,EAAQ5D,KAAO2D,EACfD,SAASM,KAAKC,YAAYL,QAzFtC,KAAajB,GAKMS,e,EAiGnB,IAAMc,GAA0C,CAC5C,CAAC,SAAUnC,MACX,CAAC,MAAOF,MACR,CAAC,OAAQF,MACT,CAAC,YAAaJ,MACd,CAAC,QAASH,MACV,CAAC,SAAUM,MACX,CAAC,OAAQD,MACT,CAAC,SAAUG,MACX,CAAC,SAAUN,MACX,CAAC,OAAQL,MACT,CAAC,aAAcE,OAGbgD,GAA8C,WAChD,IAAMC,EAAiC,GAIvC,OAHAF,GAAqB/O,SAAQ,YAAoB,IAAD,mBAAjBiB,EAAiB,KAAX+L,EAAW,KAC5CiC,EAAIhO,GAAQ+L,KAETiC,EALyC,GAQvCC,GAAsBH,GAAqB3M,KAAI,mCAAEnB,EAAF,iBAAeA,KAOpE,SAASkO,GAAsBjP,GAClC,OAAOgP,GAAoBhP,EAAQgP,GAAoB5N,QAGpD,SAAS8N,GAAkBrC,EAAmBsC,GACjD,IAAMC,EATH,SAAwBD,GAC3B,MAAuB,UAAhBA,EAA0B,IAAM,IAQzBE,CAAeF,GAC7B,OAAOL,GAAgBjC,GAAWuC,GAItC,IAAME,GAA6C,CAC/C,OAAU,CACNC,MAAO,eACPnH,MAAO,6FC1HR,IAAMoH,GAA+BC,GAAQ,CAAC,QAAS,QAAS,OAAQ,OAClEC,GAAqCD,GAAQ,CAAC,cAAe,OAAQ,WAAY,YACjFE,GAA+BF,GAAQ,CAAC,UACxCG,GAA+BH,GAAQ,CAAC,QAAS,MAAO,UAAW,QAezE,IAAMI,GAAeC,aAbrB,SAA0BC,EAAwBC,GACrD,IAAMC,EAAU,GAShB,OARAC,GAAgBD,EAASF,EAAYC,EAAO,QAASA,EAAM/J,GAAK,GAC5DuJ,IACJU,GAAgBD,EAASF,EAAYC,EAAO,QAASf,GAiGzD,SAAsBe,GAClB,IACcG,EADRlK,EAAK+J,EAAM/J,GAAK,GAClBmK,EAAO,EACX,GAAkB,IAAdnK,EAAG7E,OACH,OAAOgP,EAEX,IAAKD,EAAI,EAAGA,EAAIlK,EAAG7E,OAAQ+O,IAEvBC,GAASA,GAAQ,GAAKA,EADlBnK,EAAGoK,WAAWF,GAElBC,GAAQ,EAEZ,OAAOA,EA5GoEE,CAAaN,IACpFL,IACJO,GAAgBD,EAASF,EAAYC,EAAO,QAAS,KACjDJ,IACJM,GAAgBD,EAASF,EAAYC,EAAO,cAAe,KACvDN,IACG,aAACK,aAAYC,SAAUC,MAMlC,SAASC,GAAgBD,EACAF,EACAC,EACAO,EACAC,EACAC,GACrB,IAAIC,EACEC,EAAsBZ,EAAWa,iBAAmBb,EAAWa,gBAAgBL,GACrF,GAAII,EAAqB,CACrB,GAAIA,EAAoBrO,SAAS,MAE7B,YADA2N,EAAQM,GAgBpB,SAAsCP,EAAcU,GAChD,IAAIG,EAAoBH,EACxB,GAAIV,EAAMc,WAAY,CAAC,IAAD,gBACDxR,OAAOC,oBAAoByQ,EAAMc,aADhC,IAClB,2BAA+D,CAAC,IAAvD/P,EAAsD,QAC3D,IAAK8P,EAAkBvO,SAAS,MAC5B,MAEJ,IAAMyO,EAAc,KAAOhQ,EAAO,IAC9B8P,EAAkBvO,SAASyO,KAC3BF,EAAoBA,EAAkB7P,QAAQ+P,EAA1B,UAA0Cf,EAAMc,WAAW/P,OAPrE,+BAWtB,OAAO8P,EA7ByBG,CAA6BhB,EAAOW,IAG5DF,EAAqBrP,OAAS,GAAKqP,EAAqB,KAAOE,IAC/DF,EAAoB,CAAIE,GAAJ,mBAA4BF,KAGpDT,EAAMc,aACNJ,EAAgBO,GAAiBjB,EAAMc,WAAYL,SAEjCS,IAAlBR,IACAA,EAAgBO,GAAiBjB,EAAOS,IAE5CR,EAAQM,GAAgBG,GAAiBF,EAmB7C,SAASS,GAAiBE,EAAgBC,GACtC,IAD+D,gBAEtCA,GAFsC,IAE/D,2BAAwC,CAAC,IAAhCb,EAA+B,QACpC,GAAIA,KAAgBY,EAChB,OAAOA,EAAUZ,IAJsC,+BAWnE,SAASd,GAAQ9L,GACb,IADwC,EACpC0N,EAAsB,GADc,cAEvB1N,GAFuB,IAExC,2BAAwB,CAAC,IAAhB5C,EAAe,QACpBsQ,EAAYA,EAAUC,OAAOvQ,EAAKE,cAC9BF,EAAKuJ,cACLvJ,EAAK,GAAGuJ,cAAgBvJ,EAAKqJ,OAAO,GAAGnJ,gBALP,8BAOxC,OAAOoQ,EAGJ,SAASE,GAAaC,EAA2BC,GACpDD,EAAY1R,SAAQ,SAAAiQ,GACZ2B,GAAkB3B,IAClBA,EAAW4B,SAAS7R,SAAQ,SAACkQ,GACzByB,EAAS1B,EAAYC,SAgC9B,SAAS0B,GAAkB3B,GAC9B,QAASA,EAAW4B,SAGjB,SAASC,GAAsB7B,EAAwB8B,GAC1D,IAAKA,IAAYH,GAAkB3B,GAC/B,OAAO,KAEX,IAAMC,EAAQD,EAAW4B,SAAS3L,MAAK,SAAAgK,GAAK,OAAIA,EAAM/J,KAAO4L,KAC7D,GAAM7B,EACF,OAAOA,EAEX,IAAI8B,EAAiB/B,EAAWyB,YAChC,GAAIM,EACA,IAAK,IAAIC,KAAiBD,EAAgB,CACtC,IAAM9B,EAAQ4B,GAAsBE,EAAeC,GAAgBF,GACnE,GAAM7B,EACF,OAAOA,EAInB,OAAO,KAGJ,SAASgC,GAAuBR,EAA2BK,GAC9D,GAAIA,EAAS,CAAC,IAAD,gBACcL,GADd,IACT,2BAAoC,CAAC,IAC3BxB,EAAQ4B,GADkB,QACgBC,GAChD,GAAc,OAAV7B,EACA,OAAOA,GAJN,+BAQb,OAAO,KAIX,IAAIiC,GAA0B,EAC1BC,GAA8B,EAC9BC,GAA0B,EAmL9B,SAASC,GAAkBC,EAAsBvB,GAC7C,MAAO,CACHwB,KAAM,UACNrM,GAAI+D,IACJqI,UAAU,IAAIE,KAAkBC,oBAAoBH,GACpDvB,WAAYA,G,kFCjYb,SAAS2B,GAAOC,GACnB,OAAQ,eAAC,WAAD,UAAiBA,EAAMC,W,sDCRtBC,I,cAAiB,aACjBC,GAAmB,YAEnBC,GAAkBD,GCkBlBE,GAAiBC,gBAAgC,CAACC,WAAY,KAerEC,GAA+C,CAACC,MAAO,OAAQC,OAAQ,QAEhEC,GAAb,kDAKI,WAAYX,GAAkB,IAAD,uBACzB,cAAMA,IAJOY,kBAGY,IAFrBC,eAAqC,KAEhB,EAoIrBC,YAAc,SAACC,GACnB,IAAMC,EAAU,EAAKhB,MAAMgB,QACvBA,GACAA,EAAQD,IAvIa,EA2IrBE,WAAa,SAACF,GAClB,GAAI,EAAKf,MAAMkB,YAAa,CACxBH,EAAMI,iBAEN,IAAMC,EAAgB,GACtB,GAAIL,EAAMM,aAAaC,MACnB,IAAK,IAAI7D,EAAI,EAAGA,EAAIsD,EAAMM,aAAaC,MAAM5S,OAAQ+O,IAAK,CACtD,IAAM8D,EAAOR,EAAMM,aAAaC,MAAM7D,GAEtC,GAAkB,SAAd8D,EAAKC,KAAiB,CACtB,IAAMC,EAAOF,EAAKG,YACL,OAATD,GACAL,EAAMhQ,KAAKqQ,SAIpB,GAAIV,EAAMM,aAAaD,MAC1B,IAAK,IAAI3D,EAAI,EAAGA,EAAIsD,EAAMM,aAAaD,MAAM1S,OAAQ+O,IAAK,CACtD,IAAMgE,EAAOV,EAAMM,aAAaD,MAAM3D,GACzB,OAATgE,GACAL,EAAMhQ,KAAKqQ,GAInBL,EAAM1S,QACN,EAAKsR,MAAMkB,YAAYE,KApKN,EAyKrBO,eAAiB,SAACZ,GAClB,EAAKf,MAAMkB,aACXH,EAAMI,kBA3Ke,EA+KZS,UAAY,SAACC,GAC1B,EAAKjB,aAAaiB,OAASA,GAhLF,EAmLrBC,aAAe,WACnB,IAAMD,EAAS,EAAKjB,aAAaiB,OAC3BrS,EAAM,EAAKoR,aAAapR,IAC9B,GAAIqS,GAAUrS,EAAK,CACfA,EAAIuS,aACJ,IAAMC,EAAOxS,EAAIyS,UACXC,EAAU,EAAKC,WAAWN,GAC5BK,IAAYF,EAAKG,cACjBH,EAAKI,WAAWF,KA3LC,EAgMrBC,WAAa,SAACE,GAGlB,IAAMC,EAAOD,EAAOE,YACdL,EAAU3K,KAAKiL,MAAQjL,KAAKqB,IAAI0J,EAAO,KAC7C,OAAIJ,GAAW,EACJA,EAEJ,GAxMkB,IAIlB3O,EAAkByM,EAAlBzM,GAAIgN,EAAcP,EAAdO,WAJc,OAMrB,EAAKK,aADLL,EACoB,CAChB/Q,IAAK+Q,EAAWhN,SAAgBiL,EAChC+B,WAAYA,GAGI,CAChBA,WAAY,IAZK,EALjC,qDAsBI,WAA0B,IAGfhN,EAAM5F,KAAKqS,MAAXzM,GACDsO,EAASlU,KAAKiT,aAAaiB,OAE7BrS,EAAoB,KACxB,GAAI7B,KAAKqS,MAAMyC,QAAS,CACpB,IAAMC,EAAY/U,KAAKiT,aAAaL,WAAWhN,GAC3CmP,aAAqBC,QACrBnT,EAAMkT,GACFE,UAAUf,GACVlU,KAAKkT,gBACLrR,EAAIqT,GAAG,QAASlV,KAAKkT,eAAeiC,WAKhD,IAAKtT,EAAK,CACN,IAAMuT,EAAcpV,KAAKwU,WAAWN,GAC9BG,EAAO,IAAIgB,KAAO,CACpBC,WAAY7C,GACZ8C,OAAQ,CAAC,EAAG,GACZhB,QAASa,EACTI,KAAMJ,IAEVvT,EAAM,IAAImT,KAAJ,yBACFX,QACGrU,KAAKyV,iBAFN,IAGFf,OAAQR,KAIhBlU,KAAKiT,aAAapR,IAAMA,EACxB7B,KAAKiT,aAAaL,WAAWhN,GAAM/D,EAEnC7B,KAAKkT,eAAiBrR,EAAI6T,GAAG,QAAS1V,KAAKmT,aAG3CtR,EAAIuS,aAGJpU,KAAK2V,cAILvL,OAAOwL,iBAAiB,SAAU5V,KAAKmU,cAEvC,IAAM0B,EAAW7V,KAAKqS,MAAMwD,SACxBA,GACAA,EAAShU,KAxErB,gCA4EI,SAAmBiU,GAGf,IAAMjU,EAAM7B,KAAKiT,aAAapR,IACxBqS,EAASlU,KAAKiT,aAAaiB,OAC3B6B,EAAa/V,KAAKyV,gBACxB5T,EAAImU,cAAJ,eAAsBD,IACtBlU,EAAIoT,UAAUf,GAMdrS,EAAIuS,eAzFZ,kCA4FI,WAIIhK,OAAO6L,oBAAoB,SAAUjW,KAAKmU,cAM1C,IAAM0B,EAAW7V,KAAKqS,MAAMwD,SACxBA,GACAA,EAAS,QAxGrB,oBA4GI,WACI,IAAIK,EAQJ,OAPIlW,KAAKiT,aAAapR,MAClBqU,EACI,eAACxD,GAAeyD,SAAhB,CAAyBlW,MAAOD,KAAKiT,aAArC,SACKjT,KAAKqS,MAAMC,YAKpB,sBACI8D,IAAKpW,KAAKiU,UACVoC,MAAOxD,GACPyD,WAAYtW,KAAKgU,eACjBuC,OAAQvW,KAAKsT,WAJjB,SAMK4C,MA5HjB,2BAiII,WACI,IAAMH,EAAU,eAAO/V,KAAKqS,OAI5B,cAHO0D,EAAU,gBACVA,EAAU,eACVA,EAAU,YACVA,MAtIf,GAAyBpD,aC3BH6D,GAAtB,4MAGIC,QAAsB,GAH1B,EAII1R,OAAmB,KAJvB,kDAYI,SAAaa,GACT,OAAQ5F,KAAKyW,QAAQ7D,YAAc5S,KAAKyW,QAAQ7D,WAAWhN,IAAQ,OAb3E,wBAgBI,WACI,IAAImB,EAAY,eAAO/G,KAAKqS,OAE5B,cADOtL,EAAQnB,GACRmB,IAnBf,+BAsBI,WAEI/G,KAAK0W,iBAAiB1W,KAAK2W,aAAa3W,KAAKyW,QAAQ5U,QAxB7D,gCA2BI,SAAmBiU,GAEf9V,KAAK0W,iBAAiB1W,KAAK4W,gBAAgB5W,KAAKyW,QAAQ5U,IAAM7B,KAAK+E,OAAS+Q,MA7BpF,kCAgCI,WAEI,IAAMjU,EAAM7B,KAAKyW,QAAQ5U,IACzB7B,KAAK6W,gBAAgBhV,EAAK7B,KAAK+E,QAC3B/E,KAAKqS,MAAMzM,WACJ5F,KAAKyW,QAAQ7D,WAAY5S,KAAKqS,MAAMzM,IAE/C5F,KAAK+E,OAAS,OAvCtB,8BA0CI,SAAyBA,GACP,MAAVA,GAAkB/E,KAAKqS,MAAMzM,KAC7Bb,EAAO+R,IAAI,WAAY9W,KAAKqS,MAAMzM,IAClC5F,KAAKyW,QAAQ7D,WAAY5S,KAAKqS,MAAMzM,IAAOb,GAE/C/E,KAAK+E,OAASA,IA/CtB,oBAkDI,WACI,OAAO,SAnDf,GAAwG4N,iBAAlF6D,GAEXO,YAAcrE,GCDzB,IAEIsE,GAIAA,GAAQ,aA4BL,IAAMC,GAAb,kKAEI,SAAapV,GACT,IAAMqV,EAAQ,IAAIC,KAAYnX,KAAKqS,OAEnC,OADAxQ,EAAIuV,YAAY3T,KAAKyT,GACdA,IALf,6BAQI,SAAgBrV,EAAYqV,EAAoBpB,GAC5C,IAAMuB,EAA0BH,EAAMI,YAChCC,EAAsCvX,KAAKqS,MAAMmF,OACvD,GAAID,GAAaF,IAAcE,EAAW,CAgBtC,IAAIE,GAAgB,EACpB,GAAIJ,aAAqBK,MAAmBH,aAAqBG,KAAiB,CAC9E,IAAMC,EAAoCN,EACpCO,EAAoCL,EAI1C,GAiGhB,SAAwBM,EAAyBC,GAK7C,GAJAd,GAAM,aAAca,EAAaC,GAEjCd,GAAM,YAAaa,EAAYrD,aAAcsD,EAAYtD,cACzDwC,GAAM,YAAaa,EAAYE,aAAcD,EAAYC,cACrDF,EAAYrD,eAAiBsD,EAAYtD,cACtCqD,EAAYE,eAAiBD,EAAYC,aAC5C,OAAO,EAIX,IAAMC,EAAYH,EAAYI,YACxBC,EAAYJ,EAAYG,YAC9BjB,GAAM,UAAWgB,EAAWE,GAC5B,IAAK,IAAIpI,EAAI,EAAGA,EAAIkI,EAAUjX,OAAQ+O,IAClC,GAAIkI,EAAUlI,KAAOoI,EAAUpI,GAC3B,OAAO,EAKf,IAAMqI,EAAiBN,EAAYO,iBAC7BC,EAAiBP,EAAYM,iBACnCpB,GAAM,eAAgBmB,EAAgBE,GACtC,IAAMC,EAAYH,EAAepX,OACjC,GAAIuX,IAAcD,EAAetX,OAC7B,OAAO,EAIX,IAAK,IAAIwX,EAAI,EAAGA,EAAID,EAAWC,IAAK,CAEhC,IAAMC,EAAgBX,EAAYY,cAAcF,GAC1CG,EAAgBZ,EAAYW,cAAcF,GAEhD,GADAvB,GAAM,cAAD,OAAeuB,EAAf,KAAqBC,EAAeE,GACrCF,IAAkBE,EAClB,OAAO,EAGX,IAAMC,EAAYd,EAAYe,UAAUL,GAClCM,EAAYf,EAAYc,UAAUL,GACxCvB,GAAM,UAAD,OAAWuB,EAAX,KAAiBI,EAAWE,GACjC,IAAK,IAAI/I,EAAI,EAAGA,EAAI6I,EAAU5X,OAAQ+O,IAClC,GAAI6I,EAAU7I,KAAO+I,EAAU/I,GAC3B,OAAO,EAIf,IAAIgJ,EAAcjB,EAAYkB,YAAYR,GACtCS,EAAclB,EAAYiB,YAAYR,GAC1CvB,GAAM,aAAD,OAAcuB,EAAd,KAAoBO,EAAaE,GACtC,IAAK,IAAIlJ,EAAI,EAAGA,EAAI6I,EAAU5X,OAAQ+O,IAOlC,GAN2B,kBAAhBgJ,IACPA,EAAc,CAACA,EAAaA,IAEL,kBAAhBE,IACPA,EAAc,CAACA,EAAaA,IAE5BF,EAAY,KAAOE,EAAY,IAC5BF,EAAY,KAAOE,EAAY,GAClC,OAAO,EAIf,IAAIC,EAAepB,EAAYqB,iBAAiBX,GAC5CY,EAAerB,EAAYoB,iBAAiBX,GAEhD,GADAvB,GAAM,cAAD,OAAeuB,EAAf,KAAqBU,EAAcE,GACpCF,GAAgBE,GAChB,GAAIF,EAAaG,aAAeD,EAAaC,YACtCH,EAAaI,cAAgBF,EAAaE,YAC7C,OAAO,OAER,GAAMJ,GAAkBE,EAC3B,OAAO,EAGf,OAAO,EA7KSG,CAFgB3B,EAAiB4B,cACjB3B,EAAiB2B,eACS,CAC1CvC,GAAM,4BACN,IAAMwC,EAAU7B,EAAiB8B,UAC3BC,EAAU9B,EAAiB6B,UAC7BD,IAAYE,IAAWA,GAAwB,OAAZF,GAAoBA,EAAQ,KAAOE,EAAQ,KAC9E/B,EAAiBgC,QAAQD,GACzBjC,GAAgB,GAEpB,IAAMmC,EAAsBjC,EAAiBkC,sBACvCC,EAAsBlC,EAAiBiC,sBACzCD,IAAwBE,IACxBnC,EAAiBoC,oBAAoBD,GACrCrC,GAAgB,GAEpB,IAAMuC,EAAqBrC,EAAiBsC,qBACtCC,EAAqBtC,EAAiBqC,qBACxCD,IAAuBE,IACvBvC,EAAiBwC,mBAAmBD,GACpCzC,GAAgB,QAGpBT,GAAM,oCAGd,IAAMoD,EAAoB/C,EAAUgD,oBAC9BC,EAAoB/C,EAAU8C,qBACmB,kBAAtBD,GACNA,EAA6CG,mBACjB,kBAAtBD,GACNA,EAA6CC,kBAEpE9C,GAAgB,GAGhBA,GAEAP,EAAMsD,UAAUjD,GAChBP,GAAM,gDAENA,GAAM,0DAqBd,OAhBIhX,KAAKqS,MAAMoI,SAAWza,KAAKqS,MAAMoI,UAAY3E,EAAU2E,SACvDvD,EAAMwD,WAAW1a,KAAKqS,MAAMoI,SAE5Bza,KAAKqS,MAAMsI,SAAW3a,KAAKqS,MAAMsI,UAAY7E,EAAU6E,SACvDzD,EAAM0D,WAAW5a,KAAKqS,MAAMsI,SAE5B3a,KAAKqS,MAAMwI,QAAU7a,KAAKqS,MAAMwI,SAAW/E,EAAU+E,QACrD3D,EAAM4D,UAAU9a,KAAKqS,MAAMwI,QAE3B7a,KAAKqS,MAAM0I,eAAiB/a,KAAKqS,MAAM0I,gBAAkBjF,EAAUiF,eACnE7D,EAAM8D,iBAAiBhb,KAAKqS,MAAM0I,eAElC/a,KAAKqS,MAAM4I,eAAiBjb,KAAKqS,MAAM4I,gBAAkBnF,EAAUmF,eACnE/D,EAAMgE,iBAAiBlb,KAAKqS,MAAM4I,eAG/B/D,IA9Ff,6BAiGI,SAAgBrV,EAAYqV,GACxBrV,EAAIuV,YAAY+D,OAAOjE,OAlG/B,GAA0BV,IAsGK,IAAI4E,KAC/B,CACI1Z,IAAK,uEACL2Z,aAAc,CACV,0EACA,oFAIc,IAAID,KAC1B,CACI1Z,IAAK,6GACL2Z,aAAc,CACV,wGACA,uFAIO,IAAIC,KAED,IAAIF,KACtB,CACI1Z,IAAK,sDACL2Z,aAAc,CACV,uG,cClKCE,GAAb,kKACI,SAAa1Z,GACT,IAAMqV,EAAQ,IAAIsE,KAAcxb,KAAKqS,OAErC,OADAxQ,EAAIuV,YAAY3T,KAAKyT,GACdA,IAJf,6BAOI,SAAgBrV,EAAYqV,EAAsBpB,GAoB9C,OAlBI9V,KAAKqS,MAAMmF,SAAW1B,EAAU0B,QAAUxX,KAAKqS,MAAMmF,QACrDN,EAAMsD,UAAUxa,KAAKqS,MAAMmF,QAE3BxX,KAAKqS,MAAMoI,SAAWza,KAAKqS,MAAMoI,UAAY3E,EAAU2E,SACvDvD,EAAMwD,WAAW1a,KAAKqS,MAAMoI,SAE5Bza,KAAKqS,MAAMsI,SAAW3a,KAAKqS,MAAMsI,UAAY7E,EAAU6E,SACvDzD,EAAM0D,WAAW5a,KAAKqS,MAAMsI,SAE5B3a,KAAKqS,MAAMwI,QAAU7a,KAAKqS,MAAMwI,SAAW/E,EAAU+E,QACrD3D,EAAM4D,UAAU9a,KAAKqS,MAAMwI,QAE3B7a,KAAKqS,MAAM0I,eAAiB/a,KAAKqS,MAAM0I,gBAAkBjF,EAAUiF,eACnE7D,EAAM8D,iBAAiBhb,KAAKqS,MAAM0I,eAElC/a,KAAKqS,MAAM4I,eAAiBjb,KAAKqS,MAAM4I,gBAAkBnF,EAAUmF,eACnE/D,EAAMgE,iBAAiBlb,KAAKqS,MAAM4I,eAE/B/D,IA3Bf,6BA8BI,SAAgBrV,EAAYqV,GACxBrV,EAAIuV,YAAY+D,OAAOjE,OA/B/B,GAA4BV,I,qBCFrB,SAASiF,GAAiBrW,EAAiBnF,GAC9C,IAAMyb,EAAItW,EAAMrE,OAChB,GAAU,IAAN2a,EACA,OAAQ,EAEZ,GAAU,IAANA,EACA,OAAO,EAEX,IAAIC,EAAK,EAAGC,EAAKF,EAAI,EACrB,GAAIzb,GAASmF,EAAMuW,GACf,OAAOA,EAEX,GAAI1b,GAASmF,EAAMwW,GACf,OAAOA,EAGX,IADA,IAA4BC,EAAxBC,EAAKlS,KAAKmS,MAAML,EAAI,GACf5L,EAAI,EAAGA,EAAI4L,EAAG5L,IAAK,CAExB,GAAI7P,GADJ4b,EAAazW,EAAM0W,IACK,CAAC,IAAD,EACT,CAAClS,KAAKmS,OAAOJ,EAAKG,GAAM,GAAIA,GAAtCA,EADmB,KACfF,EADe,SAEjB,MAAI3b,EAAQ4b,GAGf,OAAOC,EAHqB,IAAD,EAChB,CAACA,EAAIlS,KAAKmS,OAAOD,EAAKF,GAAM,IAAtCD,EAD0B,KACtBG,EADsB,KAK/B,GAAIH,IAAOG,GAAMA,IAAOF,EACpB,OAAOhS,KAAKoS,IAAI5W,EAAMuW,GAAM1b,IAAU2J,KAAKoS,IAAI5W,EAAMwW,GAAM3b,GAAS0b,EAAKC,EAGjF,OAAQ,E,ICjCCK,G,OCCAC,GAAmB,SAACC,GAAD,OAAqBA,EAAMC,UAAUzY,UAAY,IAEpE0Y,GAA2B,SAACF,GAAD,OAAqBA,EAAMC,UAAUE,kBAChEC,GAAyB,SAACJ,GAAD,OAAqBA,EAAMC,UAAUI,gBAC9DC,GAAsB,SAACN,GAAD,OAAqBA,EAAMC,UAAUM,aAAe,IAE1EC,GAAsBC,YAC/BV,GACAK,IACA,SAAC5Y,EAAqB6Y,GAClB,IAAMrL,EAAmB,GACnB0L,EAAmB,CAACL,GAY1B,OAXA7Y,EAASlE,SAAQ,SAAAoE,GACTA,EAAQsN,aACRtN,EAAQsN,YAAY1R,SAAQ,SAAAiQ,GACnByB,EAAYzB,EAAW9J,MACxBuL,EAAYzB,EAAW9J,IAAM8J,EAC7BmN,EAAiBpZ,KAAKiM,UAM/BmN,KCpBR,SAASC,GAAgBC,GAC5B,OAAOC,GAAY,eAAgBD,GAOvC,SAASC,GAAY/K,EAAyC8K,GAC1D,IACI,IAAME,EAAU7S,OAAO6H,GACjBiL,EAAI,mBAGV,OAFAD,EAAQE,QAAQD,EAAGA,GACnBD,EAAQG,WAAWF,GACZ,IAAIG,GAAQJ,EAA0BF,GAC/C,MAAOlU,GACL,OAAO,MAIR,IAAMwU,GAAb,WAKI,WAAYC,EAA8BP,GAAuB,yBAHhDO,mBAG+C,OAF/CP,kBAE+C,EAC5D/c,KAAKsd,cAAgBA,EACrBtd,KAAK+c,aAAeA,EAP5B,2CAUI,SAAQ7M,EAAsBC,EAAoBoN,GAC9C,IAAItd,EAAQD,KAAKsd,cAAcE,QAAQxd,KAAKyd,QAAQvN,IACpD,OAAc,OAAVjQ,EACOsd,EAASA,EAAOtd,GAASA,EAEzBkQ,IAfnB,2BAmBI,SAAcD,EAAsBC,GAChC,OAAOnQ,KAAKwd,QAAQtN,EAAcC,GAAc,SAAClQ,GAAD,OAAWqJ,KAAKrC,MAAMhH,QApB9E,gCAuBI,SAAsBiQ,EAAuBwE,EAAWgJ,GACpD1d,KAAK2d,YAAYzN,EAAcwE,EAAQgJ,GAAY,SAACzd,GAAD,MAAqB,SAAVA,OAxBtE,4BA2BI,SAAeiQ,EAAsBwE,EAAagJ,GAC9C1d,KAAK2d,YAAYzN,EAAcwE,EAAQgJ,EAAYjQ,YA5B3D,+BA+BI,SAAqByC,EAAuBwE,EAAWgJ,GACnD1d,KAAK2d,YAAYzN,EAAcwE,EAAQgJ,GAAY,SAACzd,GAAD,OAAWA,OAhCtE,+BAmCI,SAAqBiQ,EAAuBwE,EAAWgJ,GACnD1d,KAAK2d,YAAYzN,EAAcwE,EAAQgJ,GAAY,SAACzd,GAAD,OAAWqJ,KAAKrC,MAAMhH,QApCjF,yBAuCI,SAAuBiQ,EACHwE,EACAgJ,EACAH,GAChB7I,EAAOxE,GAAgBlQ,KAAKwd,QAAQtN,EAAwBwN,EAAWxN,GAAeqN,KA3C9F,qBA8CI,SAAQrN,EAAsBjQ,EAAY2d,GACtC,GAAqB,qBAAV3d,GAAmC,OAAVA,EAChCD,KAAKsd,cAAcF,WAAWpd,KAAKyd,QAAQvN,QACxC,CACH,IAAM2N,EAAiBD,EAAYA,EAAU3d,GAASA,EAAQ,GAC9DD,KAAKsd,cAAcH,QAAQnd,KAAKyd,QAAQvN,GAAe2N,MAnDnE,2BAuDI,SAAc3N,EAAsBjQ,GAChCD,KAAKmd,QAAQjN,EAAcjQ,GAAO,SAACA,GAAD,OAAWqJ,KAAKwU,UAAU7d,QAxDpE,kCA2DI,SAAwBiQ,EAAuBsH,GAC3CxX,KAAKmd,QAAQjN,EAAwBsH,EAAOtH,MA5DpD,+BA+DI,SAAqBA,EAAuBsH,GACxCxX,KAAK+d,cAAc7N,EAAwBsH,EAAOtH,MAhE1D,qBAmEI,SAAgBA,GACZ,MAAM,SAAN,OAAgBlQ,KAAK+c,aAArB,YAAqC7M,OApE7C,KCCO,SAAS8N,GAAkBC,GAC9B,IAAMhB,EAAUH,GAAgB7P,GAAOiR,SAASxd,MAChD,GAAIuc,EACA,IACIA,EAAQkB,qBAAqB,SAAUF,GACvChB,EAAQkB,qBAAqB,wBAAyBF,GACtDhB,EAAQkB,qBAAqB,qBAAsBF,GACnDhB,EAAQkB,qBAAqB,0BAA2BF,GACxDhB,EAAQkB,qBAAqB,2BAA4BF,GACzDhB,EAAQkB,qBAAqB,uBAAwBF,GACrDhB,EAAQkB,qBAAqB,wBAAyBF,GACtDhB,EAAQkB,qBAAqB,gBAAiBF,GAC9ChB,EAAQkB,qBAAqB,eAAgBF,GAC7ChB,EAAQmB,kBAAkB,wBAAyBH,GACnDhB,EAAQkB,qBAAqB,wBAAyBF,GACtDhB,EAAQkB,qBAAqB,gBAAiBF,GAC9ChB,EAAQkB,qBAAqB,aAAcF,GAC3ChB,EAAQkB,qBAAqB,mBAAoBF,GACjDhB,EAAQkB,qBAAqB,4BAA6BF,GAC1DhB,EAAQkB,qBAAqB,eAAgBF,GAC7ChB,EAAQkB,qBAAqB,2BAA4BF,GACzDhB,EAAQkB,qBAAqB,mBAAoBF,GACjDhB,EAAQkB,qBAAqB,iBAAkBF,GAC/ChB,EAAQkB,qBAAqB,uBAAwBF,GACrDhB,EAAQmB,kBAAkB,0BAA2BH,GACvD,MAAOpV,GACL/I,QAAQC,KAAR,yCAA+C8I,KCzCpD,IAAMwV,GAAoD,CAAC,IAAK,IAAK,IAAM,MAwE3E,SAASC,KACZ,IAAMnR,EAAWF,GAAOiR,SAAS/Q,SAiDjC,OD5EG,SAA0BoR,GAC7B,IAAMtB,EAAUH,GAAgB7P,GAAOiR,SAASxd,MAChD,GAAIuc,EAAS,CACT,IAAMgB,EAAQ,eAAOM,GACrB,IACItB,EAAQuB,kBAAkB,SAAUP,EAAUM,GAC9CtB,EAAQwB,mBAAmB,wBAAyBR,EAAUM,GAC9DtB,EAAQwB,mBAAmB,qBAAsBR,EAAUM,GAC3DtB,EAAQwB,mBAAmB,0BAA2BR,EAAUM,GAChEtB,EAAQwB,mBAAmB,2BAA4BR,EAAUM,GACjEtB,EAAQwB,mBAAmB,uBAAwBR,EAAUM,GAC7DtB,EAAQyB,eAAe,wBAAyBT,EAAUM,GAC1DtB,EAAQyB,eAAe,gBAAiBT,EAAUM,GAClDtB,EAAQwB,mBAAmB,eAAgBR,EAAUM,GACrDtB,EAAQ0B,kBAAkB,wBAAyBV,EAAUM,GAC7DtB,EAAQwB,mBAAmB,wBAAyBR,EAAUM,GAC9DtB,EAAQuB,kBAAkB,gBAAiBP,EAAUM,GACrDtB,EAAQuB,kBAAkB,aAAcP,EAAUM,GAClDtB,EAAQwB,mBAAmB,mBAAoBR,EAAUM,GACzDtB,EAAQuB,kBAAkB,4BAA6BP,EAAUM,GACjEtB,EAAQwB,mBAAmB,eAAgBR,EAAUM,GACrDtB,EAAQwB,mBAAmB,2BAA4BR,EAAUM,GACjEtB,EAAQwB,mBAAmB,mBAAoBR,EAAUM,GACzDtB,EAAQuB,kBAAkB,iBAAkBP,EAAUM,GACtDtB,EAAQuB,kBAAkB,uBAAwBP,EAAUM,GAC5DtB,EAAQ0B,kBAAkB,0BAA2BV,EAAUM,GAIjE,MAAO1V,GACL/I,QAAQC,KAAR,wCAA8C8I,IAElD,OAAOoV,EAIX,OAFIne,QAAQC,KAAK,4CAEVwe,ECwCAK,CAhDqB,CACxBlZ,kBAAmB,KACnBmZ,qBAAsB,KACtBC,sBAAuB,CAAC,QACxBC,gBAAiB,KACjBC,oBAAqB,KACrBC,iBAAkBhS,GAAOiR,SAAShR,OAAOtH,GACzCsZ,aAAc,KACdC,kBAAmB,KACnBC,qBAAsB,MACtBC,qBAAqB,EACrBC,sBAAuB,IACvBC,cAAe,GACfC,oBAAoB,EACpBC,0BAA0B,EAC1BC,yBAAyB,EACzBC,qBAA8C,WAAxBxS,EAASyS,WAC/BC,qBAAsB,MACtBC,wBAAyB,CACrBC,QAAQ,eAAKxW,GACbyW,IAAI,eAAKlX,GACTmX,IAAI,eAAKvW,IAEbwW,MAAO,KACPC,WAAY,GACZ9gB,OAAQ,KACR+gB,WAAY,GACZC,uBAAuB,EACvBC,eAAgB,QAChBC,mBAAoB,QACpBC,cAAc,EACdC,cAAc,EACdC,sBAAuB,CACnB7c,QAAS,CAAC4W,SAAS,EAAMkG,SAAU,QACnC3a,SAAU,CAACyU,SAAS,EAAMkG,SAAU,QACpChR,MAAO,CAAC8K,SAAS,EAAMkG,SAAU,SAErCC,cAAezT,EAASyT,eAAiBnO,GACzCoO,uBAAuB,EACvBC,uBAAuB,EACvBC,WAAY5T,EAAS4T,YAAc,wCACnCC,kBAAkB,EAClBC,0BAA2B,MAC3BC,cAAc,EACdC,0BAA0B,EAC1BC,kBAAkB,EAClBC,eAAgB,WAQjB,IAAMC,GAA8C,GCzF9CC,GAA4B,SAACpF,GAAD,OAAqBA,EAAMqF,aAAa9b,mBACpE+b,GAA+B,SAACtF,GAAD,OAAqBA,EAAMqF,aAAa3C,sBACvE6C,GAAgC,SAACvF,GAAD,OAAqBA,EAAMqF,aAAa1C,uBACxE6C,GAA0B,SAACxF,GAAD,OAAqBA,EAAMqF,aAAazC,iBAClE6C,GAAuB,SAACzF,GAAD,OAAqBA,EAAMqF,aAAatC,cAG/D2C,GAA8B,SAAC1F,GAAD,OAAqBA,EAAMqF,aAAanC,qBACtEyC,GAAyB,SAAC3F,GAAD,OAAqBA,EAAMqF,aAAaX,uBAGjEkB,GAAgC,SAAC5F,GAAD,OAAqBA,EAAMqF,aAAad,uBACxEsB,GAAwB,SAAC7F,GAAD,OAAqBA,EAAMqF,aAAaZ,eAShEqB,GAA0BrF,YACnCV,GACAqF,GACA9b,GAGSyc,GAAmCtF,YAC5CqF,IACA,SAACpe,GACG,OAAQA,GAAWA,EAAQkC,WAAc,MAIpCoc,GAA2BvF,YACpCqF,GACAR,IACA,SAAC5d,EAAyBue,GACtB,OAAKve,GAAYue,GAGVve,EAAQkC,UAAUJ,MAAK,SAAA0c,GAAC,OAAIA,EAAE3hB,OAAS0hB,MAFnC,QAMNE,GAAgC1F,YACzCuF,IACA,SAACnc,GACG,OAAQA,GAAYA,EAASuc,OAAU,OAIlCC,GAAyC5F,YAClDuF,IACA,SAACnc,GACG,OAAOA,EAAW,CAACA,EAASyc,YAAazc,EAAS0c,aAAe,CAAC,EAAG,MAIhEC,GAAuC/F,YAChDuF,IACA,SAACnc,GACG,OAAQA,GAAYA,EAAS4c,cAAiB,aAIzCC,GAAkCjG,YAC3CuF,IACA,SAACnc,GACG,OAAKA,GAAuC,iBAApBA,EAAS2U,QAG1B3U,EAAS2U,QAFL,KAMNmI,GAAmClG,YAC5CqF,IACA,SAACpe,GACG,OAAmB,OAAZA,EAAmBqC,EAAoBrC,GAAW,QAIpDkf,GAAmCnG,YAC5CqF,IACA,SAACpe,GACG,OAAmB,OAAZA,GAAoBA,EAAQmf,WAAqB,QAInDC,GAAqCrG,YAC9CqF,IACA,SAACpe,GACG,OAAQA,GAAWA,EAAQsN,aAAgB,MAItCwL,GAAsBC,YAC/BqG,GACA1G,IACA,SAACpL,EAA2BqL,GACxB,OAAKA,EAAelL,UAA+C,IAAnCkL,EAAelL,SAASvQ,OAGjDoQ,EAAYF,OAAO,CAACuL,IAFhBrL,KAMnB,SAAS+R,GAAkB/R,EACAgS,GACvB,IAAMC,EAAoC,GAQ1C,OAPsB,OAAlBD,GAA0BA,EAAcpiB,OAAS,GACjDoQ,EAAY1R,SAAQ,SAAAiQ,GACZyT,EAAc5a,QAAQmH,EAAW9J,KAAO,GACxCwd,EAAoB3f,KAAKiM,MAI9B0T,EAGJ,IAAMC,GAA6CzG,YACtDqG,GACAvB,GACAwB,IAGSI,GAA8B1G,YACvCD,GACA+E,GACAwB,IAGSK,GAAmC3G,YAC5C0G,IACA,SAACnS,GACG,OAAOA,EAAYtP,KAAI,SAAA6N,GAAU,OAAIA,EAAWtM,OAASsM,EAAW9J,MAAI5D,KAAK,SAIxEwhB,GAAmC5G,YAC5C0G,IACA,SAACnS,GAAwC,IAAD,EAC9BsS,EAAOtS,EAAYtP,KAAI,SAAA6N,GAAU,OAAK2B,GAAkB3B,GAAcA,EAAW4B,SAAW,MAClG,OAAQ,MAAoBL,OAArB,oBAA+BwS,OAIjCC,GAAwB9G,YACjC4G,GACA7B,IACA,SAACgC,EAAiBnS,GACd,OAAOmS,EAAOhe,MAAK,SAAAgK,GAAK,OAAIA,EAAM/J,KAAO4L,MAAY,QAIhDoS,GAA4BhH,YACrC0G,GACA3B,IACA,SAACxQ,EAA2BK,GACxB,OAA2B,IAAvBL,EAAYpQ,QAA4B,OAAZyQ,EACrB,KbvEZ,SAAuBL,EAA2B0S,GAAiF,IAAD,gBAC9G1S,GAD8G,yBAC5HzB,EAD4H,QAEjI,GAAI2B,GAAkB3B,GAAa,CAC/B,IAAMC,EAAQD,EAAW4B,SAAS3L,MAAK,SAACgK,GAAD,OAAkBkU,EAAUnU,EAAYC,MAC/E,GAAIA,EACA,MAAM,CAAN,EAAOH,GAAaE,EAAYC,MAJ5C,2BAAoC,CAAC,IAAD,yCADiG,8BASrI,OAAO,KagEImU,CAAc3S,GAAa,SAACzB,EAAYC,GAAb,OAAuBA,EAAM/J,KAAO4L,QAIjEuS,GAA2BnH,YACpCP,GACAkF,GACAE,GACAE,IACA,SAACrF,EACA7X,EACAqB,EACA0L,GACG,IAAK/M,IAAcqB,IAAiB0L,EAChC,OAAO,EAFsB,oBAIL8K,GAJK,IAIjC,2BAA8C,CAAC,IAAD,EAArC0H,EAAqC,sBACnBA,EAAgBC,iBADG,IAC1C,2BAAwD,CAAC,IAC/CzM,EAD8C,QAC1BA,OAC1B,GAAIA,EAAO/S,YAAcA,GAClB+S,EAAO1R,eAAiBA,GACxB0R,EAAOhG,UAAYA,EACtB,OAAO,GAN2B,gCAJb,8BAcjC,OAAO,KAIF0S,GAA+BtH,YACxCP,GACAM,IACA,SAACL,EAAqCnL,GAClC,IAAMgT,EAAkB,GASxB,OARAjT,GAAaC,GAAa,SAACzB,EAAYC,GAAW,IAAD,gBACjB2M,GADiB,IAC7C,2BAA8C,CAC1C,GAD0C,QACtB2H,gBAAgBte,MAAK,SAAAye,GAAE,OAAIA,EAAG5M,OAAOhG,UAAY7B,EAAM/J,MAAK,CAC5Eue,EAAWxU,EAAM/J,IAAM4J,GAAaE,EAAYC,GAChD,QAJqC,kCAQ1CwU,KAKFE,GAAwCzH,YACjD0G,IACA,SAACnS,GACG,IAAMmT,EAAwB,GAI9B,OAHApT,GAAaC,GAAa,SAACzB,EAAYC,GACnC2U,EAAY7gB,KAAK+L,GAAaE,EAAYC,GAAOvL,UAE9CkgB,KAIFC,GAAkC3H,YAC3CqF,GACAR,IACA,SAAC5d,EAAyBiC,GACtB,OAAQjC,GAAWgC,EAAoBhC,EAASiC,IAAkB,QAI7D0e,GAAgC5H,YACzC2H,IA1NiC,SAACpI,GAAD,OAAqBA,EAAMqF,aAAajC,iBA4NzE,SAACvZ,EAA2Bye,GACxB,GAAIze,GAAYA,EAASuZ,cAAe,CACpC,IAAMmF,EAAmB1e,EAASuZ,cAClC,OAAOmF,EAAmB9a,KAAK+a,KAAKF,EAAmBC,GAE3D,OAAOD,KAIFG,GAAuChI,YAChDqF,IACA,SAACpe,GACG,OAAQA,GAAWoC,EAAwBpC,IAAa,QAInDghB,GAAsCjI,YAC/CqF,IACA,SAACpe,GACG,OAAQA,GAAWA,EAAQwX,cAAiB,QAIvCyJ,GAA0BlI,YACnCgI,IACA,SAAC5gB,GACG,OAAsB,OAAlBA,GAA+D,IAArCA,EAAcE,YAAYnD,OAC7C,KAEJiD,EAAcE,eAIhB6gB,GAA4BnI,YACrCgF,GACAkD,IACA,SAACE,EAAmB/gB,GAChB,OAAa,OAAT+gB,GAAqC,OAApB/gB,GACT,EAELwX,GAAiBxX,EAAiB+gB,MAqEjD,IAAMC,GAA4BC,MAjBlC,SAAoCrjB,GAChC,GAAIA,EAIA,OAAO,SAACsjB,EAAWC,GACXvjB,EAAIyS,UAAU+Q,iBACdxjB,EAAIyjB,KAAK,WAAW,WAChBH,EAAKI,WAAWH,IAAMA,KAG1BD,EAAKI,WAAWH,IAAMA,KAMgC,CAClEI,WAAY,SAAA/B,GACR,IAAM5hB,EAAM4hB,EAAK,GACjB,GAAI5hB,EAAK,CACL,IAAM6S,EAAS7S,EAAI4jB,YACnB,MAAsB,kBAAX/Q,EACAA,EACAA,GACAA,EAAO9O,IAEX,MAEX,MAAO,MAUf,SAAS8f,GAAaC,EACAC,EACAC,EACAC,EACAC,EACApL,EACA3W,EACAghB,EACA3F,EACAuB,EACAvF,EACAd,GAClB,GAAa,OAATyK,EAAe,CACf,IAAIgB,EACJ,GAAIhiB,EAAe,CACf,IAAMiiB,EAAYxK,GAAiBzX,EAAcE,YAAa8gB,GAC1DiB,GAAa,IACbD,EAAahiB,EAAcG,OAAO8hB,IAIrCD,IACDA,EAAa,IAAI3hB,KAAK2gB,GAAMkB,eAEhCH,EAAW,sBAAOA,GAAP,CAAoB,CAAC,OAAQC,KAKhB,kBAAjBF,IAGPA,GAAgB,GAGpB,IACMtO,EAtGV,SAAwB9V,EACAkf,EACAuF,EACA9K,EACAgE,EACA9E,EACA6L,EACAP,EACAC,GACpB,OAAO,IAAI1K,KACP,CACI1Z,MACA4T,WAAYsL,EACZuF,WACA9K,aAAcA,QAAgBxK,EAC9BwV,WAAYhH,EAAsB,EAAI,IACtC9E,eAAgBA,EAChB6L,mBAKAE,QAASR,IAgFFS,CATH9kB,EAAemkB,EAASG,GAWhCnF,EA7HR,SAAuBA,EACAkF,GACnB,GAAIlF,IAAkBpO,GAAkB,CAGpC,IAAM8F,EAAqC,kBAAjBwN,EAA6BA,EAAe,EAAI,GAC1E,OAAO,IAAIU,KAAW,CAClBC,SAAU,CAAC,IAAK,KAChB/b,OAAQ,EAAE,IAAK,IACfgc,OAAQ,EAAE,KAAM,GAAI,IAAK,IAIzBC,YAAarhB,MAAMshB,KACf,CAAC7lB,OAAQuX,IACT,SAACuO,EAAG/W,GAAJ,OAAU,IAAM,IAAMlG,KAAKkd,IAAI,EAAGhX,SA2G7BiX,CAAcnG,EAAekF,GAK1CzK,EACAgE,EACA9E,EA9CG0K,GADK3D,GAAW,KAiDnBuE,EACAC,GAIJ,OACI,eAAC,GAAD,CACIlgB,GAAI+f,EACJnO,OAAQA,EACRqD,OAAQ,GACRF,QAASA,IAKd,IAAMqM,GAAuCpK,YAChDqF,GACAD,IA3ZyC,SAAC7F,GAAD,OAAqBA,EAAMqF,aAAaV,yBA6ZjF,SAACjd,EACA+c,EACAE,GAEG,IAAKjd,IAAYid,EACb,OAAO,KAGX,IAAI9O,EAAWnO,EAAQmO,SACvB,IAAKA,EAAU,CACX,IAAInO,EAAQojB,KAgBR,OADAnnB,QAAQC,KAAR,kBAAwB8D,EAAQ+B,GAAhC,kBACO,KAhBQ,IAAD,cACW/B,EAAQojB,KADnB,GACPC,EADO,KACHC,EADG,KACCC,EADD,KACKC,EADL,KAEdrV,EAAW,CACPC,KAAM,UACN/N,YAAa,CACT,CACI,CAACgjB,EAAIC,GACL,CAACC,EAAID,GACL,CAACC,EAAIC,GACL,CAACH,EAAIG,GACL,CAACH,EAAIC,MAUzB,IAAM3P,EAAS,IAAI8P,KAAe,CAC9BhW,SAAU,IAAIY,IACV,CACIqV,eAAgBhV,GAChBiV,kBAAmB5G,IAEzB6G,aAAa,CAACxV,KAAM,UAAWD,eAG/BqE,EAAQ,IAAIqR,KAAQ,CACtBC,OAAQ,IAAIC,KAAc,CACtBnb,MAAO,SACPqG,MAAO,EACP+U,SAAU,CAAC,EAAG,OAItB,OACI,eAAC,GAAD,CACIjiB,GAAE,UAAK/B,EAAQ+B,GAAb,SACF4R,OAAQA,EACRnB,MAAOA,EACPwE,OAAQ,GACRF,QAAS,QAMZmN,GAAuClL,YAChD2H,GACAK,GACAhD,GACAC,GACAG,GACAQ,GACAG,GACAE,GACAgC,GACA/C,IACA,SAAC9b,EACAhC,EACAghB,EACA3F,EACAuB,EACAmH,EACAnF,EACAjI,EACAU,EACAd,GAEG,IAAKvU,EACD,OAAO,KAEX,IAAKA,EAAS4f,QAEV,OADA9lB,QAAQC,KAAR,mBAAyBiG,EAAStF,KAAlC,qBACO,KAEX,IAAMqlB,EAAuC,CACzC,CAAC,MAAOnF,GACR,CAAC,OAAD,UAAYmH,EAAe,KAC3B,CAAC,OAAD,UAAYA,EAAe,KAC3B,CAAC,OAAQnF,IAGb,OAAO8C,GACH,WACA1f,EAAS4f,QACT5f,EAAS6f,aACT7f,EAAS8f,aACTC,EACApL,EACA3W,EACAghB,EACA3F,EACAuB,EACAvF,EACAd,MAKCyN,GAAkCpL,aAjhBX,SAACT,GAAD,OAAqBA,EAAMqF,aAAahB,eAmhBxEuC,GACAF,GACA+B,GACAhD,GACAC,GACAG,GACA6C,GACA/C,IACA,SAACtB,EACAwC,EACArI,EACA3W,EACAghB,EACA3F,EACAuB,EACAvF,EACAd,GAEG,IAAKiG,IAAiBwC,EAClB,OAAO,KAEX,IAAM+C,EAAuC,CACzC,CAAC,MAAOnF,IAEZ,OAAO8E,GAAa,MAChB1C,EAAU4C,QACV5C,EAAU6C,aACV7C,EAAU8C,aACVC,EACApL,EACA3W,EACAghB,EACA3F,EACAuB,EACAvF,EACAd,MAiBL,SAAS0N,KACZ,OAAO,IAAIL,KAAc,CACrBnb,MAAO,CAAC,IAAK,EAAG,EAAG,KACnBqG,MAAO,OAIR,SAASoV,KACZ,OAAO,IAAIC,KAAY,CACnB1b,MAAO,CAAC,IAAK,EAAG,EApBbQ,GAAOiR,SAAS/Q,SAASib,oBAAsB,OAgCnD,IAAMC,GAA0CzL,YACnDyG,GACArB,IACA,SAAC7Q,EAA2ByP,GACxB,GAA2B,IAAvBzP,EAAYpQ,OACZ,OAAO,KAEX,IAAMunB,EAAuB,GAsB7B,OArBAnX,EAAY1R,SAAQ,SAACiQ,EAAY/P,GACzB0R,GAAkB3B,IAClB4Y,EAAO7kB,KACH,eAAC,GAAD,CAEImC,GAAE,qBAAgB8J,EAAW9J,IAC7ByQ,MArBb,IAAIqR,KAAQ,CACflkB,MAtBG,IAAI+kB,KAAS,CAChBC,KAAMN,KACNP,OAAQM,KACRQ,OAAQ,IAoBRd,OAAQM,KACRO,KAAMN,OAmBUrN,OAAQ,IACRrD,OAAQ,IAAI8P,KACR,CACIhW,SAAU,IAAIY,IACV,CACIqV,eAAgBhV,GAChBiV,kBAAmB5G,IAEzB6G,aAAa/X,MAXlB/P,OAiBb,eAACyS,GAAD,UAASkW,OAIZI,GAAkC9L,YAC3CmF,IACA,SAACrB,GACG,IAAMiI,EAAoC,GAM1C,OALA1pB,OAAOC,oBAAoBwhB,GAAuBjhB,SAAQ,SAAAoJ,GAChD6X,EAAsB7X,GAAG4R,SAC3BkO,EAAwBllB,KAAKoF,MAG9B8f,KAIFC,GAAmChM,YAC5CmF,IACA,SAACrB,GACG,IAAMmI,EAA8D,GAIpE,OAHA5pB,OAAOC,oBAAoBwhB,GAAuBjhB,SAAQ,SAAAoJ,GACtDggB,EAAyBhgB,GAAK6X,EAAsB7X,GAAG8X,UAAY,UAEhEkI,KAIFC,GAA2BlM,aAzpBN,SAACT,GAAD,OAAqBA,EAAMqF,aAAarB,cA2pBtE,SAACA,GACG,OAAOlhB,OAAOwB,KAAK0f,GAAYte,KAAI,SAAAknB,GAAC,OAAI5I,EAAW4I,SAI9CC,GAAyBpM,YAClCH,IAlqBoC,SAACN,GAAD,OAAqBA,EAAMqF,aAAavC,oBAoqB5E,SAACvC,EAAgCuM,GAC7B,GAA2B,IAAvBvM,EAAY3b,OACZ,MAAM,IAAIzB,MAAJ,yCAEV,IAAM4N,EAASwP,EAAY/W,MAAK,SAAAuH,GAAM,OAAIA,EAAOtH,KAAOqjB,KACxD,IAAK/b,EACD,MAAM,IAAI5N,MAAJ,0CAA6C2pB,EAA7C,gBAEV,OAAO/b,KAIFgc,GAAuBtM,aA5qBF,SAACT,GAAD,OAAqBA,EAAMqF,aAAaT,cA8qBtE,SAACA,GACG,Id7jBsBoI,Ec6jBhBtnB,EAoBd,SAAiBunB,GAAmE,IAAD,gBAC7DnN,IAD6D,IAC/E,2BAAwB,CAAC,IAAhBoN,EAAe,QACdxlB,EAAUwlB,EAAM1lB,SAASgC,MAAK,SAAA9B,GAAO,OAAIA,EAAQulB,WAAaA,KACpE,GAAIvlB,EACA,MAAO,CAACwlB,QAAOxlB,YAJwD,8BAO/E,OAAO,KA3BSylB,CAAQvI,GACpB,GAAIlf,EAAK,CACL,IAAM0nB,Gd/jBYJ,Ec+jBWtnB,EAAIwnB,MAAM3oB,Kd9jBxCuO,GAAWka,Ic+jBJ3R,EAAS,IAAI4D,KACf,CACI1Z,IAAKG,EAAIgC,QAAQulB,UAAYG,EAAM,WAAOA,EAAOra,MAAd,YAAuBqa,EAAOxhB,OAAU,IAC3EsT,aAAc,CAAC,wBAAD,OACcxZ,EAAIwnB,MAAMG,KADxB,kBACsC3nB,EAAIwnB,MAAM3oB,KADhD,WAItB,OAAO,eAAC,GAAD,CAAMkF,GAAI/D,EAAIwnB,MAAM3oB,KAAO,IAAMmB,EAAIgC,QAAQnD,KAAM8W,OAAQA,EAAQqD,OAAQ,IAEtF,GAAIkG,EAAY,CACZ,IAAMvJ,EAAS,IAAI4D,KAAY,CAAC1Z,IAAKqf,IACrC,OAAO,eAAC,GAAD,CAAMnb,GAAImb,EAAYvJ,OAAQA,EAAQqD,OAAQ,IAEzD,OAAO,Q,iCC7vBF4O,IAAgB,IAAIplB,KAAK,uBAAuBC,UAMtD,SAASolB,GAAiBC,GAAgD,IAA/BC,EAA8B,wDAC5E,OAAO,IAAIvlB,KAAKslB,GAAWC,EAAQH,GAAe,IAI/C,SAASI,GAAuBF,GAA0C,IAAzBC,EAAwB,wDAC5E,OAAOF,GAAiBC,EAASC,GAC5B1D,cACAnc,OAAO,EAAG,IAGZ,SAAS+f,GAA2BH,GAAwE,IAAvDC,EAAsD,wDAA9BG,EAA8B,wDAC9G,OAAOL,GAAiBC,EAASC,GAC5B1D,cACAnc,OAAO,EAAGggB,EAAc,GAAK,IAC7BppB,QAAQ,IAAK,KCTf,IAAMqpB,GAMF,QCdJ,IAAMC,GAAe,eAQrB,SAASC,GAAYC,EAA0BC,GAClD,MAAO,CAACnY,KAAMgY,GAAcE,cAAaC,YAAcA,EAAoB5iB,SAAW4iB,EAAc,IAKjG,IAAMC,GAAe,eCmC5B,IAAMC,GAASC,EAAQ,KAKVC,GAAqB,qBAO3B,SAASC,KACZ,OAAO,SAACC,EAAwFC,GAC5F,IChEsBnmB,EDgEhBomB,EAAY5B,GAAuB2B,KAEzCD,EAASG,GAAYL,GAAoB3pB,EAAKgC,IAAI,2BClE5B2B,EDoEJomB,EAAUlpB,ICnEzBS,EAAW,UAAmBqC,EAAnB,ODoETlC,MAAK,SAACwoB,GACHJ,EAYT,SAA2BI,GAC9B,MAAO,CAAC7Y,KAAMuY,GAAoBM,cAbbC,CAAkBD,OAE9BnoB,OAAM,SAAAvC,GACHsqB,EAASR,GAAY,QAAS9pB,OAGjCkC,MAAK,WACFooB,EAASM,GAAeR,SAWjC,IAAMS,GAAmB,mBAEzB,SAASC,KACZ,OAAO,SAACR,EAAsGC,GAC1G,IAAMC,EAAY5B,GAAuB2B,KACzCD,EAASG,GAAYI,GAAkBpqB,EAAKgC,IAAI,wBE7FjD,SAAyB2B,EAAsBjD,GAClD,IAAMG,EAAMD,EAAe,GAAD,OAAI+C,EAAJ,uBAAuC,IAC3DpC,EAAOd,EAAgBC,GAC7B,IACI,OAAOY,EAAqBT,EAAKU,GAC5BE,MAAK,WACF,OAAO,KAEVK,OAAM,SAAAvC,GAEH,OADAN,QAAQM,MAAMA,IACP,KAEjB,MAAOA,GAEL,OADAN,QAAQM,MAAMA,GACP+qB,QAAQC,SAAQ,IFgFvBC,CAAoBT,EAAUlpB,IAAKipB,IAAWW,cAAc/pB,aACvDe,MAAK,SAAAE,GACEA,GACA4H,OAAOC,SAASkhB,YAGvBC,SAAQ,kBACLd,EAASM,GAAeC,SAQjC,IAAMQ,GAAkB,kBAOxB,SAASC,KACZ,OAAO,SAAChB,EAAsGC,GAC1G,I9BrHoBnmB,EAAsBjD,E8BqHpCqpB,EAAY5B,GAAuB2B,KAEzCD,EAASG,GAAYY,GAAiB5qB,EAAKgC,IAAI,mB9BvH3B2B,E8ByHJomB,EAAUlpB,I9BzHgBH,E8ByHXopB,IAAWW,cAAc/pB,Y9BtHrDY,EAFKV,EAAe,GAAD,OAAI+C,EAAJ,aAA6B,CAAC,CAAC,UAAW,OACvDlD,EAAgBC,IAExBe,MAAK,SAACqpB,GAAD,OAAiBA,EAAM,YAC5BrpB,KAAKoB,I8BqHDpB,MAAK,SAACqB,GAEH,GADA+mB,EAASkB,GAAgBjoB,IACrBA,EAAS5C,OAAS,EAAG,CACrB,IAAM2E,EAAoBilB,IAAWnJ,aAAa9b,mBAAqB/B,EAAS,GAAGiC,GACnF8kB,EAASmB,GAAcnmB,EAAmB/B,GAAU,QAG3DhB,OAAM,SAAAvC,GACHsqB,EAASR,GAAY,QAAS9pB,IAC9BsqB,EAASkB,GAAgB,QAG5BtpB,MAAK,WACFooB,EAASM,GAAeS,SAKjC,SAASG,GAAgBjoB,GAC5B,MAAO,CAACsO,KAAMwZ,GAAiB9nB,YAK5B,IAAMmoB,GAA6B,6BAQnC,SAASC,GAAwBtnB,EACAiL,GACpC,MAAO,CAACuC,KAAM6Z,GAA4BrnB,YAAWiL,cAKlD,IAAMsc,GAAiB,iBAkCvB,IAAMC,GAAkB,kBA8BxB,SAASC,GAAsBplB,GAClC,OAAO,SAAC4jB,EAA8BC,GAClC,IACIhH,EADEwI,EAA0CxB,IJnKenJ,aAAa3B,qBIqK5E,IACI,GAAmB,QAAfsM,EAAsB,CACtB,IAAMplB,EJtK4B,SAACoV,GAAD,OAAqBA,EAAMqF,aAAa1B,wBAAwBE,IIsKlFoM,CAAmCzB,KACnDhH,EjBzBT,SAA8B7c,EAAcC,GAC/C,IAAIslB,EAAQxlB,EAASC,EAAMC,GAC3B,GAAIslB,EAAMtrB,OAAS,EACf,MAAM,IAAIzB,MAAMuB,EAAKgC,IAAI,+BAHgD,oBAM/DwpB,EAAM,IANyD,IAM7E,2BAAwB,CAAC,IAAhBhK,EAAe,QACpB,GAAiB,kBAANA,GAAwB,KAANA,EACzB,MAAM,IAAI/iB,MAAMuB,EAAKgC,IAAI,gCAR4C,8BAY7E,IAZ6E,EAYvEypB,EAAsBD,EAAM,GAAGxqB,KAAI,SAAAwgB,GAAC,OAAIA,KACxCkK,EAAcD,EAAUzqB,KAAI,SAAAwgB,GAAC,OAAIA,EAAEzhB,iBACnC4rB,EAAaF,EAAUvrB,OAdgD,cAgB7DsrB,GAhB6D,IAgB7E,2BACI,GADmB,QACXtrB,SAAWyrB,EACf,MAAM,IAAIltB,MAAMuB,EAAKgC,IAAI,mCAlB4C,8BAsB7E,IAAM4pB,EAAc1lB,EAAQoC,UAAUvI,cAChC8rB,EAAU3lB,EAAQgC,MAAMnI,cACxB+rB,EAAU5lB,EAAQiC,MAAMpI,cACxBgsB,EAAiB7lB,EAAQmC,aAAatI,cACtCqI,EAAgBlC,EAAQkC,cAExB4jB,EAAiBN,EAAYntB,WAAU,SAAAsB,GAAI,OAAIA,IAAS+rB,KACxDK,EAAaP,EAAYntB,WAAU,SAAAsB,GAAI,OAAIA,IAASgsB,KACpDK,EAAaR,EAAYntB,WAAU,SAAAsB,GAAI,OAAIA,IAASisB,KACtDK,EAAoBT,EAAYntB,WAAU,SAAAsB,GAAI,OAAIA,IAASksB,KAC/D,GAAI3jB,GAAiB6jB,EAAa,GAAKC,EAAa,GAAKD,IAAeC,GACpE,GAAIC,EAAoB,EACpB,MAAM,IAAI1tB,MAAMuB,EAAKgC,IAAI,qCAG7BmqB,GAAqB,EAGzB,IAAI5jB,EAAcrC,EAAQqC,YAAY3C,OAClB,KAAhB2C,IACAA,EAAcN,EAAkBM,aAOpC,IAJA,IAAMK,EAAY,IAAIwjB,IAEhBtJ,EAAkB,GACpBuJ,EAAW,EAhD8D,aAkDzE,IAAMC,EAAUd,EAAMa,GAClBlb,EAAW,KACf,GAAIgb,GAAqB,GAErB,GAAmB,kBADPG,EAAQH,GAEhB,IACIhb,EAAWvI,EAAU2jB,aAAatmB,GACpC,MAAO+B,SAIV,CACH,IAAMqU,EAAIiQ,EAAQL,GACZO,EAAIF,EAAQJ,GACD,kBAAN7P,GAAkB/U,OAAOmlB,SAASpQ,IAAmB,kBAANmQ,GAAkBllB,OAAOmlB,SAASD,KACxFrb,EAAW,IAAIub,IAAY,CAACrQ,EAAGmQ,KAGvC,GAAiB,OAAbrb,EACA,MAAM,IAAI1S,MAAMuB,EAAKgC,IAAL,uCAAyCqqB,KAG7D,IAAMM,EAAkE,CAAC/gB,MAAO,OAChF0gB,EAAQ1tB,SAAQ,SAAC4Q,EAAe1Q,GAC5B,GAAIA,IAAUmtB,GAAcntB,IAAUotB,GAAcptB,IAAUqtB,EAAmB,CAC7E,IAAM9c,EAAeoc,EAAU3sB,GAC/B6tB,EAAatd,GAAgBG,MAIrC,IAAIjM,OAAa,EACjB,GAAIyoB,GAAkB,EAClBzoB,EAAK,UAAM+oB,EAAQN,QAChB,CACH,IAAMY,IAAY7b,GAClBxN,EAAK,UAAMgF,GAAN,OAAoBqkB,GAE7BD,EAAY,MAAYppB,EAExBuf,EAAOlgB,KAAKsO,GAAkBC,EAAUwb,KAxCrCN,EAAWb,EAAMtrB,OAAQmsB,IAAa,IA2C7C,OAAOvJ,EiBnEc+J,CAAqB5mB,EAAMC,QACjC,GAAmB,YAAfolB,EAA0B,CACjC,IAAMplB,EJxKgC,SAACoV,GAAD,OAAqBA,EAAMqF,aAAa1B,wBAAwBC,QIwKtF4N,CAAuChD,KACvDhH,EjBmET,SAAkC7c,EAAcC,GACnD,IAAMyC,EAAazC,EAAQyC,WACrBokB,EAAgB,IAAIC,IACtBrkB,EAAWrJ,MAAM,KACZ0B,KAAI,SAAAnB,GAAI,OAAIA,EAAK+F,OAAO7F,iBACxB0G,QAAO,SAAA5G,GAAI,MAAa,KAATA,MAEpB0I,EAAcrC,EAAQqC,YAAY3C,OAClB,KAAhB2C,IACAA,EAAcG,EAAsBH,aAGxC,IAEIkI,EAFEjI,EAAgB,IAAI6I,IAG1B,IACIZ,EAAWjI,EAAcoe,aAAa3gB,GACxC,MAAO+B,GACL,IACI,IAAMmJ,EAAW3I,EAAc+jB,aAAatmB,GAC5CwK,EAAW,CAAC,IAAIwc,IAAU9b,IAC5B,MAAOnJ,GACL,MAAM,IAAIvJ,MAAMuB,EAAKgC,IAAL,qBAIxB,IAAM8gB,EAAkB,GAkCxB,OAjCArS,EAAS7R,SAAQ,SAAAsuB,GACb,IAAMtd,EAAasd,EAAQC,gBACrBhc,EAAW+b,EAAQE,cACzB,GAAIjc,EAAU,CACV,IAAI5N,EAAQ,GACNopB,EAAkE,CAAC/gB,MAAO,OAChF,GAAIgE,EACA,IAAK,IAAIP,KAAgBO,EAAY,CACjC,IAAMJ,EAAgBI,EAAWP,GACX,OAAlBG,GAC4B,kBAAlBA,GACkB,kBAAlBA,GACkB,mBAAlBA,IACVmd,EAAatd,GAAgBG,GAEnB,KAAVjM,GAC4B,kBAAlBiM,GACPud,EAAcM,IAAIhe,EAAatP,iBAClCwD,EAAQiM,GAKpB,GAAc,KAAVjM,EAAc,CACd,IAAMqpB,IAAY5b,GAClBzN,EAAK,UAAMgF,EAAN,YAAqBqkB,GAE9BD,EAAY,MAAYppB,EAExBuf,EAAOlgB,KAAKsO,GAAkBC,EAAUwb,QAIzC7J,EiB/HcwK,CAAyBrnB,EAAMC,QACrC,GAAmB,QAAfolB,EAAsB,CAC7B,IAAMplB,EJ1K4B,SAACoV,GAAD,OAAqBA,EAAMqF,aAAa1B,wBAAwBG,II0KlFmO,CAAmCzD,KACnDhH,EjB+HT,SAA8B7c,EAAcC,GAC/C,IAAIqC,EAAcrC,EAAQqC,YAAY3C,OAClB,KAAhB2C,IACAA,EAAcM,EAAkBN,aAEpC,IAAIhF,EAAQ2C,EAAQ3C,MAAMqC,OAC1B,GAAc,KAAVrC,EAAc,CACd,IAAMqpB,IAAY3b,GAClB1N,EAAK,UAAMgF,GAAN,OAAoBqkB,GAE7B,IAEI,MAAO,CAAC1b,IADS,IAAIkb,KAAcG,aAAatmB,GACZ,CAAC1C,WACvC,MAAOyE,GACL,MAAM,IAAIvJ,MAAMuB,EAAKgC,IAAL,0BiB7ICwrB,CAAqBvnB,EAAMC,QAEpC4c,EAAS,GAEf,MAAO9a,GACL6hB,EAASR,GAAY,QAASrhB,IAC9B6hB,EAAS4D,GAAW,0BACpB3K,EAAS,GAETA,EAAO5iB,QACP2pB,EA5CL,SAAuB/G,EACA/C,EACA2N,GAC1B,MAAO,CACHtc,KAAMga,GACNtI,OAAQA,EACR/C,gBACA2N,eAqCaC,CAAc7K,EAAQ3B,GAAsB2I,MAAa,IAClED,EAASxH,GAAkB,CAAC,UACN,IAAlBS,EAAO5iB,SACP2pB,EAAS6D,GACL5K,EAAO,GAAG/d,GACV4d,GAAiCmH,MACjC,IAEAA,IAAWnJ,aAAahC,oBACxBkL,EAAS+D,OAGjB/D,EAASR,GAAY,OAAQrpB,EAAKgC,IAAL,mBAAqB8gB,EAAO5iB,OAA5B,iBAE7B2pB,EAASR,GAAY,UAAWrpB,EAAKgC,IAAI,yBAQ9C,IAAM6rB,GAAoB,oBAc1B,IAAMC,GAAyB,yBAY/B,SAASF,KACZ,OAAO,SAAC/D,EAAyDC,GAC7D,IAAMC,EAAY5B,GAAuB2B,KAEnCjlB,EAAoB6b,GAA0BoJ,KAC9CiE,EAAyBhK,GAAqC+F,KAC9DkE,EAAmBtK,GAAgCoG,KACnD5L,EAAkB4C,GAAwBgJ,KAC1CmE,EAAgBpL,GAAsBiH,KACtCvL,EAAuBuL,IAAWnJ,aAAapC,qBAC/C2P,EAAYpE,IAAWnJ,aAAa7B,qBACpCqP,EAAYrE,IAAWnJ,aAAa9B,wBACtCH,EAAgBiF,GAA8BmG,KAE5CxZ,EAAcwL,GAAoBgO,KAExC,GAAIjlB,GAAqBmpB,GAAoB9P,GAAmB6P,EAAwB,CACpF,IAAMK,EAAaL,EAAuBzqB,OACpC+qB,EAAgBD,EAAWluB,OAI7BouB,EAAeD,EAAgB,EAC/BE,EAAiBD,GAHrB5P,EAAgBA,EAAgB,EAAIA,EAAc2P,GAGE,EAE9CG,EAAqB,WACvB,IAAMC,EAAiBF,GAAkB,EAAIH,EAAWG,GAAgB,KAClEG,EAAeN,EAAWE,GAChC,OGjUT,SAAkC3qB,EACAC,EACAuB,EACAwL,EACAQ,EACAwd,EACAC,EACAV,EACAC,EACAztB,GAErC,IAAImuB,EACAC,EAA6C,KAC3ChuB,EAA0B,GAC5BotB,GACAptB,EAAM8B,KAAK,CAAC,aAAc,WAC1BisB,EAAe,UACRV,GACPrtB,EAAM8B,KAAK,CAAC,aAAc,aAC1BisB,EAAe,OACfC,EAAe,QAEfhuB,EAAM8B,KAAK,CAAC,aAAc,SAC1BisB,EAAe,QAEfF,GACA7tB,EAAM8B,KAAK,CAAC,YAAa+rB,IAEzBC,GACA9tB,EAAM8B,KAAK,CAAC,UAAWgsB,IAE3B,IAAM9qB,EAAO5C,mBAAmB0C,GAC1BqB,EAAe/D,mBAAmBiE,EAAStF,MAgCjD,OAAOyB,EA/BKV,EAAe,GAAD,OACnB+C,EADmB,uBACQG,EADR,YACgBmB,GACtCnE,GAGM,2BACHL,EAAgBC,IADb,IAENquB,OAAQ,OACRC,KAAMvmB,KAAKwU,UAAU9L,MAwBpB1P,MArB2B,SAACqpB,GAE7B,KADAA,EAASA,EAAM,SACkB,IAAlBA,EAAO5qB,OAClB,OAAO,KAEX,IAAM+uB,EAAOnE,EAAO9pB,KAAI,SAAC+R,GACrB,OAAO,2BAAIA,GAAX,IAAiBoR,KAAM,IAAI3gB,KAAKuP,EAAKoR,MAAM1gB,eAW/C,MAAO,CAACkT,OATO,CACX/S,YACAqB,aAAcE,EAAStF,KACvBqvB,cAAe/pB,EAASuc,YAAS1R,EACjCW,UACAQ,WACA0d,eACAC,gBAEYG,OAAMrjB,MAAO,YHoQd4e,CAA6BT,EAAUlpB,IAC1CgE,EACAmpB,EACAC,EAAclpB,GACdkpB,EAAc9c,SACdsd,EACAC,EACAR,EACAC,EACArE,IAAWW,cAAc/pB,cAoBjC8tB,IACK/sB,MAlBiB,SAAhB0tB,EAAiBC,GACnB,GAAmB,OAAfA,GAAuBC,GAAa/e,EAAa2d,EAAclpB,IAAK,CACpE,IAAMuqB,EAAUf,EAAiB,EAC3BgB,EAAeD,GAAWjB,EAAgBE,GAAkBF,EAAc,EAChFxE,EAsCb,SAA0BuF,EAAwBI,EAA0CC,GAC/F,MAAO,CAACre,KAAMse,GAAoBN,aAAYI,aAAYC,YAvCjCE,CAAiB,2BAAIP,GAAL,IAAiBG,iBACtChR,EACA+P,IAAiBD,EAAgB,EAAI,MAAM,WAC3CiB,GAAWD,GAAa/e,EAAa2d,EAAclpB,MACnDwpB,GAAkB7P,EAClB4P,GAAgB5P,EAChB8P,IAAqB/sB,KAAK0tB,SAG9BtF,EAASR,GAAY,OAAQ,0BAMhCvnB,OAAM,SAACvC,GACJsqB,EAASR,GAAY,QAAS9pB,SAMlD,SAAS8vB,GAAa/e,EAA2BK,GAC7C,OAAwD,OAAjDG,GAAuBR,EAAaK,GAMxC,IAAM+e,GAAqB,qBAe3B,IAAME,GAA2B,2BAajC,IAAMC,GAAyB,yBAa/B,IAAMC,GAAoB,oBAoB1B,SAASC,GAAkBC,EAA4B5R,GAC1D,MAAO,CAAChN,KAAM0e,GAAmBE,UAAS5R,oBAMvC,SAAS6R,KACZ,OAAO,SAACpG,GACJA,EAASD,MACTC,EAASgB,MACThB,GAcG,SAACA,EAAwDC,GAC5D,I/BxcqBnmB,E+BwcfomB,EAAY5B,GAAuB2B,M/BxcpBnmB,E+B0cJomB,EAAUlpB,I/BzcxBS,EAAW,UAAeqC,EAAf,eACblC,KAAKS,I+BycDT,MAAK,SAACyuB,GACHrG,EAQT,SAA0BqG,GAC7B,MAAO,CAAC9e,KAAM+e,GAAmBD,aATZE,CAAiBF,OAE7BpuB,OAAM,SAAAvC,GACHsqB,EAASR,GAAY,QAAS9pB,WAhBvC,IAAM4wB,GAAoB,oBA4B1B,IAAME,GAA4B,4B,IAsF1BC,G,kCAMTC,G,kDAIF,WAAYC,GAAmB,IAAD,8BAC1B,gBAJJA,cAG8B,IAF9BC,gBAE8B,EAE1B,EAAKD,SAAWA,EAChB,EAAKC,WAAa,IAAIC,KAHI,E,yCAM9B,SAAMzmB,EAAcvL,GAChBS,KAAKsxB,WAAWxd,KAAKhJ,EAAMvL,K,mBAG/B,WAAS,IAAD,OACJS,KAAKsxB,WAAWE,cAAc,CAACvf,KAAM,SAChC3P,MAAK,SAAC/C,GAAD,OAAa+qB,GAAO/qB,EAAS,EAAK8xB,iB,GAhB1BF,IAoBpBM,G,2JAEF,SAAM3mB,EAAcvL,GAChB,IAAMmyB,EAAO,IAAIC,KAAK,CAACpyB,GACnB,CAAC0S,KAAM,6BACXqY,GAAOoH,EAAM5mB,K,mBAGjB,gB,GARuBqmB,IIrjBpB,IAAMS,GAAiB,iBAYvB,SAAS/F,GAAcnmB,EAAkC/B,EAAqBkuB,GACjF,OAAO,SAACnH,GACJA,EAOD,SAAwBhlB,EAAkC/B,GAC7D,MAAO,CAACsO,KAAM2f,GAAgBlsB,oBAAmB/B,YARpCmuB,CAAepsB,EAAmB/B,IACvC+B,GAAqBmsB,GACrBnH,EAASqH,GAAarsB,KAW3B,SAASqsB,GAAarsB,GACzB,OAAO,SAACglB,EAA2BC,GAC/B,IACM9mB,EAAU4B,EADCyW,GAAiByO,KACIjlB,GAClC7B,GAAWA,EAAQojB,MACnByD,EAASxK,GAAMrc,EAAQojB,QAOnC,IAAM+K,GAAwB,CAC1B,QACA,aACA,aACA,UACA,aACA,kBACA,eACA,UAGG,SAASC,GAAWlT,GACvB,OAAO,SAAC2L,EAA2BC,GAC/B,IACMhb,EAAQgC,GADM2R,GAA4BqH,KACE5L,GAC9CpP,IACIA,EAAMsX,KACNyD,EAASxK,GAAMvQ,EAAMsX,OACdtX,EAAMqC,UAAYggB,GAAsB/vB,SAAS0N,EAAMqC,SAASC,OACvEyY,EAASxK,IAAM,IAAIhO,KAAkBkb,aAAazd,EAAMqC,cAsBjE,IAAMkgB,GAAS,SAQf,SAAShS,GAAM7V,GAClB,MAAO,CAAC4H,KAAMigB,GAAQC,MAAO,MAAO9nB,YAKjC,IAAM+nB,GAAsB,sBAO5B,SAASlP,GAAkBpE,GAE9B,OAAO,SAAC4L,EAAmHC,GACvH,IAAMC,EAAY5B,GAAuB2B,KAEzCD,EA8BD,SAA4B5L,GAC/B,MAAO,CAAC7M,KAAMmgB,GAAqBtT,yBA/BtBuT,CAAmBvT,IAE5B,IAAMjb,EAAUoe,GAAwB0I,KAClCxZ,EAAckS,GAA2CsH,KAC/D,GAAgB,OAAZ9mB,GAAoBsN,EAAYpQ,OAAS,EAAG,CAAC,IAAD,gBACrBoQ,GADqB,IAC5C,2BAAoC,CAAC,IAA5BzB,EAA2B,QAC3B2B,GAAkB3B,IAAc,WACjC,IAAMjL,EAAYZ,EAAS+B,GACrBlB,EAAegL,EAAW9J,GAC1B0sB,EAAU,UAAMxG,GAAN,YAAoCrnB,EAApC,YAAiDC,GACjEgmB,EAASG,GAAYyH,EAAYzxB,EAAKgC,IAAI,oBAC1CwoB,EAAyBT,EAAUlpB,IACV+C,EACAC,EACAimB,IAAWW,cAAc/pB,aAC9Ce,MAAK,SAACoN,GACHgb,EAASqB,GAAwBloB,EAAS+B,GAAI8J,OAEjD/M,OAAM,SAAAvC,GACHsqB,EAASR,GAAY,QAAS9pB,OAEjCorB,SAAQ,WACLd,EAASM,GAAesH,OAhBE,IAFG,iCAgCjD,IAAMC,GAAe,eAUrB,SAAShE,GAAYxP,EAAgC4E,EAAiBkO,GACzE,OAAO,SAACnH,GACJA,EAOR,SAAsB3L,EAAgC4E,GAClD,MAAO,CAAC1R,KAAMsgB,GAAcxT,kBAAiB4E,UARhC6O,CAAazT,EAAiB4E,IACnCkO,GAAa9S,GACb2L,EAASuH,GAAWlT,KAWzB,IAAM0T,GAA2B,2BAajC,IAAMC,GAAkB,kBAaxB,IAAMC,GAAc,cAOpB,SAASC,GAAW1T,GACvB,MAAO,CAACjN,KAAM0gB,GAAazT,gBAKxB,IAAM2T,GAAoB,oBAa1B,IAAMC,GAAoB,oBAO1B,SAASC,GAAgB5T,GAC5B,MAAO,CAAClN,KAAM6gB,GAAmB3T,qBAO9B,IAAM6T,GAAiC,iCAavC,IAAMC,GAAwB,wBAc9B,IAAMC,GAAsB,sBAO5B,SAASC,GAAkB7S,GAC9B,MAAO,CAACrO,KAAMihB,GAAqB5S,kBAKhC,IAAM8S,GAAiB,iBAOvB,SAASC,GAAa5S,GACzB,MAAO,CAACxO,KAAMmhB,GAAgB3S,gBAK3B,IAAM6S,GAAiC,iCAavC,IAAMC,GAAqC,qCAc3C,IAAMC,GAAe,eAQrB,SAAS3I,GAAYjlB,EAAY4B,GACpC,MAAO,CAACyK,KAAMuhB,GAAc5tB,KAAI4B,WAK7B,IAAMisB,GAAkB,kBAOxB,SAASzI,GAAeplB,GAC3B,MAAO,CAACqM,KAAMwhB,GAAiB7tB,MAK5B,IAAM8tB,GAAgB,gBAOtB,SAASC,GAAat0B,GACzB,MAAO,CAAC4S,KAAMyhB,GAAer0B,UAK1B,IAAMu0B,GAAc,cAOpB,SAAStF,GAAWuF,GACvB,MAAO,CAAC5hB,KAAM2hB,GAAaC,YAKxB,IAAMC,GAAe,eAOrB,SAASC,GAAYF,GACxB,MAAO,CAAC5hB,KAAM6hB,GAAcD,YAKzB,IAAMG,GAAkB,kBAOxB,SAASC,GAAehW,GAC3B,MAAO,CAAChM,KAAM+hB,GAAiB/V,Y,wZC3WpBiW,GAlCiC,SAAC,GAAgB,IAAfC,EAAc,EAAdA,SAE9C,OACI,gBAACC,GAAA,EAAD,CAAMtjB,WAAS,EAACujB,eAAe,SAASC,QAAS,EAAjD,UACI,eAACF,GAAA,EAAD,CAAMxgB,MAAI,EAAV,SACI,sBAAKwR,IAAK+O,EAASI,QAASzhB,MAAO,GAAI0hB,IAAK3zB,EAAKgC,IAAI,oBAEzD,eAACuxB,GAAA,EAAD,CAAMxgB,MAAI,EAAV,SACI,eAAC6gB,GAAA,EAAD,CAAOC,UAAW,EAAlB,SACI,gBAACC,GAAA,EAAD,WACI,eAACC,GAAA,EAAD,UACI,eAACC,GAAA,EAAD,CACIC,QAASX,EAASzzB,KAClBq0B,UAAWl0B,EAAKgC,IAAI,iBAE5B,eAACmyB,GAAA,EAAD,CAASC,OAAK,IACd,eAACL,GAAA,EAAD,UACI,eAACC,GAAA,EAAD,CACIC,QAAO,UAAKX,EAASe,MAAd,aAAwBf,EAASgB,eAAiBt0B,EAAKgC,IAAI,YAAchC,EAAKgC,IAAI,gBAAlF,KACPkyB,UAAWl0B,EAAKgC,IAAI,cAE5B,eAACmyB,GAAA,EAAD,CAASC,OAAK,IACd,eAACL,GAAA,EAAD,UACI,eAACC,GAAA,EAAD,CACIC,QAASX,EAASiB,SAClBL,UAAWl0B,EAAKgC,IAAI,2BCqB9CwyB,GAAiD,SAAC,GAAkC,IAAjCC,EAAgC,EAAhCA,QAASC,EAAuB,EAAvBA,kBACxDC,EAAOC,qBADwE,EAErC9iB,WAAmC,MAFE,mBAE9E+iB,EAF8E,KAE5DC,EAF4D,OAGnChjB,YAAe,GAHoB,mBAG9EijB,EAH8E,KAG3DC,EAH2D,KASrFljB,aAAgB,WACZ7S,QAAQmL,IAAI,gBAAiBuqB,EAAKM,MAC9BN,EAAKM,MAAQN,EAAKM,KAAKC,aACvBR,EAAkBC,EAAKM,KAAKC,cAE5BR,EAAkB,QAEvB,CAACC,EAAKM,KAAMP,IAEf,IAKMS,EAA+B,WACjCH,GAAqB,IAOnBI,EAAsB,WACxBN,EAAoB,OAwBxB,GAAIH,EAAKM,KAAM,CACX,IACII,EADE/B,EAAWqB,EAAKM,KAAKK,QAEvBC,EAAiC,eAAC,KAAD,IACrC,GAAKjC,EAEE,GAAIA,EAASI,QAChB2B,EAAS,eAACG,GAAA,EAAD,CAAQC,UAAWhB,EAAQiB,YAAanR,IAAK+O,EAASI,QAASC,IAAKL,EAASzzB,WACnF,CACH,IAAM81B,EAAQrC,EAASsC,YAActC,EAASzzB,MAAQyzB,EAASiB,SACzDsB,EAAQvC,EAASwC,YACnBC,EAAyB,KACzBJ,GAASE,EACTE,EAAUJ,EAAM,GAAKE,EAAM,GACpBF,EACPI,EAAUJ,EAAM,GACTE,IACPE,EAAUF,EAAM,IAEJ,OAAZE,IACAR,EAAgBQ,EAAQ3sB,eAE5BisB,EAAS,eAACG,GAAA,EAAD,CAAQC,UAAWhB,EAAQuB,aAA3B,SAA0CT,SAjBnDF,EAAS,eAACG,GAAA,EAAD,CAAQC,UAAWhB,EAAQuB,aAA3B,eAmBb,OACQ,gBAAC,WAAD,WACI,eAACC,GAAA,EAAD,CACQzjB,QAxDG,SAACD,GACxBuiB,EAAoBviB,EAAM2jB,gBAwDNC,gBAAc,YACdC,gBAAc,OACdtiB,KAAK,QACL2hB,UAAWhB,EAAQ4B,WAL3B,SAOKhB,IAEL,gBAACiB,GAAA,EAAD,CACQvxB,GAAG,YACHwxB,SAAU1B,EACV2B,aAAW,EACXC,KAAMC,QAAQ7B,GACd8B,QAASvB,EALjB,UAOI,eAACwB,GAAA,EAAD,CAAUpkB,QAhFW,WACrC4iB,IACAJ,GAAqB,IA8EL,SAAsDh1B,EAAKgC,IAAI,aAC/D,eAAC40B,GAAA,EAAD,CAAUpkB,QAtDO,WACjC4iB,IACAT,EAAKkC,kBAAkBp1B,MAAK,eAIzBK,OAAM,SAAAkG,GACL/I,QAAQM,MAAMyI,OA+CF,SAAkDhI,EAAKgC,IAAI,gBAE/D,gBAAC80B,GAAA,EAAD,CACQL,KAAM1B,EACNgC,oBAAqBC,KACrBR,aAAW,EACXG,QAASxB,EACT8B,kBAAgB,2BAChBC,mBAAiB,iCANzB,UAQI,eAACC,GAAA,EAAD,CAAapyB,GAAG,2BAAhB,SAA4C/E,EAAKgC,IAAI,kBACrD,eAACo1B,GAAA,EAAD,UACI,eAAC,GAAD,CAAa9D,SAAUqB,EAAKM,KAAKK,YAErC,eAAC+B,GAAA,EAAD,UACI,eAACC,GAAA,EAAD,CAAQ9kB,QAAS2iB,EAA8BvpB,MAAM,UAArD,wBAQpB,IAAI2rB,EACI,eAACtB,GAAA,EAAD,CAAYzjB,QAASmiB,EAAK6C,eAAYxnB,EAxFhB,WAC9B2kB,EAAK8C,iBAAiBh2B,MAAK,eAIxBK,OAAM,SAAAkG,GACL/I,QAAQM,MAAMyI,OAkFmE8L,KAAK,QAAlF,SACI,eAAC,KAAD,MAWZ,OARI6gB,EAAK6C,YACLD,EACQ,uBAAK9B,UAAWhB,EAAQiD,cAAxB,UACKH,EACD,eAACI,GAAA,EAAD,CAAkB7jB,KAAM,GAAI2hB,UAAWhB,EAAQmD,qBAIxDL,GAWAM,iBAvLA,SAACC,GAAD,OAAkBC,aACzB,CACIrC,YAAa,CACTzjB,MAAO,GACPC,OAAQ,GACRtG,MAAO,OACPosB,gBAAiBrtB,KAAW,MAEhCqrB,aAAc,CACV/jB,MAAO,GACPC,OAAQ,GACRtG,MAAO,OACPosB,gBAAiBrtB,KAAW,MAEhC+sB,cAAe,CACXO,OAAQH,EAAMrE,QAAQ,GACtByE,SAAU,YAEdN,eAAgB,CACZhsB,MAAOjB,KAAW,KAClButB,SAAU,WACVC,IAAK,MACLC,KAAM,MACNpe,OAAQ,EACRqe,WAAY,GACZC,YAAa,IAEjBjC,WAAY,CACRkC,QAAS,OA2JVV,EAPiC,SAACrmB,GAC7C,OAAKpF,GAAOiR,SAAS9Q,WAGd,eAAC,GAAD,eAAwBiF,IAFpB,QCtMFgnB,GAAsB,sBCCnC,IAIMC,GAAqB,CACvB/D,kBDCG,SAA2Bh0B,GAC9B,OAAO,SAACmpB,EAAoBC,GACxB,IAAM4O,EAAkB5O,IAAWW,cAAc/pB,YAC7Cg4B,IAAoBh4B,IACpBmpB,EAQZ,SAA4BnpB,GACxB,MAAO,CAAC0Q,KAAMonB,GAAqB93B,eATlBi4B,CAAmBj4B,IACR,OAAhBA,GAA6C,OAApBg4B,GACzB7O,EAASgB,UCJV+N,gBARS,SAACtd,GACrB,MAAO,KAO6Bmd,GAAzBG,CAA6CC,I,mDCAtDC,GAAYC,cAAW,SAACjB,GAAD,OAAkBC,aAC3C,CACIiB,OAAQ,CACJhB,gBAAiBF,EAAMmB,QAAQnuB,KAAK,MAExCouB,OAAQ,CACJhB,SAAU,YAEd31B,MAAO,CACH+1B,WAAYR,EAAMrE,QAAQ,GAC1B0F,KAAM,GAEVlzB,KAAM,CACFoyB,UAAWP,EAAMrE,QAAQ,GACzB6E,WAAYR,EAAMrE,QAAQ,IAC1B2F,YAAatB,EAAMrE,QAAQ,UAKjCuD,GAAallB,IAAMunB,YAAW,SAAoB7nB,EAAO+D,GAC3D,OAAO,eAAC+jB,GAAA,EAAD,aAAOC,UAAU,KAAKhkB,IAAKA,GAAS/D,OAkDhCgoB,GAxCmC,SAAC,GAKO,IAJHj3B,EAIE,EAJFA,MACAkH,EAGE,EAHFA,KACAgtB,EAEE,EAFFA,KACAE,EACE,EADFA,QACE,EACb8C,mBAAS,IADI,mBAC9CC,EAD8C,KAChCC,EADgC,KAGrDC,qBAAU,WACNp4B,MAAMiI,GACDhI,MAAK,SAAAC,GAAQ,OAAIA,EAASuE,UAC1BxE,MAAK,SAAAwE,GAAI,OAAI0zB,EAAgB1zB,SAGtC,IAAMwuB,EAAUqE,KAEhB,OACI,gBAAChC,GAAA,EAAD,CAAQ+C,YAAU,EAACpD,KAAMA,EAAME,QAASA,EAASI,oBAAqBC,GAAtE,UACI,eAAC8C,GAAA,EAAD,CAAQrE,UAAWhB,EAAQyE,OAA3B,SACI,gBAACa,GAAA,EAAD,WACI,eAAC9D,GAAA,EAAD,CACI+D,KAAK,QACLpuB,MAAM,UACN4G,QAASmkB,EACTsD,aAAW,QACXnmB,KAAK,QALT,SAMI,eAAC,KAAD,MAEJ,eAAComB,GAAA,EAAD,CAAYC,QAAQ,KAAK1E,UAAWhB,EAAQlyB,MAA5C,SAAoDA,SAG5D,eAAC60B,GAAA,EAAD,CAAe3B,UAAWhB,EAAQuE,OAAlC,SACI,sBAAKvD,UAAWhB,EAAQxuB,KAAxB,SACI,eAAC,KAAD,CAAUwL,SAAUioB,EAAcU,WAAW,mBCvC3D3B,GAAqB,CACvBhL,cACApD,oBA6KWuO,gBAvLS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAC3B67B,QAASjuB,GAAOiR,SAAS/Q,SAASguB,YAClCC,aAAcnuB,GAAOiR,SAAS/Q,SAASiuB,gBAmLP9B,GAAzBG,CAA6Cf,cAzK7C,SAACC,GAAD,OAAkBC,aAC7B,CACIyC,QAAS,CACLxC,gBAAiB5rB,GAAOiR,SAAS/Q,SAASmuB,sBAC1CC,aAAc5C,EAAMrE,QAAQ,IAEhCyF,OAAQ,CACJlf,OAAQ8d,EAAM9d,OAAO2gB,OAAS,EAC9BnV,WAAYsS,EAAM8C,YAAYC,OAAO,CAAC,QAAS,UAAW,CACtDC,OAAQhD,EAAM8C,YAAYE,OAAOC,MACjCC,SAAUlD,EAAM8C,YAAYI,SAASC,iBAG7CC,WAAY,CACRC,QAAS,OACTC,WAAY,UAEhBC,KAAM,CACF/C,WAAYR,EAAMrE,QAAQ,IAE9BlxB,MAAM,aACF+4B,SAAU,EACVhD,WAAYR,EAAMrE,QAAQ,IACvBrnB,GAAOiR,SAAS/Q,SAASivB,kBAEhC7F,YAAa,CACTzjB,MAAO,GACPC,OAAQ,GACRtG,MAAO,OACPosB,gBAAiBrtB,KAAW,MAEhCqrB,aAAc,CACV/jB,MAAO,GACPC,OAAQ,GACRtG,MAAO,OACPosB,gBAAiBrtB,KAAW,MAEhC+sB,cAAe,CACXO,OAAQH,EAAMrE,QAAQ,GACtByE,SAAU,YAEdN,eAAgB,CACZhsB,MAAOjB,KAAW,KAClButB,SAAU,WACVC,IAAK,MACLC,KAAM,MACNpe,OAAQ,EACRqe,WAAY,GACZC,YAAa,IAEjBjC,WAAW,aACPiC,WAAYR,EAAMrE,QAAQ,IACvBrnB,GAAOiR,SAAS/Q,SAASkvB,qBAqHoB3D,EAhHrB,SAAC,GAOhB,IALhBpD,EAKe,EALfA,QACA4F,EAIe,EAJfA,QACA5M,EAGe,EAHfA,WACA8M,EAEe,EAFfA,aACAlQ,EACe,EADfA,gBACe,EAC6BvY,WAAe,MAD5C,mBACZ2pB,EADY,KACMC,EADN,OAEmB5pB,YAAe,GAFlC,mBAEZ6pB,EAFY,KAECC,EAFD,OAGiB9pB,YAAe,GAHhC,mBAGZ+pB,EAHY,KAGAC,EAHA,KAabC,EAAsB,WACxBL,EAAoB,OAqBxB,OACI,gBAAC5B,GAAA,EAAD,CACI5B,SAAS,WACTzC,UAAWuG,KAAWvH,EAAQyE,QAFlC,UAII,gBAACa,GAAA,EAAD,CAASkC,gBAAc,EAACxG,UAAWhB,EAAQ+F,QAASL,QAAQ,QAA5D,UACI,oBACI1wB,KAAM2C,GAAOiR,SAAS/Q,SAAS4vB,iBAAmB,GAClDroB,OAAO,SACPrG,IAAI,aACJioB,UAAWhB,EAAQyG,WAJvB,SAMI,sBACI3W,IAAKnY,GAAOiR,SAAS/Q,SAAS6vB,UAC9BlqB,MAAO7F,GAAOiR,SAAS/Q,SAAS8vB,UAChCzI,IAAK,aACL8B,UAAWhB,EAAQ4G,SAG3B,eAACnB,GAAA,EAAD,CACImC,UAAU,KACVlC,QAAQ,KACRvuB,MAAM,UACN0wB,QAAM,EACN7G,UAAWhB,EAAQlyB,MALvB,SAOK83B,IAEL,eAAC,GAAD,IACCE,GACG,eAACgC,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,WAA/B,SACI,eAACi0B,GAAA,EAAD,CAAYzjB,QAAS6X,EAAiBvW,KAAK,QAAQ2hB,UAAWhB,EAAQ4B,WAAtE,SACI,eAAC,KAAD,QAIZ,eAACkG,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,QAA/B,SACI,eAACi0B,GAAA,EAAD,CAAYzjB,QA/DD,SAACD,GACxBmpB,EAAoBnpB,EAAM2jB,gBA8D2BpiB,KAAK,QAAQ2hB,UAAWhB,EAAQ4B,WAAzE,SACI,eAAC,KAAD,QAGR,eAACkG,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,YAA/B,SACI,eAACi0B,GAAA,EAAD,CAAYzjB,QAxEQ,WAChCib,EAAW,aAuEmD3Z,KAAK,QAAQ2hB,UAAWhB,EAAQ4B,WAAlF,SACI,eAAC,KAAD,WAIZ,gBAACC,GAAA,EAAD,CACIvxB,GAAG,cACHwxB,SAAUkF,EACVjF,aAAW,EACXC,KAAMC,QAAQ+E,GACd9E,QAASoF,EACTU,mBAAoB,KACpBC,aAAc,CAACC,SAAU,SAAUC,WAAY,UAC/CC,gBAAiB,CAACF,SAAU,MAAOC,WAAY,UARnD,UAUI,eAAChG,GAAA,EAAD,CAAUpkB,QA3EG,WACrBupB,IACAD,GAAc,IAyEN,SAAsC97B,EAAKgC,IAAI,iBAC/C,eAAC40B,GAAA,EAAD,CAAUpkB,QAnEI,WACtBupB,IACAH,GAAe,IAiEP,SAAuC57B,EAAKgC,IAAI,gBAEpD,eAAC,GAAD,CAAcO,MAAOvC,EAAKgC,IAAI,eAChByH,KAAK,YACLgtB,KAAMoF,EAAYlF,QA3Ed,WACtBmF,GAAc,MA2EV,eAAC,GAAD,CAAcv5B,MAAOvC,EAAKgC,IAAI,WAChByH,KAAK,aACLgtB,KAAMkF,EAAahF,QArEd,WACvBiF,GAAe,aChHR/D,iBAvBA,SAACC,GAAD,OAAkBC,aAC7B,CACI+E,KAAM,CACF3B,QAAS,OACT4B,SAAU,OACVC,WAAYlF,EAAMrE,QAAQ,GAC1BwJ,YAAanF,EAAMrE,QAAQ,GAC3BiH,aAAc5C,EAAMrE,QAAQ,GAC5B6H,SAAU,OAePzD,EAR+B,SAAC,GAAyB,IAAxBpD,EAAuB,EAAvBA,QAAShjB,EAAc,EAAdA,SACrD,OACI,uBAAMgkB,UAAWhB,EAAQqI,KAAMI,aAAa,MAA5C,SACKzrB,O,qDCiBEomB,iBA/BA,SAACC,GAAD,OAAkBC,aAC7B,CACIoF,YAAa,CACT/D,YAAatB,EAAMrE,QAAQ,QA4BxBoE,EAjBuC,SAAC,GAKO,IAJHpD,EAIE,EAJFA,QACAlxB,EAGE,EAHFA,MACA65B,EAEE,EAFFA,QACAC,EACE,EADFA,QAEvD,OACI,eAACC,GAAA,EAAD,CAAanD,QAAQ,WAAW1E,UAAWhB,EAAQ0I,YAAnD,SACI,gBAACI,GAAA,EAAD,WACKh6B,EACA65B,EACAC,UC8CFxF,iBAlEA,SAACC,GAAD,OAAkBC,aAC7B,CACIoF,YAAa,CACT/D,YAAatB,EAAMrE,QAAQ,GAC3B+J,aAAc1F,EAAMrE,QAAQ,GAC5BgK,SAAU,KAEdC,YAAa,OA2DN7F,EAlDqC,SAAC,GAKO,IAJHpD,EAIE,EAJFA,QACA5vB,EAGE,EAHFA,kBACA/B,EAEE,EAFFA,SACAkoB,EACE,EADFA,cAQrDnmB,EAAoBA,GAAqB,GACzC/B,EAAWA,GAAY,GAEvB,IAAM66B,EACF,eAACC,GAAA,EAAD,CAAYC,QAAM,EAACC,QAAQ,iBAA3B,SACK99B,EAAKgC,IAAI,aAIZ+7B,EACF,eAACC,GAAA,EAAD,CACI7D,QAAQ,WACR/6B,MAAOyF,EACPo5B,SAlBoB,SAAC1rB,GACzB,IAAM3O,EAAY2O,EAAMsB,OAAOzU,OAAS,KACxC4rB,EAAcpnB,EAAWd,GAAU,IAiB/Bo7B,MAAO,eAACC,GAAA,EAAD,CAAOt+B,KAAK,UAAUkF,GAAG,mBAChCq5B,cAAY,EACZv+B,KAAK,UACL41B,UAAWhB,EAAQiJ,YAPvB,SAQK56B,EAAS9B,KAAI,SAAAgC,GAAO,OACjB,eAAC4zB,GAAA,EAAD,CAEIx3B,MAAO4D,EAAQ+B,GACfs5B,SAAUr7B,EAAQ+B,KAAOF,EAH7B,SAKK7B,EAAQT,OAJJS,EAAQ+B,SAU7B,OACI,eAAC,GAAD,CACIxB,MAAOo6B,EACPP,QAASW,OC9DftF,GAAqB,CACvBzN,kBAGW4N,gBAZS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAC3BqG,kBAAmByW,EAAMqF,aAAa9b,kBACtC/B,SAAUwY,EAAMC,UAAUzY,YAQM21B,GAAzBG,CAA6C0F,I,qBCyF7CzG,iBAzFA,SAACC,GAAD,OAAkBC,aAC7B,CACIoF,YAAa,CACT/D,YAAatB,EAAMrE,QAAQ,GAC3B+J,aAAc1F,EAAMrE,QAAQ,GAC5BgK,SAAU,KAEdC,YAAa,GACba,OAAQ,CACJtG,OAAQH,EAAMrE,QAAQ,SAgFnBoE,EApEuC,SAAC,GAOO,IANHpD,EAME,EANFA,QACA+J,EAKE,EALFA,iBACAxgB,EAIE,EAJFA,qBACA9Y,EAGE,EAHFA,UACAu5B,EAEE,EAFFA,eACA7Q,EACE,EADFA,cAYvD5P,EAAuBA,GAAwB,GAC/C9Y,EAAYA,GAAa,GAEzB,IAAMw5B,EACF,eAACd,GAAA,EAAD,CAAYC,QAAM,EAACC,QAAQ,kBAA3B,SACK99B,EAAKgC,IAAI,cAIZ28B,EACF,eAACX,GAAA,EAAD,CACI7D,QAAQ,WACR1E,UAAWhB,EAAQiJ,YACnBt+B,MAAO4e,EACPigB,SAvBqB,SAAC1rB,GAC1BksB,EAAelsB,EAAMsB,OAAOzU,OAAS,OAuBjC8+B,MAAO,eAACC,GAAA,EAAD,CAAOt+B,KAAK,WAAWkF,GAAG,oBACjCq5B,cAAY,EACZv+B,KAAK,WAPT,SAQKqF,EAAUlE,KAAI,SAAAmE,GAAQ,OACnB,eAACyxB,GAAA,EAAD,CAEIx3B,MAAO+F,EAAStF,KAChBw+B,SAAUl5B,EAAStF,OAASme,EAHhC,SAKK7Y,EAAS5C,OAAS4C,EAAStF,MAJvBsF,EAAStF,WASxB++B,EACF,eAAC3I,GAAA,EAAD,CACIR,UAAWhB,EAAQ8J,OACnBM,UAAWL,EACXhsB,QAtC+B,WACnCob,KAsCI9Z,KAAK,QAJT,SAKI,eAACyoB,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,4BAA/B,SACK,eAAC,KAAD,QAKb,OACI,eAAC,GAAD,CACIuB,MAAOm7B,EACPtB,QAASuB,EACTtB,QAASuB,OCpFfnG,GAAqB,CACvBgG,eZiMG,SAAwBzgB,GAC3B,MAAO,CAAC5M,KAAMygB,GAAiB7T,yBYjM/B4P,kBAGWgL,gBAfS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAE3Bwf,qBAAsB1C,EAAMqF,aAAa3C,qBACzCwgB,iBAAkBtb,GAAyB5H,GAC3CpW,UAAWmc,GAAiC/F,MASZmd,GAAzBG,CAA6CkG,I,sBCoB7CjH,iBA7BA,SAACC,GAAD,OAAkBC,aAC7B,MA4BWF,EApB6B,SAAC,GAAsD,IAArDlY,EAAoD,EAApDA,aAAcwC,EAAsC,EAAtCA,UAAW4c,EAA2B,EAA3BA,sBAMnE,OACI,eAACxC,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,0BAA/B,SACI,eAACg9B,GAAA,EAAD,CAAkBz7B,MAAOvD,EAAKgC,IAAI,OAAQo7B,QACtC,eAAC6B,GAAA,EAAD,CACIrzB,MAAO,UACPszB,QAAuB,OAAd/c,GAAqBxC,EAC9Bkf,SAAwB,OAAd1c,EACV8b,SAXW,SAAC1rB,GACxBwsB,EAAsBxsB,EAAMsB,OAAOqrB,mBCXrCzG,GAAqB,CACvBsG,sBduLG,SAA+Bpf,GAClC,MAAO,CAACvO,KAAMwgB,GAA0BjS,kBcrL7BiZ,gBAZS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAC3B2jB,UAAWD,GAAiC5G,GAC5CqE,aAAcrE,EAAMqF,aAAahB,gBAQD8Y,GAAzBG,CAA6CuG,I,+BCkG7CtH,iBAhGA,SAACC,GAAD,OAAkBC,aAC7B,CACIqH,OAAQ,CACJ3B,SAAU,WA6FP5F,EA9E4C,SAAC,GAOO,IANHpD,EAME,EANFA,QACAnkB,EAKE,EALFA,YACA+R,EAIE,EAJFA,kBACApE,EAGE,EAHFA,sBACAohB,EAEE,EAFFA,yBACAC,EACE,EADFA,oBAkB5D,GAFArhB,EAAwBA,GAAyB,GAEtB,KAH3B3N,EAAcA,GAAe,IAGbpQ,QAAwC,IAAvBoQ,EAAYpQ,QAAsC,SAAtBoQ,EAAY,GAAGvL,GACxE,OAAO,KAGX,IAAMw6B,EACF,eAAC3B,GAAA,EAAD,CACIC,QAAM,EACNC,QAAQ,sBAFZ,SAIK99B,EAAKgC,IAAI,YAIZw9B,EACF,eAACxB,GAAA,EAAD,CACI7D,QAAQ,WACRsF,UAAQ,EACRrB,cAAY,EACZH,SAjCwB,SAAC1rB,GAC7B8P,EAAkB9P,EAAMsB,OAAOzU,OAA4B,OAiCvD8+B,MAAO,eAACC,GAAA,EAAD,CAAOt+B,KAAK,eAAekF,GAAG,wBACrC3F,MAAO6e,EACPyhB,YA5B+B,WACnC,OAAOL,GA4BHx/B,KAAK,eACL41B,UAAWhB,EAAQ2K,OATvB,SAUK9uB,EAAYtP,KAAI,SAAA6N,GAAU,OACvB,gBAAC+nB,GAAA,EAAD,CAEIx3B,MAAOyP,EAAW9J,GAFtB,UAII,eAAC46B,GAAA,EAAD,CAAUT,QAASjhB,EAAuBvW,QAAQmH,EAAW9J,KAAO,IACpE,eAACivB,GAAA,EAAD,CAAcC,QAASplB,EAAWtM,UAJ7BsM,EAAW9J,SAU1B66B,EAAiD,IAAjC3hB,EAAsB/d,QAA6C,SAA7B+d,EAAsB,GAC5E4hB,EACF,eAAC5J,GAAA,EAAD,CAAY4I,UAAWe,EAAeptB,QAjDV,WAC5B8sB,KAgDwExrB,KAAK,QAA7E,SACI,eAACyoB,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,iBAA/B,SACK,eAAC,KAAD,QAKb,OACI,eAAC,GAAD,CACIuB,MAAOg8B,EACPnC,QAASoC,EACTnC,QAASwC,OC3FfpH,GAAqB,CACvBpW,qBACAid,oBpB8QG,WACH,MAAO,CAACluB,KAAM0c,MoB5QH8K,gBAfS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAE3Byf,sBAAuB3C,EAAMqF,aAAa1C,sBAC1C3N,YAAawL,GAAoBR,GACjC+jB,yBAA0B3c,GAAiCpH,MAS3Bmd,GAAzBG,CAA6CkH,ICiG7CjI,iBAvGA,SAACC,GAAD,OAAkBC,aAC7B,CACIqH,OAAQ,CACJ3B,SAAU,OAEdc,OAAQ,OAkGD1G,EAlFiC,SAAC,GAQO,IAPHpD,EAOE,EAPFA,QACA/G,EAME,EANFA,YACAjK,EAKE,EALFA,YACAvF,EAIE,EAJFA,gBACAD,EAGE,EAHFA,sBACA8hB,EAEE,EAFFA,gBACAjd,EACE,EADFA,OAajDA,EAASA,GAAU,GACnBW,EAAcA,GAAe,GAC7BvF,EAAkBA,GAAmB,GACrCD,EAAwBA,GAAyB,GAEjD,IAAM+hB,EACF,eAACpC,GAAA,EAAD,CACIC,QAAM,EACNC,QAAQ,eAFZ,SAIK99B,EAAKgC,IAAI,WAIZi+B,EACF,eAACjC,GAAA,EAAD,CACI7D,QAAQ,WACR/6B,MAAO8e,EACP+f,SA5BkB,SAAC1rB,GACvBmb,EAAYnb,EAAMsB,OAAOzU,OAAS,KAAM0jB,GAAQ,IA4B5Cob,MAAO,eAACC,GAAA,EAAD,CAAOt+B,KAAK,QAAQkF,GAAG,iBAC9Bq5B,cAAY,EACZv+B,KAAK,QACL41B,UAAWhB,EAAQ2K,OACnBP,SAA4B,IAAlB/b,EAAO5iB,OARrB,SAUK4iB,EAAO9hB,KAAI,SAAC8N,EAAOG,GAAR,OACR,eAAC2nB,GAAA,EAAD,CAEIx3B,MAAO0P,EAAM/J,GACbs5B,SAAUvvB,EAAM/J,KAAOmZ,EAH3B,SAKKuF,EAAYxU,IAJRH,EAAM/J,SAUrB66B,EAAgB9c,EAAO5iB,OAAS,GACE,IAAjC+d,EAAsB/d,QACO,SAA7B+d,EAAsB,IACF,KAApBC,EACDgiB,EACF,eAACjK,GAAA,EAAD,CACIR,UAAWhB,EAAQ8J,OACnBM,UAAWe,EACXptB,QAnDwB,WACJ,OAApB0L,GACA6hB,EAAgB7hB,EAAiB4E,IAkDjChP,KAAK,QAJT,SAKI,eAACyoB,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,gBAA/B,SACK,eAAC,KAAD,QAKb,OACI,eAAC,GAAD,CACIuB,MAAOy8B,EACP5C,QAAS6C,EACT5C,QAAS6C,OC7FfzH,GAAqB,CACvB/K,eACAqS,gBtB8PG,SAAyBh7B,EAAY+d,GACxC,MAAO,CAAC1R,KAAMyc,GAAmB9oB,KAAI+d,WsB9PrC2K,eAGWmL,gBApBS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAE3BsE,SAAUwY,EAAMC,UAAUzY,SAC1B6Y,eAAgBL,EAAMC,UAAUI,eAEhCsC,sBAAuB3C,EAAMqF,aAAa1C,sBAC1CC,gBAAiB5C,EAAMqF,aAAazC,gBACpC4E,OAAQH,GAAiCrH,GACzCmI,YAAaD,GAAsClI,MAUnBmd,GAAzBG,CAA6CuH,I,+HCftDrH,GAAYC,cAAW,SAAAjB,GAAK,MAAK,CAC/BqF,YAAa,CACT9E,UAAWP,EAAMrE,QAAQ,KACzB2F,YAAatB,EAAMrE,QAAQ,QCdvC,IAMMgF,GAAqB,CACvBnG,sBAGWsG,gBAVS,SAACtd,GACrB,MAAO,CACHmE,eAAgBnE,EAAMqF,aAAalB,kBAQHgZ,GAAzBG,EDcA,YAA2F,IAA9DnZ,EAA6D,EAA7DA,eAAgB6S,EAA6C,EAA7CA,kBAClDmC,EAAUqE,KAUhB,OACI,eAACwE,GAAA,EAAD,CAAanD,QAAQ,WAAW1E,UAAWhB,EAAQ0I,YAAnD,SACI,gBAACiD,GAAA,EAAD,CAAmBtsB,KAAK,QAAQ1U,MAAOqgB,EAAgB4gB,WAAS,EAACpC,SAVzE,SAAsB1rB,EAAsCnT,GAEpDkzB,EADU,OAAVlzB,EACkBA,EAEA,WAMlB,UACI,eAACkhC,GAAA,EAAD,CAAsBlhC,MAAM,SAA5B,SACI,eAACm9B,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,yBAA/B,SACI,eAAC,KAAD,OAFW,GAKnB,eAACs+B,GAAA,EAAD,CAAsBlhC,MAAM,QAA5B,SACI,eAACm9B,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,+BAA/B,SACI,eAAC,KAAD,OAFW,GAKnB,eAACs+B,GAAA,EAAD,CAAsBlhC,MAAM,UAA5B,SACI,eAACm9B,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,8BAA/B,SACI,eAAC,KAAD,OAFW,GAKnB,eAACs+B,GAAA,EAAD,CAAsBlhC,MAAM,SAA5B,SACI,eAACm9B,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,+BAA/B,SACI,eAAC,KAAD,OAFW,GAKnB,eAACs+B,GAAA,EAAD,CAAsBlhC,MAAM,WAA5B,SACI,eAACm9B,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,mBAA/B,SACI,eAAC,KAAD,OAFW,W,8DEgCpB61B,iBA7EA,SAACC,GAAD,OAAkBC,aAC7B,MA4EWF,EAjE+B,SAAC,GAKO,IAkB9C0I,EAAcC,EAtB6BC,EAIE,EAJFA,iBACApiB,EAGE,EAHFA,aACAC,EAEE,EAFFA,kBACAyT,EACE,EADFA,WAOzC2O,EACF,eAAC,KAAD,CACI7C,QAAM,EACNC,QAAQ,cAFZ,mBAIQ99B,EAAKgC,IAAI,QAJjB,YASE2+B,EADkC,kBAAjBtiB,EACKwK,GAAiBxK,GAAiB,KAG1D5Z,MAAMC,QAAQ4Z,KACdiiB,EAAe1X,GAAiBvK,EAAkB,IAClDkiB,EAAe3X,GAAiBvK,EAAkB,KAGtD,IAAMsiB,EACF,eAACC,GAAA,EAAD,CAAsBC,YAAaC,KAAnC,SACI,eAACC,GAAA,EAAD,CACInC,UAAW4B,EACXtG,QAAQ,SACR8G,WACKR,OAEKzwB,EADAhQ,EAAKgC,IAAI,qBAGnBk/B,YAAY,sBACZn8B,GAAG,cACH3F,MAAOuhC,EACPQ,YAAaZ,EACba,YAAaZ,EACbvC,SArCa,SAACoD,GACtBtP,EAAoB,OAATsP,EAAkCA,E5BpCjC59B,U4BoC0C,OAqC9C69B,MAAM,EACNC,YAAa,SAAC/vB,GAAD,OACT,eAACgwB,GAAA,EAAD,2BACQhwB,GADR,IAEI2oB,QAAQ,WACRrmB,KAAK,gBAOzB,OACI,eAAC,GAAD,CACIvQ,MAAOm9B,EACPtD,QAASwD,OCzEfnI,GAAqB,CACvB1G,eAGW6G,gBAdS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAE3BiiC,mBAAoB1c,GAAqCzI,GACzD+C,aAAc/C,EAAMqF,aAAatC,aACjCC,kBAAmBhD,EAAMqF,aAAarC,qBAQNma,GAAzBG,CAA6C6I,I,WCkF7C5J,iBAvFA,SAACC,GAAD,OAAkBC,aAC7B,CACI2J,IAAK,CACDrJ,UAAWP,EAAMrE,QAAQ,GACzB6E,WAAYR,EAAMrE,QAPX,GAQP2F,YAAatB,EAAMrE,QARZ,GASPgK,SAAU,KAEdl6B,MAAO,CACHqI,MAAO,OACP+1B,SAAU,WA6EP9J,EA/D+B,SAAC,GAMO,IALHpD,EAKE,EALFA,QACAgM,EAIE,EAJFA,iBACApiB,EAGE,EAHFA,aACA0T,EAEE,EAFFA,WACAzT,EACE,EADFA,kBACE,EACPmb,mBAASpb,GADF,mBAC1CujB,EAD0C,KAC3BC,EAD2B,KAOjD,GAJAjI,qBAAU,WACNiI,EAAiBxjB,IAAiBC,EAAoBA,EAAkB,GAAK,MAC9E,CAACD,EAAcC,KAEbmiB,EACD,OAAO,KAGX,IAYIqB,EAAyBr9B,MAAMC,QAAQ4Z,GACtCwjB,IACDxjB,EAAoB,CAAC9a,KAAK2F,MAAQ,EAAIggB,GAAY3lB,KAAK2F,QAG3D,IAAM44B,EAAgB,CAClB,CAAC3iC,MAAOkf,EAAmB,GAAI/a,MAAOylB,GAAuB1K,EAAmB,KAChF,CAAClf,MAAOkf,EAAmB,GAAI/a,MAAOylB,GAAuB1K,EAAmB,MAOpF,OACI,eAACif,GAAA,EAAD,CAAK9H,UAAWhB,EAAQiN,IAAxB,SACI,eAACnF,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,0BAA/B,SACI,eAACggC,GAAA,EAAD,CACInD,UAAWiD,EACXG,IAAK3jB,EAAmB,GACxB4jB,IAAK5jB,EAAmB,GACxBlf,MAAOwiC,GAAiB,EACxBO,kBAAkB,MAClBC,iBAbhB,SAA0BhjC,GACtB,OAAO6pB,GAA2B7pB,IAatB2iC,MAAOA,EACP9D,SArCK,SAAC1rB,EAAcnT,GACX,kBAAVA,GACPyiC,EAAiBziC,IAoCTijC,kBAhCc,SAAC9vB,EAA+BnT,GACtD2yB,GAA+B,kBAAV3yB,GACrB2yB,EAAW3yB,IA+BH0U,KAAK,iBC/EnB2kB,GAAqB,CACvB1G,cACAG,oBAGW0G,gBAfS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAE3BiiC,mBAAoB1c,GAAqCzI,GACzD+C,aAAc/C,EAAMqF,aAAatC,aACjCC,kBAAmBhD,EAAMqF,aAAarC,qBASNma,GAAzBG,CAA6C0J,I,8HCmJ7CzK,iBAlJA,SAACC,GAAD,OAAkBC,aAC7B,CACIoF,YAAa,CACT9E,UAAWP,EAAMrE,QAAQ,GACzB2F,YAAatB,EAAMrE,QAAQ,QA8IxBoE,EA9H+B,SAAC,GASO,IARHpD,EAQE,EARFA,QACAjW,EAOE,EAPFA,oBACAC,EAME,EANFA,sBACA8jB,EAKE,EALFA,oBACAlkB,EAIE,EAJFA,aACAC,EAGE,EAHFA,kBACAyT,EAEE,EAFFA,WACAyQ,EACE,EADFA,gBAGzCC,EAAaC,iBAAsB,MAEzC9I,qBAAU,WAEN,OADA+I,IACOC,KAGX,IAAMC,EAAkB,WACpBL,EAAgB,IAuBdG,EAAY,WACVnkB,EACAskB,IAEAF,KAIFE,EAAe,WACjBF,IACAH,EAAWM,QAAUx5B,OAAOy5B,YAAYH,EAAiBpkB,IAGvDmkB,EAAiB,WACQ,OAAvBH,EAAWM,UACXx5B,OAAO05B,cAAcR,EAAWM,SAChCN,EAAWM,QAAU,OAKvBG,EAAkC,kBAAjB7kB,EAEjB8kB,EAAcnjC,EAAKgC,IAAIwc,EAAsB,OAAS,SACtD4kB,EAAW5kB,EAAsB,eAAC,KAAD,IAAwB,eAAC,KAAD,IAEzD6kB,EACF,eAACpN,GAAA,EAAD,CACI4I,UAAWqE,EACXjJ,aAAYkJ,EACZ3wB,QAlDsB,WAC1B+vB,GAAqB/jB,EAAqBC,IAkDtC3K,KAAK,QAJT,SAKI,eAACyoB,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,0CAA/B,SACKohC,MAKPE,EACF,eAACrN,GAAA,EAAD,CACI4I,UAAWqE,GAAW1kB,EACtBhM,QAjD+B,WACnCuf,EAAWzT,EAAoBA,EAAkB,GAAK,OAiDlDxK,KAAK,QAHT,SAII,eAAC,KAAD,MAIFyvB,EACF,eAACtN,GAAA,EAAD,CACI4I,UAAWqE,GAAW1kB,EACtBhM,QA9D8B,WAClCgwB,GAAiB,IA8Db1uB,KAAK,QAHT,SAII,eAAC,KAAD,MAGF0vB,EACF,eAACvN,GAAA,EAAD,CACI4I,UAAWqE,GAAW1kB,EACtBhM,QA1E8B,WAClCgwB,EAAgB,IA0EZ1uB,KAAK,QAHT,SAII,eAAC,KAAD,MAGF2vB,EACF,eAACxN,GAAA,EAAD,CACI4I,UAAWqE,GAAW1kB,EACtBhM,QAtE8B,WAClCuf,EAAWzT,EAAoBA,EAAkB,GAAK,OAsElDxK,KAAK,QAHT,SAII,eAAC,KAAD,MAGR,OACI,eAACwpB,GAAA,EAAD,CAAanD,QAAQ,WAAW1E,UAAWhB,EAAQ0I,YAAnD,SACI,gBAACI,GAAA,EAAD,WACK+F,EACAC,EACAF,EACAG,EACAC,UClJXhL,GAAqB,CACvB1G,cACAyQ,gB1B2NG,SAAyBkB,GAC5B,MAAO,CAACtyB,KAAM4gB,GAAmB0R,c0B3NjCnB,oB1BoQG,SAA6B/jB,EAA8BC,GAC9D,MAAO,CAACrN,KAAMghB,GAAuB5T,sBAAqBC,2B0BlQ/Cma,gBAjBS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAE3B6f,aAAc/C,EAAMqF,aAAatC,aACjCC,kBAAmBhD,EAAMqF,aAAarC,kBACtCE,oBAAqBlD,EAAMqF,aAAanC,oBACxCC,sBAAuBnD,EAAMqF,aAAalC,yBAUVga,GAAzBG,CAA6C+K,I,+DCqG7C9L,iBAxGA,SAACC,GAAD,OAAkBC,aAC7B,CACIoF,YAAa,CACT9E,UAAWP,EAAMrE,QAAQ,GACzB2F,YAAatB,EAAMrE,QAAQ,GAC3B6E,WAAY,YAmGTT,EAnF6C,SAAC,GAavD,IAXEpD,EAWH,EAXGA,QACA7a,EAUH,EAVGA,QACAgqB,EASH,EATGA,oBACAhkB,EAQH,EARGA,aACA4S,EAOH,EAPGA,aACA/W,EAMH,EANGA,iBACAgS,EAKH,EALGA,WACA8M,EAIH,EAJGA,aACAlQ,EAGH,EAHGA,gBACA1d,EAEH,EAFGA,QAGJ,IAAKiN,EACD,OAAO,KAGX,IAEIiqB,EAFEC,EAAcroB,EAAiBvb,OAAS,EAG1CkM,GAAOiR,SAAS/Q,SAASy3B,iBACzBF,EACI,eAAC5N,GAAA,EAAD,CAAY4I,UAAWiF,EAAatxB,QAAS,kBAAMib,EAAW,WAAW3Z,KAAK,QAA9E,SACI,eAACyoB,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,eAA/B,SACK,eAAC,KAAD,SAMjB,IAiBIgiC,EACAC,EAlBEC,EACF,eAACjO,GAAA,EAAD,CAAYzjB,QAASoxB,EAAqB9vB,KAAK,QAA/C,SACI,eAACyoB,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,8BAA/B,SACI,eAAC,KAAD,QAKRmiC,EACA,eAAClO,GAAA,EAAD,CAAYzjB,QAAS,kBAAMggB,GAAa,IAAOqM,SAAUjf,EAAc9L,KAAK,QAA5E,SACI,eAACyoB,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,0BAA/B,SACK,eAAC,KAAD,QA4Bb,OAnBI2K,IACI4tB,IACAyJ,EACI,eAAC/N,GAAA,EAAD,CAAYzjB,QAAS6X,EAAiBvW,KAAK,QAA3C,SACI,eAACyoB,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,WAA/B,SACI,eAAC,KAAD,SAKhBiiC,EACI,eAAChO,GAAA,EAAD,CAAYzjB,QAAS,kBAAMib,EAAW,aAAa3Z,KAAK,QAAxD,SACI,eAACyoB,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,YAA/B,SACI,eAAC,KAAD,SAOZ,eAACs7B,GAAA,EAAD,CAAanD,QAAQ,WAAW1E,UAAWhB,EAAQ0I,YAAnD,SACI,gBAACI,GAAA,EAAD,WACKyG,EACAH,EACAK,EACAC,EACAF,UCpGXxL,GAAqB,CACvBjG,gBACAoR,oB5BuEG,WACH,OAAO,SAAC/Z,EAAoBC,GACxB,IAAMnZ,EAAUmQ,GAAwBgJ,KAClClmB,EAAY8c,GAA0BoJ,KACxCnZ,EACAkZ,EAASuH,GAAWzgB,IACb/M,GACPimB,EAASqH,GAAattB,M4B7E9B6pB,cACApD,oBAGWuO,gBAlBS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAC3Bob,WAAY0B,EAAMqF,aAAa9b,oBAAqByW,EAAMqF,aAAazC,iBACvE0B,aAActE,EAAMqF,aAAaf,aACjCnE,iBAAkBH,EAAMC,UAAUE,iBAClC9O,QAASP,GAAOiR,SAAS/Q,SAASK,QAClC4tB,aAAcnuB,GAAOiR,SAAS/Q,SAASiuB,gBAWP9B,GAAzBG,CAA6CwL,ICwB7CxL,gBA7BS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAC3B6lC,KAAM/oB,EAAMC,UAAUzY,SAAS5C,OAAS,KAIrB,GAsBZ04B,EApBgC,SAAC,GAC5C,OADuD,EAAVyL,KAKzC,gBAAC,GAAD,WACI,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,OAbG,Q,4BCdMC,I,yDACjB,WAAY9yB,GAAgB,IAAD,8BACvB,cAAMA,IACD8J,MAAQ,CAAC/b,MAAO,MAFE,E,qDAU3B,SAAkBA,EAAcglC,GAE5BtlC,QAAQM,MAAMA,GACVglC,EAAUC,gBACVvlC,QAAQM,MAAMglC,EAAUC,kB,oBAIhC,WACI,IAAKrlC,KAAKqS,MAAMC,SACZ,MAAM,IAAIhT,MAAM,gDAGpB,OAAKU,KAAKmc,MAAM/b,MAKZ,iCACI,qBAAIk2B,UAAU,uBAAd,SAAsCz1B,EAAKgC,IAAI,2BAC/C,2BAASyzB,UAAU,wBAAwBjgB,MAAO,CAACivB,WAAY,YAA/D,UACKtlC,KAAKmc,MAAM/b,MAAM0J,WAClB,8BARD9J,KAAKqS,MAAMC,Y,uCAnB1B,SAAgClS,GAE5B,MAAO,CAACA,a,GAR2BuS,c,UCN9B4yB,GAAb,4MACIC,OAAgC,KADpC,EAGIC,aAAe,SAACD,GACZ,EAAKA,OAASA,GAJtB,kDAOI,SAAa3jC,GAET,IAAMo8B,EAAU,IAAIyH,KAAU,CAACC,QAAS3lC,KAAKwlC,SAE7C,OADA3jC,EAAI+jC,WAAW3H,GACRA,IAXf,6BAcI,SAAgBp8B,EAAYo8B,EAAoBnoB,GAC5C,OAAOmoB,IAff,6BAkBI,SAAgBp8B,EAAYo8B,GAA2B,IAAD,gBACzBp8B,EAAIgkC,cAAcC,YADO,IAClD,2BAAuD,CACnD,GADmD,UAC9B7H,EAAS,CAE1Bp8B,EAAIkkC,cAAc9H,GAClB,QAL0C,iCAlB1D,oBA4BI,WAAU,IAAD,EACgCj+B,KAAKqS,MAAnCC,EADF,EACEA,SAAU+D,EADZ,EACYA,MAAOigB,EADnB,EACmBA,UAClB0P,GAAc1P,EAAYA,EAAY,IAAM,IAAM,6BACxD,OAAO,sBAAKjgB,MAAOA,EAAOigB,UAAW0P,EAAY5vB,IAAKpW,KAAKylC,aAApD,SAAmEnzB,QA/BlF,GAA6BkE,I,UCChByvB,GAAb,kKAEI,SAAapkC,GACT,IAAMo8B,EAAU,IAAIiI,KAAmBlmC,KAAKmmC,cAE5C,OADAtkC,EAAI+jC,WAAW3H,GACRA,IALf,6BAQI,SAAgBp8B,EAAYo8B,EAA6BnoB,GAErD,OADAmoB,EAAQjoB,cAAchW,KAAKmmC,cACpBlI,IAVf,6BAaI,SAAgBp8B,EAAYo8B,GACxBp8B,EAAIkkC,cAAc9H,OAd1B,GAA+BznB,I,6BCKlB4vB,GAAb,kKAEI,SAAavkC,GACT,IAAMwkC,EAAO,IAAIC,KAAkBtmC,KAAKmmC,cACpCI,IAAWvmC,KAAKqS,MAAMk0B,OAM1B,OALAF,EAAKG,UAAUD,GACf1kC,EAAI4kC,eAAeJ,GACfE,GACAvmC,KAAK0mC,OAAOL,EAAMrmC,KAAKqS,OAEpBg0B,IAVf,6BAaI,SAAgBxkC,EAAYwkC,EAAyBvwB,GACjDuwB,EAAKrwB,cAAchW,KAAKmmC,cACxB,IAAII,IAAWvmC,KAAKqS,MAAMk0B,OAM1B,OALAF,EAAKG,UAAUD,GACfvmC,KAAK2mC,SAASN,EAAMvwB,GAChBywB,GACAvmC,KAAK0mC,OAAOL,EAAMrmC,KAAKqS,OAEpBg0B,IArBf,6BAwBI,SAAgBxkC,EAAYwkC,GACxBrmC,KAAK2mC,SAASN,EAAMrmC,KAAKqS,OACzBxQ,EAAI+kC,kBAAkBP,KA1B9B,wBA6BI,WACI,IAAIt/B,EAAO,4EACJA,EAAO,eACPA,EAAO,cACPA,EAAO,mBACPA,EAAO,UACd,IAAM4e,EAAU3lB,KAAKqS,MAAMsT,QAC3B,GAAIA,IAAY5e,EAAQyQ,OAAQ,CAC5B,IAAMqvB,EAAc7mC,KAAK8mC,aAAanhB,GAClCkhB,IACA9/B,EAAO,OAAc8/B,EAA8BvvB,aAG3D,OAAOvQ,IA1Cf,oBA6CI,SAAes/B,EAAyBh0B,GAA6B,IAC1D00B,EAA0B10B,EAA1B00B,YAAaC,EAAa30B,EAAb20B,UAChBD,GACAV,EAAK3wB,GAAG,YAAaqxB,GAErBC,GACAX,EAAK3wB,GAAG,UAAWsxB,KAnD/B,sBAuDI,SAAiBX,EAAyBh0B,GAA6B,IAC5D00B,EAA0B10B,EAA1B00B,YAAaC,EAAa30B,EAAb20B,UAChBD,GACAV,EAAKnxB,GAAG,YAAa6xB,GAErBC,GACAX,EAAKnxB,GAAG,UAAW8xB,OA7D/B,GAA0BxwB,I,SCRbywB,GAAb,kKAEI,SAAaplC,GACT,OAAO7B,KAAKknC,WAAWrlC,KAH/B,6BAMI,SAAgBA,EAAYkD,MANhC,6BASI,SAAgBlD,EAAYkD,GACxB,OAAO/E,KAAKknC,WAAWrlC,KAV/B,wBAaI,SAAWA,GACP,IAAMslC,EAAgBnnC,KAAKqS,MAAMiD,WAC7B8xB,EAAkCvlC,EAAIyS,UAAU+yB,gBAMpD,GAL6B,kBAAlBF,GACHC,IACAA,EAAgBA,EAAcE,WAGlCH,GAAiBA,IAAkBC,EAAe,CAClD,IAAMG,EAAU1lC,EAAIyS,UACdkzB,EAAU,IAAInyB,KAAJ,2BACTrV,KAAKqS,OADI,IAEZkD,OAAQkyB,aAAYF,EAAQG,aAAe,CAAC,EAAG,GAC3CN,EACAD,GAEJ5yB,QAASgzB,EAAQ/yB,aACjBgB,KAAM+xB,EAAQI,aAElB9lC,EAAIuV,YAAY3X,SAAQ,SAAAyX,GAChBA,aAAiBsE,MACjBtE,EAAMI,YAAYswB,gBAAe,SAAA7Z,GAAY,IAAD,EACxC,UAAAA,EAAQE,qBAAR,SAAuB4Z,UAAUT,EAAeD,SAI5DtlC,EAAIimC,QAAQN,QAEZ3lC,EAAIyS,UAAU0B,cAAchW,KAAKqS,OAErC,OAAOxQ,EAAIyS,cA3CnB,GAA0BkC,I,qBCAnB,SAASuxB,GAAgBha,EAAoBthB,EAAeu7B,GAC/D,GAAIja,EAAQE,wBAAyBga,IACjCla,EAAQma,SAcT,SAAkCzf,EACA0f,EACAC,EACAC,GACrC,IAAM7f,EAAO,IAAIL,KACb,CACI1b,MAAO07B,IAETxgB,EAAS,IAAIC,KACf,CACInb,MAAO27B,EACPt1B,MAAOu1B,IAGf,OAAO,IAAI3gB,KACP,CACIlkB,MAAO,IAAI8kC,KAAc,CAAC7f,SAAQD,OAAMb,aA9B3B4gB,CAAyB,EAAG97B,EAAO,QAAS,QAC1D,CACHu7B,EAAqC,kBAAhBA,EAA2BA,EAAc,IAC9D,IAAIQ,EAAgBC,KAAKh8B,GAErB+7B,EADAljC,MAAMC,QAAQijC,GACE,CAACA,EAAc,GAAIA,EAAc,GAAIA,EAAc,GAAIR,GAEvD,CAAC,IAAK,IAAK,IAAKA,GAEpCja,EAAQma,SA0BT,SAA6BC,EACAC,EACAC,GAChC,IAAM7f,EAAO,IAAIL,KACb,CACI1b,MAAO07B,IAETxgB,EAAS,IAAIC,KACf,CACInb,MAAO27B,EACPt1B,MAAOu1B,IAGf,OAAO,IAAI3gB,KAAQ,CAACc,OAAMb,WAvCL+gB,CAAoBF,EAAe/7B,EAAO,KCmBnE,IAGMk8B,GAAoB,IAAIrhB,KACxBshB,GAAyB,IAAIthB,KAI7BuhB,GAA0C,CAAChuB,OAAQ,IAAMiuB,MAAO,IAAK9P,IAAK,IAE1E+P,GAAyB,IAAInhB,KAAc,CAC7Cnb,MAAO,CAAC,IAAK,IAAK,EAAG,GACrBqG,MAAO,IAELk2B,GAAuB,IAAI7gB,KAAY,CACzC1b,MAAO,CAAC,IAAK,IAAK,EAAG,OAEnBw8B,GAAwB,IAAIvhB,KAAQ,CACtCC,OAAQohB,GACRvgB,KAAMwgB,GACNxlC,MAAO,IAAI8kC,KAAc,CACrB7f,OAAQ,GACRd,OAAQohB,GACRvgB,KAAMwgB,OAwPCtQ,iBA/QA,SAACC,GAAD,OAAkBC,aAAa,MA+QZ,CAACsQ,WAAW,GAA/BxQ,EA9NuB,SAAC,GAmBO,IAlBHC,EAkBE,EAlBFA,MACAxG,EAiBE,EAjBFA,MACA7R,EAgBE,EAhBFA,eACAM,EAeE,EAfFA,cACAuoB,EAcE,EAdFA,aACAC,EAaE,EAbFA,SACAC,EAYE,EAZFA,cACAC,EAWE,EAXFA,qBACAC,EAUE,EAVFA,iBACAC,EASE,EATFA,eACAC,EAQE,EARFA,aACAvd,EAOE,EAPFA,sBACA1P,EAME,EANFA,eACA+R,EAKE,EALFA,YACAxP,EAIE,EAJFA,gBACA4E,EAGE,EAHFA,OACApJ,EAEE,EAFFA,eACA1E,EACE,EADFA,SACE,EAEnBykB,mBAAuB,MAFJ,mBAElCz4B,EAFkC,KAE7B6nC,EAF6B,OAGapP,mBAAwBvb,GAAmB,MAHxD,mBAGlC4qB,EAHkC,KAGbC,EAHa,KAKzCnP,qBAAU,WACN,GAAI54B,EAAK,CACL,IAAMgoC,EAAsB9qB,GAAmB,KAC/C,GAAI8qB,IAAwBF,EAAqB,CAE7C,GADAf,GAAuBkB,QACnBD,EAAqB,CACrB,IAAME,EAmM1B,SAAyBloC,EAAYmoC,GAA+C,IAAD,gBAC7DnoC,EAAIuV,YAAY0uB,YAD6C,IAC/E,2BAA8C,CAAC,IAAtC5uB,EAAqC,QAC1C,GAAIA,aAAiBsE,KAAe,CAChC,IACMuS,EADc7W,EACQI,YAAY2yB,eAAeD,GACvD,GAAIjc,EACA,OAAOA,IAN4D,8BAU/E,OAAO,KA7MiCmc,CAAgBroC,EAAKgoC,GAC7C,GAAIE,EAAiB,CAGjB,IAAMI,EAAiBJ,EAAgBK,QACvCD,EAAeE,MAAM,UAAYN,EAAgBO,SACjDH,EAAejC,cAASr3B,GACxB+3B,GAAuB2B,WAAWJ,IAG1CP,EAAuBC,OAGhC,CAAChoC,EAAKkd,EAAiB4qB,IAE1BlP,qBAAU,WAEF54B,GACAA,EAAIuV,YAAY3X,SAAQ,SAAAyX,GAChBA,aAAiBC,KACjBD,EAAMI,YAAYkzB,UAElBtzB,EAAMszB,eAInB,CAAC3oC,EAAK0Y,IAET,IAmBMkwB,EAAgB,SAACr3B,GAEnB,GAAY,OAARvR,GAAgB4nC,GAAmC,WAAnBnpB,EAA6B,CAAC,IAAD,aAC7D,IAAMyN,EAAU3a,EAAM2a,QAClB/b,EAAW+b,EAAQE,cACvB,IAAKjc,EACD,MAAM,CAAN,UAGJ,IAAMR,EAAO,eAAW8O,EAAX,YAA6B3W,KACpC2L,EAAazT,EAAIyS,UAAU+yB,gBAEjC,GAAIr1B,aAAoB04B,KAAkB,CACtC,IAAMC,EAAUC,aAAoB54B,GACpC+b,EAAQ8c,YAAYF,GAIxB34B,EAAW+b,EAAQqc,QAAQnc,cAAe4Z,UAAUvyB,EAAY/C,IAChE,IAAMu4B,GAAkB,IAAI54B,KAAkBC,oBAAoBH,GAClE+b,EAAQsc,MAAM74B,GACd,IAAIu5B,EAAa,EACbzpB,GAAY0pB,YAEZD,EADiBpC,GAAkBsC,cACblqC,QAE1B,IAAM0L,EAAQmC,GAAsBm8B,GAEpChD,GAAgBha,EADIlf,GAAkBpC,EAAOksB,EAAMmB,QAAQoR,MACrBj+B,GAAOiR,SAAS/Q,SAASib,oBAI/D,IAFA,IAAM+iB,EAAWtqC,EAAKgC,IAAIyd,GACtBlc,EAAgB,GACXzE,EAAQ,EACbyE,EAAK,UAAM+mC,EAAN,YAAkBxrC,GAElB6c,EAAelL,SAAS3L,MAAK,SAAAylC,GAAC,OAAKA,EAAE36B,YAAc,IAAjB,QAAkCrM,KAHvDzE,KAQtB8pC,EAAaj4B,EAASpN,EAAOqI,EAAOq+B,GAAqC,GAtCZ,qCAwCjE,OAAO,GAUX,IAAIO,EAAkB,KAClB7B,IACA6B,EACI,eAAC,GAAD,CAASzlC,GAAG,SAASyQ,MAAOwyB,GAA5B,SACKW,KAMI,OAAbJ,IACAC,EAAgBD,GAiBpB,OACI,eAAC,GAAD,UACI,gBAAC,GAAD,CACIxjC,GAAIusB,EACJ9e,QAAS,SAACD,GAAD,OAvGE,SAACA,GACpB,GAAuB,WAAnBkN,EAA6B,CAC7B,IACIvB,EAAiC,KAC/BzN,EAFM8B,EAAMvR,IAEGypC,mBAAmBl4B,EAAMm4B,OAC9C,GAAIj6B,EAAU,CAAC,IAAD,gBACIA,GADJ,IACV,2BAAwB,CAAC,IAAhBk6B,EAAe,QACpB,GAA0B,oBAAfA,EAAC,MAA0B,CAClCzsB,EAAkBysB,EAAC,QAAc,GACjC,QAJE,+BAQVjd,GACAA,EAAYxP,EAAiB4E,GAAQ,IAyFjB8nB,CAAer4B,IACnCyC,SAxCZ,SAAsBhU,GACdgU,GACAA,EAAShU,GAEb6nC,EAAO7nC,IAqCC+Q,WAAY0O,GACZxM,SAAS,EACTvB,YAtBY,SAACE,GACjByY,GACAzY,EAAMhU,SAAQ,SAAAqU,GACV,IAAM43B,EAAS,IAAIC,WACnBD,EAAOE,UAAY,WACc,kBAAlBF,EAAO/f,QACdO,EAAsBwf,EAAO/f,SAGrC+f,EAAOG,WAAW/3B,EAAM,aAO5B,UAQI,eAAC,GAAD,CAAMlO,GAAG,OAAO0P,WAAYsL,IAC5B,gBAACxO,GAAD,WACK+2B,EACAE,EACAC,EACD,eAAC,GAAD,CACI1jC,GAAG,YACH+U,QAAS,EACTE,OAAQ,IACRrD,OAAQmxB,KAEZ,eAAC,GAAD,CACI/iC,GAAG,iBACH+U,QAAS,GACTE,OAAQ,IACRxE,MAAO4yB,GACPzxB,OAAQoxB,QAGfW,EAED,eAAC,GAAD,CACI3jC,GAAG,YACH+f,QAAS,YACT4gB,OAA2B,UAAnBjmB,EACRrO,KAAM65B,KAAeC,MACrBC,OAAO,EACPC,WAAW,EACXjF,UAAWyD,IAEf,eAAC,GAAD,CACI7kC,GAAG,cACH+f,QAAS,YACT4gB,OAA2B,YAAnBjmB,EACRrO,KAAM65B,KAAeI,QACrBF,OAAO,EACPC,WAAW,EACXjF,UAAWyD,IAEf,eAAC,GAAD,CACI7kC,GAAG,aACH+f,QAAS,YACT4gB,OAA2B,WAAnBjmB,EACRrO,KAAM65B,KAAeK,OACrBH,OAAO,EACPC,WAAW,EACXjF,UAAWyD,IAEdY,EACD,eAAC,GAAD,CAAWe,KAAK,Y,eCtSnBC,GAAkB,SAClBC,GAAoB,KAyB1B,SAASC,GAAehpC,GAC3B,IAAI7C,EAAO6C,EAASipC,SAOpB,OANIjpC,EAASkpC,aACT/rC,GAAQ4rC,IAER/oC,EAASmpC,UACThsC,GAAQ2rC,IAEL3rC,EC7CJ,SAASisC,GAAmBrsC,GAC/B,IAAMwiC,EAAMxiC,EAAO,GACbyiC,EAAMziC,EAAOA,EAAOS,OAAS,GAC7B6rC,EAAiBhjC,KAAKk5B,IAAI,GAAIl5B,KAAKm5B,IAAI,EAAGn5B,KAAKijC,OAAOjjC,KAAKkjC,MAAM/J,EAAMD,MAI7E,OAAOxiC,EAAOuB,KAHd,SAAsB5B,GAClB,OASR,SAAqBA,EAAe2sC,GAChC,IAAMG,EAAenjC,KAAKijC,MAAM5sC,GAChC,OAAI2J,KAAKoS,IAAI+wB,EAAe9sC,GAAS,KAC1B8sC,EAAe,GAEf9sC,EAAM+sC,QAAQJ,GAddK,CAAYhtC,EAAO2sC,MAK3B,SAASM,GAAmBC,EAAkBC,GAAgD,IAA9BC,EAA6B,uDAAb,EACnF,OAAOV,GAAmBW,GAAOH,EAAUC,EAAUC,IAYlD,SAASC,GAAOH,EAAkBC,EAAkBC,GAGvD,IAFA,IAAME,GAASH,EAAWD,IAAaE,EAAQ,GACzCG,EAAQ,IAAIloC,MAAc+nC,GACvBv9B,EAAI,EAAGA,EAAIu9B,EAAOv9B,IACvB09B,EAAM19B,GAAKq9B,EAAWr9B,EAAIy9B,EAE9B,OAAOC,ECrDI,ICgCTC,GAAU,IAAIC,MACpBD,GAAQroB,IDjCO,6NC6CR,IAAMuoB,GAAgD,SAAC,GASxD,IAPMpqC,EAOP,EAPOA,SACAqqC,EAMP,EANOA,UACAjzB,EAKP,EALOA,QACA7H,EAIP,EAJOA,MACAC,EAGP,EAHOA,OACA86B,EAEP,EAFOA,aAGFC,EAAYvK,iBAAiC,MAcnD,OAZA9I,qBAAU,WACN,IAAMsT,EAASD,EAAUlK,QACzB,GAAe,OAAXmK,EAAJ,CAGA,IAAMvqC,EAAQ,IAAIkqC,MAClBlqC,EAAMwqC,OAAS,YAqBvB,SAAwBzqC,EACAoX,EACAozB,EACAvqC,GACpB,IAAMyqC,EAAkBjgC,SAASI,cAAc,UAC/C6/B,EAAgBn7B,MAAQtP,EAAMsP,MAC9Bm7B,EAAgBl7B,OAASvP,EAAMuP,OAC/B,IAAMm7B,EAAMD,EAAgBE,WAAW,MACvC,GAAY,OAARD,EACA,OAEJA,EAAIE,UAAU5qC,EAAO,EAAG,GACxB,IAMI6qC,EANcH,EAAII,aACd,EAAG,EACHL,EAAgBn7B,MAChBm7B,EAAgBl7B,QAGE+c,KAG1B,GAFAue,EAAYA,EAAUrmC,MAAM,EAAGqmC,EAAUttC,OAAS,GAE9CwC,EAASkpC,WAAY,CAErB,IADA,IAAM8B,EAAoB,IAAIC,kBAAkBH,EAAUttC,QACjD+O,EAAI,EAAGA,EAAIu+B,EAAUttC,OAAQ+O,GAAK,EAAG,CAC1C,IAAM2+B,EAAIJ,EAAUttC,OAAS+O,EAAI,EACjCy+B,EAAkBE,GAAKJ,EAAUv+B,GACjCy+B,EAAkBE,EAAI,GAAKJ,EAAUv+B,EAAI,GACzCy+B,EAAkBE,EAAI,GAAKJ,EAAUv+B,EAAI,GACzCy+B,EAAkBE,EAAI,GAAKJ,EAAUv+B,EAAI,GAE7Cu+B,EAAYE,EAGhB,GAAIhrC,EAASmpC,QAET,IADA,IAAMgC,EAAS,IAAUL,EAAUttC,OAC1B+O,EAAI,EAAGA,EAAIu+B,EAAUttC,OAAS,EAAG+O,GAAK,EAC3Cu+B,EAAUv+B,EAAI,GAAK4+B,EAAS5+B,EAIpC,GAAI6K,EAAU,EACV,IAAK,IAAI7K,EAAI,EAAGA,EAAIu+B,EAAUttC,OAAQ+O,GAAK,EACvCu+B,EAAUv+B,EAAI,IAAM6K,EAI5BwQ,QAAQC,QACAujB,kBACQ,IAAIC,UAAUP,EACNA,EAAUttC,OAAS,EACnB,KAEtBuB,MAAK,SAAAusC,GACH,IAAMX,EAAMH,EAAOI,WAAW,MAC9B,GAAY,OAARD,EAAc,CACd,IAAMY,EAAUZ,EAAIa,cAActB,GAAS,UAEvCS,EAAIc,UADQ,OAAZF,EACgBA,EAEA,UAEpBZ,EAAIe,SACI,EAAG,EACHlB,EAAOj7B,MAAOi7B,EAAOh7B,QAE7Bm7B,EAAIE,UACIS,EACA,EAAG,EACHd,EAAOj7B,MAAOi7B,EAAOh7B,YAxF7Bm8B,CAAe3rC,EAAUoX,EAASozB,EAAQvqC,IAE9CA,EAAM4hB,IAAN,gCAAqCwoB,MACtC,CAACrqC,EAAUqqC,EAAWjzB,IAElB,qCACF4c,QAAQqW,GACD,yBACQx3B,IAAK03B,EACLh7B,MAAOA,GAAS,IAChBC,OAAQA,GAAU,GAClBM,QAASw6B,IAGjB,+BAAMhtC,EAAKgC,IAAI,qBAAT,YAAqCU,EAASipC,eCvCpE,IAIM7S,GAAYC,cAAW,SAAAjB,GAAK,MAAK,CAC/Bv1B,MAAO,CACHo/B,SAAU,UACV2M,WAAY,OACZr8B,MAAO,OACPkpB,QAAS,OACT4B,SAAU,SACVvJ,eAAgB,SAChB+a,cAAezW,EAAMrE,QAAQ,KAEjClwB,MAAO,CACHo+B,SAAU,UACV2M,WAAY,OACZr8B,MAAO,OACPkpB,QAAS,OACT4B,SAAU,SACVvJ,eAAgB,iBAEpBvjB,UAAW,CACPgtB,YAAanF,EAAMrE,QAAQ,KAC3BiH,aAAc5C,EAAMrE,QAAQ,KAC5B8a,cAAezW,EAAMrE,QAAQ,IAC7BuJ,WAAYlF,EAAMrE,QAAQ,IAC1B7nB,MAAO,SAEX4iC,UAAW,CACPnW,UAAWP,EAAMrE,QAAQ,GACzB6E,WAAYR,EAAMrE,QA/BJ,GAgCd2F,YAAatB,EAAMrE,QAhCL,GAiCdgK,SAAU,IACVxrB,MAAM,eAAD,OAAiB6lB,EAAMrE,QAAQ,IAA/B,QAETgb,YAAa,CACTpW,UAAWP,EAAMrE,QAAQib,IACzBpW,WAAYR,EAAMrE,QArCD,GAsCjB2F,YAAatB,EAAMrE,QAtCF,GAuCjB+J,aAAc1F,EAAMrE,QAvCH,IAyCrBkb,mBAAoB,CAChBtW,UAAWP,EAAMrE,QAAQ,IACzB7nB,MAAOksB,EAAMmB,QAAQnuB,KAAK,MAE9B8jC,qBAAsB,CAClBvW,UAAWP,EAAMrE,QA7CK,KA+C1Bob,qBAAsB,CAClBxW,UAAWP,EAAMrE,QAAQ,GACzB+J,aAAc1F,EAAMrE,QAAQ,IAEhCqb,UAAW,CACP3T,QAAS,OACT3H,eAAgB,UAEpBub,aAAc,CACVC,SAAU,MACVtU,aAAc,GAElBuU,aAAc,CACVD,SAAU,MACV/R,YAAa,OAmYzB,SAASiS,GAAT,GAA2D,IAA1C5C,EAAyC,EAAzCA,SAAUC,EAA+B,EAA/BA,SAAUC,EAAqB,EAArBA,MACjC,OACI,eAAC,WAAD,UACKH,GAAmBC,EAAUC,EAAUC,GAAOxrC,KAAI,SAACuC,EAAO0L,GAAR,OAAc,gCAAe1L,GAAJ0L,QAKxF,SAASkgC,GAAaC,GAClB,MAAO,CAACA,EAAY,GAAK,GAAIA,EAAY,GAAK,IC7clD,IAWM3W,GAAqB,CACvB4W,uB9CidG,SAAgCnoB,EACAnF,EACAjI,GACnC,OAAO,SAAC+P,EAA4CC,GAChD,IAAMjlB,EAAoBilB,IAAWnJ,aAAa9b,kBAC5CmZ,EAAuB8L,IAAWnJ,aAAa3C,qBACjDnZ,GAAqBmZ,GACrB6L,EAQL,SAAiCjmB,EACAqB,EACAiiB,EACAnF,EACAjI,GACpC,MAAO,CACH1I,KAAMif,GACNzsB,YACAqB,eACAiiB,iBACAnF,eACAjI,WAnBaw1B,CACLzqC,EAAmBmZ,EACnBkJ,EAAgBnF,EAAcjI,O8Cvd/B8e,gBAfS,SAACtd,GACrB,MAAO,CACHrW,aAAc2b,GAA6BtF,GAC3C4T,cAAezN,GAA8BnG,GAC7Ci0B,uBAAwB5tB,GAAuCrG,GAC/Dk0B,qBAAsB1tB,GAAqCxG,GAC3Dm0B,gBAAiBztB,GAAgC1G,GACjD4U,UAAW5U,EAAMC,UAAU2U,aAQKuI,GAAzBG,EDqEA,YAUiD,IATrB3zB,EASoB,EATpBA,aACAiqB,EAQoB,EARpBA,cACAqgB,EAOoB,EAPpBA,uBACAC,EAMoB,EANpBA,qBACAC,EAKoB,EALpBA,gBACAJ,EAIoB,EAJpBA,uBACAnf,EAGoB,EAHpBA,UACAje,EAEoB,EAFpBA,MAAOC,EAEa,EAFbA,OACPw9B,EACoB,EADpBA,SAEjCjb,EAAUqE,KAD2C,EAEChnB,WAAsC,MAFvC,mBAEpD69B,EAFoD,KAE5BC,EAF4B,OAGH99B,WAAyC,MAHtC,mBAGpD+9B,EAHoD,KAG9BC,EAH8B,OAIDh+B,WAAiCy9B,GAJhC,mBAIpDQ,EAJoD,KAI7BC,EAJ6B,OAKCl+B,WAAiCy9B,GALlC,mBAKpDU,EALoD,KAK5BC,EAL4B,OAMDp+B,WACtDq9B,GAAaI,IAP0C,mBAMpDY,EANoD,KAM7BC,EAN6B,OASSt+B,WAChE,EAAC,GAAO,IAV+C,mBASpDu+B,EAToD,KASxBC,EATwB,KAa3Dx+B,aAAgB,WACZs+B,EAAyBjB,GAAaI,MACvC,CAACA,IAEJ,IAAMgB,EAA2B7Z,QAAQiZ,GACnCa,EAAyB9Z,QAAQmZ,GAEvC,IAAK5qC,IAAiBirB,EAClB,OAAO,KAGX,IAyGI2e,EAmFA4B,EA5LEC,EJ9GH,SAAuB7wC,GAC1B,IAAI8rC,EAAW9rC,EAETgsC,EAAUF,EAAStqC,SAASmqC,IAC9BK,IACAF,EAAWA,EAASxkC,MAAM,EAAGwkC,EAASzrC,OAASsrC,GAAgBtrC,SAGnE,IAAM0rC,EAAaD,EAAStqC,SAASoqC,IAKrC,OAJIG,IACAD,EAAWA,EAASxkC,MAAM,EAAGwkC,EAASzrC,OAASurC,GAAkBvrC,SAG9D,CAACyrC,WAAUE,UAASD,cIiGF+E,CAAcnB,GAEjCzC,EAAY7c,EAAU7tB,OAAOquC,EAAiB/E,UAqG9CppC,EAAK,UAAM0C,EAAN,aAAuBiqB,GAAiB,IAAxC,KAGX,GAAIqhB,EAA0B,CAQ1B,IAR2B,IAiBvBK,EAjBsB,cAEKX,EAFL,GAEnBY,EAFmB,KAERC,EAFQ,KAGpBC,EAAOF,EAAYC,EAAaA,EAAYD,EAAW,EACvDG,EAAUjoC,KAAKmS,MAAMnS,KAAKkjC,MAAM8E,IAChCE,GAAWF,EAAOhoC,KAAKkd,IAAI,IAAK+qB,GAElCE,GAAgB,KACpB,QAAkB,CAAC,IAAM,GAAK,IAAM,KAAO,IAA3C,kBAAiD,CAA5C,IACGC,GAAgBF,GADV,OAENG,GAAcroC,KAAKmS,MAAMi2B,IAC7B,GAAIpoC,KAAKoS,IAAIi2B,GAAcD,IAAiB,MAAO,CAC/CD,GAAgBE,GAChB,OAKc,OAAlBF,IAA0BA,IAAiB,EAC3CN,EAAgB7nC,KAAKm5B,IAAI,EAAGn5B,KAAKijC,MAAMkF,GAAgB,KAEvDN,EAAgB,EAChBM,GAAgB,GAGpB,IAAMxE,GAAQmE,EAAYC,EAAYC,EAAOG,GAAc,GAErDG,GAASR,EAAYD,EAAgBlE,GACrC4E,GAASR,EAAYF,EAAgBlE,GACrC6E,IAAQD,GAASD,KAHNH,GAAgB,EAAIN,GAK/BnxC,GAAS,CACX4xC,GACAR,EACAC,EACAQ,IAGEvP,GAAgB+J,GAAmBrsC,IAAQuB,KAAI,SAACuC,EAAO0L,GACzD,MAAO,CAAC7P,MAAOK,GAAOwP,GAAI1L,YAG9BsrC,EACI,uBAAKpZ,UAAWhB,EAAQoa,qBAAxB,UACI,uBAAMr5B,MAAO,CAACynB,YAAa,IAA3B,SAAiC16B,IACjC,eAACg7B,GAAA,EAAD,CAAK9H,UAAWhB,EAAQ+Z,UAAxB,SACI,eAACxM,GAAA,EAAD,CACIC,IAAKoP,GACLnP,IAAKoP,GACLlyC,MAAO2wC,EACPhO,MAAOA,GACPwP,KAAMA,GACNtT,SAhJe,SAAC1rB,EAAcnT,GAC1CqF,MAAMC,QAAQtF,IACd4wC,EAAyB,CAAC5wC,EAAM,GAAIA,EAAM,MA+I9BijC,kBA3IwB,SAAC9vB,EAA+BnT,GACpEqF,MAAMC,QAAQtF,IACdiwC,EAAuB,CAACjwC,EAAM,GAAIA,EAAM,IAAKowC,EAAsBC,IA0IvDtN,kBAAkB,OAClBruB,KAAK,YAGb,gBAACypB,GAAA,EAAD,CAAKlB,UAAU,OAAO5G,UAAWhB,EAAQqa,UAAzC,UACI,eAACtN,GAAA,EAAD,CACI/L,UAAWhB,EAAQsa,aACnBxrC,MAAM,UACN42B,QAAQ,SACRrmB,KAAK,QACL1U,MAAO+wC,EAAsB,GAC7B5wC,MAAO8wC,EAA2B,GAClCpS,SAAU,SAAAuT,GAAG,OAzGM,SAACj/B,GACpC,IAAMk/B,EAAel/B,EAAMsB,OAAOzU,MAClCgxC,EAAyB,CAACqB,EAActB,EAAsB,KAC9D,IAAM7D,EAAWhlC,OAAOE,WAAWiqC,GAC/BlyC,GAAQ,EACZ,IAAK+H,OAAOG,MAAM6kC,IAAaA,EAAWyD,EAAsB,IAC5D,GAAIzD,IAAayD,EAAsB,GAAI,CACvC,IAAM2B,EAA8B,CAACpF,EAAUyD,EAAsB,IACrEC,EAAyB0B,GACzBxB,EAA0BwB,GAC1BrC,EAAuBqC,EAAWlC,EAAsBC,SAG5DlwC,GAAQ,EAEZ+wC,EAA8B,CAAC/wC,EAAO8wC,EAA2B,KA0FhCsB,CAA+BH,MAEpD,eAAChQ,GAAA,EAAD,CACI/L,UAAWhB,EAAQwa,aACnB1rC,MAAM,UACN42B,QAAQ,SACRrmB,KAAK,QACL1U,MAAO+wC,EAAsB,GAC7B5wC,MAAO8wC,EAA2B,GAClCpS,SAAU,SAAAuT,GAAG,OAhGM,SAACj/B,GACpC,IAAMk/B,EAAel/B,EAAMsB,OAAOzU,MAClCgxC,EAAyB,CAACD,EAAsB,GAAIsB,IACpD,IAAMlF,EAAWjlC,OAAOE,WAAWiqC,GAC/BlyC,GAAQ,EACZ,IAAK+H,OAAOG,MAAM8kC,IAAaA,EAAWwD,EAAsB,IAC5D,GAAIxD,IAAawD,EAAsB,GAAI,CACvC,IAAM2B,EAA8B,CAAC3B,EAAsB,GAAIxD,GAC/DyD,EAAyB0B,GACzBxB,EAA0BwB,GAC1BrC,EAAuBqC,EAAWlC,EAAsBC,SAG5DlwC,GAAQ,EAEZ+wC,EAA8B,CAACD,EAA2B,GAAI9wC,IAiF7BqyC,CAA+BJ,YAQpE,GAAIhB,EAAwB,CACxB,IADwB,GACpB7wC,GAAM,EACJkyC,GAAU,GAFQ,eAGR3hB,EAAU9tB,QAHF,IAGxB,8BAAkC,CAAC,IAA1B0vC,GAAyB,SAC9B,GAAKA,GAAIrvC,OAA8B,IAArBqvC,GAAIrvC,MAAMvC,OAA5B,CAGA2xC,GAAQjvC,KACJ,eAAC25B,GAAA,EAAD,CAASC,OAAK,EAAaj6B,MAAOuvC,GAAItvC,YAAauvC,UAAU,OAA7D,SACI,eAACxU,GAAA,EAAD,CAAK9H,UAAWhB,EAAQka,mBAAxB,SACKmD,GAAIvvC,SAFO5C,OALM,sBAWbmyC,GAAIrvC,OAXS,0BAWrB5C,EAXqB,SAY1BgyC,GAAQjvC,KACJ,eAAC26B,GAAA,EAAD,CAEI9H,UAAWhB,EAAQma,qBACnBoD,OAAQ,EACRC,YAAapyC,IAAS6wC,EAAiB/E,SAAW,SAAS,QAC3D15B,MAAO,IACPC,OAAQ,GANZ,SAQI,eAACqqB,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAO1C,EAAMkyC,UAAU,OAAtC,SACI,sBACIxtB,IAAG,gCAA2B2L,EAAU7tB,OAAOxC,IAC/C8zB,IAAK,YACL1hB,MAAO,OACPC,OAAQ,OACRM,QAAS,WAzLJ,IAACm5B,IA0LuB9rC,EAzLrD2vC,EAAuB9D,GAAe,2BAAIgF,GAAL,IAAuB/E,cAC5D0D,EAAuBE,EAAwBC,EAAsBC,SA0KhD9vC,QAHjB,8BAA6B,KAXC,qCAHV,kCAuCxB8wC,EACI,gBAAClT,GAAA,EAAD,CAAK9H,UAAWhB,EAAQga,YAAxB,UACI,gBAAClR,GAAA,EAAD,CAAKlB,UAAU,OAAf,UACI,eAACsD,GAAA,EAAD,CAAU/zB,MAAM,UACNszB,QAASwR,EAAiB7E,QAC1B5N,SAlME,SAAC1rB,GACzB,IAAMs5B,EAAUt5B,EAAM2jB,cAAcgJ,QACpCsQ,EAAuB9D,GAAe,2BAAIgF,GAAL,IAAuB7E,aAC5DwD,EACIE,EACAC,EACAC,IA6LkB37B,KAAK,QACL0B,MAAO,CACHynB,YAAa,EACbvC,aAAc,EACdsC,WAAY,EACZuR,cAAe,KAG7B,eAAChR,GAAA,EAAD,CAAKlB,UAAU,OAAf,SAAuBr8B,EAAKgC,IAAI,uBAChC,eAAC29B,GAAA,EAAD,CAAU/zB,MAAM,UACNszB,QAASwR,EAAiB9E,WAC1B3N,SApMK,SAAC1rB,GAC5B,IAAMq5B,EAAar5B,EAAM2jB,cAAcgJ,QACvCsQ,EAAuB9D,GAAe,2BAAIgF,GAAL,IAAuB9E,gBAC5DyD,EACIE,EACAC,EACAC,IA+LkB37B,KAAK,QACL0B,MAAO,CACHynB,YAAa,GACbvC,aAAc,EACdsC,WAAY,EACZuR,cAAe,KAG7B,eAAChR,GAAA,EAAD,CAAKlB,UAAU,OAAf,SAAuBr8B,EAAKgC,IAAI,gBAEpC,gBAACu7B,GAAA,EAAD,CAAKlB,UAAU,MAAM7mB,MAAO,CAAC2lB,QAAS,OAAQC,WAAY,UAA1D,UACI,gCAAOp7B,EAAKgC,IAAI,aAChB,eAACggC,GAAA,EAAD,CACIC,IAAK,EACLC,IAAK,EACL9iC,MAAOqwC,EACP8B,KAAM,IACN/7B,MAAO,CAAC8lB,SAAU,EAAGhD,WAAY,GAAIc,YAAa,IAClD6E,SA7MU,SAAC1rB,EAAcnT,GACzCiwC,EACIE,EACAC,EACApwC,IA0MY0U,KAAK,aAGZ+9B,MAKb,OACI,uBAAKpc,UAAW,cAAgBhB,EAAQxkB,UAAxC,UACI,sBAAKwlB,UAAWhB,EAAQlyB,MAAxB,SACI,gCAAOA,MAEX,eAAC,GAAD,CACIG,SAAUguC,EACV3D,UAAWA,EACXjzB,QAAS21B,EACTx9B,MAAOA,EACPC,OAAQA,EACR86B,aAlQyB,SAACz6B,GAClCu9B,EAAwBv9B,EAAM2jB,kBAmQ1B,sBACIT,UAAWhB,EAAQlxB,MACnBiP,QA5R2B,SAACD,GACpCq9B,EAA0Br9B,EAAM2jB,eAChC8Z,EAAyBT,GACzBW,EAA0BX,IAuRtB,SAII,eAACL,GAAD,CAAQ5C,SAAUiD,EAAuB,GAAIhD,SAAUgD,EAAuB,GACtE/C,MAAOkD,GAAY,MAE/B,eAACwC,GAAA,EAAD,CACI3b,SAAUoZ,EACVlZ,KAAM8Z,EACN5Z,QA9R4B,WACpCiZ,EAA0B,OA8RlBlT,aAAc,CACVC,SAAU,SACVC,WAAY,QAEhBC,gBAAiB,CACbF,SAAU,MACVC,WAAY,UAVpB,SAaKiS,IAEL,eAACqD,GAAA,EAAD,CACI3b,SAAUsZ,EACVpZ,KAAM+Z,EACN7Z,QAzR0B,WAClCmZ,EAAwB,OAyRhBpT,aAAc,CACVC,SAAU,SACVC,WAAY,QAEhBC,gBAAiB,CACbF,SAAU,MACVC,WAAY,QAVpB,SAaK6T,UEtZXhY,GAAqB,CACvBmQ,a/CiIG,SAAsB7jC,EACAxB,EACAqI,EACAuF,EACAuc,GACzB,OAAO,SAAC7D,EAAkCC,GACtCD,EAOD,SAAuB9kB,EACAxB,EACAqI,EACAuF,EACAuc,GAC1B,MAAO,CAACtc,KAAM+Z,GAAgBpmB,KAAIxB,QAAOqI,QAAOuF,WAAUuc,eAZ7CykB,CAAcptC,EAAIxB,EAAOqI,EAAOuF,EAAUuc,IAC/C5D,IAAWnJ,aAAahC,oBACxBkL,EAAS+D,Q+CxIjBvC,yBACAqC,gBAGWkL,gBA1BS,SAACtd,EAAiB82B,GACtC,MAAO,CACH5zC,OAAQ8c,EAAMqF,aAAaniB,OAC3BgqC,cAAevhB,GAAqC3L,GACpDitB,SAAUphB,GAAgC7L,GAC1CmtB,qBAAsBtiB,GAAqC7K,GAC3DotB,iBAAkBlhB,GAAwClM,GAC1DqtB,eAAgB,eAAC,GAAD,IAChBhtB,eAAgBD,GAAuBJ,GACvCgW,MAAO,MACP7R,eAAgBnE,EAAMqF,aAAalB,eACnCM,cAAeoB,GAAsB7F,GACrC4C,gBAAiB5C,EAAMqF,aAAazC,gBACpC4E,OAAQH,GAAiCrH,GACzCgtB,aAAcjgB,GAAqB/M,GACnC5B,eAAgBuH,GAAuB3F,GACvCtG,SAAUo9B,EAASp9B,YAUayjB,GAAzBG,CAA6CyZ,I,mICZtDC,GAAS,SAACxa,GAAD,OAAkBC,aAC7B,CACIwa,eAAgB,CACZC,WAAY,OACZna,UAAWP,EAAMrE,QAAQ,GACzBxhB,MAAO,MACPC,OAAQ,OACRipB,QAAS,OACTsX,cAAe,SACfrX,WAAY,gBAEhBsX,oBAAqB,CACjBpX,SAAU,GAEdqX,aAAc,CACV34B,OAAQ,IACRF,QAAS,IAEb84B,iBAAkB,CACd5a,gBAAiB,QACjBle,QAAS,GACTlO,MAAO,QACPomC,OAAQ,kBACRa,aAAc/a,EAAMrE,QAAQ,GAC5B8E,QAAST,EAAMrE,QAAQ,MAE3Bqf,aAAc,CACVxE,WAAY,QAEhByE,aAAc,CACVzE,WAAY,OACZC,cAAezW,EAAMrE,QAAQ,IAEjCuf,WAAY,MA6BdC,GAA0C,CAAC,UAAW,WACtDC,GAA0C,CAAC,OAAQ,QAmU1Crb,gBAAWya,GAAQ,CAACjK,WAAW,GAA/BxQ,EA3TyC,SAAC,GAiBO,IlDzEhCsb,EAAsBC,EkDyDO3e,EAgBE,EAhBFA,QACAtR,EAeE,EAfFA,gBACAkwB,EAcE,EAdFA,iBACAh1B,EAaE,EAbFA,aACA0T,EAYE,EAZFA,WACAzT,EAWE,EAXFA,kBACA4T,EAUE,EAVFA,gBACApP,EASE,EATFA,OACA4K,EAQE,EARFA,YACApK,EAOE,EAPFA,WACAgwB,EAME,EANFA,cACAxb,EAKE,EALFA,MACAyb,EAIE,EAJFA,cACAC,EAGE,EAHFA,eACAC,EAEE,EAFFA,sBACAC,EACE,EADFA,UACE,EAIvDja,mBAA6B,IAJ0B,mBAEvDka,EAFuD,KAGvDC,EAHuD,KAMrDC,EAA0B,WAC5BD,EAAsB,KAGpB3lC,EAAc6pB,EAAMmB,QAAQoR,KAC5ByJ,EAAchc,EAAMmB,QAAQhF,QAAQG,MACpC2f,EAAajc,EAAMmB,QAAQhF,QAAQ+f,KACnCC,EAAiBnc,EAAMmB,QAAQhF,QAAQigB,aAEzCC,GAAa,EAAOC,EAAuB,KAAMC,EAAuB,KAC5E,GAAI/1B,EAAmB,CACnB61B,KlD1FwBhB,EkD0FM70B,MlD1FgB80B,EkD0FGE,GAAiB,OlDvFpD,OAAPH,GAAqB,MAANC,GACfD,EAAG,KAAOC,EAAG,IAAMD,EAAG,KAAOC,EAAG,IkDqFpB,kBAEF90B,EAFE,GAElB81B,EAFkB,KAEXC,EAFW,KAKvB,IAwDMC,EAAS,WAAO,IACXC,EAAyBZ,EAAzBY,UAAWC,EAAcb,EAAda,WAElB,GADAv1C,QAAQmL,IAAI,UAAWmqC,EAAWC,GAC9BD,IAAcC,QACGxkC,IAAdukC,QACevkC,IAAfwkC,EAFP,CAHiB,IASZC,EAAqBF,EAAZG,EAAuBF,EACrC,GAAIC,EAAUC,EAAS,CAAC,IAAD,EACE,CAACA,EAASD,GAA9BA,EADkB,KACTC,EADS,KAGvBb,IACI3hB,GACAA,EAAgB,CAACuiB,EAASC,SAT1Bb,KAaFc,EAAU,WACZd,IACI3hB,GACAA,EAAgBohB,GAAiB,OAIrCsB,EAAmD,KAEjDC,EAAQ1xB,EAAgBC,gBAAgBpiB,KAAI,SAACuiB,EAAItU,GACnD,IAAM0H,EAAS4M,EAAG5M,OACZkY,EAAelY,EAAOkY,aACxBimB,EAAWn+B,EAAO1R,aAClB8vC,EAAY,SAChB,GAAIzxB,EAAY,CACZ,IAAM0xB,EAAY1xB,EAAW3M,EAAOhG,SACpC,GAAIqkC,EAAW,CAAC,IACLlmC,EAAuBkmC,EAAvBlmC,MAAOvL,EAAgByxC,EAAhBzxC,MAAOqI,EAASopC,EAATppC,MACrB,GAA4B,UAAxBkD,EAAMqC,SAASC,KAAkB,CACjC,IAAM6jC,EAAMnmC,EAAMqC,SAAS9N,YAAY,GACjC6xC,EAAMpmC,EAAMqC,SAAS9N,YAAY,GACvCyxC,GAAQ,YAASvxC,EAAT,aAAmB2xC,EAAI/I,QAAQ,GAA/B,YAAqC8I,EAAI9I,QAAQ,GAAjD,UAER2I,GAAQ,YAASvxC,EAAT,KAEZwxC,EAAYnpC,GAIpB,IAAMqjB,EAA0B,GAChC1L,EAAG0L,KAAKrwB,SAAQ,SAAAu2C,GACZ,GAA4B,OAAxBA,EAAMtmB,GAAwB,CAC9B,IAAIumB,GAAU,EACVC,GAAU,EACA,OAAVjB,IACAgB,EAAUD,EAAMhxB,MAAQiwB,GAEd,OAAVC,IACAgB,EAAUF,EAAMhxB,MAAQkwB,GAExBe,GAAWC,GACXpmB,EAAKrsB,KAAKuyC,OAIK,OAAvBP,IACAA,EAAqB/lB,GAEzB,IACIymB,EADEC,EAAkBvnC,GAAkB+mC,EAAW9mC,GAYrD,OAVI4gB,GAAgB0kB,GAAiB58B,EAAOmY,eACxCwmB,EACI,eAACE,GAAA,EAAD,CACIC,QAAS9+B,EAAOmY,aAChB7c,MAAO,EACPu1B,YAAa,EACb1gB,OAAQyuB,KAKhB,eAACG,GAAA,EAAD,CAEItkC,KAAK,WACLvR,KAAMi1C,EACNa,KAAMh/B,EAAOuY,cACbD,KAAMA,EACNwmB,QAAS5mB,EACT+mB,IAAK,eAAC,GAAD,CAAehuB,OAAQ,EAAGd,OAAQyuB,EAAiB5tB,KAAM,QAAS6f,YAAa,IACpFqO,UAAW,eAAC,GAAD,CAAejuB,OAAQ,EAAGd,OAAQ,QAASa,KAAM4tB,EAAiB/N,YAAa,IAC1F1gB,OAAQyuB,EACRO,cAAetC,EAAiB,EAAIjwB,EAAGgM,aAIvCwmB,mBAAmB,EACnBvjC,QAAS,kBAzIUwjC,EAyIkB7yB,EAAgBpe,GAzIPkxC,EAyIWhnC,EAzIcmgB,EAyIX7L,EAxI9D8vB,GACFA,EAAiB2C,EAAmBC,EAAiB7mB,QAEzD1B,EAAY0B,EAAWzY,OAAOhG,QAASmS,GAAQ,GAJrB,IAACkzB,EAA2BC,EAAyB7mB,GA0H3E,SAiBKkmB,GAhBIrmC,MAqBbinC,EAAgB,KACC,OAAjB73B,IACA63B,EACI,eAACC,GAAA,EAAD,CACIC,SAAS,EACT/5B,EAAGgC,EACHyI,OAAQitB,EACRvM,YAAa,EACbsO,cAAe,MA3LgC,IA+LpDvB,EAAyBZ,EAAzBY,UAAWC,EAAcb,EAAda,WACd6B,EAAgB,UACFrmC,IAAdukC,QAA0CvkC,IAAfwkC,IAC3B6B,EACI,eAACC,GAAA,EAAD,CACIjwB,GAAIkuB,EACJhuB,GAAIiuB,EACJsB,cAAe,GACfnuB,KAAMmsB,EACN3M,YAAa,MAIzB,IAAMoP,EAAgB,GAEtB,GAAIpC,EAAY,CACZ,IAAMqC,EACF,eAACvgB,GAAA,EAAD,CAEIR,UAAWhB,EAAQke,aACnB1Y,aAAW,WACXznB,QAjJqB,WAC7BmiC,KAiJQ7gC,KAAK,QALT,SAMI,eAAC,KAAD,KALK,iBAQbyiC,EAAc3zC,KAAK4zC,GAEvB,IAGIC,EAHEC,EAAWhD,EAAUiD,QAAO,SAACC,EAAWC,GAAZ,OAA0BD,EAAIC,IAAG,GAAKnD,EAAUxzC,OAK9Eu2C,EAJaC,EAAW,GAAKA,EAAW,IAKpC,eAAC/e,GAAA,EAAD,CAEI7jB,KAAM,GACN2hB,UAAWhB,EAAQke,aACnB/mC,MAAO,aAHF,0BAQT,eAACqqB,GAAA,EAAD,CAEIR,UAAWhB,EAAQke,aACnB1Y,aAAW,QACXznB,QAvK6B,WACjCihC,GACAA,EAAsBtwB,EAAgBpe,KAsKlC+O,KAAK,QALT,SAMI,eAAC,KAAD,KALK,yBAUjByiC,EAAc3zC,KAAK6zC,GAEnB,IAAMK,EAAiB92C,EAAKgC,IAAI,eAC1B+0C,EAAY5zB,EAAgB+L,eAAiBlvB,EAAKgC,IAAI,iBACtDgxC,EAAU,UAAM8D,EAAN,aAAyBC,EAAzB,KAGhB,OACI,uBAAKthB,UAAWhB,EAAQ8d,eAAxB,UACI,gBAAChV,GAAA,EAAD,CAAKpC,QAAQ,OAAOsX,cAAc,MAAMrX,WAAW,SAAS5H,eAAe,gBAA3E,UACI,eAAC0G,GAAA,EAAD,CAAYzE,UAAWhB,EAAQue,WAA/B,SAA4CA,IAC5C,eAACzV,GAAA,EAAD,CAAKpC,QAAQ,OAAOsX,cAAc,MAAM1V,SAAS,SAAS3B,WAAW,SAArE,SACKmb,OAGT,eAACS,GAAA,EAAD,CAAqB/kC,MAAM,MAAMwjB,UAAWhB,EAAQie,oBAApD,SACI,gBAACuE,GAAA,EAAD,CACIC,YA5NQ,SAAC3kC,GACrB,IAAMgiC,EAAYhiC,GAASA,EAAM4kC,YACjCvD,EAAsB,CAACW,eA2NX6C,YAxNQ,SAAC7kC,GAErB,QAAkBvC,IADA2jC,EAAmBY,UACR,CACzB,IAAMC,EAAajiC,GAASA,EAAM4kC,YAClCvD,EAAsB,2BAAID,GAAL,IAAyBa,kBAqNtC6C,UAjNM,SAAC9kC,GACnB+hC,KAiNYgD,aA9MS,WACrBzD,KA8MY0D,aA3MS,WACrB1D,KA2MYrhC,QA/OI,SAACD,GACbA,GAASwf,GAAoC,OAAtBxf,EAAM4kC,aAAwB7vC,OAAOmlB,SAASla,EAAM4kC,cAC3EplB,EAAWxf,EAAM4kC,aAErBtD,KA4OY2D,OAAO,QACPhiC,MAAO,CAAC5J,MAAOqoC,GARnB,UAUI,eAACwD,GAAA,EAAD,CACIhC,QAAQ,OACRrkC,KAAK,SACLsmC,UAAW,EACXC,OAAQr5B,GAAqB20B,GAC7B2E,cA/PE,SAACx4C,GACnB,MAAqB,kBAAVA,GAAuBkI,OAAOmlB,SAASrtB,GAG3C4pB,GAAuB5pB,GAFnB,MA8PK0nB,OAAQmtB,EACR4D,yBAAyB,IAE7B,eAACC,GAAA,EAAD,CACIrC,QAASb,GAAsB,OAC/BxjC,KAAK,SACLumC,OAAQzE,GACRpsB,OAAQmtB,IAEZ,eAAC8D,GAAA,EAAD,CAAeC,gBAAgB,QAC/B,eAAC,KAAD,CAASt5C,QAAS,eAACu5C,GAAD,MAClB,eAACC,GAAA,EAAD,IACCrD,EACAwB,EACAH,aAqEf+B,GAAgBpgB,aAAWya,GAAXza,EAxDgC,SAAC,GAOjD,IALEpD,EAKH,EALGA,QACAiR,EAIH,EAJGA,OACAniC,EAGH,EAHGA,MACA40C,EAEH,EAFGA,QAGJ,IAAKzS,EACD,OAAO,KAEX,GAAqB,kBAAVniC,EACP,OAAO,KAEX,IAAK40C,GAA8B,IAAnBA,EAAQj4C,OACpB,OAAO,KAEX,IAAM4S,EAAQqlC,EAAQn3C,KAAI,SAACupC,EAAmBzrC,GAAkB,IAEvDe,EAAqC0qC,EAArC1qC,KAAMT,EAA+BmrC,EAA/BnrC,MAAOwM,EAAwB2+B,EAAxB3+B,MAAO+pC,EAAiBpL,EAAjBoL,KAAMF,EAAWlL,EAAXkL,QAC/B,GAAqB,kBAAVr2C,EACP,OAAO,KAQX,IAAMg5C,EAAYh5C,EAAM+sC,QAAQ,GAxaX,cAyajBvgC,IACAA,EAzamB,WA2avB,IACMysC,GADiC,IAAvBx4C,EAAK6H,QAAQ,KACJ,GAAH,YAAa+tC,EAAb,KACtB,OACI,iCACI,kCAAO51C,EAAP,WACA,uBAAM41B,UAAWhB,EAAQqe,aAAct9B,MAAO,CAAC5J,SAA/C,SAAwDwsC,IACxD,mDAAgBzC,EAAhB,YAAwB0C,QAHlBv5C,MAQlB,OAAKgU,EAKD,uBAAK2iB,UAAWhB,EAAQme,iBAAxB,UACI,uBAAMnd,UAAWhB,EAAQse,aAAzB,mBAA2C9pB,GAA2B1lB,GAAtE,UACCuP,KANE,QAqBTwlC,GAAgB,SAAC9mC,GAA+B,IAE3C+mC,EAA6C/mC,EAA7C+mC,GAAIC,EAAyChnC,EAAzCgnC,GAAI5wB,EAAqCpW,EAArCoW,OAAQd,EAA6BtV,EAA7BsV,OAAQa,EAAqBnW,EAArBmW,KAAM6f,EAAeh2B,EAAfg2B,YAG/BiR,EAAc7wB,EAAS,GAAM4f,EAC7BkR,EAAgB,EAAID,EAEpBE,EAAI5vC,KAAKmS,MAAM,IAAM0M,EAAS8wB,EAAgB,IAAO,IACrDE,EAAK7vC,KAAKmS,MAAM,IAAMssB,EAAckR,EAAgB,IAAO,IAGjE,MAAkB,kBAAPH,GAAiC,kBAAPC,EAE7B,sBACIn8B,EAAGk8B,EAAKE,EACRjsB,EAAGgsB,EAAKC,EACRxmC,MAAOymC,EACPxmC,OAAQwmC,EACRG,QAAO,cAfJ,KAeI,YAfJ,MAUP,SAOI,yBACIN,GAAG,MACHC,GAAG,MACHG,EAAGA,EACHnR,YAAaoR,EACb9xB,OAAQA,EACRa,KAAMA,MAMf,MC5bIkQ,iBAxEA,SAACC,GAAD,OAAkBC,aAC7B,CACI2J,IAAK,CACDrJ,UAAWP,EAAMrE,QAAQ,GACzB6E,WAAYR,EAAMrE,QAPX,GAQP2F,YAAatB,EAAMrE,QARZ,GASPxhB,MAAM,eAAD,OAAiB6lB,EAAMrE,QAAQ,IAA/B,KACLvhB,OAAQ,MACRipB,QAAS,OACTC,WAAY,gBA+DTvD,EAnDyC,SAAC,GAAkE,IAAjEpD,EAAgE,EAAhEA,QAAS6e,EAAuD,EAAvDA,cAAeh1B,EAAwC,EAAxCA,kBAAmB4T,EAAqB,EAArBA,gBAAqB,EAClEuH,mBAASnb,GADyD,mBAC/Gw6B,EAD+G,KAC3FC,EAD2F,KAGtHnf,qBAAU,WACNmf,EAAsBz6B,KACvB,CAACA,IAkBJ,IAAM06B,EAAqBv0C,MAAMC,QAAQ4uC,GACpC0F,IACD1F,EAAgB,CAAC9vC,KAAK2F,MAAQ,EAAIggB,GAAY3lB,KAAK2F,QAGvD,IAAM44B,EAAgB,CAClB,CAAC3iC,MAAOk0C,EAAe,GAAI/vC,MAAOylB,GAAuBsqB,EAAe,KACxE,CAACl0C,MAAOk0C,EAAe,GAAI/vC,MAAOylB,GAAuBsqB,EAAe,MAG5E,OACI,eAAC/V,GAAA,EAAD,CAAK9H,UAAWhB,EAAQiN,IAAxB,SACI,eAACM,GAAA,EAAD,CACInD,UAAWma,EACX/W,IAAKqR,EAAe,GACpBpR,IAAKoR,EAAe,GACpBl0C,MAAO05C,EACP/W,MAAOA,EACP9D,SAlCS,SAAC1rB,EAAcnT,GAC5BqF,MAAMC,QAAQtF,IACd25C,EAAsB,CAAC35C,EAAM,GAAIA,EAAM,MAiCnCijC,kBA7BkB,SAAC9vB,EAAqCnT,GAC5D8yB,GAAmBztB,MAAMC,QAAQtF,IACjC8yB,EAAgB,CAAC9yB,EAAM,GAAIA,EAAM,MA4B7B0U,KAAK,QACLquB,kBAAkB,KAClBC,iBA1BZ,SAA0BhjC,GACtB,OAAO6pB,GAA2B7pB,WC+C3By4B,iBAzFA,SAACC,GAAD,OAAkBC,aAC7B,CACIwa,eAAgB,CACZpX,QAAS,OACTsX,cAAe,SACf1V,SAAU,OACVkc,SAAU,aACV7d,WAAY,UAEhB8d,aAAc,CACVjnC,MAAO,QAEXknC,cAAe,CACXxX,SAAU,QA4EY,CAAC0G,WAAW,GAA/BxQ,EApD2C,SAAC,GAOO,IANHpD,EAME,EANFA,QAASj2B,EAMP,EANOA,OACTid,EAKE,EALFA,iBACA4C,EAIE,EAJFA,aAAcC,EAIZ,EAJYA,kBACdg1B,EAGE,EAHFA,cAAevhB,EAGb,EAHaA,WAAYG,EAGzB,EAHyBA,gBAC3BuhB,EAEE,EAFFA,sBAAuBD,EAErB,EAFqBA,eAAgBD,EAErC,EAFqCA,cACvCjwB,EACE,EADFA,WAAYR,EACV,EADUA,OAAQ4K,EAClB,EADkBA,YAIzE0rB,EAAS39B,EAAiBza,KAAI,SAACmiB,GACjC,IAAMuwB,EAAYvwB,EAAgBC,gBAAgBpiB,KAAI,SAAA+R,GAAI,OACtDA,EAAKwc,aAAe,IAAMxc,EAAKwc,aAAe,KAGlD,OACI,eAAC,GAAD,CAEI/wB,OAAQA,EACR2kB,gBAAiBA,EACjB9E,aAAcA,EACdC,kBAAmBA,EACnBg1B,cAAeA,EACfvhB,WAAYA,EACZG,gBAAiBA,EACjBuhB,sBAAuBA,EACvBC,UAAWA,EACXF,eAAgBA,EAChBD,cAAeA,EACfjwB,WAAYA,EACZR,OAAQA,EACR4K,YAAaA,GAdRvK,EAAgBpe,OAmBjC,OAAsB,IAAlBq0C,EAAOl5C,OACA,KAIP,uBAAKu1B,UAAWhB,EAAQ8d,eAAxB,UACI,eAAC,GAAD,CACIj0B,kBAAmBA,EACnBg1B,cAAeA,EACfphB,gBAAiBA,IAEpBknB,QCvEP3gB,GAAqB,CACvB1G,cACAG,mBACAuhB,sBnD6WG,SAA+B1uC,GAClC,MAAO,CAACqM,KAAMwe,GAA0B7qB,OmD7WxC2oB,gBAGWkL,gBArBS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAC3Bid,iBAAkBH,EAAMC,UAAUE,iBAClC4C,aAAc/C,EAAMqF,aAAatC,aACjCC,kBAAmBhD,EAAMqF,aAAarC,kBACtCg1B,cAAerxB,GAAiC3G,GAChDk4B,eAAgBl4B,EAAMqF,aAAa/B,yBACnC20B,cAAej4B,EAAMqF,aAAa9B,wBAClCyE,WAAYD,GAA6B/H,GACzCwH,OAAQH,GAAiCrH,MAWTmd,GAAzBG,CAA6CygB,I,gSC1D7C,OAA0B,sCCuEnCvgB,GAAYC,cAAW,SAACjB,GAAD,OAAkBC,aAC3C,CACIuhB,KAAM,CACFtK,SAAU,OACVxR,aAAc1F,EAAMrE,QAAQ,GAC5B2F,YAAatB,EAAMrE,QAAQ,IAE/B8lB,KAAM,CACFngB,YAAatB,EAAMrE,QAAQ,IAE/B+lB,MAAO,CACHlhB,WAAY,QAEhB9M,MAAO,GACPiuB,uBAAwB,CACpBC,WAAY5hB,EAAMmB,QAAQ0gB,SAE9BC,0BAA2B,CACvBF,WAAY5hB,EAAMmB,QAAQ0gB,QAC1BphB,QAAST,EAAMrE,QAAQ,GACvB4E,UAAWP,EAAMrE,QAAQ,GACzB+J,aAAc1F,EAAMrE,QAAQ,IAEhComB,MAAO,CACH3nC,OAAQ,KAEZ4nC,YAAa,CACTvhB,QAAS,GAEbwhB,KAAM,CACFC,WAAY,kBA0ITC,GArH2B,SAAC,GAaO,IAZHr6B,EAYE,EAZFA,aACA4S,EAWE,EAXFA,aACA1K,EAUE,EAVFA,wBACAoyB,EASE,EATFA,2BACAC,EAQE,EARFA,yBACAC,EAOE,EAPFA,8BACAC,EAME,EANFA,gBACArsB,EAKE,EALFA,iBACAssB,EAIE,EAJFA,kBACAj8B,EAGE,EAHFA,aACAk8B,EAEE,EAFFA,aACAC,EACE,EADFA,oBAErC/lB,EAAUqE,KAEhB,IAAKlZ,EACD,OAAO,KAGX,IASI66B,EACAC,EACAC,EACJ,GAAIN,EAAiB,CACjB,IAAMO,EAAc,UACd96B,EAAWq6B,EAAwB,QAEnCU,EAAY/yB,EAAwB1mB,SAASw5C,GACnDH,EACI,eAAC,GAAD,CACIK,KAAMD,EACN/6B,SAAUA,EACVi7B,YANY,SAACj7B,GAAD,OAAwBs6B,EAA8BQ,EAAa96B,IAO/E9c,QAASq3C,EACTE,aAAcA,EACdS,UAAWR,IAIvB,GAAIH,GAAmBrsB,EAAkB,CACrC,IAAM4sB,EAAc,WACd96B,EAAWq6B,EAAwB,SAEnCU,EAAY/yB,EAAwB1mB,SAASw5C,GACnDF,EACI,eAAC,GAAD,CACII,KAAMD,EACN/6B,SAAUA,EACVi7B,YANY,SAACj7B,GAAD,OAAwBs6B,EAA8BQ,EAAa96B,IAO/E3a,SAAU6oB,EACV7J,KAAM9F,EACNk8B,aAAcA,EACdS,UAAWR,IAIvB,GAAIF,EAAmB,CACnB,IAAMM,EAAc,QACd96B,EAAWq6B,EAAwB,MAEnCU,EAAY/yB,EAAwB1mB,SAASw5C,GACnDD,EACI,eAAC,GAAD,CACIG,KAAMD,EACN/6B,SAAUA,EACVi7B,YANY,SAACj7B,GAAD,OAAwBs6B,EAA8BQ,EAAa96B,IAO/Ek1B,UAAWsF,IAKvB,OACI,gBAACW,GAAA,EAAD,CAAMxlB,UAAWhB,EAAQ6kB,KAAzB,UACI,gBAAC4B,GAAA,EAAD,CAAaC,gBAAc,EAA3B,UACI,eAAC,KAAD,CAAUxZ,SAAU,QAASlM,UAAWhB,EAAQ8kB,OAChD,gBAACnZ,GAAA,EAAD,CAA2BtsB,KAAK,QAAQ1U,MAAO0oB,EAC5BmW,SAjEG,SAAC1rB,EAAsC6oC,GACrElB,EAA2BkB,IA+DnB,UAEI,eAAC9a,GAAA,EAAD,CAAsBlhC,MAAM,UAAUy/B,SAA8B,OAApBwb,EAAhD,SACI,eAAC9d,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,uBAA/B,SACI,eAAC,KAAD,OAFW,GAKnB,eAACs+B,GAAA,EAAD,CAAsBlhC,MAAM,WAAWy/B,SAA+B,OAArB7Q,EAAjD,SACI,eAACuO,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,wBAA/B,SACI,eAAC,KAAD,OAFW,GAKnB,eAACs+B,GAAA,EAAD,CAAsBlhC,MAAM,QAAQy/B,SAAgC,OAAtByb,EAA9C,SACI,eAAC/d,GAAA,EAAD,CAASC,OAAK,EAACj6B,MAAOvC,EAAKgC,IAAI,qBAA/B,SACI,eAAC,KAAD,OAFW,KAZC,GAkBxB,eAACi0B,GAAA,EAAD,CAEIzjB,QAhFY,WACxBggB,GAAa,IAgFDiD,UAAWhB,EAAQ+kB,MACnB1lC,KAAK,QAJT,SAKK,eAAC,KAAD,KAJI,MAOZ2mC,EACAC,EACAC,MAkBPU,GAAwD,SAAC,GASzD,IAEE38C,EATAo8C,EAOH,EAPGA,KACAh7B,EAMH,EANGA,SACAi7B,EAKH,EALGA,YACA/3C,EAIH,EAJGA,QACAu3C,EAGH,EAHGA,aACAS,EAEH,EAFGA,UAKJ,GAAiB,SAAbl7B,EAAqB,CACrB,IAAMw7B,EAAiBC,GAAUv4C,EAAQC,WAAY,CAAC,OAAQ,OAAQ,UAChEu4C,EAAcD,GAAUv4C,EAAS,CAAC,KAAM,QAAS,OAAQ,UAC/Dw4C,EAAW,WAAiBF,EAC5B58C,EACI,eAAC,GAAD,CAAiBq7C,KAAMtxC,KAAKwU,UAAUu+B,EAAa,KAAM,UAE1D,GAAiB,SAAb17B,EACPphB,EACI,eAAC,GAAD,UACI,eAAC,GAAD,CACIuwB,KAAM7wB,OAAOC,oBAAoB2E,EAAQy4C,OAAS,IAAIz6C,KAAI,SAAAnB,GAAI,MAAI,CAACA,EAAMmD,EAAQy4C,MAAM57C,gBAIhG,GAAiB,SAAbigB,EAAqB,CAC5B,IAAMmP,EAAmB,CACrB,CAACjvB,EAAKgC,IAAI,mBAAoBgB,EAAQC,WAAWjC,KAAI,SAAA06C,GAAC,OAAIA,EAAE77C,QAAMsB,KAAK,OACvE,CAACnB,EAAKgC,IAAI,wBAAyBgB,EAAQC,WAAWjC,KAAI,SAAA06C,GAAC,OAAIA,EAAEC,SAAOx6C,KAAK,OAC7E,CAACnB,EAAKgC,IAAI,qBAAsBgB,EAAQC,WAAWjC,KAAI,SAAA06C,GAAC,OAAIA,EAAE5nC,QAAM3S,KAAK,OACzE,CAACnB,EAAKgC,IAAI,uBAAyB,oBAAqBgB,EAAQojB,KAAKplB,KAAI,SAAAqb,GAAC,OAAIA,EAAI,MAAIlb,KAAK,OAC3F,CAACnB,EAAKgC,IAAI,4BAA6BgB,EAAQ44C,aAEnDl9C,EACI,eAAC,GAAD,UACI,eAAC,GAAD,CAAeuwB,KAAMA,UAGT,WAAbnP,IACPphB,EACI,eAAC,GAAD,CAAmBq7C,KAAM8B,GAAqBtB,EAAcv3C,MAGpE,OACI,eAAC,GAAD,CACIT,MAAOS,EAAQT,OAAS,IACxBu5C,UAAW94C,EAAQT,OAAR,cAAwBS,EAAQ+B,IAC3C+1C,KAAMA,EACNh7B,SAAUA,EACVi7B,YAAaA,EACbC,UAAWA,EANf,SAQKt8C,KAkBPq9C,GAA0D,SAAC,GAU3D,IAEEr9C,EACAs9C,EAXAlB,EAQH,EARGA,KACAh7B,EAOH,EAPGA,SACAi7B,EAMH,EANGA,YACA51C,EAKH,EALGA,SACAgf,EAIH,EAJGA,KACAo2B,EAGH,EAHGA,aACAS,EAEH,EAFGA,UAGEvmB,EAAUqE,KAGhB,GAAiB,SAAbhZ,EAAqB,CACrB,IAAMm8B,EAAeV,GAAUp2C,EAAU,CACrC,KAAM,OAAQ,QAAS,QAAS,QAAS,QAAS,QAClD,gBACA,cACA,cACA,eACA,UAEJzG,EACI,eAAC,GAAD,CAAiBq7C,KAAMtxC,KAAKwU,UAAUg/B,EAAc,KAAM,UAE3D,GAAiB,SAAbn8B,GAQP,GAPAphB,EACI,eAAC,GAAD,UACI,eAAC,GAAD,CACIuwB,KAAM7wB,OAAOC,oBAAoB8G,EAASs2C,OAAS,IAAIz6C,KAAI,SAAAnB,GAAI,MAAI,CAACA,EAAMsF,EAASs2C,MAAM57C,WAIjGsF,EAAS+2C,SAAU,CAMnBF,EACI,eAAC,GAAD,UACI,eAACpoB,GAAA,EAAD,CAAOre,IAPG,SAACuvB,GACXA,GAAW3/B,EAAS+2C,WACpBpX,EAAQqX,UAAYh3C,EAAS+2C,WAKNzmB,UAAWhB,EAAQmlB,oCAInD,GAAiB,SAAb95B,EAAqB,CAC5B,IAAMmP,EAAmB,CACrB,CAACjvB,EAAKgC,IAAI,SAAUmD,EAAS5C,OAC7B,CAACvC,EAAKgC,IAAI,QAASmD,EAAStF,MAC5B,CAACG,EAAKgC,IAAI,SAAUmD,EAASuc,OAC7B,CAAC1hB,EAAKgC,IAAI,aAAcmD,EAASw2C,OACjC,CAAC37C,EAAKgC,IAAI,mBAAoBmD,EAASi3C,KAAKj7C,KAAK,OACjD,CAACnB,EAAKgC,IAAI,qBAAsBmD,EAASk3C,MAAMr7C,KAAI,SAAAs7C,GAAC,OAAIA,EAAI,MAAIn7C,KAAK,OACrE,CAACnB,EAAKgC,IAAI,mBAAoBmD,EAASuZ,gBAE3ChgB,EACI,eAAC,GAAD,UACI,eAAC,GAAD,CAAeuwB,KAAMA,UAGT,WAAbnP,IACPphB,EACI,eAAC,GAAD,CAAmBq7C,KAAMwC,GAAsBhC,EAAcp1C,EAAUgf,MAG/E,OACI,gBAAC,GAAD,CACI5hB,MAAO4C,EAAS5C,OAAS4C,EAAStF,KAClCi8C,UAAS,UAAK97C,EAAKgC,IAAI,QAAd,aAA0BmD,EAAStF,MAC5Ci7C,KAAMA,EACNh7B,SAAUA,EACVi7B,YAAaA,EACbC,UAAWA,EANf,UAQKgB,EACAt9C,MAcP89C,GAAoD,SAAC,GAOrD,IAGE99C,EACAiE,EACAH,EAVAs4C,EAKH,EALGA,KACAh7B,EAIH,EAJGA,SACAi7B,EAGH,EAHGA,YACA/F,EAEH,EAFGA,UAGEvgB,EAAUqE,KACVhqB,EAAQkmC,EAAUlmC,MAIxB,GAAiB,SAAbgR,EACAphB,EACI,eAAC,GAAD,CAAiBq7C,KAAMtxC,KAAKwU,UAAUnO,EAAO,KAAM,UAEpD,GAAiB,SAAbgR,EACP,GAAMhR,EAAMc,WAAY,CACpB,IAAMqf,EAAmB7wB,OAAOC,oBAAoByQ,EAAMc,YAAY5O,KAClE,SAACnB,GAAD,MAAe,CAACA,EAAMiP,EAAMc,WAAY/P,OAE5CnB,EACI,eAAC,GAAD,UACI,eAAC,GAAD,CAAeuwB,KAAMA,WAI7BvwB,EACI,eAAC,GAAD,UACI,eAACw7B,GAAA,EAAD,UAAal6B,EAAKgC,IAAI,iEAK9BgzC,EAAUryC,OAASqyC,EAAUryC,MAAM+D,WAAW,UAC9C/D,EACI,eAAC85C,GAAA,EAAD,CAAWhnB,UAAWhB,EAAQolB,MAAOl3C,MAAOqyC,EAAUryC,MAAOJ,MAAOyyC,EAAUzxC,SAGlFyxC,EAAUxyC,cACVA,EACI,eAAC,GAAD,UACI,eAAC03B,GAAA,EAAD,UAAa8a,EAAUxyC,iBAKvC,OACI,gBAAC,GAAD,CACID,MAAOyyC,EAAUzxC,MACjBu4C,UAAS,UAAK97C,EAAKgC,IAAI,iBAAd,aAAmChC,EAAKgC,IAAI8M,EAAMqC,SAASC,OACpE0pC,KAAMA,EACNh7B,SAAUA,EACVi7B,YAAaA,EALjB,UAOKp4C,EACAH,EACA9D,MAgBPg+C,GAAkD,SAAC,GAQO,IAPH5B,EAOE,EAPFA,KACAv4C,EAME,EANFA,MACAu5C,EAKE,EALFA,UACAh8B,EAIE,EAJFA,SACAi7B,EAGE,EAHFA,YACAC,EAEE,EAFFA,UACAvpC,EACE,EADFA,SAOzD,OACI,gBAACkrC,GAAA,EAAD,CAAUC,GAAI9B,EAAM+B,QAAQ,OAAOC,eAAa,EAAhD,UACI,eAACC,GAAA,EAAD,CACIx6C,MAAOA,EACPu5C,UAAWA,EACXkB,OACI,gBAAC5c,GAAA,EAAD,CAEItsB,KAAK,QACL1U,MAAO0gB,EACPugB,WAAW,EACXpC,SAfS,SAAC1rB,EAAsCuN,GAChEi7B,EAAYj7B,IASA,UAOI,eAACwgB,GAAA,EAAD,CAAsBlhC,MAAM,OAA5B,SACI,eAAC,KAAD,KADe,GAGnB,eAACkhC,GAAA,EAAD,CAAsBlhC,MAAM,OAA5B,SACI,eAAC,KAAD,KADe,GAGnB,eAACkhC,GAAA,EAAD,CAAsBlhC,MAAM,OAA5B,SACI,eAAC,KAAD,KADe,GAIf47C,GACI,eAAC1a,GAAA,EAAD,CAAsBlhC,MAAM,SAA5B,SACI,sBAAKmlB,IAAK04B,GAAYhrC,MAAO,GAAI0hB,IAAI,iBADtB,KAjBtB,KAyBhBliB,MAcPyrC,GAA8C,SAAC,GAAY,IAAXjuB,EAAU,EAAVA,KAC5CwF,EAAUqE,KAChB,OACI,eAACqkB,GAAA,EAAD,CAAgB9gB,UAAWzI,KAAO6B,UAAWhB,EAAQglB,uBAArD,SACI,eAAC2D,GAAA,EAAD,CAAO3nB,UAAWhB,EAAQjJ,MAAO1X,KAAK,QAAtC,SACI,eAACupC,GAAA,EAAD,UAEQpuB,EAAKjuB,KAAI,SAACC,EAAInC,GAAW,IAAD,cACCmC,EADD,GACbtB,EADa,KACRP,EADQ,KAEhBk+C,EAAgBl+C,EAepB,MAdqB,kBAAVA,IACHA,EAAMsH,WAAW,YACdtH,EAAMsH,WAAW,aACxB42C,EACI,eAACC,GAAA,EAAD,CACI9zC,KAAMrK,EACNyU,OAAO,SACPrG,IAAI,aAHR,SAKKpO,IAEFqF,MAAMC,QAAQtF,KACrBk+C,EAAgB,IAAMl+C,EAAM4B,KAAI,SAAAwgB,GAAC,OAAIA,EAAI,MAAIrgB,KAAK,MAAQ,KAG1D,gBAACq8C,GAAA,EAAD,WACI,eAACC,GAAA,EAAD,UAAY99C,IACZ,eAAC89C,GAAA,EAAD,CAAWC,MAAM,QAAjB,SAA0BJ,MAFfx+C,aAezC6+C,GAAyB,SAAC,GAAgB,IAAflsC,EAAc,EAAdA,SACvBgjB,EAAUqE,KAChB,OAAO,eAAC8kB,GAAA,EAAD,CAAanoB,UAAWhB,EAAQqlB,YAAhC,SAA8CroC,KAcnDosC,GAA0C,SAAC,GAAuB,IAAtB9D,EAAqB,EAArBA,KAAM+D,EAAe,EAAfA,UACpD,OACI,eAAC,GAAD,UACI,eAAC,KAAD,CACIhmB,MAAO1rB,GAAOiR,SAAS/Q,SAASyxC,WAAa,QAC7C7rC,OAAO,QACP8rC,WAAY,CAACF,GACb1+C,MAAO26C,EACPkE,UAAU,OAMpBC,GAAkD,SAAC,GAAY,IAAXnE,EAAU,EAAVA,KACtD,OACI,eAAC,GAAD,CAAaA,KAAMA,EAAM+D,UAAW//C,kBAItCogD,GAAoD,SAAC,GAAY,IAAXpE,EAAU,EAAVA,KACxD,OACI,eAAC,GAAD,CAAaA,KAAMA,EAAM+D,UAAWM,kBAM5C,SAAS7C,GAAU1tC,EAAUjO,GACzB,IAD8C,EACxCy+C,EAAkC,GADM,cAE9Bz+C,GAF8B,IAE9C,2BAAsB,CAAC,IAAdD,EAAa,QACdA,KAAOkO,IACPwwC,EAAO1+C,GAAOkO,EAAIlO,KAJoB,8BAO9C,OAAO0+C,EAGX,SAASxC,GAAqBtB,EACAv3C,GAC1B,MAAO,CACH,8CACA,GACA,0BACA,YACA,uDACA,wBACA,wBACA,6BARG,uCAS6Bu3C,EAAa15C,IAT1C,QAUH,YACA,QACA,IAZG,oEAc2BmC,EAAQ+B,GAdnC,YAeL5D,KAAK,MAIX,SAASo7C,GAAsBhC,EACAp1C,EACAgf,GAC3B,IAAMtkB,EAAOsF,EAAStF,KAChBy+C,EAAOn5C,EAASyc,YAChB28B,EAAOp5C,EAAS0c,YAChB28B,EAAOr5C,EAAS4c,aAClB08B,EAAU,GAId,OAHa,OAATt6B,IACAs6B,EAAO,qBAAiBx1B,GAA2B9E,GAA5C,yBAEJ,CAAC,iBAAD,OACctkB,GADd,OACqB4+C,GADrB,+BAEqBH,EAFrB,kBAEmCC,EAFnC,mBAEkDC,EAFlD,OAGLr9C,KAAK,MC1nBX,IAeMs3B,GAAqB,CACvBjG,gBACA0nB,2BlD4RG,SAAoCwE,GACvC,MAAO,CAACttC,KAAMqhB,GAAgCisB,oBkD5R9CtE,8BlDySG,SAAuCQ,EAAqB96B,GAC/D,MAAO,CAAC1O,KAAMshB,GAAoCkoB,cAAa96B,ckDvSpD8Y,gBArBS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAC3BohB,aAActE,EAAMqF,aAAaf,aACjCkI,wBAAyBD,GAAgCvM,GACzD6+B,yBAA0BpyB,GAAiCzM,GAC3D++B,gBAAiBj5B,GAAwB9F,GACzC0S,iBAAkB1M,GAAyBhG,GAC3Cg/B,kBAAmBv3B,GAA0BzH,GAC7C+C,aAAc0C,GAAqBzF,GACnCi/B,aAAcpyB,GAAuB7M,GACrCk/B,oBAAqBpuC,GAAOiR,SAAS/Q,SAASkuC,uBAUd/hB,GAAzBG,CAA6CqhB,I,UCuBtD0E,G,kDAIF,WAAYntC,GAAwB,IAAD,EAE/B,GAF+B,qBAC/B,cAAMA,IAJFotC,aAA8B,KAGH,EAF3BC,wBAE2B,GAE1BrtC,EAAMysB,SACP,MAAMx/B,MAAM,sCAHe,OAK/B,EAAKy4C,YAAc,EAAKA,YAAY5wC,KAAjB,iBACnB,EAAKu4C,mBAAqB,CACtB,CAAC,YAAa,EAAKC,gBAAgBx4C,KAArB,kBACd,CAAC,UAAW,EAAKy4C,cAAcz4C,KAAnB,kBACZ,CAAC,eAAgB,EAAK04C,iBAAiB14C,KAAtB,kBACjB,CAAC,eAAgB,EAAK24C,iBAAiB34C,KAAtB,mBAVU,E,wDAcnC,WACInH,KAAK+/C,6B,oBAGT,WACI,OACI,sBACIzpB,UAA8B,QAAnBt2B,KAAKqS,MAAM2tC,IAAgBhgD,KAAKqS,MAAMijB,QAAQ2qB,IAAMjgD,KAAKqS,MAAMijB,QAAQ4qB,IAClFnI,YAAa/3C,KAAK+3C,gB,yBAK9B,SAAoB3kC,GACZpT,KAAKmgD,iBAAiB/sC,IACtBpT,KAAKy/C,aAAez/C,KAAKogD,mBAAmBhtC,GAC5CpT,KAAK+/C,2BACL//C,KAAKqgD,yBAELrgD,KAAKy/C,aAAe,O,6BAI5B,SAAwBrsC,GACpB,GAA0B,OAAtBpT,KAAKy/C,cAA0Bz/C,KAAKmgD,iBAAiB/sC,GAAzD,CAGA,IAAMktC,EAAkBtgD,KAAKogD,mBAAmBhtC,GAC1CmtC,EAAgBD,EAAkBtgD,KAAKy/C,aAC7Cz/C,KAAKy/C,aAAea,EACE,IAAlBC,GACAvgD,KAAKqS,MAAMysB,SAASyhB,M,2BAK5B,SAAsBntC,GAElBpT,KAAKwgD,gB,8BAIT,SAAyBptC,GAErBpT,KAAKwgD,gB,8BAIT,SAAyBptC,GAErBpT,KAAKwgD,gB,8BAIT,SAAyBptC,GACrB,OAAwB,IAAjBA,EAAMgsB,QAAkC,IAAlBhsB,EAAMqtC,U,gCAGvC,SAA2BrtC,GACvB,MAA0B,QAAnBpT,KAAKqS,MAAM2tC,IAAgB5sC,EAAMstC,QAAQttC,EAAMutC,U,yBAG1D,WACI3gD,KAAK+/C,2BACL//C,KAAKy/C,aAAe,O,mCAGxB,WACIz/C,KAAK0/C,mBAAmBjgD,SAAQ,SAACmhD,GAAD,OAC5B5yC,SAAS6hB,KAAKja,iBAAiBgrC,EAAK,GAAIA,EAAK,S,sCAGrD,WACI5gD,KAAK0/C,mBAAmBjgD,SAAQ,SAACmhD,GAAD,OAC5B5yC,SAAS6hB,KAAK5Z,oBAAoB2qC,EAAK,GAAIA,EAAK,W,GA5FrCjuC,iBAgGR+lB,iBAtJA,SAACC,GAAD,OAAkBC,aAC7B,CACIqnB,IAAK,CACDjmB,KAAM,OACN6Y,OAAQ,OACRgO,QAAS,OACT/tC,MAAO,MACPguC,UAAW,OACXC,UAAW,OACXC,OAAQ,aAERnoB,gBAAwC,SAAvBF,EAAMmB,QAAQoR,KAAkB,QAAU,QAC3DvwB,QAAS,GAEbulC,IAAK,CACDlmB,KAAM,OACN6Y,OAAQ,OACRgO,QAAS,OACT9tC,OAAQ,MACRurB,SAAU,OACVuR,SAAU,OACVmR,OAAQ,aAERnoB,gBAAwC,SAAvBF,EAAMmB,QAAQoR,KAAkB,QAAU,QAC3DvwB,QAAS,OA8HN+d,CAAmB8mB,ICzG5ByB,G,kDAEF,WAAY5uC,GAAyB,IAAD,8BAChC,cAAMA,IACD6uC,iBAAmB,EAAKA,iBAAiB/5C,KAAtB,iBACxB,EAAKgV,MAAQ,CAACxH,KAAMtC,EAAM8uC,aAAe,IAHT,E,oDAMpC,SAAyB5T,GAAgB,IAAD,OACpCvtC,KAAKohD,UAAS,SAACjlC,GACX,IAAMklC,EAAUllC,EAAMxH,KAChB2sC,EAAUD,EAAU9T,EAI1B,OAHI,EAAKl7B,MAAMysB,UACX,EAAKzsB,MAAMysB,SAASwiB,EAASD,GAE1B,CAAC1sC,KAAM2sC,Q,oBAItB,WACI,IAUIhrB,EACAirB,EACAC,EACAC,EAbEnvC,EAAWtS,KAAKqS,MAAMC,SAC5B,IAAKA,IAAahN,MAAMC,QAAQ+M,GAC5B,OAAOA,EAEX,GAAwB,IAApBA,EAASvR,OACT,OAAOuR,EAAS,GAEpB,GAAIA,EAASvR,OAAS,EAClB,MAAM,IAAIzB,MAAM,gDAMpB,GAAuB,QAAnBU,KAAKqS,MAAM2tC,IAAe,CAC1B,IAAM0B,EAAS1hD,KAAKmc,MAAMxH,KAC1B2hB,EAAYt2B,KAAKqS,MAAMijB,QAAQ2qB,IAC/BsB,EAAiBvhD,KAAKqS,MAAMijB,QAAQqsB,SACpCH,EAAW,aAAI1uC,MAAO4uC,GAAW1hD,KAAKqS,MAAMmvC,aAC5CC,EAAczhD,KAAKqS,MAAMovC,gBACtB,CACH,IAAMG,EAAU5hD,KAAKmc,MAAMxH,KAC3B2hB,EAAYt2B,KAAKqS,MAAMijB,QAAQ4qB,IAC/BqB,EAAiBvhD,KAAKqS,MAAMijB,QAAQqsB,SACpCH,EAAW,aAAIzuC,OAAQ6uC,GAAY5hD,KAAKqS,MAAMmvC,aAC9CC,EAAczhD,KAAKqS,MAAMovC,YAE7B,OACI,uBACQ77C,GAAG,YACH0wB,UAAWuG,KAAWvG,EAAWt2B,KAAKqS,MAAMikB,WAC5CjgB,MAAOrW,KAAKqS,MAAMgE,MAH1B,UAKI,sBACQzQ,GAAG,oBACH0wB,UAAWuG,KAAW0kB,EAAgBvhD,KAAKqS,MAAMwvC,iBACjDxrC,MAAOmrC,EAHf,SAKKlvC,EAAS,KAEd,eAAC,GAAD,CACQ0tC,IAAKhgD,KAAKqS,MAAM2tC,IAChBlhB,SAAU9+B,KAAKkhD,mBAEvB,sBACQt7C,GAAG,oBACH0wB,UAAWuG,KAAW0kB,EAAgBvhD,KAAKqS,MAAMyvC,iBACjDzrC,MAAOorC,EAHf,SAKKnvC,EAAS,Y,GArENK,iBA4ET+lB,iBAzHA,SAACC,GAAD,OAAkBC,aAC7B,CACIqnB,IAAK,CACDjkB,QAAS,OACT8d,SAAU,aACV9f,KAAM,QAEVkmB,IAAK,CAEDntC,OAAQ,OACRipB,QAAS,OACT8d,SAAU,gBACV9f,KAAM,QAEV+nB,SAAU,CACN/nB,KAAM,QAEV2nB,SAAU,CACN3nB,KAAM,YAuGHtB,CAAmBuoB,IChH5Be,GAAqC,CAAC5oB,QAAS,GA8D/C6oB,GAAY,WACd,OAAO73C,OAAO83C,WAAa93C,OAAO+3C,aAAe,EAAI,MAAM,OAuDhD1oB,gBArES,SAACtd,GACrB,MAAO,CACHimC,YAAajmC,EAAMqF,aAAaf,cACgB,OAAzCtE,EAAMqF,aAAa9b,mBACnByW,EAAMC,UAAUzY,SAAS5C,OAAS,EACzCshD,cAAelmC,EAAMC,UAAUE,iBAAiBvb,OAAS,KAItC,GA4DZ04B,CAA6Cf,cApH7C,SAACC,GAAD,OAAkBC,aAC7B,CAEI0pB,aAAc,CACVnmB,SAAU,EACVomB,SAAU,UAEdC,aAAc,CACVrmB,SAAU,EACVsmB,UAAW,SACXC,UAAW,QAGfC,WAAW,aACP5vC,OAAQ,OACRwvC,SAAU,UACPP,IAEPY,WAAW,aACP9vC,MAAO,OACPyvC,SAAU,UACPP,IAGPa,eAAgB,CACZ7oB,KAAM,OACNyoB,UAAW,SACXC,UAAW,QAEfI,eAAgB,CACZhwC,MAAO,OACPyvC,SAAU,UAGdQ,gBAAiB,CACbR,SAAU,SACVzvC,MAAO,OACPC,OAAQ,YA+EwC2lB,EApDhB,SAAC,GAIO,IAHHpD,EAGE,EAHFA,QACA8sB,EAEE,EAFFA,YACAC,EACE,EADFA,cACE,EACzB1vC,WAA6B,MADJ,mBACxC9Q,EADwC,KACnC6nC,EADmC,OAEnB/2B,WAAuBsvC,MAFJ,mBAExCe,EAFwC,KAEhCC,EAFgC,KAI/CtwC,aAAgB,WACZuwC,IACA94C,OAAO+4C,SAAWD,IACnB,IAEH,IAAMA,EAAe,WACjBD,EAAUhB,OASd,GAAIG,GAAeC,EAAe,CAC9B,IAAMe,EAAgC,QAAXJ,EAAmB1tB,EAAQgtB,aAAahtB,EAAQktB,aACrEa,EAA8B,QAAXL,EAAmB1tB,EAAQqtB,WAAWrtB,EAAQstB,WACjEU,EAAkC,QAAXN,EAAmB1tB,EAAQutB,eAAevtB,EAAQwtB,eAC/E,OACI,gBAAC,GAAD,CACI9C,IAAKgD,EACL7B,YAAav3C,KAAKm5B,IAAI34B,OAAO83C,WAAY93C,OAAO+3C,aAAe,EAC/DrjB,SAdZ,SAAsBnqB,GACd9S,GACAA,EAAIuS,cAaAkiB,UAAW8sB,EACXvB,gBAAiBwB,EACjBvB,gBAAiBwB,EANrB,UAQI,eAAC,GAAD,CAAQztC,SAAU6zB,IAClB,iCACI,eAAC,GAAD,IACA,eAAC,GAAD,UAKZ,OACI,sBAAKpT,UAAWhB,EAAQytB,gBAAxB,SACI,eAAC,GAAD,CAAQltC,SAAU6zB,UCnEnBjQ,gBA3CS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAC3BkkD,WAAYpnC,EAAMqF,aAAanB,sBAC/B7S,QAASP,GAAOiR,SAAS/Q,SAASK,WAIf,GAmCZisB,CAA6Cf,cAjC7C,SAACC,GAAD,OAAkBC,aAC7B,CACIic,KAAK,cACDzb,QAAS,EACTtmB,MAAO,QACPC,OAAQ,QACRwvC,SAAU,SACVvmB,QAAS,OACTsX,cAAe,SACfrX,WAAY,WACXtD,EAAM6qB,YAAYC,GAAG,MAAQ,CAC1BlB,SAAU,eAsBkC7pB,EAjBpB,SAAC,GAAoC,IAAnCpD,EAAkC,EAAlCA,QAASiuB,EAAyB,EAAzBA,WAAY/1C,EAAa,EAAbA,QAE3D,OACI,wBAAM8oB,UAAWhB,EAAQuf,KAAzB,WACMrnC,GAAW,eAACotB,GAAA,EAAD,CAASI,QAAQ,UAE1BuoB,GACI,uCACI,eAAC,GAAD,IACA,eAAC,GAAD,c,gCCvClB5pB,GAAYC,cAAW,SAAAjB,GAAK,MAAK,CAC/B+qB,KAAM,CACFzpB,YAAatB,EAAMrE,QAAQ,QCXvC,IAOMgF,GAAqB,CACvBrF,kBACAnD,mBAGW2I,gBAZS,SAACtd,GACrB,MAAO,CACHmb,MAAOnb,EAAMqF,aAAanB,sBAC1BpC,SAAU9B,EAAMqF,gBASgB8X,GAAzBG,EDWA,YAMoB,IAJ3BnC,EAI0B,EAJ1BA,KACArZ,EAG0B,EAH1BA,SACAgW,EAE0B,EAF1BA,eACAnD,EAC0B,EAD1BA,eAC0B,EACUwJ,mBAAwB,MADlC,mBACvBC,EADuB,KACTC,EADS,KAG9BC,qBAAU,WACN,IAAMnwB,EAAOzJ,EAAKgC,IAAI,4BAEtBR,MAAMiI,GACDhI,MAAK,SAAAC,GAAQ,OAAIA,EAASuE,UAC1BxE,MAAK,SAAAwE,GAAI,OAAI0zB,EAAgB1zB,SAGtC,IAAMwuB,EAAUqE,KAEhB,OAAKrC,EAwBD,gBAACK,GAAA,EAAD,CACIL,KAAMA,EACNqsB,sBAAsB,EACtBtsB,aAAa,EACbusB,OAAO,OAJX,UAMI,eAAC5rB,GAAA,EAAD,UAAcn3B,EAAKgC,IAAI,oBACvB,eAACo1B,GAAA,EAAD,UACI,eAAC4rB,GAAA,EAAD,UAEyB,OAAjBtpB,EACM,eAAC/B,GAAA,EAAD,IACD,eAAC,KAAD,CAAUlmB,SAAUioB,EAAcU,WAAW,eAK9D,gBAAC/C,GAAA,EAAD,WACI,gBAACC,GAAA,EAAD,CAAQ9kB,QAtCpB,WACI4gB,EAAe,2BAAIhW,GAAL,IAAeoC,uBAAuB,KACpDyQ,KAoCwCrkB,MAAM,UAAtC,UACI,eAAC,KAAD,CAAW6pB,UAAWhB,EAAQouB,OAC7B7iD,EAAKgC,IAAI,0BAEd,eAACs1B,GAAA,EAAD,CAAQ9kB,QArCpB,WACI,IACQjJ,OAAO05C,QAAQ/iD,OAAS,EACxBqJ,OAAO05C,QAAQC,OACwB,oBAAxB35C,OAAe45C,KAC7B55C,OAAe45C,OAEhB55C,OAAOC,SAASC,KAAO,aAE7B,MAAOzB,GACL/I,QAAQM,MAAMyI,KA2BV,SACKhI,EAAKgC,IAAI,iBA9Cf,QEKA61B,iBAzCA,SAACC,GAAD,OAAkBC,aAC7B,CACI2e,SAAU,CACNze,OAAQH,EAAMrE,QAAQ,IAE1B9sB,QAAS,CACLsxB,OAAQH,EAAMrE,QAAQ,IAE1B2vB,iBAAkB,CACdnrB,OAAQH,EAAMrE,QAAQ,GACtB4vB,UAAW,SACXloB,QAAS,OACTC,WAAY,SACZqX,cAAe,cA4BZ5a,EApBqC,SAAC,GAAyB,IAAxBpD,EAAuB,EAAvBA,QAAS6uB,EAAc,EAAdA,SAE3D,OAAwB,IAApBA,EAASpjD,OACF,KAIP,gBAAC42B,GAAA,EAAD,CAAQL,MAAM,EAAMQ,kBAAgB,UAApC,UACI,eAACE,GAAA,EAAD,CAAapyB,GAAG,UAAhB,SAA2B/E,EAAKgC,IAAI,oBACpC,uBAAKyzB,UAAWhB,EAAQ2uB,iBAAxB,UACI,eAACzrB,GAAA,EAAD,CAAkBlC,UAAWhB,EAAQiiB,WACpC4M,EAAStiD,KAAI,SAAC2F,EAASsI,GAAV,OACV,eAACirB,GAAA,EAAD,CAAYmC,UAAU,MACV5G,UAAWhB,EAAQ9tB,QAD/B,SACyCA,GADRsI,eC/BtC2pB,gBATS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAC3B8kD,SAAUr7B,GAAyB3M,MAIhB,GAEZsd,CAA6C2qB,I,0ECMtDC,GAAc,CAChBC,Q,QAASC,EACTC,QAASC,KACTrkD,MAAOskD,KACPtK,KAAMuK,MA4CJC,GAAyC,CAC3CpnB,SAAU,SACVC,WAAY,UAgDD/E,iBA1FA,SAACC,GAAD,OAAkBC,aAC7B,CACIyhB,MAAO,CACHjhB,QAAST,EAAMrE,QAAQ,KAE3BgwB,QAAS,CACL73C,MAAOksB,EAAMmB,QAAQ15B,MAAM20C,aAC3Blc,gBAAiBntB,KAAM,MAE3BtL,MAAO,CACHqM,MAAOksB,EAAMmB,QAAQ15B,MAAM20C,aAC3Blc,gBAAiBF,EAAMmB,QAAQ15B,MAAMykD,MAEzCzK,KAAM,CACF3tC,MAAOksB,EAAMmB,QAAQ15B,MAAM20C,aAC3Blc,gBAAiBF,EAAMmB,QAAQhF,QAAQ+vB,MAE3CL,QAAS,CACL/3C,MAAOksB,EAAMmB,QAAQ15B,MAAM20C,aAC3Blc,gBAAiB1tB,KAAM,MAE3Bu4C,KAAM,CACFlhB,SAAU,IAEdsiB,YAAa,CACTnqC,QAAS,GACTsf,YAAatB,EAAMrE,QAAQ,IAE/B9sB,QAAS,CACLw0B,QAAS,OACTC,WAAY,cA4DTvD,EA5C+B,SAAC,GAAgD,IAA/CpD,EAA8C,EAA9CA,QAASgB,EAAqC,EAArCA,UAAW9uB,EAA0B,EAA1BA,QAASu9C,EAAiB,EAAjBA,YAEnEC,EAAc,WAChBD,EAAYv9C,EAAS5B,KAGzB,IAAK4B,EACD,OAAO,KAGX,IAAMy9C,EAAcZ,GAAY78C,EAAQyK,MAExC,OACI,eAACizC,GAAA,EAAD,CAEI5tB,MAAM,EACNiG,aAAcqnB,GACdO,iBAAkB,IAClB3tB,QAASwtB,EALb,SAMI,eAACI,GAAA,EAAD,CACI9uB,UAAWuG,KAAWvH,EAAQ9tB,EAAQyK,MAAOqkB,GAC7CyB,mBAAiB,kBACjBvwB,QACI,wBAAM5B,GAAG,kBAAkB0wB,UAAWhB,EAAQ9tB,QAA9C,UACQ,eAACy9C,EAAD,CAAa3uB,UAAWuG,KAAWvH,EAAQouB,KAAMpuB,EAAQwvB,eAC5Dt9C,EAAQV,QAGjB+2C,OAAQ,CACJ,eAAC/mB,GAAA,EAAD,CAEIgE,aAAW,QACXruB,MAAM,UACN6pB,UAAWhB,EAAQ+kB,MACnBhnC,QAAS2xC,EACTrwC,KAAK,QANT,SAOI,eAAC,KAAD,CAAW2hB,UAAWhB,EAAQouB,QAN1B,aAhBXl8C,EAAQyK,KAAO,IAAMzK,EAAQV,SC3ExCwyB,GAAqB,CACvByrB,YjESG,SAAqBM,GACxB,MAAO,CAACpzC,KAAMoY,GAAcg7B,eiEPjB5rB,gBAZS,SAACtd,GACrB,IAAImpC,EAAanpC,EAAMopC,gBAAgBD,WACvC,MAAO,CACHjmD,OAAQ8c,EAAMqF,aAAaniB,OAC3BmI,QAAS89C,EAAWvkD,OAAS,EAAIukD,EAAW,GAAK,QAQjBhsB,GAAzBG,CAA6C+rB,ICoC7CC,GA7C0D,SAAC,GAAgB,IAAfnzC,EAAc,EAAdA,SACjElF,EAAaH,GAAOiR,SAAS9Q,WACnC,IAAKA,EACD,OAAO,qCAAGkF,IAGd,IAkBMozC,EAAct7C,OAAOC,SAASK,OAEpC,OACQ,eAAC,GAAD,UACI,eAAC,gBAAD,2BACY0C,GADZ,IAEQu4C,cAAc,EACdC,MAAM,uBACNC,sBAAsB,EACtBC,aAAcJ,EACdK,yBAA0BL,EAC1BM,+BAAgCN,EAChCO,iBA9BS,SAACC,GAC1BpmD,QAAQs6C,KAAK,wBAAyB8L,GACtC97C,OAAO05C,QAAQqC,aACP,GACAn4C,SAAS5K,MACTgH,OAAOC,SAASG,WA0BR47C,aAtBK,WACrBtmD,QAAQs6C,KAAK,oBAEbhwC,OAAOC,SAASG,SAAW,KAUnB,SAWK8H,Q,0EC4ONomB,iBAhQA,SAACC,GAAD,OAAkBC,aAC7B,CACIoF,YAAa,CACT7E,WAAYR,EAAMrE,QAAQ,GAC1B2F,YAAatB,EAAMrE,QAAQ,GAC3BxhB,MAAO,KAEXuzC,UAAW,CACPltB,WAAYR,EAAMrE,QAAQ,GAC1B2F,YAAatB,EAAMrE,QAAQ,GAC3BxhB,MAAO,KAEXwzC,WAAY,CACRntB,WAAYR,EAAMrE,QAAQ,GAC1B2F,YAAatB,EAAMrE,QAAQ,GAC3BxhB,MAAO,KAEXssB,OAAQ,CACJtG,OAAQ,GAAMH,EAAMrE,QAAQ,QA8OzBoE,EAjOmC,SAAC,GAA6E,IAA5EpD,EAA2E,EAA3EA,QAASgC,EAAkE,EAAlEA,KAAMzG,EAA4D,EAA5DA,QAAS01B,EAAmD,EAAnDA,eAAgBxyB,EAAmC,EAAnCA,YAAayyB,EAAsB,EAAtBA,iBAC/FpwC,EAAMmtB,kBAAO,GADwG,EAE3FjJ,mBAASzJ,GAFkF,mBAEpH41B,EAFoH,KAE1GC,EAF0G,OAG7EpsB,mBAASisB,GAHoE,mBAGpHI,EAHoH,KAGnGC,EAHmG,OAIvFtsB,mBAAS,UAJ8E,mBAIpHusB,EAJoH,KAIxGC,EAJwG,KAM3HrsB,qBAAU,WACFrkB,EAAIwtB,UACJ8iB,EAAY71B,GACZ+1B,EAAmBL,IAEvBnwC,EAAIwtB,SAAU,IACf,CAAC/S,EAAS01B,IAEb,IA0GIQ,EASAC,EASAC,EAvEEC,EAAU,WACZnzB,EAAY,WAGVozB,EAAyB,WAC3B,IAAMloC,EAAmB0nC,EAAgB/gD,GACzC,OAAO6gD,EAASrnD,WAAU,SAAA8N,GAAM,OAAIA,EAAOtH,KAAOqZ,MAGhDmoC,EAAoB,SAACC,EAA6Bd,GACpD,IAAM11B,EAAO,YAAO41B,GACpB51B,EAAQw2B,GAAuBd,EAC/BG,EAAY71B,GACZ+1B,EAAmBL,GACnBO,EAAc,WAGZQ,EAAa,SAACz2B,EAA4B01B,GAC5CG,EAAY71B,GACZ+1B,EAAmBL,GACnBO,EAAc,WAGZS,EAAc,WAChB,IAAMhB,EAAc,2BAAOI,GAAP,IAAwB/gD,GAAI+D,MAC1CknB,EAAO,sBAAO41B,GAAP,CAAiBF,IAC9Be,EAAWz2B,EAAS01B,IAGlBiB,EAAe,WACjBJ,EAAkBD,IAAD,eAA+BR,KAG9Cc,EAAsB,WACxB,IAAMJ,EAAsBF,IAC5BC,EAAkBD,IAA0BV,EAASY,KAGnDK,EAAiB,WACnB,IAAM72B,EAAO,YAAO41B,GACpB,GAAI51B,EAAQ9vB,OAAS,EACjB,MAAM,IAAIzB,MAAM,iDAEpB,IAAM+nD,EAAsBF,IACtBZ,EAAiB11B,EAAQw2B,GAAuBA,EAAsB,GAAK,EAAI,IACrFx2B,EAAQ82B,OAAON,EAAqB,GACpCC,EAAWz2B,EAAS01B,IAGlBqB,EAAYnB,EAAS5kD,KAAI,SAACqL,EAAQvN,GAAT,OAC3B,eAAC83B,GAAA,EAAD,CAAsBx3B,MAAOiN,EAAOtH,GAApC,SAAyCsH,EAAOxM,MAAjCf,MA4FnB,OAvFIonD,EADe,QAAfF,EACehmD,EAAKgC,IAAI,OACF,SAAfgkD,EACQhmD,EAAKgC,IAAI,QAEThC,EAAKgC,IAAI,MAKxBmkD,EADe,QAAfH,EACchmD,EAAKgC,IAAI,cACD,SAAfgkD,EACOhmD,EAAKgC,IAAI,eAEThC,EAAKgC,IAAI,iBAKvBokD,EADe,QAAfJ,GAAuC,SAAfA,EAEpB,gBAAC5uB,GAAA,EAAD,CAAe4vB,UAAQ,EAAvB,UACI,eAACxlB,GAAA,EAAD,CACIrH,QAAQ,WACR8sB,UAAQ,EACRliD,GAAG,cACHxB,MAAM,OACNkyB,UAAWhB,EAAQ+wB,UACnBvtB,OAAO,SACP74B,MAAO0mD,EAAgBjmD,KACvBo+B,SA3Ge,SAAC1rB,GAC5B,IAAM20C,EAAqB30C,EAAMsB,OAAOzU,MAClCsmD,EAAc,2BAAOI,GAAP,IAAwBjmD,KAAMqnD,IAClDnB,EAAmBL,MAyGX,wBACA,eAAClkB,GAAA,EAAD,CACIrH,QAAQ,WACR8sB,UAAQ,EACRliD,GAAG,aACHxB,MAAM,MACNkyB,UAAWhB,EAAQgxB,WACnBxtB,OAAO,SACP74B,MAAO0mD,EAAgBjlD,IACvBo9B,SA/Gc,SAAC1rB,GAC3B,IAAM40C,EAAoB50C,EAAMsB,OAAOzU,MACjCsmD,EAAc,2BAAOI,GAAP,IAAwBjlD,IAAKsmD,IACjDpB,EAAmBL,SAiHf,eAACtuB,GAAA,EAAD,CAAe4vB,UAAQ,EAAvB,SACI,iCACI,gBAAC1pB,GAAA,EAAD,CAAanD,QAAQ,WAAW1E,UAAWhB,EAAQ0I,YAAnD,UACI,eAAC,KAAD,CAAYW,QAAQ,cAApB,kBACA,eAACE,GAAA,EAAD,CACI7D,QAAQ,WACR/6B,MAAO0mD,EAAgB/gD,GACvBk5B,SAvIG,SAAC1rB,GACxB,IAAM6L,EAAmB7L,EAAMsB,OAAOzU,MAChCsmD,EAAiBE,EAAS9gD,MAAK,SAAAuH,GAAM,OAAIA,EAAOtH,KAAOqZ,KAC7D2nC,EAAmBL,IAqIC0B,WAAY,CACRvnD,KAAM,cACNkF,GAAI,eANZ,SAQKgiD,IAEL,eAACM,GAAA,EAAD,UAAiBvB,EAAgBjlD,SAErC,eAACo1B,GAAA,EAAD,CACIR,UAAWhB,EAAQ8J,OACnBtE,aAAW,MACXruB,MAAM,UACN4G,QAlIE,WAClByzC,EAAc,QAkIEnyC,KAAK,QALT,SAMI,eAAC,KAAD,CAAS6tB,SAAS,YAEtB,eAAC1L,GAAA,EAAD,CACIR,UAAWhB,EAAQ8J,OACnBtE,aAAW,OACXznB,QArIG,WACnByzC,EAAc,SAqIEnyC,KAAK,QAJT,SAKI,eAAC,KAAD,CAAU6tB,SAAS,YAEvB,eAAC1L,GAAA,EAAD,CACIR,UAAWhB,EAAQ8J,OACnBtE,aAAW,SACX4E,SAAU+mB,EAAS1lD,OAAS,EAC5BsS,QAzIO,WACvBq0C,KAyIgB/yC,KAAK,QALT,SAMI,eAAC,KAAD,CAAY6tB,SAAS,iBAQrC,gBAAC7K,GAAA,EAAD,CACIL,KAAMA,EACNE,QAnLY,WAChB0vB,KAmLIpvB,kBAAgB,sBAHpB,UAKI,eAACE,GAAA,EAAD,CAAapyB,GAAG,sBAAhB,SAAuCohD,IACtCC,EACD,gBAAC/uB,GAAA,EAAD,WACI,eAACC,GAAA,EAAD,CAAQ9kB,QAjMC,WACE,WAAfwzC,EACAK,IAEAO,KA6LI,SAAgC5mD,EAAKgC,IAAI,YACzC,eAACs1B,GAAA,EAAD,CAAQ9kB,QA7ME,WACC,WAAfwzC,GACA9yB,EAAY,UACZyyB,EAAiBC,EAAUE,EAAgB/gD,KACrB,QAAfihD,EACPU,IACsB,SAAfV,GACPW,KAsMoCW,WAAS,EAAC17C,MAAM,UAAhD,SAA2Ds6C,aCrQrEztB,GAAqB,CACvBvF,eACAyyB,iBnEkZG,SAA0B31B,EAA4B5R,GACzD,OAAO,SAACyL,EAAyBC,GACzBA,IAAWnJ,aAAavC,mBAAqBA,GAC7CyL,EAjBD,CAACzY,KAAMye,KAkBNhG,EAASkG,GAAkBC,EAAS5R,IACpCyL,EAASoG,OACFnG,IAAWvO,UAAUM,cAAgBmU,GAC5CnG,EAASkG,GAAkBC,EAAS5R,OmEtZjCwa,gBAbS,SAACtd,GACrB,MAAO,CACHmb,OAAQnb,EAAMqF,aAAapB,WAAnB,OACRyQ,QAASpU,GAAoBN,GAC7BoqC,eAAgBv9B,GAAuB7M,MASPmd,GAAzBG,CAA6C2uB,I,qBCbtDzuB,GAAYC,cAAW,SAAAjB,GAAK,MAAK,CAC/B0vB,mBAAoB,CAChBhqB,aAAc1F,EAAMrE,QAAQ,IAEhCg0B,mBAAoB,CAChBzvB,iBAAyC,SAAvBF,EAAMmB,QAAQoR,KAAkBqd,KAAUC,MAAQ7vB,EAAMmB,QAAQygB,WAAWkO,MAAO,IACpGpqB,aAAc1F,EAAMrE,QAAQ,IAEhCo0B,kBAAmB,CACf5vB,OAAQ,OA2CL6vB,GAlC4C,SAAC,GAKtD,IAHEvlD,EAGH,EAHGA,MACAkP,EAEH,EAFGA,SAGEgjB,EAAUqE,KAEVivB,EAAaj2C,IAAMk2C,SAASxb,MAAM/6B,GAElCw2C,EAA+B,GAQrC,OAPAn2C,IAAMk2C,SAASppD,QAAQ6S,GAAU,SAACy2C,EAAwBppD,GACtDmpD,EAAUrlD,KAAKslD,GACXppD,EAAQipD,EAAa,GACrBE,EAAUrlD,KAAK,eAACuxB,GAAA,EAAD,CAAkCgG,QAAQ,YAAYkC,UAAU,MAAlD0rB,EAAajpD,OAK9C,gBAACy+B,GAAA,EAAD,WACKh7B,GAAmB,KAAVA,GACN,eAAC23B,GAAA,EAAD,CAAYC,QAAQ,QAAQ1E,UAAWhB,EAAQ+yB,mBAA/C,SACKjlD,IAGT,eAACqxB,GAAA,EAAD,CAAOC,UAAW,EAAG4B,UAAWhB,EAAQgzB,mBAAxC,SACI,eAAC3zB,GAAA,EAAD,CAAMuI,UAAU,MAAM8rB,OAAO,EAAM1yB,UAAWhB,EAAQozB,kBAAtD,SACKI,U,WCDNG,GA1C2C,SAAC,GAOrD,IAEEC,EAPA9kD,EAKH,EALGA,MACAnE,EAIH,EAJGA,MACAoT,EAGH,EAHGA,QACAf,EAEH,EAFGA,SAKCrS,IACDipD,EAAgB,CAAC7qB,aAAc,KAGnC,IAEI8qB,EAFEC,EAAgB,eAACv0B,GAAA,EAAD,CAAcC,QAAS1wB,EAAO2wB,UAAW90B,IAW/D,OARIqS,IACA62C,EACI,eAACE,GAAA,EAAD,UACK/2C,KAKPe,EAEE,gBAACuhB,GAAA,EAAD,CAAUve,MAAO6yC,EAAe9pB,QAAM,EAAC/rB,QAASA,EAAhD,UACK+1C,EACAD,KAMT,gBAACv0B,GAAA,EAAD,CAAUve,MAAO6yC,EAAjB,UACKE,EACAD,MCnBEG,GAjBqC,SAAC,GAO/C,IALEp5C,EAKH,EALGA,aACA+N,EAIH,EAJGA,SACAgW,EAGH,EAHGA,eACAyL,EAEH,EAFGA,SAGJ,OACI,eAACI,GAAA,EAAD,CACIC,UAAW9hB,EAAS/N,GACpB4uB,SAAU,kBAAM7K,EAAe,2BAAIhW,GAAL,mBAAgB/N,GAAgB+N,EAAS/N,OACvEwvB,SAAUA,K,qBCwBP6pB,GAjCmC,SAAC,GAQ7C,IANEr5C,EAMH,EANGA,aACA+N,EAKH,EALGA,SACAgW,EAIH,EAJGA,eACAltB,EAGH,EAHGA,QACA24B,EAEH,EAFGA,SAMJ,OACI,eAAC8pB,GAAA,EAAD,CACIC,KAAG,EACHxpD,MAAOge,EAAS/N,GAChB4uB,SAPa,SAAC1rB,EAA4CnT,GAC9Dg0B,EAAe,2BAAIhW,GAAL,mBAAgB/N,EAAejQ,MAG7C,SAMQ8G,EAAQlF,KAAI,mCAAEuC,EAAF,KAASnE,EAAT,YACR,eAAC4/B,GAAA,EAAD,CAEI5B,QAAS,eAACyrB,GAAA,EAAD,IACTzpD,MAAOA,EACPmE,MAAOA,EACPs7B,SAAUA,GAJLt7B,SCdvBu1B,GAAYC,cAAW,SAAAjB,GAAK,MAAK,CAC/B0tB,UAAW,CACPltB,WAAYR,EAAMrE,QAAQ,GAC1B2F,YAAatB,EAAMrE,QAAQ,GAC3BkO,SAAU7J,EAAMgxB,WAAWnnB,SAAW,GAE1ConB,aAAc,CACVzwB,WAAYR,EAAMrE,QAAQ,GAC1B2F,YAAatB,EAAMrE,QAAQ,GAC3BkO,SAAU7J,EAAMgxB,WAAWnnB,SAAW,EACtC1vB,MAAO6lB,EAAMrE,QAAQ,IAEzBu1B,aAAc,CACV/wB,OAAQ,QA4RLgxB,GAzQuC,SAAC,GAUO,IATHxyB,EASE,EATFA,KACAvD,EAQE,EARFA,YACA9V,EAOE,EAPFA,SACAsoC,EAME,EANFA,eACAtyB,EAKE,EALFA,eACAN,EAIE,EAJFA,aACArF,EAGE,EAHFA,WACAy7B,EAEE,EAFFA,cACAj/B,EACE,EADFA,WACE,EACLnY,IAAM2nB,SAAS,MADV,mBAClD0vB,EADkD,KAC9BC,EAD8B,OAEPt3C,IAAM2nB,SAAS,MAFR,mBAElD4vB,EAFkD,KAE/BC,EAF+B,OAGfx3C,IAAM2nB,SAASrc,EAASsB,cAAgB,IAHzB,mBAGlDA,EAHkD,KAGnC6qC,EAHmC,KAInD90B,EAAUqE,KAShB,GAPAhnB,IAAM8nB,WAAU,WACZ,IAAM4vB,EAAmB58C,SAAS8R,GAC7BpX,OAAOG,MAAM+hD,IAAqBA,IAAqBpsC,EAASsB,eACjE0U,EAAe,CAAC1U,cAAe8qC,MAEpC,CAAC9qC,EAAetB,EAAUgW,KAExBqD,EACD,OAAO,KAmBX,IAAIgzB,EAAkB,KAClB/yB,QAAQyyB,KACRM,EAAkBrrD,OAAOC,oBAAoB2B,EAAK1B,WAAW0C,KAAI,SAAA0oD,GAC7D,IAAMC,EAAW3pD,EAAK1B,UAAUorD,GAChC,OACI,eAAC9yB,GAAA,EAAD,CAEIyH,SAAUqrB,IAAetsC,EAAS5e,OAClCgU,QAAS,kBAAMsgB,EAAa42B,IAHhC,SAKI,eAAC11B,GAAA,EAAD,CAAcC,QAAS01B,KAJlBD,OAkBrB,IAAIE,EAAgD,KAChDlzB,QAAQ2yB,KACRO,EAAmB,GACnBxuC,GAAKxc,SAAQ,SAACirD,EAAoB56C,GAC9B26C,EAAkBhnD,KAAK,eAACknD,GAAA,EAAD,CAAuBC,eAAe,EAAtC,SAA6CF,EAAShqD,MAAlCoP,IAC3C46C,EAAS/mD,SAASlE,SAAQ,SAACorD,EAAsBpc,GAC7Cgc,EAAkBhnD,KACd,eAACg0B,GAAA,EAAD,CAEIyH,SAAUjhB,EAAS8C,aAAe8pC,EAAUzhC,SAC5C/V,QAAS,kBAAM4gB,EAAe,CAAClT,WAAY8pC,EAAUzhC,YAHzD,SAII,eAACyL,GAAA,EAAD,CAAcC,QAAS+1B,EAAUnqD,QAH5BoP,EAAI,IAAM2+B,WAkBnC,IAAIqc,EAAe7sC,EAAS8C,WAS5B,OARA9E,GAAKxc,SAAQ,SAACirD,GACVA,EAAS/mD,SAASlE,SAAQ,SAACorD,GACnBA,EAAUzhC,WAAanL,EAAS8C,aAChC+pC,EAAY,UAAMJ,EAAShqD,KAAf,cAAyBmqD,EAAUnqD,aAMvD,iCACI,gBAACi3B,GAAA,EAAD,CACIL,KAAMA,EACNyzB,WAAS,EACTlb,SAAU,KACVrY,QAjFZ,WACIzD,EAAY,aAiFJ6vB,OAAO,OALX,UAOI,eAAC5rB,GAAA,EAAD,UAAcn3B,EAAKgC,IAAI,cACvB,gBAACo1B,GAAA,EAAD,WAEI,gBAAC,GAAD,CAAe70B,MAAOvC,EAAKgC,IAAI,WAA/B,UACI,eAAC,GAAD,CACIuB,MAAOvD,EAAKgC,IAAI,UAChB5C,MAAOsmD,EAAe7lD,KACtB2S,QAvFxB,WACIib,EAAW,aAwFK,eAAC,GAAD,CACIlqB,MAAOvD,EAAKgC,IAAI,YAChB5C,MAAOY,EAAK1B,UAAU8e,EAAS5e,QAC/BgU,QAhExB,SAAgCD,GAC5B62C,EAAsB72C,EAAM2jB,kBAiEZ,eAAC,GAAD,CAAkB3yB,MAAOvD,EAAKgC,IAAI,+BAAlC,SACI,eAACw/B,GAAA,EAAD,CACIrH,QAAQ,WACRiF,QAAM,EACN3J,UAAWhB,EAAQ+wB,UACnBpmD,MAAOge,EAASqB,sBAChBwf,SAhG5B,SAA2C1rB,GACvC6gB,EAAe,CAAC3U,sBAAuB7R,SAAS2F,EAAMsB,OAAOzU,UAgGrC64B,OAAO,SANX,SAOKza,GAAyBxc,KAAI,SAAC5B,EAAO6P,GAAR,OAC1B,eAAC2nB,GAAA,EAAD,CAAkBx3B,MAAOA,EAAzB,SAAiCA,EAAQ,OAA1B6P,aAM/B,gBAAC,GAAD,CAAe1M,MAAOvC,EAAKgC,IAAI,eAA/B,UACI,eAAC,GAAD,CAAkBuB,MAAOvD,EAAKgC,IAAI,mCAChB5C,MAAO+qD,GAAS/sC,EAASuB,oBAD3C,SAEI,eAAC,GAAD,CACItP,aAAc,qBACd+N,SAAUA,EACVgW,eAAgBA,MAGxB,eAAC,GAAD,CAAkB7vB,MAAOvD,EAAKgC,IAAI,8BAChB5C,MAAO+qD,GAAS/sC,EAASwB,0BAD3C,SAEI,eAAC,GAAD,CACIvP,aAAc,2BACd+N,SAAUA,EACVgW,eAAgBA,MAGxB,eAAC,GAAD,CAAkB7vB,MAAOvD,EAAKgC,IAAI,mBAChB5C,MAAO+qD,GAAS/sC,EAASyB,yBAD3C,SAEI,eAAC,GAAD,CACIxP,aAAc,0BACd+N,SAAUA,EACVgW,eAAgBA,MAGxB,eAAC,GAAD,CAAkB7vB,MAAOvD,EAAKgC,IAAI,qDAChB5C,MAAO+qD,GAAS/sC,EAAS0B,sBAD3C,SAEI,eAAC,GAAD,CACIzP,aAAc,uBACd+N,SAAUA,EACVgW,eAAgBA,MAGxB,eAAC,GAAD,CAAkB7vB,MAAOvD,EAAKgC,IAAI,yDAAlC,SACI,eAACw/B,GAAA,EAAD,CACIrH,QAAQ,WACR1E,UAAWhB,EAAQs0B,aACnB3pD,MAAOsf,EACPuf,SA3I5B,SAAmC1rB,GAC/Bg3C,EAAiBh3C,EAAMsB,OAAOzU,QA2IN64B,OAAO,SACPnkB,KAAM,eAIlB,gBAAC,GAAD,CAAevR,MAAOvC,EAAKgC,IAAI,OAA/B,UACI,eAAC,GAAD,CACIuB,MAAOvD,EAAKgC,IAAI,YAChB5C,MAAO6qD,EACPz3C,QAvGxB,SAA+BD,GAC3B+2C,EAAqB/2C,EAAM2jB,kBAwGX,eAAC,GAAD,CAAkB3yB,MAAOvD,EAAKgC,IAAI,cAAlC,SACI,eAAC,GAAD,CACIqN,aAAc,gBACd+N,SAAUA,EACVgW,eAAgBA,EAChBltB,QAAS,CACL,CAAClG,EAAKgC,IAAI,cAAe0P,IACzB,CAAC1R,EAAKgC,IAAI,YAAa2P,SAInC,eAAC,GAAD,CAAkBpO,MAAOvD,EAAKgC,IAAI,mBAChB5C,MAAO+qD,GAAS/sC,EAAS4C,uBAD3C,SAEI,eAAC,GAAD,CACI3Q,aAAc,wBACd+N,SAAUA,EACVgW,eAAgBA,MAGxB,eAAC,GAAD,CAAkB7vB,MAAOvD,EAAKgC,IAAI,2BAChB5C,MAAO+qD,GAAS/sC,EAAS6C,uBAD3C,SAEI,eAAC,GAAD,CACI5Q,aAAc,wBACd+N,SAAUA,EACVgW,eAAgBA,SAK5B,eAAC,GAAD,CAAe7wB,MAAOvC,EAAKgC,IAAI,mBAA/B,SACI,eAACs1B,GAAA,EAAD,CACI9kB,QAAS,WACL4gB,EAAe,CAAC5T,uBAAuB,IACvCjW,OAAOC,SAASkhB,UAHxB,SAMK1qB,EAAKgC,IAAI,sBAIlB,gBAAC,GAAD,CAAeO,MAAOvC,EAAKgC,IAAI,sBAA/B,UACI,eAAC,GAAD,CACIuB,MAAK,uBAAkBvD,EAAKgC,IAAI,YAChC5C,MAAO8pD,IAEX,eAAC,GAAD,CACI3lD,MAAK,uBAAkBvD,EAAKgC,IAAI,YAChC5C,MAAO6qB,EAAaA,EAAWmgC,QAAQpqD,EAAKgC,IAAI,kCAMhE,eAACs0B,GAAA,EAAD,CACIC,SAAU4yB,EACV3yB,aAAW,EACXC,KAAMC,QAAQyyB,GACdxyB,QAxLZ,WACIyyB,EAAsB,OAmLlB,SAMKK,IAGL,eAACnzB,GAAA,EAAD,CACIC,SAAU8yB,EACV7yB,aAAW,EACXC,KAAMC,QAAQ2yB,GACd1yB,QAvKZ,WACI2yB,EAAqB,OAkKjB,SAMKM,QASXO,GAAW,SAAC7uC,GACd,OAAOA,EAAQtb,EAAKgC,IAAI,MAAMhC,EAAKgC,IAAI,QC/SrCy2B,GAAqB,CACvBvF,eACAE,kBACAN,gBACArF,eAGWmL,gBAlBS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAC3Bi4B,KAAMnb,EAAMqF,aAAapB,WAAnB,SACNnC,SAAU9B,EAAMqF,aAChB+kC,eAAgBv9B,GAAuB7M,GACvC4tC,cCfQ,eDgBRj/B,WAAY3O,EAAMC,UAAU0O,cAWIwO,GAAzBG,CAA6CqwB,IEdtDnwB,GAAYC,cAAW,SAAAjB,GAAK,MAAK,CAC/BuyB,mBAAoB,CAChB/xB,WAAYR,EAAMrE,QAAQ,GAC1B2F,YAAatB,EAAMrE,QAAQ,GAC3BkO,SAAU7J,EAAMgxB,WAAWnnB,SAAW,EACtCqN,SAAU,OAEdsb,kBAAmB,CACfhyB,WAAYR,EAAMrE,QAAQ,GAC1B2F,YAAatB,EAAMrE,QAAQ,GAC3BkO,SAAU7J,EAAMgxB,WAAWnnB,SAAW,OAoInC4oB,GAvHmC,SAAC,GAMO,IALH9zB,EAKE,EALFA,KACAvD,EAIE,EAJFA,YACA9V,EAGE,EAHFA,SACAgW,EAEE,EAFFA,eACAo3B,EACE,EADFA,mBAE7C/1B,EAAUqE,KAEV2xB,EAAoB,WACtBv3B,EAAY,WAgBhB,OACI,+BACI,gBAAC4D,GAAA,EAAD,CACIL,KAAMA,EACNyzB,WAAS,EACTlb,SAAU,KACVrY,QAAS8zB,EACT1H,OAAO,OALX,UAOI,eAAC3rB,GAAA,EAAD,UACI,gBAAC,GAAD,CAAe70B,MAAOvC,EAAKgC,IAAI,mBAA/B,UACI,eAAC,GAAD,CACIuB,MAAOvD,EAAKgC,IAAI,4BAA8B,WAC9C5C,MAAO+qD,GAAS/sC,EAAS+C,kBAF7B,SAII,eAAC,GAAD,CACI9Q,aAAc,mBACd+N,SAAUA,EACVgW,eAAgBA,MAGxB,eAAC,GAAD,CACI7vB,MAAOvD,EAAKgC,IAAI,kCADpB,SAGI,eAACw/B,GAAA,EAAD,CACIrH,QAAQ,WACR1E,UAAWhB,EAAQ41B,mBACnBjrD,MAAOge,EAASgD,0BAChB6d,SArC5B,SAA+B1rB,GAC3B6gB,EAAe,CAAChT,0BAA2B7N,EAAMsB,OAAOzU,SAqChCy/B,UAAWzhB,EAAS+C,iBACpB8X,OAAO,SACPnkB,KAAM,YAEd,eAAC,GAAD,CACIvQ,MAAOvD,EAAKgC,IAAI,uBAAyB,eACzC5C,MAAO+qD,GAAS/sC,EAASiD,cAF7B,SAII,eAAC,GAAD,CACIhR,aAAc,eACd+N,SAAUA,EACVgW,eAAgBA,MAGxB,eAAC,GAAD,CACI7vB,MAAOvD,EAAKgC,IAAI,kCAChB5C,MAAO+qD,GAAS/sC,EAASkD,0BAF7B,SAII,eAAC,GAAD,CACIjR,aAAc,2BACd+N,SAAUA,EACVgW,eAAgBA,EAChByL,UAAWzhB,EAASiD,iBAG5B,eAAC,GAAD,CACI9c,MAAOvD,EAAKgC,IAAI,kBAChB5C,MAAO+qD,GAAS/sC,EAASmD,kBAF7B,SAII,eAAC,GAAD,CACIlR,aAAc,mBACd+N,SAAUA,EACVgW,eAAgBA,MAGxB,eAAC,GAAD,CAAkB7vB,MAAOvD,EAAKgC,IAAI,aAAlC,SACI,eAACw/B,GAAA,EAAD,CACIrH,QAAQ,WACR1E,UAAWhB,EAAQ61B,kBACnBlrD,MAAOge,EAASoD,eAChByd,SAlF5B,SAA8B1rB,GAC1B6gB,EAAe,CAAC5S,eAAgBjO,EAAMsB,OAAOzU,SAkFrB64B,OAAO,SACPnkB,KAAM,iBAKtB,eAACujB,GAAA,EAAD,UACI,eAACC,GAAA,EAAD,CACI9kB,QAnFG,WACnBi4C,IACAD,KAkFgB5+C,MAAO,UACPizB,UAAWiF,GAAY1mB,GAH3B,SAKKpd,EAAKgC,IAAI,sBAc5BmoD,GAAW,SAAC7uC,GACd,OAAOA,EAAQtb,EAAKgC,IAAI,MAAQhC,EAAKgC,IAAI,QAWvC8hC,GAAc,SAAC1mB,GACjB,OAAQA,EAAS+C,kBAAoB/C,EAASiD,gBATzBmQ,EAUKpT,EAASoD,eAT5B,mBAAmBkqC,KAAKl6B,OAUnBpT,EAAS+C,mBANc,SADb3a,EAOoC4X,EAASgD,2BANlDhX,eAAgD,IAArB5D,EAAUtF,SADjC,IAACsF,EAJDgrB,GClJnBiI,GAAqB,CACvBvF,eACAE,kBACAo3B,mB5EufG,WACH,OAAO,SAAC3gC,EAA4CC,GAA8B,IAAD,EAQzEA,IAAWnJ,aANXR,EAFyE,EAEzEA,iBACAC,EAHyE,EAGzEA,0BACAC,EAJyE,EAIzEA,aACAC,EALyE,EAKzEA,yBACAC,EANyE,EAMzEA,iBACAC,EAPyE,EAOzEA,eAGAlQ,EAA4B,GAE5B6P,GAEA7P,EAAc,GACG+K,GAAiByO,KACzBlrB,SAAQ,SAAAoE,GACTA,EAAQsN,cACRA,EAAcA,EAAYF,OAAOpN,EAAQsN,iBAGjDA,EAAY1N,KAAK8Y,GAAuBoO,OACjCzJ,IAEP/P,EAAcmS,GAA4BqH,OAiEtD,SAAqBrO,EACAnL,EACApK,GAAyB,IAsBtCykD,EAOAC,EA1BAC,EAMA3kD,EANA2kD,kBACArlD,EAKAU,EALAV,UACAslD,EAIA5kD,EAJA4kD,cACAt6B,EAGAtqB,EAHAsqB,SACAu6B,EAEA7kD,EAFA6kD,mBACAC,EACA9kD,EADA8kD,IAI4B,SADhCxlD,EAAYA,GAAa,OACX4D,gBACV5D,EAAY,MAKhB,GAFAgrB,EAAWA,GAAY,UAElBq6B,IAAsBC,EACvB,OAKAH,EADAK,EACW,IAAIz6B,GAAJ,UAAmBC,EAAnB,SAEA,IAAII,GAKnB,GAAIi6B,EAAmB,CAAC,IAAD,EFtjBpB,SAAiCpvC,EACAnL,GAEpC,IAFgF,EAE1E26C,EAAe,IAAIj+B,IACnBk+B,EAAW,IAAIl+B,IACfm+B,EAA+B,GAJ2C,cAKpD1vC,GALoD,IAKhF,2BAA8C,CAAC,IAAD,EAArC0H,EAAqC,sBACnBA,EAAgBC,iBADG,yBACjCgM,EADiC,UAEiCA,EAAWzY,OAA3EhG,EAF+B,EAE/BA,QAAS/M,EAFsB,EAEtBA,UAAWqB,EAFW,EAEXA,aAAc4pB,EAFH,EAEGA,aAAcC,EAFjB,EAEiBA,aACvDo8B,EAASE,IAAIz6C,GACb,IAAM06C,EAAY,UAAMznD,EAAN,YAAmBqB,EAAnB,YAAmC4pB,GACrDo8B,EAAaG,IAAIC,GACjB,IAAIC,EAA8B,KAC9B50B,QAAQ5H,KACRw8B,EAAY,UAAM1nD,EAAN,YAAmBqB,EAAnB,YAAmC6pB,GAC/Cm8B,EAAaG,IAAIE,IAErBl8B,EAAWH,KAAKrwB,SAAQ,SAAAu2C,GACpB,IAAMhxB,EAAO8E,GAA2BksB,EAAMhxB,MACxConC,EAAc56C,EAAU,IAAMwT,EAC9BqnC,EAAeL,EAAcI,GAI/BJ,EAAcI,GAHbC,EAGD,2BAAiCA,GAAjC,mBAAgDH,EAAelW,EAAMtmB,KAFrE,cAA8Ble,UAASwT,QAAOknC,EAAelW,EAAMtmB,IAIlD,OAAjBy8B,IACAH,EAAcI,GAAaD,GAAiBnW,EAAMrmB,QApB9D,2BAAyD,IADf,gCALkC,8BAiChF,IAAM28B,EAAqB,CAAC,UAAW,QAAQr7C,OAAO3L,MAAMshB,KAAKklC,GAAcS,QACzEC,EAAsB,GAE5BvtD,OAAOwB,KAAKurD,GAAevsD,SAAQ,SAAA2sD,GAC/B,IAAMK,EAAUT,EAAcI,GACxBj/B,EAAU,IAAI7nB,MAAiBgnD,EAASvrD,QAC9CurD,EAAS7sD,SAAQ,SAACitD,EAAS58C,GACvBqd,EAAQrd,GAAK28C,EAAQC,MAEzBF,EAAS/oD,KAAK0pB,MAGlBq/B,EAASD,MAAK,SAACI,EAAMC,GACjB,IAAM3X,EAAgB0X,EAAK,GACrBzX,EAAgB0X,EAAK,GACrBC,EAAY5X,EAAM6X,cAAc5X,GACtC,GAAkB,IAAd2X,EACA,OAAOA,EAEX,IAAME,EAAmBJ,EAAK,GACxBK,EAAmBJ,EAAK,GAC9B,OAAOG,EAASD,cAAcE,MAGlC,IAAMC,EAA+C,GAKrD,OAJAlB,EAAStsD,SAAQ,SAAA+R,GACby7C,EAAiBz7C,GAAWG,GAAuBR,EAAaK,MAG7D,CAAC86C,WAAUE,WAAUS,oBEwfuBC,CAAwB5wC,EAAkBnL,GAAlFm7C,EADY,EACZA,SAAUE,EADE,EACFA,SAAUS,EADR,EACQA,iBACrBE,EAA8C,CAACC,QAAQ,EAAMC,QAAQ,GACrEC,EAAehB,EAAStqD,KAAKqE,GAC7BknD,EAAcf,EAAS3qD,KAAI,SAAA4nD,GAAG,OAAIA,EAAI5nD,KAAI,SAAA5B,GAAK,OAAIktD,SAAkBltD,GAASA,EAAQ,GAAG,MAAI+B,KAAKqE,MAClGmnD,EAAU,CAACF,GAAcr8C,OAAOs8C,GAAavrD,KAAK,MACxDwpD,EAASiC,MAAT,UAAkBp8B,EAAlB,QAAkCm8B,GAClC/B,EAAiBwB,OAEjBxB,EAAiB,GACjBt6C,EAAY1R,SAAQ,SAAAiQ,GACZA,EAAW4B,UACX5B,EAAW4B,SAAS7R,SAAQ,SAAAkQ,GACxB87C,EAAe97C,EAAM/J,IAAM+J,QAM3C,GAAIg8C,EACA,GAAIC,EAAoB,CACpB,IAAM8B,EAAa,CACfz7C,KAAM,oBACNX,SAAUrS,OAAOwB,KAAKgrD,GAAgB5pD,KAAI,SAAA2P,GAAO,OAAIi6C,EAAgBj6C,OAEzEg6C,EAASiC,MAAT,UAAkBp8B,EAAlB,YACI/nB,KAAKwU,UAAU4vC,EAAY,KAAM,SAErCzuD,OAAOwB,KAAKgrD,GAAgBhsD,SAAQ,SAAA+R,GAChCg6C,EAASiC,MAAT,UAAkBj8C,EAAlB,YACIlI,KAAKwU,UAAU2tC,EAAgBj6C,GAAU,KAAM,OAK/Dg6C,EAASnR,QAlILsT,CAAYhjC,IAAWvO,UAAUE,iBAC7BnL,EACA,CACIu6C,kBAAmB1qC,EACnB2qC,cAAezqC,EACf7a,UAAW4a,EACX2qC,mBAAoBzqC,EACpB0qC,IAAKzqC,EACLiQ,SAAUhQ,O4ExhBXoY,gBAdS,SAACtd,GACrB,MAAO,CACH9c,OAAQ8c,EAAMqF,aAAaniB,OAC3Bi4B,KAAMC,QAAQpb,EAAMqF,aAAapB,WAAnB,QACdnC,SAAU9B,EAAMqF,gBAUgB8X,GAAzBG,CAA6C2xB,I,0CCT/CwC,GAAwC,SAAC,GAShD,IAPExqD,EAOH,EAPGA,MACAyqD,EAMH,EANGA,OACAvtB,EAKH,EALGA,SACAZ,EAIH,EAJGA,SACAouB,EAGH,EAHGA,SACAx3B,EAEH,EAFGA,UAGEy3B,EAAYp7C,SAAsC,MAkBxD,OACI,uCACI,wBACIV,KAAK,OACL47C,OAAQA,EACRvtB,SAAUA,EACVlqB,IAAK23C,EACLC,QAAM,EACNlvB,SAxBa,SAACj2B,GACtB,GAAuB,OAAnBA,EAAE6L,OAAOjB,OAAkB5K,EAAE6L,OAAOjB,MAAM1S,OAAQ,CAElD,IADA,IAAM0S,EAAgB,GACb3D,EAAI,EAAGA,EAAIjH,EAAE6L,OAAOjB,MAAM1S,OAAQ+O,IACvC2D,EAAMhQ,KAAKoF,EAAE6L,OAAOjB,MAAM3D,IAE9Bg+C,EAASr6C,KAmBLisB,SAAUA,IAEd,eAACvH,GAAA,EAAD,CACI9kB,QAlBc,WACI,OAAtB06C,EAAUnqB,SACVmqB,EAAUnqB,QAAQqqB,SAiBdvuB,SAAUA,EACVpJ,UAAWA,EACX0E,QAAQ,WACRrmB,KAAK,QALT,SAOKvR,QCTF8qD,GArCmD,SAAC,GAM7D,IAJMnnD,EAIP,EAJOA,QACAonD,EAGP,EAHOA,cACA73B,EAEP,EAFOA,UAWR,OACQ,uBAAKA,UAAWA,EAAhB,UACI,eAAC+L,GAAA,EAAD,CACQj+B,MAAOvD,EAAKgC,IAAI,wBAChB5C,MAAO8G,EAAQyC,WACfs1B,SAbpB,SAAgCj2B,GAC5BslD,EAAc,CAAC3kD,WAAYX,EAAE6L,OAAOzU,SAapB0U,KAAK,QACLqmB,QAAQ,WACR3kB,MAAO,CAAC8lB,SAAU,EAAGlC,YAAa,MAE1C,eAACoI,GAAA,EAAD,CACQj+B,MAAOvD,EAAKgC,IAAI,mCAChB5C,MAAO8G,EAAQqC,YACf01B,SAjBpB,SAAwCj2B,GACpCslD,EAAc,CAAC/kD,YAAaP,EAAE6L,OAAOzU,SAiBrB0U,KAAK,QACLqmB,QAAQ,WACR3kB,MAAO,CAAC8lB,SAAU,SCX3BiyB,GAnB6C,SAAC,GAOvD,IALErnD,EAKH,EALGA,QACAonD,EAIH,EAJGA,cACAE,EAGH,EAHGA,WACAjqD,EAEH,EAFGA,MAGJ,OACI,eAACi+B,GAAA,EAAD,CACIj+B,MAAOvD,EAAKgC,IAAIuB,GAChBnE,MAAO8G,EAAQsnD,GACfvvB,SAAU,SAAAj2B,GAAC,OAAIslD,EAAc,gBAAEE,EAAaxlD,EAAE6L,OAAOzU,SACrD0U,KAAK,QACLqmB,QAAQ,cC6FLszB,GA5G2C,SAAC,GAMrD,IAJEvnD,EAIH,EAJGA,QACAonD,EAGH,EAHGA,cAGH,EAFG73B,UAIJ,OACI,iCACI,uBAAKjgB,MAAO,CAAC2lB,QAAS,OAAQuyB,IAAK,GAAI1wB,WAAY,GAAI2wB,oBAAqB,aAA5E,UACI,eAAC,GAAD,CACIH,WAAY,QACZjqD,MAAO,0BACP2C,QAASA,EACTonD,cAAeA,IAEnB,eAAC,GAAD,CACIE,WAAY,QACZjqD,MAAO,yBACP2C,QAASA,EACTonD,cAAeA,IAEnB,kCACI,eAAC3tB,GAAA,EAAD,CACIT,QAASh5B,EAAQkC,cACjB61B,SAAU,SAAAj2B,GAAC,OAAIslD,EAAc,CAACllD,cAAeJ,EAAE6L,OAAOqrB,WACtDprB,KAAK,UAET,gCAAO,2BAEX,eAAC,GAAD,CACI05C,WAAY,eACZjqD,MAAO,uBACP2C,QAASA,EACTonD,cAAeA,IAEnB,eAAC,GAAD,CACIE,WAAY,YACZjqD,MAAO,oBACP2C,QAASA,EACTonD,cAAeA,IAEnB,eAAC,GAAD,CACIE,WAAY,cACZjqD,MAAO,kCACP2C,QAASA,EACTonD,cAAeA,OAGvB,uBAAK93C,MAAO,CAAC2lB,QAAS,OAAQuyB,IAAK,GAAI1wB,WAAY,GAC/C2wB,oBAAqB,kBADzB,UAEI,eAAC,GAAD,CACIH,WAAY,YACZjqD,MAAO,sBACP2C,QAASA,EACTonD,cAAeA,IAEnB,eAAC,GAAD,CACIE,WAAY,UACZjqD,MAAO,oBACP2C,QAASA,EACTonD,cAAeA,IAEnB,eAAC,GAAD,CACIE,WAAY,QACZjqD,MAAO,kBACP2C,QAASA,EACTonD,cAAeA,IAEnB,eAAC,GAAD,CACIE,WAAY,SACZjqD,MAAO,mBACP2C,QAASA,EACTonD,cAAeA,IAEnB,yBACA,kCACI,eAAC3tB,GAAA,EAAD,CACIT,QAASh5B,EAAQN,KACjBq4B,SAAU,SAAAj2B,GAAC,OAAIslD,EAAc,CAAC1nD,KAAMoC,EAAE6L,OAAOqrB,WAC7CprB,KAAK,UAET,0DAEJ,eAAC,GAAD,CACI05C,WAAY,WACZjqD,MAAO,qBACP2C,QAASA,EACTonD,cAAeA,IAEnB,eAAC,GAAD,CACIE,WAAY,YACZjqD,MAAO,aACP2C,QAASA,EACTonD,cAAeA,IAEnB,eAAC,GAAD,CACIE,WAAY,aACZjqD,MAAO,cACP2C,QAASA,EACTonD,cAAeA,WChEpBM,GArC2C,SAAC,GAMrD,IAJM1nD,EAIP,EAJOA,QACAonD,EAGP,EAHOA,cACA73B,EAEP,EAFOA,UAWR,OACQ,uBAAKA,UAAWA,EAAhB,UACI,eAAC+L,GAAA,EAAD,CACQj+B,MAAOvD,EAAKgC,IAAI,SAChB5C,MAAO8G,EAAQ3C,MACf06B,SAbpB,SAA2Bj2B,GACvBslD,EAAc,CAAC/pD,MAAOyE,EAAE6L,OAAOzU,SAaf0U,KAAK,QACLqmB,QAAQ,WACR3kB,MAAO,CAAC8lB,SAAU,EAAGlC,YAAa,MAE1C,eAACoI,GAAA,EAAD,CACQj+B,MAAOvD,EAAKgC,IAAI,mCAChB5C,MAAO8G,EAAQqC,YACf01B,SAjBpB,SAAiCj2B,GAC7BslD,EAAc,CAAC/kD,YAAaP,EAAE6L,OAAOzU,SAiBrB0U,KAAK,QACLqmB,QAAQ,WACR3kB,MAAO,CAAC8lB,SAAU,SCpCpCuyB,GAAiB,CACnB,QACA,aACA,UACA,aACA,kBACA,eACA,sBACF7sD,KAAI,SAAAknB,GAAC,OAAIA,EAAEnoB,iBAGN,SAAS+tD,GAAiB7nD,GAE7B,GAAa,MADbA,EAAOA,EAAKL,QAER,MAAO,MAGX,GAAgB,MAAZK,EAAK,GACL,MAAO,UAGX,IAAM8nD,EAAS9nD,EAAKiD,OAAO,EAAG,IAAInJ,cAMlC,OALiB8tD,GAAe/oD,MAC5B,SAAAkpD,GAAQ,OAAID,EAAOrnD,WAAWsnD,KACtBD,EAAO7tD,SAAW8tD,EAAS9tD,QACxB,SAASwH,QAAQqmD,EAAOC,EAAS9tD,UAAY,MAGjD,MAGJ,MCFX,IAAM+tD,GAA8C,CAChD9uC,IAAI,2BAAKtX,GAAN,IAAiBqmD,QAAS,KAC7BhvC,QAAQ,2BAAK1W,GAAN,IAAqB0lD,QAAS,CAACnwD,kBACtCqhB,IAAI,2BAAKxW,GAAN,IAAiBslD,QAAS,MAK3Bp1B,GAAYC,cAAW,SAAAjB,GAAK,MAC9B,CACIq2B,OAAQ,CACJ7yB,SAAU,GAEd8yB,UAAW,CACPpxB,WAAYlF,EAAMrE,QAAQ,IAC1B0H,QAAS,OACTsX,cAAe,MACfrX,WAAY,UAEhBuX,aAAc,CACVvZ,YAAatB,EAAMrE,QAAQ,IAE/Bl0B,MAAO,CACHoiC,SAAU,aAsQP0sB,GAtP2C,SAAC,GAUhD,IARH53B,EAQE,EARFA,KACAvD,EAOE,EAPFA,YACAlU,EAME,EANFA,qBACAC,EAKE,EALFA,wBACAmU,EAIE,EAJFA,eACA/H,EAGE,EAHFA,sBACAijC,EAEE,EAFFA,mBACAh8B,EACE,EADFA,kBACE,EAEkBxgB,WAAe,IAFjC,mBAEC7L,EAFD,KAEOsoD,EAFP,OAGoBz8C,WAA8B,MAHlD,mBAGCvS,EAHD,KAGQivD,EAHR,OAIwB18C,YAAe,GAJvC,mBAIC28C,EAJD,KAIUC,EAJV,OAK0B58C,YAAe,GALzC,mBAKC68C,EALD,KAKWC,EALX,OAMmD98C,WAAekN,GANlE,mBAMC6vC,EAND,KAMwBC,EANxB,OAOyDh9C,WAAemN,GAPxE,mBAOC8vC,EAPD,KAO2BC,EAP3B,KAQAv6B,EAAUqE,KAUhB,GARAhnB,aAAgB,WACZg9C,EAAwB9vC,KACzB,CAACA,IAEJlN,aAAgB,WACZk9C,EAA2B/vC,KAC5B,CAACA,KAECwX,EACD,OAAO,KAGX,IAwFIw4B,EA9EE9K,EAAc,WAChB7xB,EAAkBg8B,GAClBp7B,EAAY,0BA2BVg8B,EAAkB,WACpBjwD,QAAQs6C,KAAK,SAAUtzC,IA2E3B,OAzBIgpD,EAD0B,QAA1BJ,EAEI,eAAC,GAAD,CACI3oD,QAAS6oD,EAAyB5vC,IAClCmuC,cAnCZ,SAA0BpnD,GACtB8oD,EAA2B,2BACpBD,GADmB,IAEtB5vC,IAAI,2BACG4vC,EAAyB5vC,KACzBjZ,OA+BHuvB,UAAWhB,EAAQ25B,YAGM,YAA1BS,EAEH,eAAC,GAAD,CACI3oD,QAAS6oD,EAAyB7vC,QAClCouC,cAjCZ,SAA8BpnD,GAC1B8oD,EAA2B,2BACpBD,GADmB,IAEtB7vC,QAAQ,2BACD6vC,EAAyB7vC,SACzBhZ,OA6BHuvB,UAAWhB,EAAQ25B,YAKvB,eAAC,GAAD,CACIloD,QAAS6oD,EAAyB3vC,IAClCkuC,cA/BZ,SAA0BpnD,GACtB8oD,EAA2B,2BACpBD,GADmB,IAEtB3vC,IAAI,2BACG2vC,EAAyB3vC,KACzBlZ,OA2BHuvB,UAAWhB,EAAQ25B,YAM3B,gBAACt3B,GAAA,EAAD,CACIozB,WAAS,EACTzzB,KAAMA,EACNE,QAASwtB,EACTltB,kBAAgB,sBAJpB,UAMI,eAACE,GAAA,EAAD,CAAapyB,GAAG,sBAAhB,SAAuC/E,EAAKgC,IAAI,gBAChD,gBAACo1B,GAAA,EAAD,CAAe4vB,UAAQ,EAAvB,UACI,gBAAC2B,GAAA,EAAD,CACIC,KAAG,EACHxpD,MAAOyvD,EACP5wB,SAAU,SAAAj2B,GAAC,OAzE3B,SAAgCA,GAC5B8mD,EAAwB9mD,EAAE6L,OAAOzU,OAwEN+vD,CAAuBnnD,IAH1C,UAKI,eAACg3B,GAAA,EAAD,CAEI5/B,MAAO,MACPmE,MAAOvD,EAAKgC,IAAI6F,EAAUhI,MAC1Bu9B,QAAS,eAACyrB,GAAA,EAAD,KAHJ,OAKT,eAAC7pB,GAAA,EAAD,CAEI5/B,MAAO,UACPmE,MAAOvD,EAAKgC,IAAIwG,EAAc3I,MAC9Bu9B,QAAS,eAACyrB,GAAA,EAAD,KAHJ,WAKT,eAAC7pB,GAAA,EAAD,CAEI5/B,MAAO,MACPmE,MAAOvD,EAAKgC,IAAI4G,EAAU/I,MAC1Bu9B,QAAS,eAACyrB,GAAA,EAAD,KAHJ,UAMb,eAAC,KAAD,CACI/wB,MAAO1rB,GAAOiR,SAAS/Q,SAASyxC,WAAa,QAC7CqR,YAAapvD,EAAKgC,IAAI,0CACtBslD,WAAS,EACTp1C,OAAO,QACP8rC,WAAYiQ,GAAQY,GAAuBX,QAC3C9uD,MAAO6G,EACPg4B,SAhHS,SAAC7+B,GACtB,IAAIksB,EAAaujC,EACJ,KAAT5oD,GAAe7G,EAAMc,OAAS,KAE9BorB,EAAawiC,GAAiB1uD,GAC9B0vD,EAAwBxjC,IAE5BijC,EAAQnvD,GACRovD,EAASP,GAAQ3iC,GAAYvjB,WAAW3I,KAyG5BsW,OAzHO,WACnB64C,EAAQ,KAyHIc,QAASH,EACTI,eAAgBJ,IAEnB3vD,GAAS,eAAC26B,GAAA,EAAD,CAAYtuB,MAAM,QAAQ6pB,UAAWhB,EAAQl1B,MAA7C,SAAqDA,IAC/D,uBAAKk2B,UAAWhB,EAAQ25B,UAAxB,UACI,eAAC,GAAD,CACI7rD,MAAOvC,EAAKgC,IAAI,aAAe,MAC/BgrD,OAAQiB,GAAQY,GAAuB/mD,QACvC23B,UAAU,EACVwtB,SAnJK,SAACsC,GACtB,IAAMt8C,EAAOs8C,EAAU,GACvBb,GAAW,GACX,IAAM7jB,EAAS,IAAIC,WACnBD,EAAOE,UAAY,WACf,IAAM9kC,EAAO4kC,EAAO/f,OACpBgkC,EAAwBhB,GAAiB7nD,IACzCsoD,EAAQtoD,GACRyoD,GAAW,IAEf7jB,EAAO2kB,QAAU3kB,EAAO4kB,QAAU,WAC9Bf,GAAW,IAEf7jB,EAAOG,WAAW/3B,EAAM,UAuIR4rB,SAAU4vB,EACVh5B,UAAWhB,EAAQke,eAEvB,eAACrb,GAAA,EAAD,CACI9kB,QA5JI,WACpB+7C,EAAQ,KA4JQ1vB,SAA0B,KAAhB54B,EAAKL,QAAiB6oD,EAChCh5B,UAAWhB,EAAQke,aACnBxY,QAAQ,WACRrmB,KAAK,QALT,SAOK9T,EAAKgC,IAAI,WAEd,eAACu7B,GAAA,EAAD,CAAK9H,UAAWhB,EAAQ05B,SACxB,eAAC72B,GAAA,EAAD,CACI9kB,QAAS,kBAAMo8C,GAAaD,IAC5Be,QAASf,EAAW,eAAC,KAAD,IAAkB,eAAC,KAAD,IACtCx0B,QAAQ,WACRrmB,KAAK,QAJT,SAMK9T,EAAKgC,IAAI,gBAGlB,eAAC26C,GAAA,EAAD,CAAUC,GAAI+R,EAAU9R,QAAQ,OAAOC,eAAa,EAApD,SACKmS,OAGT,gBAAC53B,GAAA,EAAD,WACI,eAACC,GAAA,EAAD,CACI9kB,QAAS2xC,EACThqB,QAAQ,OAFZ,SAIKn6B,EAAKgC,IAAI,YAEd,eAACs1B,GAAA,EAAD,CACI9kB,QAzMM,WAClB8f,EAAkB,UAClBY,EAAY,yBACZE,EAAe,CACXpU,qBAAsB6vC,EACtB5vC,wBAAyB8vC,IAE7B1jC,EAAsBplB,IAmMV44B,SAA0B,KAAhB54B,EAAKL,QAA2B,OAAVrG,GAAkBkvD,EAClD7iD,MAAM,UACNuuB,QAAQ,OAJZ,SAMKn6B,EAAKgC,IAAI,eCjUxBy2B,GAAqB,CACvBvF,eACAE,kBACAd,qBACAjH,0BAGWuN,gBAhBS,SAACtd,GACrB,MAAO,CACHmb,OAAQnb,EAAMqF,aAAapB,WAAnB,sBACRP,qBAAsB1D,EAAMqF,aAAa3B,qBACzCC,wBAAyB3D,EAAMqF,aAAa1B,wBAC5CqvC,mBAAoBhzC,EAAMqF,aAAajB,sBAWP+Y,GAAzBG,CAA6Cy1B,ICmE7Cz1B,gBA5CS,SAACtd,GACrB,MAAO,CACH3O,QAASP,GAAOiR,SAAS/Q,SAASK,WAIf,GAsCZisB,EAvBiB,SAAC,GAAe,IAAdjsB,EAAa,EAAbA,QAC9B,OACI,eAAC,GAAD,UACI,eAACgjD,GAAA,EAAD,CAAsBC,aAAW,EAAjC,SACI,gBAACC,GAAA,EAAD,CAAe/3B,MAjBRg4B,aACnBC,aAAa,CACTjH,WAAY,CACRnnB,SAAU,GACVquB,aAAc,IAElB/2B,QAAS,CACLoR,KAAMj+B,GAAOiR,SAAS/Q,SAASyxC,UAC/B9pB,QAAS7nB,GAAOiR,SAAS/Q,SAAS2jD,aAClC/7B,UAAW9nB,GAAOiR,SAAS/Q,SAAS4jD,mBAQhC,UACI,eAACC,GAAA,EAAD,KACExjD,GAAW,eAAC,GAAD,IACb,eAAC,GAAD,IACA,uCACI,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAAC,GAAD,iBCzCjB,SAASyjD,KACZ,IAAMC,E5FHH,WACH,IAAMj0C,EAAUH,GAAgB7P,GAAOiR,SAASxd,MAChD,GAAIuc,EACA,IACI,OAAOA,EAAQk0C,cAAc,cAAe,IAC9C,MAAOtoD,GACL/I,QAAQC,KAAR,uCAA6C8I,IAGrD,MAAO,G4FNkBuoD,GACnB10C,EAAc,CAAC,eACbzP,GAAOiR,SAAShR,SAOxB,OALAgkD,EAAiBzxD,SAAQ,SAAA4xD,GAChB30C,EAAY/W,MAAK,SAAA2rD,GAAU,OAAIA,EAAW1rD,KAAOyrD,EAAgBzrD,OAClE8W,EAAYjZ,KAAK4tD,MAGlB,CACHvmC,WAAY,KACZnnB,SAAU,GACVotB,UAAW,KACXzU,iBAAkB,GAClBE,eAAgB,CACZ5W,GAAI,OACJxC,MAAOvC,EAAKgC,IAAI,aAChBoP,KAAM,oBACNX,SAAU,IAEdoL,eCVD,SAAS60C,GAAYp1C,EAA8B0hC,GAItD,YAHchtC,IAAVsL,IACAA,EAAQ80C,MAEJpT,EAAO5rC,MACX,KAAKuY,GACD,OAAO,2BAAIrO,GAAX,IAAkB2O,WAAY+yB,EAAO/yB,aAEzC,KAAKW,GACD,OAAO,2BAAItP,GAAX,IAAkBxY,SAAUk6C,EAAOl6C,WAEvC,KAAKutB,GACD,IAAMsgC,EAAer1C,EAAMxY,SAASvE,WAAU,SAAAqyD,GAAE,OAAIA,EAAG7rD,KAAOi4C,EAAOp5C,aACrE,GAAI+sD,GAAgB,EAAG,CACnB,IAAI3tD,EAAUsY,EAAMxY,SAAS6tD,GACvBE,EAAgB7tD,EAAQkC,UAAU3G,WAAU,SAAAijB,GAAC,OAAIA,EAAE3hB,OAASm9C,EAAO/3C,gBACzE,GAAI4rD,GAAiB,EAAG,CACpB,IAAI1rD,EAAWnC,EAAQkC,UAAU2rD,GAC7B/tD,EAAWwY,EAAMxY,SAASqE,QAC1BjC,EAAYlC,EAAQkC,UAAUiC,QASlC,OARAjC,EAAU2rD,GAAV,2BACO1rD,GADP,IAEIyc,YAAao7B,EAAO91B,eAAe,GACnCrF,YAAam7B,EAAO91B,eAAe,GACnCnF,aAAci7B,EAAOj7B,aACrBjI,QAASkjC,EAAOljC,UAEpBhX,EAAS6tD,GAAT,2BAA6B3tD,GAA7B,IAAsCkC,cAC/B,2BAAIoW,GAAX,IAAkBxY,cAG1B,OAAOwY,EAEX,KAAK2P,GAMD,IAAMpc,EAAamuC,EAAOnuC,WACpB/L,EAAWwY,EAAMxY,SAAS9B,KAAI,SAAAgC,GAChC,GAAIA,EAAQsN,YAAa,CACrB,IAAMwgD,EAAkB9tD,EAAQsN,YAAY/R,WAAU,SAAAwyD,GAAE,OAAIA,EAAGhsD,KAAO8J,EAAW9J,MACjF,GAAI+rD,GAAmB,EAAG,CACtB,IAAMxgD,EAAW,YAAOtN,EAAQsN,aAEhC,OADAA,EAAYwgD,GAAmBjiD,EACxB,2BAAI7L,GAAX,IAAoBsN,iBAG5B,OAAOtN,KAEX,OAAO,2BAAIsY,GAAX,IAAkBxY,aAEtB,KAAKqoB,GAAiB,IACXpmB,EAA8Bi4C,EAA9Bj4C,GAAIxB,EAA0By5C,EAA1Bz5C,MAAOqI,EAAmBoxC,EAAnBpxC,MACZkD,EAAe,CACjBsC,KAAM,UACNrM,KACAoM,SAJiC6rC,EAAZ7rC,SAKrBvB,WAAY,CAACrM,QAAOqI,UAElB6E,EAAQ,sBAAO6K,EAAMK,eAAelL,UAA5B,CAAsC3B,IAC9C6M,EAAc,2BAAOL,EAAMK,gBAAb,IAA6BlL,aACjD,OAAO,2BACA6K,GADP,IAEIK,mBAGR,KAAKyP,GAAkB,IACZtI,EAAyBk6B,EAAzBl6B,OAAQ/C,EAAiBi9B,EAAjBj9B,cACf+C,EAAOlkB,SAAQ,SAAAkQ,GAAK,OAmFhC,SAA6BA,EAAciR,GACvC,GAAIU,GAAY0pB,UAAW,CACvB,IAAMA,EAAY1pB,GAAY0pB,UACxBxzB,EAASwzB,EAAU1zB,YACnByW,GAAU,IAAI7b,KAAkB2/C,YAAYliD,EAC9C,CACI4X,eAAgB,YAChBC,kBAAmB5G,IAG3BmnB,GAAgBha,GADDpe,EAAMc,YAAc,IAAIhE,OAAS,MAChBQ,GAAOiR,SAAS/Q,SAASib,oBACzD5Q,EAAO+yB,WAAWxc,GAClBid,EAAUR,WA/FkBsnB,CAAoBniD,EAAOiR,MACnD,IAAMtP,EAAQ,sBAAO6K,EAAMK,eAAelL,UAA5B,YAAyCqS,IACjDnH,EAAc,2BAAOL,EAAMK,gBAAb,IAA6BlL,aACjD,OAAO,2BACA6K,GADP,IAEIK,mBAGR,KAAKkS,GAAoB,IACd9oB,EAAMi4C,EAANj4C,GACDjG,EAAQwc,EAAMK,eAAelL,SAASlS,WAAU,SAAAgsC,GAAC,OAAIA,EAAExlC,KAAOA,KACpE,GAAIjG,GAAS,EAAG,CACZoyD,GAA0B,CAACnsD,IAC3B,IAAM0L,EAAQ,YAAO6K,EAAMK,eAAelL,UAC1CA,EAASq2C,OAAOhoD,EAAO,GACvB,IAAM6c,EAAc,2BAAOL,EAAMK,gBAAb,IAA6BlL,aAC3C2S,EAAkB+tC,GAAmB71C,EAAMG,iBAAkB,CAAC1W,IAChE0W,EAAmBH,EAAMG,iBAK7B,OAJA2H,EAAgBxkB,SAAQ,SAAA2kB,GACpB9H,EAAmB21C,GAAuB31C,EACA8H,EAAI,SAAU,aAErD,2BACAjI,GADP,IAEIK,iBACAF,qBAGR,OAAOH,EAEX,KAAKwS,GACD,IACMujC,EADa/1C,EAAMK,eAAelL,SACRzP,KAAI,SAAAupC,GAAC,OAAIA,EAAExlC,MAC3CmsD,GAA0BG,GAC1B,IAAM11C,EAAc,2BAAOL,EAAMK,gBAAb,IAA6BlL,SAAU,KACrD2S,EAAkB+tC,GAAmB71C,EAAMG,iBAAkB41C,GAC/D51C,EAAmBH,EAAMG,iBAK7B,OAJA2H,EAAgBxkB,SAAQ,SAAA2kB,GACpB9H,EAAmB21C,GAAuB31C,EACA8H,EAAI,SAAU,aAErD,2BACAjI,GADP,IAEIK,iBACAF,qBAGR,KAAK0U,GACD,OAAO,2BAAI7U,GAAX,IAAkB4U,UAAW8sB,EAAO9sB,YAExC,KAAKR,GAAqB,IACfN,EAAoC4tB,EAApC5tB,WAAYI,EAAwBwtB,EAAxBxtB,WAAYC,EAAYutB,EAAZvtB,SACzBhU,EAAmB21C,GAAuB91C,EAAMG,iBACN2T,EAAYI,EAAYC,GACxE,OAAIhU,IAAqBH,EAAMG,iBACpB,2BAAIH,GAAX,IAAkBG,qBAEfH,EAEX,KAAKsU,GACD,IAAI0hC,EAAWh2C,EAAMG,iBAAiBld,WAAU,SAAAgzD,GAAG,OAAIA,EAAIxsD,KAAOi4C,EAAOj4C,MACzE,GAAIusD,GAAY,EAAG,CACf,IAAM71C,EAAgB,YAAOH,EAAMG,kBAEnC,OADAA,EAAiBqrC,OAAOwK,EAAU,GAC3B,2BAAIh2C,GAAX,IAAkBG,qBAEtB,OAAOH,EAEX,KAAKuU,GACD,OAAO,2BAAIvU,GAAX,IAAkBG,iBAAkB,KAExC,KAAKqU,GACD,OAAIxU,EAAMO,cAAgBmhC,EAAOhtB,S7FtKtC,SAA0BnU,GAC7B,IAAMO,EAAUH,GAAgB7P,GAAOiR,SAASxd,MAChD,GAAIuc,EACA,IACIA,EAAQc,cAAc,cAAerB,GACvC,MAAO7T,GACL/I,QAAQC,KAAR,wCAA8C8I,K6FiK1CwpD,CAAiBxU,EAAOhtB,SACjB,2BAAI1U,GAAX,IAAkBO,YAAamhC,EAAOhtB,WAEnC1U,EAIf,OAAOA,EAmBX,SAAS41C,GAA0BG,GAC/B,GAAI5wC,GAAY0pB,UAAW,CACvB,IACMxzB,EADY8J,GAAY0pB,UACL1zB,YACzB46C,EAAazyD,SAAQ,SAAA+R,GACjB,IAAMuc,EAAUvW,EAAOyyB,eAAez4B,GAClCuc,GACAvW,EAAO86C,cAAcvkC,OAOrC,SAASkkC,GAAuB31C,EACA2T,EACAI,EACAC,GAC5B,IAEIiiC,EAFAC,EAAoBviC,EAGlBkiC,EAAW71C,EAAiBld,WAAU,SAAAgzD,GAAG,OAAIA,EAAIriC,gBAAkByiC,EAAkBh7C,OAAOuY,iBAClG,GAAIoiC,GAAY,EAAG,CACf,IAKIM,EALEzuC,EAAkB1H,EAAiB61C,GACnCluC,EAAkBD,EAAgBC,gBAClCyuC,EAAUzuC,EAAgB7kB,WAAU,SAAAglB,GAAE,OAAIA,EAAG5M,OAAO/S,YAAc+tD,EAAkBh7C,OAAO/S,WAC9C2f,EAAG5M,OAAO1R,eAAiB0sD,EAAkBh7C,OAAO1R,cACpDse,EAAG5M,OAAOhG,UAAYghD,EAAkBh7C,OAAOhG,WAElG,GAAIkhD,GAAW,EAAG,CACd,IAAMC,EAAgB1uC,EAAgByuC,GACrB,WAAbpiC,IACAkiC,EAAiB,2BACVA,GADU,IAEb1iC,KAAK,GAAD,mBAAM0iC,EAAkB1iC,MAAxB,YAAiC6iC,EAAc7iC,UAGxC,YAAfO,EACAoiC,EAAqB,CAACD,GACA,QAAfniC,GACPoiC,EAAqBxuC,EAAgBjc,SAClB0qD,GAAWF,GAE9BC,EAAqBxuC,EAAgBjc,SAClB2/C,OAAO+K,EAAS,QAInCD,EADe,YAAfpiC,EACqB,CAACmiC,GACA,QAAfniC,EACW,CAAImiC,GAAJ,mBAA0BvuC,IAGvBA,EAGV,YAAfoM,EACAkiC,EAAsB,CAAC,2BAAIvuC,GAAL,IAAsBC,gBAAiBwuC,KACvC,QAAfpiC,GAIHoiC,EAAmB1xD,QAAU,GAHjCwxD,EAAsBj2C,EAAiBtU,SACnBmqD,GAApB,2BAAoCnuC,GAApC,IAAqDC,gBAAiBwuC,KAMlEF,EAAsBj2C,EAAiBtU,SACnB2/C,OAAOwK,EAAU,OAG1C,CACH,GAAmB,YAAf9hC,EAMAkiC,EAAsB,CALK,CACvB3sD,GAAI+D,IACJomB,cAAeyiC,EAAkBh7C,OAAOuY,cACxC9L,gBAAiB,CAACuuC,UAGnB,GAAmB,QAAfniC,EAAsB,CAM7BkiC,EAAmB,CALQ,CACvB3sD,GAAI+D,IACJomB,cAAeyiC,EAAkBh7C,OAAOuY,cACxC9L,gBAAiB,CAACuuC,KAEH,mBAA2Bl2C,SAG9Ci2C,EAAsBj2C,EAI9B,OAAOi2C,EAIX,SAASP,GAAmB11C,EAAqCyvC,GAC7D,IAAM9nC,EAAgC,GAUtC,OATA3H,EAAiB7c,SAAQ,SAAA2yD,GACrBA,EAAInuC,gBAAgBxkB,SAAQ,SAAA2kB,GACxB2nC,EAAStsD,SAAQ,SAAA+R,GACT4S,EAAG5M,OAAOhG,UAAYA,GACtByS,EAAgBxgB,KAAK2gB,YAK9BH,ECzPJ,SAAS2uC,GAAez2C,EACA0hC,EACAgV,GAI3B,YAHchiD,IAAVsL,IACAA,EAAQmC,MAEJu/B,EAAO5rC,MACX,KAAK+hB,GACD,IAAM/V,EAAQ,2BAAO9B,GAAU0hC,EAAO5/B,UAEtC,OADAD,GAAkBC,GACXA,EAEX,KAAKwN,GACD,IAAI/lB,EAAoByW,EAAOzW,mBAAqBoH,GAAUjK,IAAI,WAC9Dgc,EAAuB1C,EAAO0C,sBAAwB/R,GAAUjK,IAAI,YACpEyd,EAAiBnE,EAAOmE,eACxB46B,EAAkBz1C,EAAYo4C,EAAOl6C,SAAU+B,GAC7CmpB,EAAoBqsB,GACfr1C,EAAoBq1C,EAAiBr8B,IACzC,KAmBP,OAlBIq8B,EACKrsB,IACDhQ,EAAuBq8B,EAAgBn1C,UAAUhF,OAASm6C,EAAgBn1C,UAAU,GAAGrF,KAAO,OAGlGgF,EAAoB,KACpBmZ,EAAuB,MACvBq8B,EAAkB2C,EAAOl6C,SAAS5C,OAAS88C,EAAOl6C,SAAS,GAAK,QAE5D+B,EAAoBw1C,EAAgBt1C,GAChCs1C,EAAgBn1C,UAAUhF,OAAS,IACnC8d,EAAuBq8B,EAAgBn1C,UAAU,GAAGrF,QAI3DgF,IACD4a,EAAiB,UAEd,2BAAInE,GAAX,IAAkBzW,oBAAmBmZ,uBAAsByB,mBAE/D,KAAKsR,GACD,IAAI/S,EAAuB1C,EAAM0C,qBAC3Bq8B,EAAkBz1C,EAAYo4C,EAAOl6C,SAAUk6C,EAAOn4C,oBACnCG,EAAoBq1C,EAAiBr8B,IACrCq8B,EAAgBn1C,UAAUhF,OAAS,IACxD8d,EAAuBq8B,EAAgBn1C,UAAU,GAAGrF,MAExD,IAAMgF,EAAoBm4C,EAAOn4C,kBAC3ByZ,EAAoBjZ,EAAoBg1C,GACxCh8B,EAAeC,EAAoBA,EAAkB,GAAK,KAChE,OAAO,2BACAhD,GADP,IAEIzW,oBACAmZ,uBACAM,oBACAD,iBAGR,KAAKgT,GACD,IAAMnd,EAAYuM,GAAYu8B,EAAO1rB,OAC/B2gC,EAAYjV,EAAOxzC,SACzB,GAAI0K,aAAqBC,MAAuB,OAAd89C,EAAoB,CAClD,IAEIC,EAFElxD,EAAMkT,EACNO,EAAazT,EAAIyS,UAAU+yB,gBAG7B/hC,MAAMC,QAAQutD,IAEdC,EAAcC,aAAsBF,EAAWvgD,GAAgB+C,GAC/DzT,EAAIyS,UAAU2+C,IAAIF,EAAa,CAACp+C,KAAM9S,EAAIqxD,aAIZ,WAD9BH,EAAcD,EAAUjrB,UAAUt1B,GAAgB+C,IAClC69C,UAEZtxD,EAAIyS,UAAU8+C,UAAUL,EAAYM,sBAGpCxxD,EAAIyS,UAAU2+C,IAAIF,EAAa,CAACp+C,KAAM9S,EAAIqxD,YAItD,OAAI/2C,EAAM+D,QAAU29B,EAAOxzC,SAChB,2BACA8R,GADP,IAEI+D,MAAO29B,EAAOxzC,WAGf8R,EAEX,KAAKiW,GACD,IAAMtT,EAAwB++B,EAAO/+B,sBAErC,OAAO,2BACA3C,GADP,IAEI2C,wBACAC,gBAJoB,OAO5B,KAAKwT,GACD,IAAMxT,EAAkB8+B,EAAO9+B,gBAC/B,OAAO,2BACA5C,GADP,IAEI4C,oBAGR,KAAK2T,GACD,OAAO,2BACAvW,GADP,IAEI0C,qBAAsBg/B,EAAOh/B,uBAGrC,KAAK4T,GACD,OAAO,2BACAtW,GADP,IAEIqE,aAAcq9B,EAAOr9B,eAG7B,KAAKmS,GAAc,IACVzT,EAAgB2+B,EAAhB3+B,aACL,GAAqB,OAAjBA,GAAyB2zC,EAAU,CACnC,IAAM5uD,EAAkB6gB,GAAwB+tC,GAC1ClzD,EAAQsE,EAAkBwX,GAAiBxX,EAAiBib,IAAiB,EAC/Evf,GAAS,IACTuf,EAAejb,EAAgBtE,IAGvC,OAAIwc,EAAM+C,eAAiBA,EAChB,2BACA/C,GADP,IAEI+C,iBAGD/C,EAEX,KAAK0W,GACD,GAAIggC,EAAU,CACV,IAAIlzD,EAAQolB,GAA0B8tC,GACtC,GAAIlzD,GAAS,EAAG,CACZ,IAAMsE,EAAkB6gB,GAAwB+tC,IAChDlzD,GAASk+C,EAAOtZ,WACJ,IACR5kC,EAAQsE,EAAgBlD,OAAS,GAEjCpB,EAAQsE,EAAgBlD,OAAS,IACjCpB,EAAQ,GAEZ,IAAIuf,EAAejb,EAAgBtE,GAC/Bwf,EAAoBhD,EAAMgD,kBAS9B,GAR0B,OAAtBA,IACID,EAAeC,EAAkB,KACjCD,EAAeC,EAAkB,IAEjCD,EAAeC,EAAkB,KACjCD,EAAeC,EAAkB,KAGrChD,EAAM+C,eAAiBA,EACvB,OAAO,2BACA/C,GADP,IAEI+C,kBAKhB,OAAO/C,EAEX,KAAK2W,GACD,OAAO,2BACA3W,GADP,IAEIgD,kBAAmB0+B,EAAO1+B,oBAGlC,KAAK6T,GACD,OAAO,2BACA7W,GADP,IAEIiD,qBAAsBy+B,EAAOz+B,uBAGrC,KAAK6T,GACD,OAAO,2BACA9W,GADP,IAEIkD,oBAAqBw+B,EAAOx+B,oBAC5BC,sBAAuBu+B,EAAOv+B,wBAGtC,KAAK0M,GACD,OAAI6xB,EAAOtvB,YACAA,GAAYpS,EAAO0hC,EAAOj4C,IAE9BuW,EAEX,KAAK8P,GACD,OAAI4xB,EAAOtvB,aAAesvB,EAAOl6B,OAAO5iB,OAC7BwtB,GAAYpS,EAAO0hC,EAAOl6B,OAAO,GAAG/d,IAExCuW,EAEX,KAAKuS,GAAoB,IACd9oB,EAAci4C,EAAdj4C,GAAI+d,EAAUk6B,EAAVl6B,OACX,GAAI/d,IAAOuW,EAAM4C,gBAAiB,CAC9B,IAAIA,EAAkB,KAChBpf,EAAQgkB,EAAOvkB,WAAU,SAAAgsC,GAAC,OAAIA,EAAExlC,KAAOA,KAQ7C,OAPIjG,GAAS,IACLA,EAAQgkB,EAAO5iB,OAAS,EACxBge,EAAkB4E,EAAOhkB,EAAQ,GAAGiG,GAC7BjG,EAAQ,IACfof,EAAkB4E,EAAOhkB,EAAQ,GAAGiG,KAGrC,2BACAuW,GADP,IAEI4C,oBAGR,OAAO5C,EAEX,KAAK+W,GACD,IAAIogC,EAAQ,2BACLn3C,GADK,IAERmE,eAAgBu9B,EAAOv9B,eACvBC,mBAAoBpE,EAAMmE,iBAW9B,MAT8B,aAA1Bu9B,EAAOv9B,iBACPgzC,EAAQ,2BACDA,GADC,IAEJlzC,WAAW,2BACJjE,EAAMiE,YADH,IAEN8L,uBAAuB,OAI5BonC,EAEX,KAAKlgC,GAMD,OADApV,GAJA7B,EAAK,2BACEA,GADF,IAEDsE,aAAco9B,EAAOp9B,gBAGlBtE,EAEX,KAAKmX,GACD,IAAM5S,EAAqB,eAAOvE,EAAMuE,uBASxC,OARAzhB,OAAOC,oBAAoBwhB,GAAuBjhB,SAAQ,SAAAoJ,GACtD6X,EAAsB7X,GAAtB,2BAA+B6X,EAAsB7X,IAArD,IAAyD4R,QAASojC,EAAO0B,gBAAgBt9C,SAAS4G,QAMtGmV,GAJA7B,EAAK,2BACEA,GADF,IAEDuE,2BAGGvE,EAEX,KAAKoX,GAYD,OADAvV,GAVA7B,EAAK,2BACEA,GADF,IAEDuE,sBAAsB,2BACfvE,EAAMuE,uBADQ,mBAEhBm9B,EAAOpC,YAFS,2BAGVt/B,EAAMuE,sBAAsBm9B,EAAOpC,cAHzB,IAIb96B,SAAUk9B,EAAOl9B,gBAKtBxE,EAEX,KAAKqX,GACD,OAAO,2BACArX,GADP,IAEIgE,WAAW,2BAAKhE,EAAMgE,YAAZ,mBAAyB09B,EAAOj4C,GAAKi4C,EAAOr2C,YAG9D,KAAKisB,GACD,IAAMtT,EAAU,eAAOhE,EAAMgE,YAE7B,cADOA,EAAW09B,EAAOj4C,IAClB,2BACAuW,GADP,IAEIgE,eAGR,KAAKuT,GACD,IAAMr0B,EAASw+C,EAAOx+C,OAMtB,OALAwB,EAAKxB,OAASA,EACVA,IAAW8c,EAAM9c,QAEjB2e,GADA7B,EAAK,2BAAOA,GAAP,IAAc9c,YAGhB8c,EAEX,KAAKyX,GACD,IAAMC,EAAWgqB,EAAOhqB,SACxB,OAAO,2BACA1X,GADP,IAEIiE,WAAW,2BAAKjE,EAAMiE,YAAZ,mBAAyByT,GAAW,MAGtD,KAAKC,GACD,IAAMD,EAAWgqB,EAAOhqB,SACxB,OAAO,2BACA1X,GADP,IAEIiE,WAAW,2BAAKjE,EAAMiE,YAAZ,mBAAyByT,GAAW,MAGtD,KAAKlD,GACD,GAAIxU,EAAM8C,mBAAqB4+B,EAAO5+B,iBAClC,OAAO,2BAAI9C,GAAX,IAAkB8C,iBAAkB4+B,EAAO5+B,mBAIvD,OAAO9C,EAGX,SAASoS,GAAYpS,EAAqB4C,GACtC,IAAID,EAQJ,OAJIA,EAHC3C,EAAM2C,uBAAgE,IAAvC3C,EAAM2C,sBAAsB/d,OAErDob,EAAM2C,sBAAsBnZ,MAAK,SAAAC,GAAE,MAAW,SAAPA,KACtBuW,EAAM2C,sBAET,sBAAO3C,EAAM2C,uBAAb,CAAoC,SAJjC,CAAC,QAMtB,2BACA3C,GADP,IAEI2C,wBACAC,oBCzXR,IAAIw0C,GAAc,EAEX,SAASC,GAAkBr3C,EAAoC0hC,QACpDhtC,IAAVsL,IACAA,ECMG,CACHmpC,WAAY,GACZmO,WAAY,KDNhB,IAAMC,EAAuBv3C,EAAMmpC,WACnC,OAAQzH,EAAO5rC,MACX,KAAKgY,GACD,IAAMhY,EAAO4rC,EAAO1zB,YACdrjB,EAAO+2C,EAAOzzB,YAChBupC,EAAcD,EAAqB3yD,OAAS2yD,EAAqB,GAAK,KAC1E,OAAIC,GAAe1hD,IAAS0hD,EAAY1hD,MAAQnL,IAAS6sD,EAAY7sD,KAC1DqV,GAEXw3C,EAAc,CAAC/tD,KAAM2tD,GAAathD,OAAMnL,QACjC,2BAAIqV,GAAX,IAAkBmpC,WAAW,CAAEqO,GAAH,mBAAmBD,OAEnD,KAAKrpC,GACD,IAAMva,EAAI4jD,EAAqBt0D,WAAU,SAAAyJ,GAAC,OAAIA,EAAEjD,KAAOi4C,EAAOwH,aAC9D,GAAIv1C,GAAK,EAAG,CACR,IAAM8jD,EAAcF,EAAqB5jD,GACnCw1C,EAAU,YAAOoO,GACvBpO,EAAWqC,OAAO73C,EAAG,GACrB,IAAM2jD,EAAU,CAAIG,GAAJ,mBAAoBz3C,EAAMs3C,aAC1C,OAAO,2BAAIt3C,GAAX,IAAkBmpC,aAAYmO,gBAI1C,OAAOt3C,EE7BJ,SAAS03C,GAAgB13C,EAAkC0hC,GAI9D,YAHchtC,IAAVsL,IACAA,ECDG,CACH5a,YAAa,ODETs8C,EAAO5rC,MACX,KAAKonB,GACD,OAAO,2BACAld,GADP,IAEI5a,YAAas8C,EAAOt8C,cAGhC,OAAO4a,EEAJ,SAAS23C,GAAW33C,EACA0hC,GAKvB,MAAO,CACHzhC,UAAWm1C,GAAYp1C,GAASA,EAAMC,UAAWyhC,GACjDr8B,aAAcoxC,GAAez2C,GAASA,EAAMqF,aAAcq8B,EAAQ1hC,GAClEopC,gBAAiBiO,GAAkBr3C,GAASA,EAAMopC,gBAAiB1H,GACnEvyB,cAAeuoC,GAAgB13C,GAASA,EAAMmP,cAAeuyB,ICbjDtmB,QACW,cAA7BntB,OAAOC,SAAS0pD,UAEe,UAA7B3pD,OAAOC,SAAS0pD,UAEhB3pD,OAAOC,SAAS0pD,SAASC,MACvB,2DCFN/mD,GAAOgnD,OAAO3xD,MAAK,WACf,IAAM4xD,EAASC,eAAyB,CAACC,WAAW,EAAMC,MAAM,IAC1DC,EAAQC,IAAkBT,GAAYS,IAAsBC,IAAON,IAEzEI,EAAM5pC,SAASiJ,GAAa2gC,EAAM3pC,WAAWnJ,aAAaniB,SAEtDi1D,EAAM3pC,WAAWnJ,aAAanB,uBAC9Bi0C,EAAM5pC,SAASoG,MAGnB2jC,SACI,eAAC,IAAD,CAAUH,MAAOA,EAAjB,SAAyB,eAAC,GAAD,MACzBtmD,SAAS0mD,eAAe,SD+G1B,kBAAmB5zD,WACrBA,UAAU6zD,cAAcC,MAAMtyD,MAAK,SAAAuyD,GACjCA,EAAaC,qB","file":"static/js/main.e0d7476d.chunk.js","sourcesContent":["/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nexport type LanguageDictionaryEntry = { [locale: string]: string };\r\n\r\nexport interface LanguageDictionaryJson {\r\n    languages: LanguageDictionaryEntry;\r\n    dictionary: LanguageDictionaryEntry[];\r\n}\r\n\r\ntype LanguageDictionaryContent = { [key: string]: LanguageDictionaryEntry };\r\n\r\nexport interface WithLocale {\r\n    locale?: string;\r\n}\r\n\r\nexport class LanguageDictionary {\r\n    private readonly _languages: LanguageDictionaryEntry;\r\n    private readonly _content: LanguageDictionaryContent;\r\n    private _locale: string;\r\n\r\n    constructor(json: LanguageDictionaryJson) {\r\n\r\n        const locales = Object.getOwnPropertyNames(json.languages);\r\n        if (locales.findIndex(locale => locale === \"en\") < 0) {\r\n            throw new Error(`Internal error: locale \"en\" must be included in supported languages`)\r\n        }\r\n\r\n        const content: any = {};\r\n        json.dictionary.forEach((entry, index) => {\r\n            locales.forEach(locale => {\r\n                if (!entry[locale]) {\r\n                    throw new Error(`Internal error: invalid entry at index ${index} in \"./resources/lang.json\":` +\r\n                                    ` missing translation for locale: \"${locale}\": ${entry}`)\r\n                }\r\n            });\r\n            const phraseKey = getPhraseKey(entry[\"en\"]);\r\n            if (content[phraseKey]) {\r\n                console.warn(`Translation already defined for \"${entry[\"en\"]}\".`);\r\n            }\r\n            content[phraseKey] = entry;\r\n        });\r\n\r\n        this._languages = json.languages;\r\n        this._content = content;\r\n        this._locale = \"en\";\r\n    }\r\n\r\n    get languages(): LanguageDictionaryEntry {\r\n        return this._languages;\r\n    }\r\n\r\n    get locale(): string {\r\n        return this._locale;\r\n    }\r\n\r\n    set locale(value: string) {\r\n        const locales = Object.getOwnPropertyNames(this._languages);\r\n        if (locales.findIndex(locale => locale === value) < 0) {\r\n            const baseValue = value.split(\"-\")[0];\r\n            if (locales.findIndex(locale => locale === baseValue) < 0) {\r\n                console.error(`No translation found for locale \"${value}\", staying with \"${this._locale}\".`);\r\n                return;\r\n            } else {\r\n                console.warn(`No translation found for locale \"${value}\", falling back to \"${baseValue}\".`);\r\n                value = baseValue;\r\n            }\r\n        }\r\n\r\n        this._locale = value;\r\n    }\r\n\r\n    get(phrase: string, values?: { [name: string]: any }): string {\r\n        const key = getPhraseKey(phrase);\r\n        const entry = this._content[key];\r\n        let translatedPhrase: string;\r\n        if (!entry) {\r\n            console.warn(`missing translation for phrase \"${phrase}\"`);\r\n            translatedPhrase = phrase;\r\n        } else {\r\n            translatedPhrase = entry[this._locale];\r\n            if (!translatedPhrase) {\r\n                console.warn(`missing translation of phrase \"${phrase}\" for locale \"${this._locale}\"`);\r\n                translatedPhrase = phrase;\r\n            }\r\n        }\r\n        if (values) {\r\n            Object.keys(values).forEach(name => {\r\n                translatedPhrase = translatedPhrase.replace(\"${\" + name + \"}\", `${values[name]}`)\r\n            });\r\n        }\r\n        return translatedPhrase;\r\n    }\r\n}\r\n\r\nexport const getCurrentLocale = (): string => {\r\n    let locale;\r\n    if (navigator.languages && navigator.languages.length > 0) {\r\n        locale = navigator.languages[0];\r\n    } else {\r\n        locale = navigator.language || (navigator as any).userLanguage || (navigator as any).browserLanguage || 'en';\r\n    }\r\n    return locale.split('-')[0];\r\n};\r\n\r\n\r\nconst getPhraseKey = (phrase: string) => phrase.toLowerCase();\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { getCurrentLocale, LanguageDictionary } from './util/lang';\r\nimport lang from './resources/lang.json';\r\n\r\nconst i18n = new LanguageDictionary(lang);\r\ni18n.locale = getCurrentLocale();\r\n\r\nexport default i18n;\r\n\r\n\r\n\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nexport class HTTPError extends Error {\r\n    readonly statusCode: number;\r\n\r\n    constructor(statusCode: number, statusMessage: string) {\r\n        super(statusMessage);\r\n        this.statusCode = statusCode;\r\n    }\r\n}","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport i18n from '../i18n';\r\nimport { HTTPError } from './errors';\r\n\r\n\r\nexport type QueryComponent = [string, string];\r\n\r\nexport function makeRequestInit(accessToken: string | null): RequestInit {\r\n    if (accessToken) {\r\n        return {\r\n            headers: [['Authorization', `Bearer ${accessToken}`]],\r\n        };\r\n    }\r\n    return {};\r\n}\r\n\r\nexport function makeRequestUrl(url: string, query: QueryComponent[]) {\r\n    if (query.length > 0) {\r\n        const queryString = query.map(kv => kv.map(encodeURIComponent).join('=')).join('&');\r\n        if (!url.includes('?')) {\r\n            return url + '?' + queryString;\r\n        } else if (!url.endsWith('&')) {\r\n            return url +  '&' + queryString;\r\n        } else {\r\n            return url +  queryString;\r\n        }\r\n    }\r\n    return url;\r\n}\r\n\r\nexport function callApi(url: string, init?: RequestInit): Promise<Response> {\r\n\r\n    if (process.env.NODE_ENV === 'development') {\r\n        console.debug('Calling API: ', url, init);\r\n    }\r\n\r\n    return fetch(url, init)\r\n        .then(response => {\r\n            if (!response.ok) {\r\n                throw new HTTPError(response.status, response.statusText);\r\n            }\r\n            return response;\r\n        })\r\n        .catch(error => {\r\n            if (error instanceof TypeError) {\r\n                console.error(`Server did not respond for ${url}. `\r\n                              +  \"May be caused by timeout, refused connection, network error, etc.\", error);\r\n                throw new Error(i18n.get(\"Cannot reach server\"));\r\n            } else {\r\n                console.error(error);\r\n                throw error;\r\n            }\r\n        });\r\n}\r\n\r\nexport function callJsonApi<T>(url: string, init?: RequestInit): Promise<T> {\r\n    return callApi(url, init).then(response => response.json());\r\n}\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { callJsonApi } from './callApi';\r\nimport { ColorBars, ColorBarGroup } from \"../model/colorBar\";\r\n\r\n\r\nexport function getColorBars(apiServerUrl: string): Promise<ColorBars> {\r\n    return callJsonApi<ColorBars>(`${apiServerUrl}/colorbars`)\r\n        .then(parseColorBars);\r\n}\r\n\r\nfunction parseColorBars(colorBarGroups: any): ColorBars {\r\n    const groups: ColorBarGroup[] = [];\r\n    const images: any = {};\r\n    colorBarGroups.forEach((colorBarGroup: [string, string, any[]]) => {\r\n        const title = colorBarGroup[0];\r\n        const description = colorBarGroup[1];\r\n        const names: string[] = [];\r\n        colorBarGroup[2].forEach((colorBar: [string, string]) => {\r\n            const name = colorBar[0];\r\n            const image = colorBar[1];\r\n            names.push(name);\r\n            images[name] = image;\r\n        });\r\n        groups.push({title, description, names});\r\n    });\r\n    return {groups, images};\r\n}","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { callJsonApi, makeRequestInit, makeRequestUrl } from './callApi';\r\nimport { Dataset, Dimension, TimeDimension } from '../model/dataset';\r\n\r\n\r\nexport function getDatasets(apiServerUrl: string, accessToken: string | null): Promise<Dataset[]> {\r\n    const url = makeRequestUrl(`${apiServerUrl}/datasets`, [['details', '1']]);\r\n    const init = makeRequestInit(accessToken);\r\n    return callJsonApi<Dataset[]>(url, init)\r\n        .then((result: any) => result['datasets'])\r\n        .then(adjustTimeDimensionsForDatasets);\r\n}\r\n\r\nfunction adjustTimeDimensionsForDatasets(datasets: Dataset[]): Dataset[] {\r\n    return datasets.map(adjustTimeDimensionsForDataset);\r\n}\r\n\r\nfunction adjustTimeDimensionsForDataset(dataset: Dataset): Dataset {\r\n    if (dataset.dimensions && dataset.dimensions.length) {\r\n        let dimensions = dataset.dimensions;\r\n        const index = dimensions.findIndex((dimension: Dimension) => dimension.name === 'time');\r\n        if (index > -1) {\r\n            const timeDimension = dimensions[index];\r\n            let timeCoordinates: any = timeDimension.coordinates;\r\n            if (timeCoordinates && timeCoordinates.length && typeof timeCoordinates[0] === 'string') {\r\n                let labels = timeCoordinates as string[];\r\n                let coordinates = labels.map((label: string) => new Date(label).getTime());\r\n                dimensions = [...dimensions];\r\n                dimensions[index] = {...timeDimension, coordinates, labels} as TimeDimension;\r\n                return {...dataset, dimensions};\r\n            }\r\n        }\r\n    }\r\n    return dataset;\r\n}","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport {callJsonApi, makeRequestInit} from './callApi';\r\nimport {PlaceGroup} from '../model/place';\r\n\r\n\r\nexport function getDatasetPlaceGroup(\r\n    apiServerUrl: string,\r\n    datasetId: string,\r\n    placeGroupId: string,\r\n    accessToken: string | null\r\n): Promise<PlaceGroup> {\r\n    const init = makeRequestInit(accessToken);\r\n    const dsId = encodeURIComponent(datasetId);\r\n    const pgId = encodeURIComponent(placeGroupId);\r\n    return callJsonApi<PlaceGroup>(\r\n        `${apiServerUrl}/datasets/${dsId}/places/${pgId}`,\r\n        init\r\n    );\r\n}\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nexport class DeveloperError extends Error {\r\n}\r\n\r\nexport function assertTrue(condition: any, message: string) {\r\n    if (!condition) {\r\n        throw new DeveloperError(`assertion failed: ${message}`);\r\n    }\r\n}\r\n\r\nexport function assertNotNull(object: any, objectName: string) {\r\n    if (object === null) {\r\n        throw new DeveloperError(`assertion failed: ${objectName} must not be null`);\r\n    }\r\n}\r\n\r\nexport function assertDefined(object: any, objectName: string) {\r\n    if (typeof object === \"undefined\") {\r\n        throw new DeveloperError(`assertion failed: ${objectName} must not be undefined`);\r\n    }\r\n}\r\n\r\nexport function assertDefinedAndNotNull(object: any, objectName: string) {\r\n    assertNotNull(object, objectName);\r\n    assertDefined(object, objectName);\r\n}\r\n\r\nexport function assertArray(array: any, arrayName: string) {\r\n    if (!Array.isArray(array)) {\r\n        throw new DeveloperError(`assertion failed: ${arrayName} must be an array`);\r\n    }\r\n}\r\n\r\nexport function assertArrayNotEmpty(array: any, arrayName: string) {\r\n    assertArray(array, arrayName);\r\n    if (array.length === 0) {\r\n        throw new DeveloperError(`assertion failed: ${arrayName} must be a non-empty array`);\r\n    }\r\n}\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { TileSourceOptions } from './tile';\r\nimport { Variable } from './variable';\r\nimport { PlaceGroup } from './place';\r\nimport { TimeRange } from './timeSeries';\r\nimport {\r\n    assertArrayNotEmpty,\r\n    assertDefinedAndNotNull,\r\n} from '../util/assert';\r\n\r\n\r\nexport interface Dimension {\r\n    name: string;\r\n    size: number;\r\n    dtype: string;\r\n    coordinates: number[];\r\n}\r\n\r\n// export interface LonDimension extends Dimension {\r\n//     name: 'lon';\r\n// }\r\n//\r\n// export interface LatDimension extends Dimension {\r\n//     name: 'lat';\r\n// }\r\n\r\nexport interface TimeDimension extends Dimension {\r\n    name: 'time';\r\n    labels: string[];\r\n}\r\n\r\nexport type NormRange = [number, number];\r\n\r\nexport interface RgbSchema {\r\n    // The following are new since xcube 0.11\r\n    tileUrl: string;\r\n    tileLevelMin?: number;\r\n    tileLevelMax?: number;\r\n    // tileSourceOptions are longer used since xcube 0.11\r\n    tileSourceOptions?: TileSourceOptions;\r\n    varNames: [string, string, string];\r\n    normRanges: [NormRange, NormRange, NormRange];\r\n}\r\n\r\nexport interface Dataset {\r\n    id: string;\r\n    title: string;\r\n    bbox: [number, number, number, number];\r\n    geometry: {\r\n        type: \"Polygon\";\r\n        coordinates: Array<Array<[number, number]>>;\r\n    };\r\n    spatialRef: string;\r\n    dimensions: Dimension[];\r\n    variables: Variable[];\r\n    placeGroups?: PlaceGroup[];\r\n    attributions?: string[];\r\n    attrs: { [name: string]: any };\r\n    rgbSchema?: RgbSchema;\r\n}\r\n\r\n\r\nexport function findDataset(datasets: Dataset[], selectedDatasetId: string | null): Dataset | null {\r\n    return (selectedDatasetId && datasets.find(dataset => dataset.id === selectedDatasetId)) || null;\r\n}\r\n\r\nexport function findDatasetVariable(dataset: Dataset, variableName: string | null): Variable | null {\r\n    return (variableName && dataset.variables.find(variable => variable.name === variableName)) || null;\r\n}\r\n\r\nexport function getDatasetTimeDimension(dataset: Dataset): TimeDimension | null {\r\n    assertDefinedAndNotNull(dataset, 'dataset');\r\n    assertArrayNotEmpty(dataset.dimensions, 'dataset.dimensions');\r\n    const dimension: any = dataset.dimensions.find(dimension => dimension.name === 'time');\r\n    if (!dimension) {\r\n        return null;\r\n    }\r\n    assertArrayNotEmpty(dimension!.coordinates, 'timeDimension.coordinates');\r\n    assertArrayNotEmpty(dimension!.labels, 'timeDimension.labels');\r\n    return dimension as TimeDimension;\r\n}\r\n\r\nexport function getDatasetTimeRange(dataset: Dataset): TimeRange | null {\r\n    const timeDimension = getDatasetTimeDimension(dataset);\r\n    if (!timeDimension) {\r\n        return null;\r\n    }\r\n    const coordinates = timeDimension.coordinates;\r\n    return [coordinates[0], coordinates[coordinates.length - 1]];\r\n}\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport class ParseError extends Error {\n}\n\nexport interface ParseOptions {\n    separator: string;\n    comment: string;\n    quote: string;\n    escape: string;\n    trim: boolean;\n    nanToken: string;\n    trueToken: string;\n    falseToken: string;\n}\n\nexport const defaultParseOptions: ParseOptions = {\n    separator: ',',\n    comment: '#',\n    quote: '\"',\n    escape: '\\\\',\n    trim: true,\n    nanToken: 'NaN',\n    trueToken: 'true',\n    falseToken: 'false',\n}\n\ntype Line = [string, number];\nexport type Value = string | number | boolean | null;\n\nexport function parseCsv(text: string, options?: Partial<ParseOptions>): Value[][] {\n    return new Parser(options).parse(text);\n}\n\nclass Parser {\n    readonly options: ParseOptions;\n\n    constructor(options?: Partial<ParseOptions>) {\n        this.options = {\n            ...defaultParseOptions,\n            ...options\n        };\n        this.parseLine = this.parseLine.bind(this);\n    }\n\n    parse(text: string): Value[][] {\n        return this.parseText(text).map(this.parseLine);\n    }\n\n    parseText(text: string): Line[] {\n        const {comment, trim} = this.options;\n        return text\n            .split(\"\\n\")\n            .map((line, index): Line => {\n                if (trim) {\n                    line = line.trim();\n                }\n                return [line, index];\n            })\n            .filter(([line, index]): boolean => {\n                return line.trim() !== \"\" && !line.startsWith(comment);\n            });\n    }\n\n    parseLine([line, index]: Line): Value[] {\n        const {separator, quote, escape} = this.options;\n        let quoteSeen = false;\n        let values: Value[] = [];\n        let start = 0;\n        let end = 0;\n        for (; end < line.length; end++) {\n            const char = line[end];\n            if (char === escape) {\n                end++;\n            } else if (quoteSeen) {\n                if (char === quote) {\n                    quoteSeen = false;\n                }\n            } else if (char === quote) {\n                quoteSeen = true;\n            } else if (char === separator) {\n                this.collectValue(line, start, end, values);\n                start = end + 1;\n            }\n        }\n        if (quoteSeen) {\n            throw error(`missing quote character [${this.options.quote}]`, index, start);\n        }\n        this.collectValue(line, start, end, values);\n        return values;\n    }\n\n    collectValue(line: string, start: number, end: number, values: Value[]): void {\n        const token = line.slice(start, end);\n        values.push(this.parseToken(token));\n    }\n\n    parseToken(token: string): Value {\n        const options = this.options;\n        if (options.trim) {\n            token = token.trim();\n        }\n        if (token === \"\") {\n            return null;\n        }\n        if (token.startsWith(options.quote)) {\n            token = token.substring(1, token.length - 1);\n        } else {\n            if (token === options.trueToken) {\n                return true;\n            }\n            if (token === options.falseToken) {\n                return false;\n            }\n            if (token === options.nanToken) {\n                return Number.NaN;\n            }\n            const value = parseFloat(token);\n            if (!Number.isNaN(value)) {\n                return value;\n            }\n        }\n        return unescapeString(token, options.escape);\n    }\n}\n\nfunction error(message: string, lineIndex: number, colIndex: number): ParseError {\n    return new ParseError(`line ${lineIndex + 1}, column ${colIndex + 1}: ${message}`);\n}\n\nfunction unescapeString(token: string, escape: string) {\n    let end = token.indexOf(escape);\n    if (end < 0) {\n        return token;\n    }\n    let start = 0;\n    let token2 = '';\n    for (; end < token.length; end++) {\n        if (token[end] === escape) {\n            token2 += token.substring(start, end) + token.substring(end + 1, end + 2);\n            end += 2;\n            start = end;\n        }\n    }\n    token2 += token.substring(start, token.length);\n    return token2;\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { parseCsv, ParseOptions, defaultParseOptions } from '../../util/csv';\nimport { Format } from './common';\n\n\nconst checkError = (text: string): string | null => {\n    if (text.trim() !== '') {\n        try {\n            parseCsv(text);\n        } catch (e) {\n            console.error(e);\n            return `${e}`;\n        }\n    }\n    return null;\n};\n\nexport const csvFormat: Format = {\n    name: 'Text/CSV',\n    fileExt: '.txt,.csv',\n    checkError\n};\n\nexport interface CsvOptions extends ParseOptions {\n    xName: string;\n    yName: string;\n    forceGeometry: boolean;\n    geometryName: string;\n    labelName: string;\n    labelPrefix: string;\n}\n\nexport const defaultCsvOptions: CsvOptions = {\n    ...defaultParseOptions,\n    xName: \"longitude\",\n    yName: \"latitude\",\n    forceGeometry: false,\n    geometryName: \"geometry\",\n    labelName: \"name\",\n    labelPrefix: \"CSV-\",\n};\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Format } from './common';\n\n\nconst checkError = (text: string): string | null => {\n    if (text.trim() !== '') {\n        try {\n            JSON.parse(text);\n        } catch (e) {\n            console.error(e);\n            return `${e}`;\n        }\n    }\n    return null;\n};\n\nexport const geoJsonFormat: Format = {\n    name: 'GeoJSON',\n    fileExt: '.json,.geojson',\n    checkError\n};\n\nexport interface GeoJsonOptions {\n    labelNames: string;\n    labelPrefix: string;\n}\n\nexport const defaultGeoJsonOptions: GeoJsonOptions = {\n    labelNames: \"label, name, title, id\",\n    labelPrefix: \"GeoJSON-\",\n};\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Format } from './common';\n\n\nconst checkError = (text: string): string | null => {\n    // TODO\n    return null;\n};\n\nexport const wktFormat: Format = {\n    name: 'WKT',\n    fileExt: '.txt,.wkt',\n    checkError\n};\n\nexport interface WktOptions {\n    label: string;\n    labelPrefix: string;\n}\n\nexport const defaultWktOptions: WktOptions = {\n    label: \"\",\n    labelPrefix: \"WKT-\"\n};\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nexport function newId(): string {\r\n    return (Math.random().toString(16).substr(2) + '-' + Date.now().toString(16)).toUpperCase();\r\n}\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2023 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nfunction _getBaseUrl(): URL {\n    const url = new URL(window.location.href);\n    const pathComponents = url.pathname.split('/');\n    const numPathComponents = pathComponents.length;\n    if (numPathComponents > 0) {\n        const lastComponent = pathComponents[numPathComponents - 1];\n        if (lastComponent === 'index.html') {\n            return new URL(pathComponents.slice(0, numPathComponents - 1).join('/'), window.location.origin);\n        } else {\n            return new URL(url.pathname, window.location.origin);\n        }\n    }\n    return new URL(window.location.origin);\n}\n\nconst baseUrl = _getBaseUrl();\n\nexport default baseUrl;\n\nconsole.log(\"baseUrl = \", baseUrl.href);","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2023 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n\n/**\n * Builds a path by concatenating a base path and subsequent path components.\n * The function ensures that only single path separators are used between\n * path components.\n *\n * @param base\n * @param components\n */\nexport function buildPath(base: string, ...components: string[]): string {\n    let path = base;\n    for (let c of components) {\n        if (c !== '') {\n            if (path.endsWith('/')) {\n                if (c.startsWith('/')) {\n                    path += c.substr(1);\n                } else {\n                    path += c;\n                }\n            } else {\n                if (c.startsWith('/')) {\n                    path += c;\n                } else {\n                    path += '/' + c;\n                }\n            }\n        }\n    }\n    return path;\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { CSSProperties } from \"react\";\nimport {\n    amber,\n    blue,\n    blueGrey,\n    brown,\n    cyan,\n    deepOrange,\n    deepPurple,\n    green,\n    grey,\n    indigo,\n    lightBlue,\n    lightGreen,\n    lime,\n    orange,\n    pink,\n    purple,\n    red,\n    teal,\n    yellow,\n} from '@mui/material/colors';\nimport {Color} from '@mui/material';\nimport { PaletteColorOptions } from '@mui/material/styles';\nimport baseUrl from './baseurl';\nimport { buildPath } from './path';\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst COLORS: { [name: string]: Partial<Color> } = {\n    amber,\n    blue,\n    blueGrey,\n    brown,\n    cyan,\n    deepOrange,\n    deepPurple,\n    green,\n    grey,\n    indigo,\n    lightBlue,\n    lightGreen,\n    lime,\n    orange,\n    pink,\n    purple,\n    red,\n    teal,\n    yellow,\n};\n\n// Align any changes made here with\n// - resources/config.json\n// - resources/config.schema.json\nexport interface Branding {\n    appBarTitle: string;\n    windowTitle: string;\n    windowIcon: string | null;\n    compact: boolean;\n    themeName: 'dark' | 'light';\n    primaryColor: PaletteColorOptions;\n    secondaryColor: PaletteColorOptions;\n    headerBackgroundColor?: string;\n    headerTitleStyle?: CSSProperties;\n    headerIconStyle?: CSSProperties;\n    organisationUrl?: string;\n    logoImage: any;\n    logoWidth: number;\n    baseMapUrl?: string;\n    defaultAgg?: 'median' | 'mean';\n    polygonFillOpacity?: number;\n    mapProjection?: string;\n    allowDownloads?: boolean;\n    allowRefresh?: boolean;\n    allowViewModePython?: boolean;\n}\n\n\nfunction setBrandingColor(brandingConfig: any, key: keyof Branding) {\n    const colorName = brandingConfig[key];\n    if (typeof colorName === 'string') {\n        const color = COLORS[colorName];\n        if (color) {\n            brandingConfig[key] = color;\n        } else {\n            throw new Error(`branding.${key} \"${colorName}\" is invalid`);\n        }\n    }\n}\n\nfunction setBrandingImage(brandingConfig: any, key: keyof Branding, configPath: string) {\n    const imagePath = brandingConfig[key];\n    if (typeof imagePath === 'string') {\n        brandingConfig[key] = buildPath(baseUrl.href, configPath, imagePath);\n    }\n}\n\nexport function parseBranding(brandingConfig: any, configPath: string): Branding {\n    brandingConfig = {...brandingConfig};\n    setBrandingColor(brandingConfig, 'primaryColor');\n    setBrandingColor(brandingConfig, 'secondaryColor');\n    setBrandingImage(brandingConfig, 'logoImage', configPath);\n    return brandingConfig as Branding;\n}\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Color, PaletteType } from '@mui/material';\nimport {\n    cyan,\n    deepPurple,\n    green,\n    indigo,\n    lightBlue,\n    lime,\n    orange,\n    pink,\n    purple,\n    red,\n    yellow,\n} from '@mui/material/colors';\nimport { ApiServerConfig } from './model/apiServer';\nimport rawDefaultConfig from './resources/config.json';\nimport { AuthClientConfig } from './util/auth';\nimport { Branding, parseBranding } from './util/branding';\nimport baseUrl from './util/baseurl';\nimport { buildPath } from './util/path';\n\n\nexport const appParams = new URLSearchParams(window.location.search);\n\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport class Config {\n    readonly name: string;\n    readonly server: ApiServerConfig;\n    readonly branding: Branding;\n    readonly authClient?: AuthClientConfig;\n    private static _instance: Config;\n\n    constructor(\n        name: string,\n        server: ApiServerConfig,\n        branding: Branding,\n        authClient?: AuthClientConfig\n    ) {\n        this.name = name;\n        this.server = server;\n        this.branding = branding;\n        this.authClient = authClient;\n    }\n\n    static async load(): Promise<Config> {\n        let configPath = appParams.get('configPath') || 'config';\n        let rawConfig;\n        const configUrl = buildPath(baseUrl.href, configPath, 'config.json');\n        try {\n            rawConfig = await fetch(configUrl);\n            rawConfig = await rawConfig.json();\n            if (process.env.NODE_ENV === 'development') {\n                console.debug(`Configuration loaded from ${configUrl}`);\n            }\n        } catch (e) {\n            configPath = '';\n            rawConfig = rawDefaultConfig;\n            if (process.env.NODE_ENV === 'development') {\n                console.debug(`Failed loading configuration from ${configUrl}:`, e);\n                console.debug(`Using defaults.`);\n            }\n        }\n\n        const name = rawConfig.name || 'default';\n        const authClient = rawConfig.authClient && {...rawConfig.authClient};\n        const server = {...rawDefaultConfig.server, ...rawConfig.server} as ApiServerConfig;\n        server.id = appParams.get('serverId') || server.id;\n        server.name = appParams.get('serverName') || server.name;\n        server.url = appParams.get('serverUrl') || server.url;\n        const compact = parseInt(appParams.get('compact') || '0') != 0;\n        const branding = parseBranding(\n            {\n                ...rawDefaultConfig.branding,\n                ...rawConfig.branding,\n                compact: compact || !!rawConfig.branding.compact\n            },\n            configPath\n        );\n        Config._instance = new Config(name, server, branding, authClient);\n        if (process.env.NODE_ENV === 'development') {\n            console.debug('Configuration:', Config._instance);\n        }\n        if (branding.windowTitle) {\n            this.changeWindowTitle(branding.windowTitle);\n        }\n        if (branding.windowIcon) {\n            this.changeWindowIcon(branding.windowIcon);\n        }\n        return Config._instance;\n    }\n\n    static get instance(): Config {\n        Config.assertConfigLoaded();\n        return Config._instance;\n    }\n\n    private static assertConfigLoaded() {\n        if (!Config._instance) {\n            throw new Error('internal error: configuration not available yet');\n        }\n    }\n\n    private static changeWindowTitle(title: string) {\n        document.title = title;\n    }\n\n    private static changeWindowIcon(iconUrl: string) {\n        let favicon = document.querySelector<HTMLLinkElement>('link[rel=\"icon\"]');\n        if (favicon !== null) {\n            favicon.href = iconUrl;\n        } else {\n            favicon = document.createElement(\"link\");\n            favicon.rel = \"icon\";\n            favicon.href = iconUrl;\n            document.head.appendChild(favicon);\n        }\n    }\n}\n\n\ninterface TileAccess {\n    param: string;\n    token: string;\n}\n\n\n// Array of user place colors in stable order (see #153)\nconst userPlaceColorsArray: [string, Color][] = [\n    [\"yellow\", yellow],\n    [\"red\", red],\n    [\"pink\", pink],\n    [\"lightBlue\", lightBlue],\n    [\"green\", green],\n    [\"orange\", orange],\n    [\"lime\", lime],\n    [\"purple\", purple],\n    [\"indigo\", indigo],\n    [\"cyan\", cyan],\n    [\"deepPurple\", deepPurple],\n];\n\nconst userPlaceColors: { [name: string]: Color } = (() => {\n    const obj: { [name: string]: Color } = {};\n    userPlaceColorsArray.forEach(([name, color]) => {\n        obj[name] = color;\n    });\n    return obj;\n})();\n\nexport const userPlaceColorNames = userPlaceColorsArray.map(([name, _]) => name);\n\n\nexport function getStrokeShade(paletteType: PaletteType) {\n    return paletteType === 'light' ? 800 : 400;\n}\n\nexport function getUserPlaceColorName(index: number): string {\n    return userPlaceColorNames[index % userPlaceColorNames.length];\n}\n\nexport function getUserPlaceColor(colorName: string, paletteType: PaletteType): string {\n    const shade = getStrokeShade(paletteType);\n    return userPlaceColors[colorName][shade];\n}\n\n// See resources/maps.json\nconst tileAccess: { [name: string]: TileAccess } = {\n    'Mapbox': {\n        param: 'access_token',\n        token: 'pk.eyJ1IjoiZm9ybWFuIiwiYSI6ImNrM2JranV0bDBtenczb2szZG84djh6bWUifQ.q0UKwf4CWt5fcQwIDwF8Bg'\n    },\n};\n\n\nexport function getTileAccess(groupName: string) {\n    return tileAccess[groupName];\n}\n\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as  GeoJSON from 'geojson';\nimport { defaultMemoize } from 'reselect';\nimport { default as OlWktFormat } from \"ol/format/WKT\";\nimport { default as OlGeomPoint } from \"ol/geom/Point\";\nimport { default as OlGeoJSONFormat } from \"ol/format/GeoJSON\";\nimport { default as OlFeature } from \"ol/Feature\";\nimport { default as OlGeometry } from \"ol/geom/Geometry\";\n\nimport { CsvOptions, defaultCsvOptions } from \"./user-place/csv\";\nimport { defaultGeoJsonOptions, GeoJsonOptions } from \"./user-place/geojson\";\nimport { defaultWktOptions, WktOptions } from \"./user-place/wkt\";\nimport { newId } from \"../util/id\";\nimport { getUserPlaceColorName } from '../config';\nimport { parseCsv } from \"../util/csv\";\nimport i18n from \"../i18n\";\n\n\n/**\n * A place is a GeoJSON feature with a mandatory string ID.\n */\nexport interface Place extends GeoJSON.Feature {\n    id: string;\n\n    [name: string]: any;\n}\n\n/**\n * A group of places represented by GeoJSON features.\n */\nexport interface PlaceGroup extends GeoJSON.FeatureCollection {\n    id: string;\n    title: string;\n    features: Place[];\n    propertyMapping?: { [role: string]: string };\n    placeGroups?: { [placeId: string]: PlaceGroup }; // placeGroups in placeGroups are not yet supported\n}\n\n/**\n * Computed place information.\n */\nexport interface PlaceInfo {\n    placeGroup: PlaceGroup;\n    place: Place;\n    label: string;\n    color: string;\n    image: string | null;\n    description: string | null;\n}\n\nexport const DEFAULT_LABEL_PROPERTY_NAMES = mkCases(['label', 'title', 'name', 'id']);\nexport const DEFAULT_DESCRIPTION_PROPERTY_NAMES = mkCases(['description', 'desc', 'abstract', 'comment']);\nexport const DEFAULT_COLOR_PROPERTY_NAMES = mkCases(['color']);\nexport const DEFAULT_IMAGE_PROPERTY_NAMES = mkCases(['image', 'img', 'picture', 'pic']);\n\nexport function computePlaceInfo(placeGroup: PlaceGroup, place: Place): PlaceInfo {\n    const infoObj = {};\n    updatePlaceInfo(infoObj, placeGroup, place, 'label', place.id + '',\n        DEFAULT_LABEL_PROPERTY_NAMES);\n    updatePlaceInfo(infoObj, placeGroup, place, 'color', getUserPlaceColorName(getPlaceHash(place)),\n        DEFAULT_COLOR_PROPERTY_NAMES);\n    updatePlaceInfo(infoObj, placeGroup, place, 'image', null,\n        DEFAULT_IMAGE_PROPERTY_NAMES);\n    updatePlaceInfo(infoObj, placeGroup, place, 'description', null,\n        DEFAULT_DESCRIPTION_PROPERTY_NAMES);\n    return {placeGroup, place, ...infoObj} as PlaceInfo;\n}\n\nexport const getPlaceInfo = defaultMemoize(computePlaceInfo);\n\n\nfunction updatePlaceInfo(infoObj: { [name: string]: any },\n                         placeGroup: PlaceGroup,\n                         place: Place,\n                         propertyName: string,\n                         defaultValue: any,\n                         defaultPropertyNames: string[]) {\n    let propertyValue;\n    const mappedPropertyValue = placeGroup.propertyMapping && placeGroup.propertyMapping[propertyName];\n    if (mappedPropertyValue) {\n        if (mappedPropertyValue.includes('${')) {\n            infoObj[propertyName] = getInterpolatedPropertyValue(place, mappedPropertyValue);\n            return;\n        }\n        if (defaultPropertyNames.length > 0 && defaultPropertyNames[0] !== mappedPropertyValue) {\n            defaultPropertyNames = [mappedPropertyValue, ...defaultPropertyNames];\n        }\n    }\n    if (place.properties) {\n        propertyValue = getPropertyValue(place.properties, defaultPropertyNames);\n    }\n    if (propertyValue === undefined) {\n        propertyValue = getPropertyValue(place, defaultPropertyNames);\n    }\n    infoObj[propertyName] = propertyValue || defaultValue;\n}\n\nfunction getInterpolatedPropertyValue(place: Place, propertyValue: string) {\n    let interpolatedValue = propertyValue;\n    if (place.properties) {\n        for (let name of Object.getOwnPropertyNames(place.properties)) {\n            if (!interpolatedValue.includes('${')) {\n                break;\n            }\n            const placeHolder = '${' + name + '}';\n            if (interpolatedValue.includes(placeHolder)) {\n                interpolatedValue = interpolatedValue.replace(placeHolder, `${place.properties[name]}`);\n            }\n        }\n    }\n    return interpolatedValue;\n}\n\nfunction getPropertyValue(container: any, propertyNames: string[]) {\n    let value;\n    for (let propertyName of propertyNames) {\n        if (propertyName in container) {\n            return container[propertyName];\n        }\n    }\n    // noinspection JSUnusedAssignment\n    return value;\n}\n\nfunction mkCases(names: string[]): string[] {\n    let nameCases: string[] = [];\n    for (let name of names) {\n        nameCases = nameCases.concat(name.toLowerCase(),\n            name.toUpperCase(),\n            name[0].toUpperCase() + name.substr(1).toLowerCase())\n    }\n    return nameCases;\n}\n\nexport function forEachPlace(placeGroups: PlaceGroup[], callback: (placeGroup: PlaceGroup, place: Place) => void) {\n    placeGroups.forEach(placeGroup => {\n        if (isValidPlaceGroup(placeGroup)) {\n            placeGroup.features.forEach((place: Place) => {\n                callback(placeGroup, place);\n            });\n        }\n    });\n}\n\nexport function findPlaceInfo(placeGroups: PlaceGroup[], predicate: (placeGroup: PlaceGroup, place: Place) => boolean): PlaceInfo | null {\n    for (let placeGroup of placeGroups) {\n        if (isValidPlaceGroup(placeGroup)) {\n            const place = placeGroup.features.find((place: Place) => predicate(placeGroup, place));\n            if (place) {\n                return getPlaceInfo(placeGroup, place);\n            }\n        }\n    }\n    return null;\n}\n\nfunction getPlaceHash(place: Place): number {\n    const id = place.id + '';\n    let hash = 0, i, c;\n    if (id.length === 0) {\n        return hash;\n    }\n    for (i = 0; i < id.length; i++) {\n        c = id.charCodeAt(i);\n        hash = ((hash << 5) - hash) + c;\n        hash |= 0; // Convert to 32bit integer\n    }\n    return hash;\n}\n\nexport function isValidPlaceGroup(placeGroup: PlaceGroup): boolean {\n    return !!placeGroup.features;\n}\n\nexport function findPlaceInPlaceGroup(placeGroup: PlaceGroup, placeId: string | null): Place | null {\n    if (!placeId || !isValidPlaceGroup(placeGroup)) {\n        return null;\n    }\n    const place = placeGroup.features.find(place => place.id === placeId);\n    if (!!place) {\n        return place as Place;\n    }\n    let subPlaceGroups = placeGroup.placeGroups;\n    if (subPlaceGroups) {\n        for (let parentPlaceId in subPlaceGroups) {\n            const place = findPlaceInPlaceGroup(subPlaceGroups[parentPlaceId], placeId);\n            if (!!place) {\n                return place;\n            }\n        }\n    }\n    return null;\n}\n\nexport function findPlaceInPlaceGroups(placeGroups: PlaceGroup[], placeId: string | null): Place | null {\n    if (placeId) {\n        for (let placeGroup of placeGroups) {\n            const place = findPlaceInPlaceGroup(placeGroup, placeId);\n            if (place !== null) {\n                return place;\n            }\n        }\n    }\n    return null;\n}\n\n\nlet LAST_PLACE_LABEL_ID_CSV = 0;\nlet LAST_PLACE_LABEL_ID_GEOJSON = 0;\nlet LAST_PLACE_LABEL_ID_WKT = 0;\n\n\nexport function getUserPlacesFromCsv(text: string, options: CsvOptions): Place[] {\n    let table = parseCsv(text, options);\n    if (table.length < 2) {\n        throw new Error(i18n.get('Missing header line in CSV'));\n    }\n\n    for (let v of table[0]) {\n        if (typeof v !== 'string' || v === '') {\n            throw new Error(i18n.get('Invalid header line in CSV'));\n        }\n    }\n\n    const headerRow: string[] = table[0].map(v => v as string);\n    const headerRowLC = headerRow.map(v => v.toLowerCase());\n    const numColumns = headerRow.length;\n\n    for (let row of table) {\n        if (row.length !== numColumns) {\n            throw new Error(i18n.get('All rows must have same length'));\n        }\n    }\n\n    const labelNameLC = options.labelName.toLowerCase();\n    const xNameLC = options.xName.toLowerCase();\n    const yNameLC = options.yName.toLowerCase();\n    const geometryNameLC = options.geometryName.toLowerCase();\n    const forceGeometry = options.forceGeometry;\n\n    const labelNameIndex = headerRowLC.findIndex(name => name === labelNameLC);\n    const xNameIndex = headerRowLC.findIndex(name => name === xNameLC);\n    const yNameIndex = headerRowLC.findIndex(name => name === yNameLC);\n    let geometryNameIndex = headerRowLC.findIndex(name => name === geometryNameLC);\n    if (forceGeometry || xNameIndex < 0 || yNameIndex < 0 || xNameIndex === yNameIndex) {\n        if (geometryNameIndex < 0) {\n            throw new Error(i18n.get('No geometry column(s) found'));\n        }\n    } else {\n        geometryNameIndex = -1;\n    }\n\n    let labelPrefix = options.labelPrefix.trim();\n    if (labelPrefix === '') {\n        labelPrefix = defaultCsvOptions.labelPrefix;\n    }\n\n    const wktFormat = new OlWktFormat();\n\n    const places: Place[] = [];\n    let rowIndex = 1;\n    for (; rowIndex < table.length; rowIndex++) {\n        const dataRow = table[rowIndex];\n        let geometry = null;\n        if (geometryNameIndex >= 0) {\n            const wkt = dataRow[geometryNameIndex];\n            if (typeof wkt === 'string') {\n                try {\n                    geometry = wktFormat.readGeometry(text);\n                } catch (e) {\n                    // will handle error below\n                }\n            }\n        } else {\n            const x = dataRow[xNameIndex];\n            const y = dataRow[yNameIndex];\n            if (typeof x === 'number' && Number.isFinite(x) && typeof y === 'number' && Number.isFinite(y)) {\n                geometry = new OlGeomPoint([x, y]);\n            }\n        }\n        if (geometry === null) {\n            throw new Error(i18n.get(`Invalid geometry in data row ${rowIndex}`));\n        }\n\n        const geoJsonProps: { [k: string]: number | string | boolean | null } = {color: 'red'};\n        dataRow.forEach((propertyValue, index) => {\n            if (index !== xNameIndex && index !== yNameIndex && index !== geometryNameIndex) {\n                const propertyName = headerRow[index];\n                geoJsonProps[propertyName] = propertyValue;\n            }\n        });\n\n        let label: string;\n        if (labelNameIndex >= 0) {\n            label = `${dataRow[labelNameIndex]}`;\n        } else {\n            const labelId = ++LAST_PLACE_LABEL_ID_CSV;\n            label = `${labelPrefix}${labelId}`;\n        }\n        geoJsonProps['label'] = label;\n\n        places.push(newGeoJsonFeature(geometry, geoJsonProps));\n    }\n\n    return places;\n}\n\nexport function getUserPlacesFromGeoJson(text: string, options: GeoJsonOptions): Place[] {\n    const labelNames = options.labelNames;\n    const labelNamesSet = new Set(\n        labelNames.split(',')\n            .map(name => name.trim().toLowerCase())\n            .filter(name => name !== '')\n    )\n    let labelPrefix = options.labelPrefix.trim();\n    if (labelPrefix === '') {\n        labelPrefix = defaultGeoJsonOptions.labelPrefix;\n    }\n\n    const geoJsonFormat = new OlGeoJSONFormat();\n\n    let features: OlFeature[];\n    try {\n        features = geoJsonFormat.readFeatures(text);\n    } catch (e) {\n        try {\n            const geometry = geoJsonFormat.readGeometry(text);\n            features = [new OlFeature(geometry)];\n        } catch (e) {\n            throw new Error(i18n.get(`Invalid GeoJSON`));\n        }\n    }\n\n    const places: Place[] = [];\n    features.forEach(feature => {\n        const properties = feature.getProperties();\n        const geometry = feature.getGeometry();\n        if (geometry) {\n            let label = '';\n            const geoJsonProps: { [k: string]: number | string | boolean | null } = {color: 'red'};\n            if (properties) {\n                for (let propertyName in properties) {\n                    const propertyValue = properties[propertyName];\n                    if (propertyValue === null\n                        || typeof propertyValue === 'number'\n                        || typeof propertyValue === 'string'\n                        || typeof propertyValue === 'boolean') {\n                        geoJsonProps[propertyName] = propertyValue;\n                    }\n                    if (label === ''\n                        && typeof propertyValue === 'string'\n                        && labelNamesSet.has(propertyName.toLowerCase())) {\n                        label = propertyValue;\n                    }\n                }\n            }\n\n            if (label === '') {\n                const labelId = ++LAST_PLACE_LABEL_ID_GEOJSON;\n                label = `${labelPrefix}-${labelId}`;\n            }\n            geoJsonProps['label'] = label;\n\n            places.push(newGeoJsonFeature(geometry, geoJsonProps));\n        }\n    });\n\n    return places;\n}\n\nexport function getUserPlacesFromWkt(text: string, options: WktOptions): Place[] {\n    let labelPrefix = options.labelPrefix.trim();\n    if (labelPrefix === '') {\n        labelPrefix = defaultWktOptions.labelPrefix;\n    }\n    let label = options.label.trim();\n    if (label === '') {\n        const labelId = ++LAST_PLACE_LABEL_ID_WKT;\n        label = `${labelPrefix}${labelId}`;\n    }\n    try {\n        const geometry = new OlWktFormat().readGeometry(text);\n        return [newGeoJsonFeature(geometry, {label})];\n    } catch (e) {\n        throw new Error(i18n.get(`Invalid Geometry WKT`));\n    }\n}\n\nfunction newGeoJsonFeature(geometry: OlGeometry, properties: { [name: string]: any }): Place {\n    return {\n        type: 'Feature',\n        id: newId(),\n        geometry: new OlGeoJSONFormat().writeGeometryObject(geometry),\n        properties: properties,\n    };\n}\n\n\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { MapElement } from '../Map';\r\n\r\ninterface LayersProps {\r\n    children: MapElement[];\r\n}\r\n\r\nexport function Layers(props: LayersProps) {\r\n    return (<React.Fragment>{props.children}</React.Fragment>);\r\n}\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport const GEOGRAPHIC_CRS = 'EPSG:4326';\nexport const WEB_MERCATOR_CRS = 'EPSG:3857';\n\nexport const DEFAULT_MAP_CRS = WEB_MERCATOR_CRS;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport {default as OlMap} from 'ol/Map';\nimport {default as OlBaseObject} from 'ol/Object';\nimport {default as OlMapBrowserEvent} from 'ol/MapBrowserEvent';\nimport {default as OlView} from 'ol/View';\nimport {default as OlEvent} from 'ol/events/Event';\nimport {EventsKey as OlEventsKey} from 'ol/events';\nimport {MapOptions as OlMapOptions} from 'ol/PluggableMap';\n\nimport 'ol/ol.css';\nimport './Map.css';\nimport {DEFAULT_MAP_CRS} from \"../../model/proj\";\n\nexport type MapElement = React.ReactElement | null | undefined;\n\nexport interface MapContext {\n    map?: OlMap;\n    mapDiv?: HTMLDivElement | null;\n    mapObjects: { [id: string]: OlBaseObject };\n}\n\nexport const MapContextType = React.createContext<MapContext>({mapObjects: {}});\n\ninterface MapProps extends OlMapOptions {\n    id: string;\n    children?: React.ReactNode;\n    mapObjects?: { [id: string]: OlBaseObject };\n    onClick?: (event: OlMapBrowserEvent) => void;\n    onMapRef?: (map: OlMap | null) => void;\n    isStale?: boolean;\n    onDropFiles?: (files: File[]) => any;\n}\n\ninterface MapState {\n}\n\nconst DEFAULT_CONTAINER_STYLE: React.CSSProperties = {width: '100%', height: '100%'};\n\nexport class Map extends React.Component<MapProps, MapState> {\n\n    private readonly contextValue: MapContext;\n    private clickEventsKey: OlEventsKey | null = null;\n\n    constructor(props: MapProps) {\n        super(props);\n        // console.log(\"Map.constructor: id =\", this.props.id);\n\n        const {id, mapObjects} = props;\n        if (mapObjects) {\n            this.contextValue = {\n                map: mapObjects[id] as OlMap || undefined,\n                mapObjects: mapObjects\n            };\n        } else {\n            this.contextValue = {\n                mapObjects: {}\n            };\n        }\n    }\n\n    componentDidMount(): void {\n        // console.log('Map.componentDidMount: id =', this.props.id);\n\n        const {id} = this.props;\n        const mapDiv = this.contextValue.mapDiv!;\n\n        let map: OlMap | null = null;\n        if (this.props.isStale) {\n            const mapObject = this.contextValue.mapObjects[id];\n            if (mapObject instanceof OlMap) {\n                map = mapObject;\n                map.setTarget(mapDiv);\n                if (this.clickEventsKey) {\n                    map.un('click', this.clickEventsKey.listener)\n                }\n            }\n        }\n\n        if (!map) {\n            const initialZoom = this.getMinZoom(mapDiv);\n            const view = new OlView({\n                projection: DEFAULT_MAP_CRS,\n                center: [0, 0],\n                minZoom: initialZoom,\n                zoom: initialZoom,\n            });\n            map = new OlMap({\n                view,\n                ...this.getMapOptions(),\n                target: mapDiv\n            });\n        }\n\n        this.contextValue.map = map;\n        this.contextValue.mapObjects[id] = map;\n\n        this.clickEventsKey = map.on('click', this.handleClick);\n\n        //map.set('objectId', this.props.id);\n        map.updateSize();\n\n        // Force update so we can pass this.map as context to all children in next render()\n        this.forceUpdate();\n\n        // Add resize listener, so we can adjust the view's minZoom.\n        // See https://openlayers.org/en/latest/examples/min-zoom.html\n        window.addEventListener('resize', this.handleResize);\n\n        const onMapRef = this.props.onMapRef;\n        if (onMapRef) {\n            onMapRef(map);\n        }\n    }\n\n    componentDidUpdate(prevProps: Readonly<MapProps>): void {\n        // console.log('Map.componentDidUpdate: id =', this.props.id);\n\n        const map = this.contextValue.map!;\n        const mapDiv = this.contextValue.mapDiv!;\n        const mapOptions = this.getMapOptions();\n        map.setProperties({...mapOptions});\n        map.setTarget(mapDiv);\n        // if (this.clickEventsKey) {\n        //     unByKey(this.clickEventsKey);\n        // }\n        // this.clickEventsKey = map.on('click', this.handleClick);\n        // console.log('Map: ', this.handleClick, this.clickEventsKey);\n        map.updateSize();\n    }\n\n    componentWillUnmount(): void {\n        // console.log('Map.componentWillUnmount: id =', this.props.id);\n\n        // Remove resize listeners\n        window.removeEventListener('resize', this.handleResize);\n\n        // if (this.clickEventsKey) {\n        //     unByKey(this.clickEventsKey);\n        // }\n\n        const onMapRef = this.props.onMapRef;\n        if (onMapRef) {\n            onMapRef(null);\n        }\n    }\n\n    render() {\n        let childrenWithContext;\n        if (this.contextValue.map) {\n            childrenWithContext = (\n                <MapContextType.Provider value={this.contextValue}>\n                    {this.props.children}\n                </MapContextType.Provider>\n            );\n        }\n        return (\n            <div\n                ref={this.handleRef}\n                style={DEFAULT_CONTAINER_STYLE}\n                onDragOver={this.handleDragOver}\n                onDrop={this.handleDrop}\n            >\n                {childrenWithContext}\n            </div>\n        );\n    }\n\n    private getMapOptions(): OlMapOptions {\n        const mapOptions = {...this.props};\n        delete mapOptions['children'];\n        delete mapOptions['onClick'];\n        delete mapOptions['onDropFiles'];\n        return mapOptions;\n    }\n\n    private handleClick = (event: OlEvent) => {\n        const onClick = this.props.onClick;\n        if (onClick) {\n            onClick(event as OlMapBrowserEvent);\n        }\n    };\n\n    private handleDrop = (event: React.DragEvent<HTMLDivElement>) => {\n        if (this.props.onDropFiles) {\n            event.preventDefault();\n\n            const files: File[] = [];\n            if (event.dataTransfer.items) {\n                for (let i = 0; i < event.dataTransfer.items.length; i++) {\n                    const item = event.dataTransfer.items[i];\n                    // If dropped items aren't files, reject them\n                    if (item.kind === 'file') {\n                        const file = item.getAsFile();\n                        if (file !== null) {\n                            files.push(file);\n                        }\n                    }\n                }\n            } else if (event.dataTransfer.files) {\n                for (let i = 0; i < event.dataTransfer.files.length; i++) {\n                    const file = event.dataTransfer.files[i];\n                    if (file !== null) {\n                        files.push(file);\n                    }\n                }\n            }\n            if (files.length) {\n                this.props.onDropFiles(files);\n            }\n        }\n    };\n\n    private handleDragOver = (event: React.DragEvent<HTMLDivElement>) => {\n        if (this.props.onDropFiles) {\n            event.preventDefault();\n        }\n    };\n\n    private readonly handleRef = (mapDiv: HTMLDivElement | null) => {\n        this.contextValue.mapDiv = mapDiv;\n    };\n\n    private handleResize = () => {\n        const mapDiv = this.contextValue.mapDiv;\n        const map = this.contextValue.map;\n        if (mapDiv && map) {\n            map.updateSize();\n            const view = map.getView();\n            const minZoom = this.getMinZoom(mapDiv);\n            if (minZoom !== view.getMinZoom()) {\n                view.setMinZoom(minZoom);\n            }\n        }\n    };\n\n    private getMinZoom = (target: HTMLDivElement) => {\n        // Adjust the view's minZoom so there is only one world,\n        // see https://openlayers.org/en/latest/examples/min-zoom.html\n        const size = target.clientWidth;\n        const minZoom = Math.LOG2E * Math.log(size / 256);\n        if (minZoom >= 0.0) {\n            return minZoom;\n        }\n        return 0;\n    };\n}\n\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { default as OlBaseObject } from 'ol/Object';\r\nimport { default as OlMap } from 'ol/Map';\r\n\r\nimport { MapContext, MapContextType } from './Map';\r\n\r\n\r\nexport interface MapComponentProps {\r\n    id?: string;\r\n}\r\n\r\nexport abstract class MapComponent<T extends OlBaseObject, P extends MapComponentProps, S = {}> extends React.PureComponent<P, S> {\r\n    // noinspection JSUnusedGlobalSymbols\r\n    static contextType = MapContextType;\r\n    context: MapContext = {} as MapContext;\r\n    object: T | null = null;\r\n\r\n    abstract addMapObject(map: OlMap): T;\r\n\r\n    abstract updateMapObject(map: OlMap, object: T, prevProps: Readonly<P>): T;\r\n\r\n    abstract removeMapObject(map: OlMap, object: T): void;\r\n\r\n    getMapObject(id: string): OlBaseObject | null {\r\n        return (this.context.mapObjects && this.context.mapObjects[id]) || null;\r\n    }\r\n\r\n    getOptions(): any {\r\n        let options: any = {...this.props};\r\n        delete options.id;\r\n        return options;\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        // console.log(\"MapComponent.componentDidMount: id =\", this.props.id);\r\n        this._updateMapObject(this.addMapObject(this.context.map!));\r\n    }\r\n\r\n    componentDidUpdate(prevProps: Readonly<P>): void {\r\n        // console.log(\"MapComponent.componentDidUpdate: id =\", this.props.id);\r\n        this._updateMapObject(this.updateMapObject(this.context.map!, this.object!, prevProps));\r\n    }\r\n\r\n    componentWillUnmount(): void {\r\n        // console.log(\"MapComponent.componentWillUnmount: id =\", this.props.id);\r\n        const map = this.context.map!;\r\n        this.removeMapObject(map, this.object!);\r\n        if (this.props.id) {\r\n            delete this.context.mapObjects![this.props.id!];\r\n        }\r\n        this.object = null;\r\n    }\r\n\r\n    private _updateMapObject(object: T) {\r\n        if (object != null && this.props.id) {\r\n            object.set(\"objectId\", this.props.id);\r\n            this.context.mapObjects![this.props.id!] = object;\r\n        }\r\n        this.object = object;\r\n    }\r\n\r\n    render(): React.ReactNode {\r\n        return null;\r\n    }\r\n}\r\n\r\n\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { default as OlMap } from 'ol/Map';\nimport { default as OlTileLayer } from 'ol/layer/Tile';\nimport { default as OlTileSource } from 'ol/source/Tile';\nimport { default as OlTileGrid } from 'ol/tilegrid/TileGrid';\nimport { default as OlUrlTileSource } from 'ol/source/UrlTile';\nimport { default as OlXYZSource } from 'ol/source/XYZ';\nimport { default as OlOSMSource } from 'ol/source/OSM';\nimport { Options as OlTileLayerOptions } from 'ol/layer/BaseTile';\n\nimport { MapComponent, MapComponentProps } from '../MapComponent';\n\nconst DEBUG = false;\n\nlet trace: (message?: string, ...optionalParams: any[]) => void;\nif (process.env.NODE_ENV === 'development' && DEBUG) {\n    trace = console.debug;\n} else {\n    trace = () => {};\n}\n\n// noinspection JSUnusedGlobalSymbols\nexport function NaturalEarth2(): JSX.Element {\n    return <Tile id={'NaturalEarth2'} source={NATURAL_EARTH_2_SOURCE}/>;\n}\n\n// noinspection JSUnusedGlobalSymbols\nexport function Bathymetry(): JSX.Element {\n    return <Tile id={'Bathymetry'} source={BATHYMETRY_SOURCE}/>;\n}\n\n// noinspection JSUnusedGlobalSymbols\nexport function OSM(): JSX.Element {\n    return <Tile id={'OSM'} source={OSM_SOURCE}/>;\n}\n\n// noinspection JSUnusedGlobalSymbols\nexport function OSMBlackAndWhite(): JSX.Element {\n    return <Tile id={'OSMBW'} source={OSM_BW_SOURCE}/>;\n}\n\n\ninterface TileProps extends MapComponentProps, OlTileLayerOptions {\n}\n\n\nexport class Tile extends MapComponent<OlTileLayer, TileProps> {\n\n    addMapObject(map: OlMap): OlTileLayer {\n        const layer = new OlTileLayer(this.props);\n        map.getLayers().push(layer);\n        return layer;\n    }\n\n    updateMapObject(map: OlMap, layer: OlTileLayer, prevProps: Readonly<TileProps>): OlTileLayer {\n        const oldSource: OlTileSource = layer.getSource();\n        const newSource: OlTileSource | undefined = this.props.source;\n        if (newSource && oldSource !== newSource) {\n            // We don't expect anything to change in a XYZ source\n            // but the tile URL and the new imageSmoothing property.\n            // Just setting source properties allows for\n            // smooth layer transitions.\n            // Replacing the entire source cause the layer\n            // to flicker in the map.\n            // See https://github.com/dcs4cop/xcube-viewer/issues/119\n            //\n            // If the tile source's URL changes, we just set the URL.\n            // Otherwise we replace the source.\n            // Since we cannot detect which single source properties\n            // have changed, we assume here that the URL, if changed, is the\n            // only changed property. This is not a valid assumption\n            // in the general case.\n            //\n            let replaceSource = true;\n            if (oldSource instanceof OlUrlTileSource && newSource instanceof OlUrlTileSource) {\n                const oldUrlTileSource: OlUrlTileSource = oldSource;\n                const newUrlTileSource: OlUrlTileSource = newSource;\n\n                const oldTileGrid = oldUrlTileSource.getTileGrid();\n                const newTileGrid = newUrlTileSource.getTileGrid();\n                if (equalTileGrids(oldTileGrid, newTileGrid)) {\n                    trace(\"--> Equal tile grids!\")\n                    const oldUrls = oldUrlTileSource.getUrls();\n                    const newUrls = newUrlTileSource.getUrls();\n                    if (oldUrls !== newUrls && newUrls && (oldUrls === null || oldUrls[0] !== newUrls[0])) {\n                        oldUrlTileSource.setUrls(newUrls!);\n                        replaceSource = false;\n                    }\n                    const oldTileLoadFunction = oldUrlTileSource.getTileLoadFunction();\n                    const newTileLoadFunction = newUrlTileSource.getTileLoadFunction();\n                    if (oldTileLoadFunction !== newTileLoadFunction) {\n                        oldUrlTileSource.setTileLoadFunction(newTileLoadFunction!);\n                        replaceSource = false;\n                    }\n                    const oldTileUrlFunction = oldUrlTileSource.getTileUrlFunction();\n                    const newTileUrlFunction = newUrlTileSource.getTileUrlFunction();\n                    if (oldTileUrlFunction !== newTileUrlFunction) {\n                        oldUrlTileSource.setTileUrlFunction(newTileUrlFunction!);\n                        replaceSource = false;\n                    }\n                } else {\n                    trace('--> Tile grids are not equal!');\n                }\n            }\n            const oldContextOptions = oldSource.getContextOptions()\n            const newContextOptions = newSource.getContextOptions()\n            const oldImageSmoothing = typeof oldContextOptions === 'object' ?\n                                      (oldContextOptions as { [key: string]: any }).imageSmoothing : true;\n            const newImageSmoothing = typeof newContextOptions === 'object' ?\n                                      (newContextOptions as { [key: string]: any }).imageSmoothing : true;\n            if (oldImageSmoothing !== newImageSmoothing) {\n                replaceSource = true;\n            }\n\n            if (replaceSource) {\n                // Replace the entire source and accept layer flickering.\n                layer.setSource(newSource);\n                trace(\"--> Replaced source (expect flickering!)\")\n            } else {\n                trace(\"--> Updated source (check, is it still flickering?)\")\n            }\n        }\n\n        // TODO: Code duplication in ./Vector.tsx\n        if (this.props.visible && this.props.visible !== prevProps.visible) {\n            layer.setVisible(this.props.visible);\n        }\n        if (this.props.opacity && this.props.opacity !== prevProps.opacity) {\n            layer.setOpacity(this.props.opacity);\n        }\n        if (this.props.zIndex && this.props.zIndex !== prevProps.zIndex) {\n            layer.setZIndex(this.props.zIndex);\n        }\n        if (this.props.minResolution && this.props.minResolution !== prevProps.minResolution) {\n            layer.setMinResolution(this.props.minResolution);\n        }\n        if (this.props.maxResolution && this.props.maxResolution !== prevProps.maxResolution) {\n            layer.setMaxResolution(this.props.maxResolution);\n        }\n        // TODO: add more props here\n        return layer;\n    }\n\n    removeMapObject(map: OlMap, layer: OlTileLayer): void {\n        map.getLayers().remove(layer);\n    }\n}\n\nconst NATURAL_EARTH_2_SOURCE = new OlXYZSource(\n    {\n        url: 'https://a.tiles.mapbox.com/v3/mapbox.natural-earth-2/{z}/{x}/{y}.png',\n        attributions: [\n            '&copy; <a href=&quot;https://www.naturalearthdata.com/&quot;>MapBox</a>',\n            '&copy; <a href=&quot;https://www.mapbox.com/&quot;>MapBox</a> and contributors',\n        ],\n    });\n\nconst BATHYMETRY_SOURCE = new OlXYZSource(\n    {\n        url: 'https://gis.ngdc.noaa.gov/arcgis/rest/services/web_mercator/gebco_2014_contours/MapServer/tile/{z}/{y}/{x}',\n        attributions: [\n            '&copy; <a href=&quot;https://www.gebco.net/data_and_products/gridded_bathymetry_data/&quot;>GEBCO</a>',\n            '&copy; <a href=&quot;https://maps.ngdc.noaa.gov/&quot;>NOAHH</a> and contributors',\n        ]\n    });\n\nconst OSM_SOURCE = new OlOSMSource();\n\nconst OSM_BW_SOURCE = new OlXYZSource(\n    {\n        url: 'https://tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png',\n        attributions: [\n            '&copy; <a href=&quot;https://www.openstreetmap.org/copyright&quot;>OpenStreetMap</a> contributors',\n        ]\n    });\n\n\nfunction equalTileGrids(oldTileGrid: OlTileGrid, newTileGrid: OlTileGrid) {\n    trace('tile grid:', oldTileGrid, newTileGrid);\n    // Check min/max zoom level\n    trace('min zoom:', oldTileGrid.getMinZoom(), newTileGrid.getMinZoom());\n    trace('max zoom:', oldTileGrid.getMaxZoom(), newTileGrid.getMaxZoom());\n    if (oldTileGrid.getMinZoom() !== newTileGrid.getMinZoom()\n        || oldTileGrid.getMaxZoom() !== newTileGrid.getMaxZoom()) {\n        return false;\n    }\n\n    // Check extents\n    const oldExtent = oldTileGrid.getExtent();\n    const newExtent = newTileGrid.getExtent();\n    trace('extent:', oldExtent, newExtent);\n    for (let i = 0; i < oldExtent.length; i++) {\n        if (oldExtent[i] !== newExtent[i]) {\n            return false;\n        }\n    }\n\n    // Check number of z-levels\n    const oldResolutions = oldTileGrid.getResolutions();\n    const newResolutions = newTileGrid.getResolutions();\n    trace('resolutions:', oldResolutions, newResolutions);\n    const numLevels = oldResolutions.length;\n    if (numLevels !== newResolutions.length) {\n        return false;\n    }\n\n    // Check all z-level properties are equal\n    for (let z = 0; z < numLevels; z++) {\n        // Check resolution\n        const oldResolution = oldTileGrid.getResolution(z);\n        const newResolution = newTileGrid.getResolution(z);\n        trace(`resolution ${z}:`, oldResolution, newResolution);\n        if (oldResolution !== newResolution) {\n            return false;\n        }\n        // Check origin\n        const oldOrigin = oldTileGrid.getOrigin(z);\n        const newOrigin = newTileGrid.getOrigin(z);\n        trace(`origin ${z}:`, oldOrigin, newOrigin);\n        for (let i = 0; i < oldOrigin.length; i++) {\n            if (oldOrigin[i] !== newOrigin[i]) {\n                return false;\n            }\n        }\n        // Check tile size\n        let oldTileSize = oldTileGrid.getTileSize(z);\n        let newTileSize = newTileGrid.getTileSize(z);\n        trace(`tile size ${z}:`, oldTileSize, newTileSize);\n        for (let i = 0; i < oldOrigin.length; i++) {\n            if (typeof oldTileSize === 'number') {\n                oldTileSize = [oldTileSize, oldTileSize]\n            }\n            if (typeof newTileSize === 'number') {\n                newTileSize = [newTileSize, newTileSize]\n            }\n            if (oldTileSize[0] !== newTileSize[0]\n                || oldTileSize[1] !== newTileSize[1]) {\n                return false;\n            }\n        }\n        // Check tile range\n        let oldTileRange = oldTileGrid.getFullTileRange(z);\n        let newTileRange = newTileGrid.getFullTileRange(z);\n        trace(`tile range ${z}:`, oldTileRange, newTileRange);\n        if (oldTileRange && newTileRange) {\n            if (oldTileRange.getWidth() !== newTileRange.getWidth()\n                || oldTileRange.getHeight() !== newTileRange.getHeight()) {\n                return false;\n            }\n        } else if (!!oldTileRange || !!newTileRange) {\n            return false;\n        }\n    }\n    return true;\n}\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { default as OlMap } from 'ol/Map';\r\nimport { default as OlVectorLayer } from 'ol/layer/Vector';\r\nimport { Options as OlVectorLayerOptions } from 'ol/layer/Vector';\r\n\r\nimport { MapComponent, MapComponentProps } from \"../MapComponent\";\r\n\r\n\r\ninterface VectorProps extends MapComponentProps, OlVectorLayerOptions {\r\n}\r\n\r\nexport class Vector extends MapComponent<OlVectorLayer, VectorProps> {\r\n    addMapObject(map: OlMap): OlVectorLayer {\r\n        const layer = new OlVectorLayer(this.props);\r\n        map.getLayers().push(layer);\r\n        return layer;\r\n    }\r\n\r\n    updateMapObject(map: OlMap, layer: OlVectorLayer, prevProps: Readonly<VectorProps>): OlVectorLayer {\r\n        // TODO: Code duplication in ./Tile.tsx\r\n        if (this.props.source !== prevProps.source && this.props.source) {\r\n            layer.setSource(this.props.source);\r\n        }\r\n        if (this.props.visible && this.props.visible !== prevProps.visible) {\r\n            layer.setVisible(this.props.visible);\r\n        }\r\n        if (this.props.opacity && this.props.opacity !== prevProps.opacity) {\r\n            layer.setOpacity(this.props.opacity);\r\n        }\r\n        if (this.props.zIndex && this.props.zIndex !== prevProps.zIndex) {\r\n            layer.setZIndex(this.props.zIndex);\r\n        }\r\n        if (this.props.minResolution && this.props.minResolution !== prevProps.minResolution) {\r\n            layer.setMinResolution(this.props.minResolution);\r\n        }\r\n        if (this.props.maxResolution && this.props.maxResolution !== prevProps.maxResolution) {\r\n            layer.setMaxResolution(this.props.maxResolution);\r\n        }\r\n        return layer;\r\n    }\r\n\r\n    removeMapObject(map: OlMap, layer: OlVectorLayer): void {\r\n        map.getLayers().remove(layer);\r\n    }\r\n}\r\n\r\n\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\n/**\r\n * Find index into `array` so that `array[index]` is closest to `value`.\r\n * Uses a bi-section algorithm, so it should perform according to O(log2(N)).\r\n *\r\n * @param {number[]} array of monotonically increasing values\r\n * @param {number} value some value to find the index for\r\n * @returns {number} the integer index or -1 if the array is empty\r\n */\r\nexport function findIndexCloseTo(array: number[], value: number): number {\r\n    const n = array.length;\r\n    if (n === 0) {\r\n        return -1;\r\n    }\r\n    if (n === 1) {\r\n        return 0;\r\n    }\r\n    let i1 = 0, i3 = n - 1;\r\n    if (value <= array[i1]) {\r\n        return i1;\r\n    }\r\n    if (value >= array[i3]) {\r\n        return i3;\r\n    }\r\n    let i2 = Math.floor(n / 2), otherValue;\r\n    for (let i = 0; i < n; i++) {\r\n        otherValue = array[i2];\r\n        if (value < otherValue) {\r\n            [i2, i3] = [Math.floor((i1 + i2) / 2), i2];\r\n        } else if (value > otherValue) {\r\n            [i1, i2] = [i2, Math.floor((i2 + i3) / 2)];\r\n        } else {\r\n            return i2;\r\n        }\r\n        if (i1 === i2 || i2 === i3) {\r\n            return Math.abs(array[i1] - value) <= Math.abs(array[i3] - value) ? i1 : i3;\r\n        }\r\n    }\r\n    return -1;\r\n}\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\n// Thanks to alexurquhart, maps.json is content of https://github.com/alexurquhart/free-tiles/blob/master/tiles.json\r\n// Check http://alexurquhart.github.io/free-tiles/\r\nimport _maps from '../resources/maps.json';\r\n\r\nexport const maps = _maps as  MapGroup[];\r\n\r\nexport interface MapGroup {\r\n    name: string;\r\n    link: string;\r\n    datasets: MapSource[];\r\n    overlays: MapSource[];\r\n}\r\n\r\nexport interface MapSource {\r\n    name: string;\r\n    endpoint: string;\r\n}\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { AppState } from \"../states/appState\";\r\nimport { createSelector } from \"reselect\";\r\nimport { Dataset } from \"../model/dataset\";\r\nimport { PlaceGroup } from \"../model/place\";\r\n\r\nexport const datasetsSelector = (state: AppState) => state.dataState.datasets || [];\r\nexport const colorBarsSelector = (state: AppState) => state.dataState.colorBars;\r\nexport const timeSeriesGroupsSelector = (state: AppState) => state.dataState.timeSeriesGroups;\r\nexport const userPlaceGroupSelector = (state: AppState) => state.dataState.userPlaceGroup;\r\nexport const userServersSelector = (state: AppState) => state.dataState.userServers || [];\r\n\r\nexport const placeGroupsSelector = createSelector(\r\n    datasetsSelector,\r\n    userPlaceGroupSelector,\r\n    (datasets: Dataset[], userPlaceGroup: PlaceGroup): PlaceGroup[] => {\r\n        const placeGroups: any = {};\r\n        const placeGroupsArray = [userPlaceGroup];\r\n        datasets.forEach(dataset => {\r\n            if (dataset.placeGroups) {\r\n                dataset.placeGroups.forEach(placeGroup => {\r\n                    if (!placeGroups[placeGroup.id]) {\r\n                        placeGroups[placeGroup.id] = placeGroup;\r\n                        placeGroupsArray.push(placeGroup);\r\n                    }\r\n\r\n                });\r\n            }\r\n        });\r\n        return placeGroupsArray;\r\n    }\r\n);\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nexport interface NativeStorage {\r\n    getItem: (key: string) => string | null;\r\n    setItem: (key: string, value: string) => void;\r\n    removeItem: (key: string) => void;\r\n    clear: () => void;\r\n    length: number;\r\n}\r\n\r\nexport function getLocalStorage(brandingName: string): Storage | null {\r\n    return _getStorage('localStorage', brandingName);\r\n}\r\n\r\nexport function getSessionStorage(brandingName: string): Storage | null {\r\n    return _getStorage('sessionStorage', brandingName);\r\n}\r\n\r\nfunction _getStorage(type: 'localStorage' | 'sessionStorage', brandingName: string): Storage | null {\r\n    try {\r\n        const storage = window[type];\r\n        const x = '__storage_test__';\r\n        storage.setItem(x, x);\r\n        storage.removeItem(x);\r\n        return new Storage(storage as NativeStorage, brandingName);\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport class Storage {\r\n\r\n    private readonly nativeStorage: NativeStorage;\r\n    private readonly brandingName: string;\r\n\r\n    constructor(nativeStorage: NativeStorage, brandingName: string) {\r\n        this.nativeStorage = nativeStorage;\r\n        this.brandingName = brandingName;\r\n    }\r\n\r\n    getItem(propertyName: string, defaultValue?: any, parser?: (value: string) => any): any {\r\n        let value = this.nativeStorage.getItem(this.makeKey(propertyName));\r\n        if (value !== null) {\r\n            return parser ? parser(value) : value;\r\n        } else {\r\n            return defaultValue;\r\n        }\r\n    }\r\n\r\n    getObjectItem(propertyName: string, defaultValue?: any): any {\r\n        return this.getItem(propertyName, defaultValue, (value) => JSON.parse(value));\r\n    }\r\n\r\n    getBooleanProperty<T>(propertyName: keyof T, target: T, defaultObj: T) {\r\n        this.getProperty(propertyName, target, defaultObj, (value) => value === 'true');\r\n    }\r\n\r\n    getIntProperty(propertyName: string, target: any, defaultObj: any) {\r\n        this.getProperty(propertyName, target, defaultObj, parseInt);\r\n    }\r\n\r\n    getStringProperty<T>(propertyName: keyof T, target: T, defaultObj: T) {\r\n        this.getProperty(propertyName, target, defaultObj, (value) => value);\r\n    }\r\n\r\n    getObjectProperty<T>(propertyName: keyof T, target: T, defaultObj: T) {\r\n        this.getProperty(propertyName, target, defaultObj, (value) => JSON.parse(value));\r\n    }\r\n\r\n    private getProperty<T>(propertyName: keyof T,\r\n                        target: T,\r\n                        defaultObj: T,\r\n                        parser: (value: string) => any) {\r\n        target[propertyName] = this.getItem(propertyName as string, defaultObj[propertyName], parser);\r\n    }\r\n\r\n    setItem(propertyName: string, value: any, formatter?: (value: any) => string) {\r\n        if (typeof value === 'undefined' || value === null) {\r\n            this.nativeStorage.removeItem(this.makeKey(propertyName));\r\n        } else {\r\n            const formattedValue = formatter ? formatter(value) : value + '';\r\n            this.nativeStorage.setItem(this.makeKey(propertyName), formattedValue);\r\n        }\r\n    }\r\n\r\n    setObjectItem(propertyName: string, value: any) {\r\n        this.setItem(propertyName, value, (value) => JSON.stringify(value));\r\n    }\r\n\r\n    setPrimitiveProperty<T>(propertyName: keyof T, source: T) {\r\n        this.setItem(propertyName as string, source[propertyName]);\r\n    }\r\n\r\n    setObjectProperty<T>(propertyName: keyof T, source: T) {\r\n        this.setObjectItem(propertyName as string, source[propertyName]);\r\n    }\r\n\r\n    private makeKey(propertyName: string): string {\r\n        return `xcube.${this.brandingName}.${propertyName}`;\r\n    }\r\n}\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Config } from '../config';\nimport { ApiServerConfig } from '../model/apiServer';\nimport { getLocalStorage } from '../util/storage';\nimport { ControlState } from './controlState';\n\nexport function storeUserServers(userServers: ApiServerConfig[]) {\n    const storage = getLocalStorage(Config.instance.name);\n    if (storage) {\n        try {\n            storage.setObjectItem('userServers', userServers);\n        } catch (e) {\n            console.warn(`failed to store user servers: ${e}`);\n        }\n    }\n}\n\nexport function loadUserServers(): ApiServerConfig[] {\n    const storage = getLocalStorage(Config.instance.name);\n    if (storage) {\n        try {\n            return storage.getObjectItem('userServers', []);\n        } catch (e) {\n            console.warn(`failed to load user servers: ${e}`);\n        }\n    }\n    return [];\n}\n\n\nexport function storeUserSettings(settings: ControlState) {\n    const storage = getLocalStorage(Config.instance.name);\n    if (storage) {\n        try {\n            storage.setPrimitiveProperty('locale', settings);\n            storage.setPrimitiveProperty('privacyNoticeAccepted', settings);\n            storage.setPrimitiveProperty('autoShowTimeSeries', settings);\n            storage.setPrimitiveProperty('showTimeSeriesErrorBars', settings);\n            storage.setPrimitiveProperty('showTimeSeriesPointsOnly', settings);\n            storage.setPrimitiveProperty('showTimeSeriesMedian', settings);\n            storage.setPrimitiveProperty('timeAnimationInterval', settings);\n            storage.setPrimitiveProperty('timeChunkSize', settings);\n            storage.setPrimitiveProperty('infoCardOpen', settings);\n            storage.setObjectProperty('infoCardElementStates', settings);\n            storage.setPrimitiveProperty('imageSmoothingEnabled', settings);\n            storage.setPrimitiveProperty('mapProjection', settings);\n            storage.setPrimitiveProperty('baseMapUrl', settings);\n            storage.setPrimitiveProperty('exportTimeSeries', settings);\n            storage.setPrimitiveProperty('exportTimeSeriesSeparator', settings);\n            storage.setPrimitiveProperty('exportPlaces', settings);\n            storage.setPrimitiveProperty('exportPlacesAsCollection', settings);\n            storage.setPrimitiveProperty('exportZipArchive', settings);\n            storage.setPrimitiveProperty('exportFileName', settings);\n            storage.setPrimitiveProperty('userPlacesFormatName', settings);\n            storage.setObjectProperty('userPlacesFormatOptions', settings);\n        } catch (e) {\n            console.warn(`failed to store user settings: ${e}`);\n        }\n    }\n}\n\nexport function loadUserSettings(defaultSettings: ControlState): ControlState {\n    const storage = getLocalStorage(Config.instance.name);\n    if (storage) {\n        const settings = {...defaultSettings};\n        try {\n            storage.getStringProperty('locale', settings, defaultSettings);\n            storage.getBooleanProperty('privacyNoticeAccepted', settings, defaultSettings);\n            storage.getBooleanProperty('autoShowTimeSeries', settings, defaultSettings);\n            storage.getBooleanProperty('showTimeSeriesErrorBars', settings, defaultSettings);\n            storage.getBooleanProperty('showTimeSeriesPointsOnly', settings, defaultSettings);\n            storage.getBooleanProperty('showTimeSeriesMedian', settings, defaultSettings);\n            storage.getIntProperty('timeAnimationInterval', settings, defaultSettings);\n            storage.getIntProperty('timeChunkSize', settings, defaultSettings);\n            storage.getBooleanProperty('infoCardOpen', settings, defaultSettings);\n            storage.getObjectProperty('infoCardElementStates', settings, defaultSettings);\n            storage.getBooleanProperty('imageSmoothingEnabled', settings, defaultSettings);\n            storage.getStringProperty('mapProjection', settings, defaultSettings);\n            storage.getStringProperty('baseMapUrl', settings, defaultSettings);\n            storage.getBooleanProperty('exportTimeSeries', settings, defaultSettings);\n            storage.getStringProperty('exportTimeSeriesSeparator', settings, defaultSettings);\n            storage.getBooleanProperty('exportPlaces', settings, defaultSettings);\n            storage.getBooleanProperty('exportPlacesAsCollection', settings, defaultSettings);\n            storage.getBooleanProperty('exportZipArchive', settings, defaultSettings);\n            storage.getStringProperty('exportFileName', settings, defaultSettings);\n            storage.getStringProperty('userPlacesFormatName', settings, defaultSettings);\n            storage.getObjectProperty('userPlacesFormatOptions', settings, defaultSettings);\n            if (process.env.NODE_ENV === 'development') {\n                console.debug('Loaded user settings:', settings);\n            }\n        } catch (e) {\n            console.warn(`Failed to load user settings: ${e}`);\n        }\n        return settings;\n    } else {\n        console.warn('User settings not found or access denied');\n    }\n    return defaultSettings;\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Extent as OlExtent } from 'ol/extent';\nimport { Geometry as OlGeometry } from 'ol/geom';\nimport { default as OlBaseObject } from 'ol/Object';\nimport { Config } from '../config';\n\nimport { Time, TimeRange } from '../model/timeSeries';\nimport { loadUserSettings } from './userSettings';\nimport { DEFAULT_MAP_CRS } from \"../model/proj\";\nimport { CsvOptions, defaultCsvOptions } from \"../model/user-place/csv\";\nimport { GeoJsonOptions, defaultGeoJsonOptions } from \"../model/user-place/geojson\";\nimport { WktOptions, defaultWktOptions } from \"../model/user-place/wkt\";\n\n\nexport type TimeAnimationInterval = 250 | 500 | 1000 | 2500;\nexport const TIME_ANIMATION_INTERVALS: TimeAnimationInterval[] = [250, 500, 1000, 2500];\n\nexport type MapInteraction = 'Select' | 'Point' | 'Polygon' | 'Circle' | 'Geometry';\n\nexport type ViewMode = 'text' | 'list' | 'code' | 'python';\n\n\nexport interface InfoCardElementState {\n    visible?: boolean;\n    viewMode?: ViewMode;\n}\n\nexport interface InfoCardElementStates {\n    [key: string]: InfoCardElementState;\n}\n\nexport type UserPlacesFormatName = 'geojson' | 'csv' | 'wkt';\n\nexport interface UserPlacesFormatOptions {\n    csv: CsvOptions;\n    geojson: GeoJsonOptions;\n    wkt: WktOptions;\n}\n\nexport interface ExportSettings {\n    format: \"GeoJSON\" | \"CSV\";\n    multiFile: boolean;\n    zipArchive: boolean;\n}\n\nexport interface ControlState {\n    selectedDatasetId: string | null;\n    selectedVariableName: string | null;\n    selectedPlaceGroupIds: string[] | null;\n    selectedPlaceId: string | null;\n    selectedUserPlaceId: string | null;\n    selectedServerId: string;\n    selectedTime: Time | null;\n    selectedTimeRange: TimeRange | null;\n    timeSeriesUpdateMode: 'add' | 'replace';\n    timeAnimationActive: boolean;\n    timeAnimationInterval: TimeAnimationInterval;\n    timeChunkSize: number;\n    autoShowTimeSeries: boolean;\n    showTimeSeriesPointsOnly: boolean;\n    showTimeSeriesErrorBars: boolean;\n    showTimeSeriesMedian: boolean;\n    userPlacesFormatName: UserPlacesFormatName;\n    userPlacesFormatOptions: UserPlacesFormatOptions;\n    flyTo: OlGeometry | OlExtent | null;\n    activities: { [id: string]: string };\n    locale: string;\n    dialogOpen: { [dialogId: string]: boolean };\n    privacyNoticeAccepted: boolean;\n    mapInteraction: MapInteraction;\n    lastMapInteraction: MapInteraction;\n    infoCardOpen: boolean;\n    infoCardElementStates: InfoCardElementStates;\n    mapProjection: string;\n    imageSmoothingEnabled: boolean;\n    showDatasetBoundaries: boolean;\n    baseMapUrl: string;\n    showRgbLayer: boolean;\n    exportTimeSeries: boolean;\n    exportPlaces: boolean;\n    exportTimeSeriesSeparator: string;\n    exportPlacesAsCollection: boolean;\n    exportZipArchive: boolean;\n    exportFileName: string;\n}\n\n\nexport function newControlState(): ControlState {\n    const branding = Config.instance.branding;\n    const state: ControlState = {\n        selectedDatasetId: null,\n        selectedVariableName: null,\n        selectedPlaceGroupIds: ['user'],\n        selectedPlaceId: null,\n        selectedUserPlaceId: null,\n        selectedServerId: Config.instance.server.id,\n        selectedTime: null,\n        selectedTimeRange: null,\n        timeSeriesUpdateMode: 'add',\n        timeAnimationActive: false,\n        timeAnimationInterval: 1000,\n        timeChunkSize: 20,\n        autoShowTimeSeries: true,\n        showTimeSeriesPointsOnly: false,\n        showTimeSeriesErrorBars: true,\n        showTimeSeriesMedian: branding.defaultAgg === 'median',\n        userPlacesFormatName: 'csv',\n        userPlacesFormatOptions: {\n            geojson: {...defaultGeoJsonOptions},\n            csv: {...defaultCsvOptions},\n            wkt: {...defaultWktOptions},\n        },\n        flyTo: null,\n        activities: {},\n        locale: 'en',\n        dialogOpen: {},\n        privacyNoticeAccepted: false,\n        mapInteraction: 'Point',\n        lastMapInteraction: 'Point',\n        showRgbLayer: false,\n        infoCardOpen: false,\n        infoCardElementStates: {\n            dataset: {visible: true, viewMode: 'text'},\n            variable: {visible: true, viewMode: 'text'},\n            place: {visible: true, viewMode: 'text'},\n        },\n        mapProjection: branding.mapProjection || DEFAULT_MAP_CRS,\n        imageSmoothingEnabled: false,\n        showDatasetBoundaries: false,\n        baseMapUrl: branding.baseMapUrl || 'http://a.tile.osm.org/{z}/{x}/{y}.png',\n        exportTimeSeries: true,\n        exportTimeSeriesSeparator: 'TAB',\n        exportPlaces: true,\n        exportPlacesAsCollection: true,\n        exportZipArchive: true,\n        exportFileName: 'export',\n    };\n    return loadUserSettings(state);\n}\n\n// We cannot keep \"MAP_OBJECTS\" in control state object, because these objects are (1) not serializable\n// and (2) logging actions will cause the browsers to crash\n\nexport const MAP_OBJECTS: { [id: string]: OlBaseObject } = {};\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { createSelector } from 'reselect'\nimport { default as OlMap } from 'ol/map';\nimport { default as OlGeoJSONFormat } from 'ol/format/GeoJSON';\nimport { default as OlVectorSource } from 'ol/source/Vector';\nimport { default as OlXYZSource } from 'ol/source/XYZ';\nimport { default as OlCircle } from 'ol/style/Circle';\nimport { default as OlFillStyle } from 'ol/style/Fill';\nimport { default as OlStrokeStyle } from 'ol/style/Stroke';\nimport { default as OlStyle } from 'ol/style/Style';\nimport { default as OlTileGrid } from 'ol/tilegrid/TileGrid';\nimport { Layers } from '../components/ol/layer/Layers';\nimport { Tile } from '../components/ol/layer/Tile';\nimport { Vector } from '../components/ol/layer/Vector';\nimport { MapElement } from '../components/ol/Map';\nimport memoize from 'fast-memoize';\nimport { Config, getTileAccess } from '../config';\nimport { ApiServerConfig } from '../model/apiServer';\n\nimport {\n    Dataset,\n    findDataset,\n    findDatasetVariable,\n    getDatasetTimeDimension,\n    getDatasetTimeRange,\n    RgbSchema,\n    TimeDimension\n} from '../model/dataset';\nimport {\n    findPlaceInfo,\n    forEachPlace,\n    getPlaceInfo,\n    isValidPlaceGroup,\n    Place,\n    PlaceGroup,\n    PlaceInfo,\n} from '../model/place';\nimport { Time, TimeRange, TimeSeriesGroup } from '../model/timeSeries';\nimport { Variable } from '../model/variable';\n\nimport { AppState } from '../states/appState';\nimport { findIndexCloseTo } from '../util/find';\nimport { MapGroup, maps, MapSource } from '../util/maps';\nimport {\n    datasetsSelector,\n    timeSeriesGroupsSelector,\n    userPlaceGroupSelector,\n    userServersSelector\n} from './dataSelectors';\nimport { makeRequestUrl } from '../api/callApi';\nimport { MAP_OBJECTS } from '../states/controlState';\nimport { GEOGRAPHIC_CRS, WEB_MERCATOR_CRS } from '../model/proj';\n\nexport const selectedDatasetIdSelector = (state: AppState) => state.controlState.selectedDatasetId;\nexport const selectedVariableNameSelector = (state: AppState) => state.controlState.selectedVariableName;\nexport const selectedPlaceGroupIdsSelector = (state: AppState) => state.controlState.selectedPlaceGroupIds;\nexport const selectedPlaceIdSelector = (state: AppState) => state.controlState.selectedPlaceId;\nexport const selectedTimeSelector = (state: AppState) => state.controlState.selectedTime;\nexport const selectedServerIdSelector = (state: AppState) => state.controlState.selectedServerId;\nexport const activitiesSelector = (state: AppState) => state.controlState.activities;\nexport const timeAnimationActiveSelector = (state: AppState) => state.controlState.timeAnimationActive;\nexport const imageSmoothingSelector = (state: AppState) => state.controlState.imageSmoothingEnabled;\nexport const baseMapUrlSelector = (state: AppState) => state.controlState.baseMapUrl;\nexport const showRgbLayerSelector = (state: AppState) => state.controlState.showRgbLayer;\nexport const infoCardElementStatesSelector = (state: AppState) => state.controlState.infoCardElementStates;\nexport const mapProjectionSelector = (state: AppState) => state.controlState.mapProjection;\nexport const timeChunkSizeSelector = (state: AppState) => state.controlState.timeChunkSize;\nexport const showDatasetBoundariesSelector = (state: AppState) => state.controlState.showDatasetBoundaries;\nexport const userPlacesFormatNameSelector = (state: AppState) => state.controlState.userPlacesFormatName;\nexport const userPlacesFormatOptionsCsvSelector = (state: AppState) => state.controlState.userPlacesFormatOptions.csv;\nexport const userPlacesFormatOptionsGeoJsonSelector = (state: AppState) => state.controlState.userPlacesFormatOptions.geojson;\nexport const userPlacesFormatOptionsWktSelector = (state: AppState) => state.controlState.userPlacesFormatOptions.wkt;\n\n\nexport const selectedDatasetSelector = createSelector(\n    datasetsSelector,\n    selectedDatasetIdSelector,\n    findDataset\n);\n\nexport const selectedDatasetVariablesSelector = createSelector(\n    selectedDatasetSelector,\n    (dataset: Dataset | null): Variable[] => {\n        return (dataset && dataset.variables) || [];\n    }\n);\n\nexport const selectedVariableSelector = createSelector(\n    selectedDatasetSelector,\n    selectedVariableNameSelector,\n    (dataset: Dataset | null, varName: string | null): Variable | null => {\n        if (!dataset || !varName) {\n            return null;\n        }\n        return dataset.variables.find(v => v.name === varName) || null;\n    }\n);\n\nexport const selectedVariableUnitsSelector = createSelector(\n    selectedVariableSelector,\n    (variable: Variable | null): string => {\n        return (variable && variable.units) || '-';\n    }\n);\n\nexport const selectedVariableColorBarMinMaxSelector = createSelector(\n    selectedVariableSelector,\n    (variable: Variable | null): [number, number] => {\n        return variable ? [variable.colorBarMin, variable.colorBarMax] : [0, 1];\n    }\n);\n\nexport const selectedVariableColorBarNameSelector = createSelector(\n    selectedVariableSelector,\n    (variable: Variable | null): string => {\n        return (variable && variable.colorBarName) || 'viridis';\n    }\n);\n\nexport const selectedVariableOpacitySelector = createSelector(\n    selectedVariableSelector,\n    (variable: Variable | null): number => {\n        if (!variable || typeof variable.opacity != 'number') {\n            return 1;\n        }\n        return variable.opacity;\n    }\n);\n\nexport const selectedDatasetTimeRangeSelector = createSelector(\n    selectedDatasetSelector,\n    (dataset: Dataset | null): TimeRange | null => {\n        return dataset !== null ? getDatasetTimeRange(dataset) : null;\n    }\n);\n\nexport const selectedDatasetRgbSchemaSelector = createSelector(\n    selectedDatasetSelector,\n    (dataset: Dataset | null): RgbSchema | null => {\n        return dataset !== null ? (dataset.rgbSchema || null) : null;\n    }\n);\n\nexport const selectedDatasetPlaceGroupsSelector = createSelector(\n    selectedDatasetSelector,\n    (dataset: Dataset | null): PlaceGroup[] => {\n        return (dataset && dataset.placeGroups) || [];\n    }\n);\n\nexport const placeGroupsSelector = createSelector(\n    selectedDatasetPlaceGroupsSelector,\n    userPlaceGroupSelector,\n    (placeGroups: PlaceGroup[], userPlaceGroup: PlaceGroup): PlaceGroup[] => {\n        if (!userPlaceGroup.features || userPlaceGroup.features.length === 0) {\n            return placeGroups;\n        }\n        return placeGroups.concat([userPlaceGroup]);\n    }\n);\n\nfunction selectPlaceGroups(placeGroups: PlaceGroup[],\n                           placeGroupIds: string[] | null): PlaceGroup[] {\n    const selectedPlaceGroups: PlaceGroup[] = [];\n    if (placeGroupIds !== null && placeGroupIds.length > 0) {\n        placeGroups.forEach(placeGroup => {\n            if (placeGroupIds.indexOf(placeGroup.id) > -1) {\n                selectedPlaceGroups.push(placeGroup);\n            }\n        });\n    }\n    return selectedPlaceGroups;\n}\n\nexport const selectedDatasetSelectedPlaceGroupsSelector = createSelector(\n    selectedDatasetPlaceGroupsSelector,\n    selectedPlaceGroupIdsSelector,\n    selectPlaceGroups\n);\n\nexport const selectedPlaceGroupsSelector = createSelector(\n    placeGroupsSelector,\n    selectedPlaceGroupIdsSelector,\n    selectPlaceGroups\n);\n\nexport const selectedPlaceGroupsTitleSelector = createSelector(\n    selectedPlaceGroupsSelector,\n    (placeGroups: PlaceGroup[]): string => {\n        return placeGroups.map(placeGroup => placeGroup.title || placeGroup.id).join(', ');\n    }\n);\n\nexport const selectedPlaceGroupPlacesSelector = createSelector(\n    selectedPlaceGroupsSelector,\n    (placeGroups: PlaceGroup[]): Place[] => {\n        const args = placeGroups.map(placeGroup => (isValidPlaceGroup(placeGroup) ? placeGroup.features : []) as Place[]);\n        return ([] as Array<Place>).concat(...args);\n    }\n);\n\nexport const selectedPlaceSelector = createSelector(\n    selectedPlaceGroupPlacesSelector,\n    selectedPlaceIdSelector,\n    (places: Place[], placeId: string | null): Place | null => {\n        return places.find(place => place.id === placeId) || null;\n    }\n);\n\nexport const selectedPlaceInfoSelector = createSelector(\n    selectedPlaceGroupsSelector,\n    selectedPlaceIdSelector,\n    (placeGroups: PlaceGroup[], placeId: string | null): PlaceInfo | null => {\n        if (placeGroups.length === 0 || placeId === null) {\n            return null;\n        }\n        return findPlaceInfo(placeGroups, (placeGroup, place) => place.id === placeId);\n    }\n);\n\nexport const canAddTimeSeriesSelector = createSelector(\n    timeSeriesGroupsSelector,\n    selectedDatasetIdSelector,\n    selectedVariableNameSelector,\n    selectedPlaceIdSelector,\n    (timeSeriesGroups: TimeSeriesGroup[],\n     datasetId: string | null,\n     variableName: string | null,\n     placeId: string | null): boolean => {\n        if (!datasetId || !variableName || !placeId) {\n            return false;\n        }\n        for (let timeSeriesGroup of timeSeriesGroups) {\n            for (let timeSeries of timeSeriesGroup.timeSeriesArray) {\n                const source = timeSeries.source;\n                if (source.datasetId === datasetId\n                    && source.variableName === variableName\n                    && source.placeId === placeId) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n);\n\nexport const timeSeriesPlaceInfosSelector = createSelector(\n    timeSeriesGroupsSelector,\n    placeGroupsSelector,\n    (timeSeriesGroups: TimeSeriesGroup[], placeGroups: PlaceGroup[]): { [placeId: string]: PlaceInfo } => {\n        const placeInfos: any = {};\n        forEachPlace(placeGroups, (placeGroup, place) => {\n            for (let timeSeriesGroup of timeSeriesGroups) {\n                if (timeSeriesGroup.timeSeriesArray.find(ts => ts.source.placeId === place.id)) {\n                    placeInfos[place.id] = getPlaceInfo(placeGroup, place);\n                    break;\n                }\n            }\n        });\n        return placeInfos;\n    }\n);\n\n\nexport const selectedPlaceGroupPlaceLabelsSelector = createSelector(\n    selectedPlaceGroupsSelector,\n    (placeGroups: PlaceGroup[]): string[] => {\n        const placeLabels: string[] = [];\n        forEachPlace(placeGroups, (placeGroup, place) => {\n            placeLabels.push(getPlaceInfo(placeGroup, place).label);\n        });\n        return placeLabels;\n    }\n);\n\nexport const selectedDatasetVariableSelector = createSelector(\n    selectedDatasetSelector,\n    selectedVariableNameSelector,\n    (dataset: Dataset | null, variableName: string | null): Variable | null => {\n        return (dataset && findDatasetVariable(dataset, variableName)) || null;\n    }\n);\n\nexport const selectedTimeChunkSizeSelector = createSelector(\n    selectedDatasetVariableSelector,\n    timeChunkSizeSelector,\n    (variable: Variable | null, minTimeChunkSize): number => {\n        if (variable && variable.timeChunkSize) {\n            const varTimeChunkSize = variable.timeChunkSize;\n            return varTimeChunkSize * Math.ceil(minTimeChunkSize / varTimeChunkSize);\n        }\n        return minTimeChunkSize;\n    }\n);\n\nexport const selectedDatasetTimeDimensionSelector = createSelector(\n    selectedDatasetSelector,\n    (dataset: Dataset | null): TimeDimension | null => {\n        return (dataset && getDatasetTimeDimension(dataset)) || null;\n    }\n);\n\nexport const selectedDatasetAttributionsSelector = createSelector(\n    selectedDatasetSelector,\n    (dataset: Dataset | null): string[] | null => {\n        return (dataset && dataset.attributions) || null;\n    }\n);\n\nexport const timeCoordinatesSelector = createSelector(\n    selectedDatasetTimeDimensionSelector,\n    (timeDimension: TimeDimension | null): Time[] | null => {\n        if (timeDimension === null || timeDimension.coordinates.length === 0) {\n            return null;\n        }\n        return timeDimension.coordinates;\n    }\n);\n\nexport const selectedTimeIndexSelector = createSelector(\n    selectedTimeSelector,\n    timeCoordinatesSelector,\n    (time: Time | null, timeCoordinates: Time[] | null): number => {\n        if (time === null || timeCoordinates === null) {\n            return -1;\n        }\n        return findIndexCloseTo(timeCoordinates, time);\n    }\n);\n\nfunction getOlTileGrid(mapProjection: string,\n                       tileLevelMax: number | undefined) {\n    if (mapProjection !== WEB_MERCATOR_CRS) {\n        // If projection is not web mercator, it is geographical.\n        // We need to define the geographical tile grid used by xcube:\n        const numLevels = (typeof tileLevelMax === 'number') ? tileLevelMax + 1 : 20;\n        return new OlTileGrid({\n            tileSize: [256, 256],\n            origin: [-180, 90],\n            extent: [-180, -90, 180, 90],\n            // Note, although correct, setting minZoom\n            // will cause OpenLayers to crash:\n            // minZoom: tileLevelMin,\n            resolutions: Array.from(\n                {length: numLevels},\n                (_, i) => 180 / 256 / Math.pow(2, i)\n            )\n        });\n    }\n}\n\nfunction getOlXYZSource(url: string,\n                        mapProjection: string,\n                        tileGrid: undefined | OlTileGrid,\n                        attributions: string[] | null,\n                        timeAnimationActive: boolean,\n                        imageSmoothing: boolean,\n                        tileLoadFunction: any,\n                        tileLevelMin: number | undefined,\n                        tileLevelMax: number | undefined) {\n    return new OlXYZSource(\n        {\n            url,\n            projection: mapProjection,\n            tileGrid,\n            attributions: attributions || undefined,\n            transition: timeAnimationActive ? 0 : 250,\n            imageSmoothing: imageSmoothing,\n            tileLoadFunction,\n            // TODO (forman): if we provide minZoom, we also need to set\n            //   tileGrid.extent, otherwise way to many tiles are loaded from\n            //   level at minZoom when zooming out!\n            // minZoom: tileLevelMin,\n            maxZoom: tileLevelMax,\n        });\n}\n\n\nfunction __getLoadTileOnlyAfterMove(map: OlMap | undefined) {\n    if (map) {\n        // Define a special tileLoadFunction\n        // that prevents tiles from being loaded while the user\n        // pans or zooms, because this leads to high server loads.\n        return (tile: any, src: string) => {\n            if (map.getView().getInteracting()) {\n                map.once('moveend', function () {\n                    tile.getImage().src = src;\n                });\n            } else {\n                tile.getImage().src = src;\n            }\n        }\n    }\n}\n\nconst _getLoadTileOnlyAfterMove = memoize(__getLoadTileOnlyAfterMove, {\n    serializer: args => {\n        const map = args[0] as OlMap | undefined;\n        if (map) {\n            const target = map.getTarget();\n            if (typeof target === 'string') {\n                return target;\n            } else if (target) {\n                return target.id || 'map';\n            }\n            return 'map';\n        }\n        return '';\n    }\n});\n\nfunction getLoadTileOnlyAfterMove() {\n    const map = MAP_OBJECTS['map'] as OlMap | undefined;\n    return _getLoadTileOnlyAfterMove(map);\n}\n\n\nfunction getTileLayer(layerId: string,\n                      tileUrl: string,\n                      tileLevelMin: number | undefined,\n                      tileLevelMax: number | undefined,\n                      queryParams: Array<[string, string]>,\n                      opacity: number,\n                      timeDimension: TimeDimension | null,\n                      time: number | null,\n                      timeAnimationActive: boolean,\n                      mapProjection: string,\n                      attributions: string[] | null,\n                      imageSmoothing: boolean) {\n    if (time !== null) {\n        let timeString;\n        if (timeDimension) {\n            const timeIndex = findIndexCloseTo(timeDimension.coordinates, time);\n            if (timeIndex > -1) {\n                timeString = timeDimension.labels[timeIndex];\n                // console.log(\"adjusted time from\", new Date(time).toISOString(), \"to\", timeString);\n            }\n        }\n        if (!timeString) {\n            timeString = new Date(time).toISOString();\n        }\n        queryParams = [...queryParams, ['time', timeString]];\n    }\n\n    const url = makeRequestUrl(tileUrl, queryParams);\n\n    if (typeof tileLevelMax === 'number') {\n        // It is ok to have some extra zoom levels, so we can magnify pixels.\n        // Using more, artifacts will become visible.\n        tileLevelMax += 3;\n    }\n\n    const tileGrid = getOlTileGrid(mapProjection, tileLevelMax);\n    const source = getOlXYZSource(\n        url,\n        mapProjection,\n        tileGrid,\n        attributions,\n        timeAnimationActive,\n        imageSmoothing,\n        getLoadTileOnlyAfterMove(),\n        tileLevelMin,\n        tileLevelMax\n    );\n    // console.debug('source = ', source)\n\n    return (\n        <Tile\n            id={layerId}\n            source={source}\n            zIndex={10}\n            opacity={opacity}\n        />\n    );\n}\n\nexport const selectedDatasetBoundaryLayerSelector = createSelector(\n    selectedDatasetSelector,\n    mapProjectionSelector,\n    showDatasetBoundariesSelector,\n    (dataset: Dataset | null,\n     mapProjection: string,\n     showDatasetBoundaries: boolean\n    ): MapElement | null => {\n        if (!dataset || !showDatasetBoundaries) {\n            return null;\n        }\n\n        let geometry = dataset.geometry;\n        if (!geometry) {\n            if (dataset.bbox) {\n                const [x1, y1, x2, y2] = dataset.bbox;\n                geometry = {\n                    type: \"Polygon\",\n                    coordinates: [\n                        [\n                            [x1, y1],\n                            [x2, y1],\n                            [x2, y2],\n                            [x1, y2],\n                            [x1, y1],\n                        ],\n                    ]\n                }\n            } else {\n                console.warn(`Dataset ${dataset.id} has no bbox!`);\n                return null;\n            }\n        }\n\n        const source = new OlVectorSource({\n            features: new OlGeoJSONFormat(\n                {\n                    dataProjection: GEOGRAPHIC_CRS,\n                    featureProjection: mapProjection\n                }\n            ).readFeatures({type: \"Feature\", geometry}),\n        });\n\n        const style = new OlStyle({\n            stroke: new OlStrokeStyle({\n                color: \"orange\",\n                width: 3,\n                lineDash: [2, 4],\n            }),\n        });\n\n        return (\n            <Vector\n                id={`${dataset.id}.bbox`}\n                source={source}\n                style={style}\n                zIndex={11}\n                opacity={0.5}\n            />\n        );\n    }\n);\n\nexport const selectedDatasetVariableLayerSelector = createSelector(\n    selectedDatasetVariableSelector,\n    selectedDatasetTimeDimensionSelector,\n    selectedTimeSelector,\n    timeAnimationActiveSelector,\n    mapProjectionSelector,\n    selectedVariableColorBarMinMaxSelector,\n    selectedVariableColorBarNameSelector,\n    selectedVariableOpacitySelector,\n    selectedDatasetAttributionsSelector,\n    imageSmoothingSelector,\n    (variable: Variable | null,\n     timeDimension: TimeDimension | null,\n     time: Time | null,\n     timeAnimationActive: boolean,\n     mapProjection: string,\n     colorBarMinMax: [number, number],\n     colorBarName: string,\n     opacity: number,\n     attributions: string[] | null,\n     imageSmoothing: boolean\n    ): MapElement => {\n        if (!variable) {\n            return null;\n        }\n        if (!variable.tileUrl) {\n            console.warn(`Variable ${variable.name} has no tileUrl!`);\n            return null;\n        }\n        const queryParams: Array<[string, string]> = [\n            ['crs', mapProjection],\n            ['vmin', `${colorBarMinMax[0]}`],\n            ['vmax', `${colorBarMinMax[1]}`],\n            ['cbar', colorBarName],\n            // ['retina', '1'],\n        ];\n        return getTileLayer(\n            'variable',\n            variable.tileUrl,\n            variable.tileLevelMin,\n            variable.tileLevelMax,\n            queryParams,\n            opacity,\n            timeDimension,\n            time,\n            timeAnimationActive,\n            mapProjection,\n            attributions,\n            imageSmoothing\n        );\n    }\n);\n\nexport const selectedDatasetRgbLayerSelector = createSelector(\n    showRgbLayerSelector,\n    selectedDatasetRgbSchemaSelector,\n    selectedVariableOpacitySelector,\n    selectedDatasetTimeDimensionSelector,\n    selectedTimeSelector,\n    timeAnimationActiveSelector,\n    mapProjectionSelector,\n    selectedDatasetAttributionsSelector,\n    imageSmoothingSelector,\n    (showRgbLayer: boolean,\n     rgbSchema: RgbSchema | null,\n     opacity: number,\n     timeDimension: TimeDimension | null,\n     time: Time | null,\n     timeAnimationActive: boolean,\n     mapProjection: string,\n     attributions: string[] | null,\n     imageSmoothing: boolean\n    ): MapElement => {\n        if (!showRgbLayer || !rgbSchema) {\n            return null;\n        }\n        const queryParams: Array<[string, string]> = [\n            ['crs', mapProjection],\n        ];\n        return getTileLayer('rgb',\n            rgbSchema.tileUrl,\n            rgbSchema.tileLevelMin,\n            rgbSchema.tileLevelMax,\n            queryParams,\n            opacity,\n            timeDimension,\n            time,\n            timeAnimationActive,\n            mapProjection,\n            attributions,\n            imageSmoothing);\n    }\n);\n\n\nexport function getDefaultFillOpacity() {\n    return Config.instance.branding.polygonFillOpacity || 0.25;\n}\n\nexport function getDefaultStyleImage() {\n    return new OlCircle({\n        fill: getDefaultFillStyle(),\n        stroke: getDefaultStrokeStyle(),\n        radius: 6\n    })\n}\n\nexport function getDefaultStrokeStyle() {\n    return new OlStrokeStyle({\n        color: [200, 0, 0, 0.75],\n        width: 1.25\n    });\n}\n\nexport function getDefaultFillStyle() {\n    return new OlFillStyle({\n        color: [255, 0, 0, getDefaultFillOpacity()]\n    });\n}\n\nexport function getDefaultPlaceGroupStyle() {\n    return new OlStyle({\n        image: getDefaultStyleImage(),\n        stroke: getDefaultStrokeStyle(),\n        fill: getDefaultFillStyle(),\n    });\n}\n\nexport const selectedDatasetPlaceGroupLayersSelector = createSelector(\n    selectedDatasetSelectedPlaceGroupsSelector,\n    mapProjectionSelector,\n    (placeGroups: PlaceGroup[], mapProjection: string): MapElement => {\n        if (placeGroups.length === 0) {\n            return null;\n        }\n        const layers: MapElement[] = [];\n        placeGroups.forEach((placeGroup, index) => {\n            if (isValidPlaceGroup(placeGroup)) {\n                layers.push(\n                    <Vector\n                        key={index}\n                        id={`placeGroup.${placeGroup.id}`}\n                        style={getDefaultPlaceGroupStyle()}\n                        zIndex={100}\n                        source={new OlVectorSource(\n                            {\n                                features: new OlGeoJSONFormat(\n                                    {\n                                        dataProjection: GEOGRAPHIC_CRS,\n                                        featureProjection: mapProjection\n                                    }\n                                ).readFeatures(placeGroup),\n                            })}\n                    />\n                );\n            }\n        });\n        return (<Layers>{layers}</Layers>);\n    }\n);\n\nexport const visibleInfoCardElementsSelector = createSelector(\n    infoCardElementStatesSelector,\n    (infoCardElementStates): string[] => {\n        const visibleInfoCardElements: string[] = [];\n        Object.getOwnPropertyNames(infoCardElementStates).forEach(e => {\n            if (!!infoCardElementStates[e].visible) {\n                visibleInfoCardElements.push(e);\n            }\n        });\n        return visibleInfoCardElements;\n    }\n);\n\nexport const infoCardElementViewModesSelector = createSelector(\n    infoCardElementStatesSelector,\n    (infoCardElementStates) => {\n        const infoCardElementCodeModes: { [elementType: string]: string } = {};\n        Object.getOwnPropertyNames(infoCardElementStates).forEach(e => {\n            infoCardElementCodeModes[e] = infoCardElementStates[e].viewMode || 'text';\n        });\n        return infoCardElementCodeModes;\n    }\n);\n\nexport const activityMessagesSelector = createSelector(\n    activitiesSelector,\n    (activities: { [id: string]: string }): string[] => {\n        return Object.keys(activities).map(k => activities[k]);\n    }\n);\n\nexport const selectedServerSelector = createSelector(\n    userServersSelector,\n    selectedServerIdSelector,\n    (userServers: ApiServerConfig[], serverId: string): ApiServerConfig => {\n        if (userServers.length === 0) {\n            throw new Error(`internal error: no servers configured`);\n        }\n        const server = userServers.find(server => server.id === serverId);\n        if (!server) {\n            throw new Error(`internal error: server with ID \"${serverId}\" not found`);\n        }\n        return server;\n    }\n);\n\nexport const baseMapLayerSelector = createSelector(\n    baseMapUrlSelector,\n    (baseMapUrl: string): JSX.Element | null => {\n        const map = findMap(baseMapUrl);\n        if (map) {\n            const access = getTileAccess(map.group.name);\n            const source = new OlXYZSource(\n                {\n                    url: map.dataset.endpoint + (access ? `?${access.param}=${access.token}` : ''),\n                    attributions: [\n                        `&copy; <a href=&quot;${map.group.link}&quot;>${map.group.name}</a>`,\n                    ]\n                });\n            return <Tile id={map.group.name + '-' + map.dataset.name} source={source} zIndex={0}/>;\n        }\n        if (baseMapUrl) {\n            const source = new OlXYZSource({url: baseMapUrl});\n            return <Tile id={baseMapUrl} source={source} zIndex={0}/>;\n        }\n        return null;\n    }\n);\n\nfunction findMap(endpoint: string): { group: MapGroup, dataset: MapSource } | null {\n    for (let group of maps) {\n        const dataset = group.datasets.find(dataset => dataset.endpoint === endpoint);\n        if (dataset) {\n            return {group, dataset};\n        }\n    }\n    return null;\n}","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport const LOCAL_OFFSET = -new Date(\"1970-01-01T00:00:00\").getTime();\n\nexport function dateTimeToUtcTime(dateTime: Date): number {\n    return dateTime.getTime();\n}\n\nexport function utcTimeToIsoDate(utcTime: number, local: boolean = false): Date {\n    return new Date(utcTime + (local ? LOCAL_OFFSET : 0));\n}\n\n\nexport function utcTimeToIsoDateString(utcTime: number, local: boolean = false) {\n    return utcTimeToIsoDate(utcTime, local)\n        .toISOString()\n        .substr(0, 10);\n}\n\nexport function utcTimeToIsoDateTimeString(utcTime: number, local: boolean = false, skipSeconds: boolean = false) {\n    return utcTimeToIsoDate(utcTime, local)\n        .toISOString()\n        .substr(0, skipSeconds ? 16 : 19)\n        .replace(\"T\", \" \");\n}\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as geojson from 'geojson';\r\n\r\nimport { utcTimeToIsoDateTimeString } from '../util/time';\r\nimport { findPlaceInPlaceGroups, Place, PlaceGroup } from './place';\r\n\r\n\r\n/**\r\n * Time is an integer value that is the number of milliseconds since 1 January 1970 UTC (Unix Time Stamp).\r\n */\r\nexport type Time = number;\r\nexport type TimeRange = [Time, Time];\r\n\r\nexport const UNIT = {\r\n    seconds: 1000,\r\n    minutes: 1000 * 60,\r\n    hours: 1000 * 60 * 60,\r\n    days: 1000 * 60 * 60 * 24,\r\n    weeks: 1000 * 60 * 60 * 24 * 7,\r\n    years: 1000 * 60 * 60 * 24 * 365,\r\n};\r\n\r\nexport interface TimeSeriesSource {\r\n    datasetId: string;\r\n    variableName: string;\r\n    variableUnits?: string;\r\n    placeId: string;\r\n    geometry: geojson.Geometry;\r\n    valueDataKey: keyof TimeSeriesPoint;\r\n    errorDataKey: keyof TimeSeriesPoint | null;\r\n}\r\n\r\nexport interface TimeSeriesPoint {\r\n    time: Time;\r\n    countTot: number;\r\n    count?: number;\r\n    mean?: number | null;\r\n    median?: number | null;\r\n    std?: number | null;\r\n    min?: number | null;\r\n    max?: number | null;\r\n    standard_error?: number | null;\r\n}\r\n\r\nexport interface TimeSeries {\r\n    source: TimeSeriesSource;\r\n    data: TimeSeriesPoint[];\r\n    dataProgress?: number;\r\n}\r\n\r\nexport interface TimeSeriesGroup {\r\n    id: string;\r\n    variableUnits?: string;\r\n    timeSeriesArray: TimeSeries[];\r\n}\r\n\r\nexport function equalTimeRanges(t1: TimeRange | null, t2: TimeRange | null) {\r\n    if (t1 === t2) {\r\n        return true;\r\n    } else if (t1 !== null && t2 != null) {\r\n        return t1[0] === t2[0] && t1[1] === t2[1];\r\n    }\r\n    return false;\r\n}\r\n\r\ntype CellValue = number | string | null | undefined;\r\ntype DataRow = CellValue[];\r\ntype RowData = {\r\n    placeId: string;\r\n    time: string;\r\n    [colName: string]: CellValue;\r\n};\r\ntype TimePlaceRows = { [timePlaceId: string]: RowData };\r\n\r\nexport interface TimeSeriesTable {\r\n    colNames: string[];\r\n    dataRows: DataRow[];\r\n    referencedPlaces: {[placeId: string]: Place};\r\n}\r\n\r\nexport function timeSeriesGroupsToTable(timeSeriesGroups: TimeSeriesGroup[],\r\n                                        placeGroups: PlaceGroup[]): TimeSeriesTable {\r\n\r\n    const dataColNames = new Set<string>();\r\n    const placeIds = new Set<string>();\r\n    const timePlaceRows: TimePlaceRows = {};\r\n    for (let timeSeriesGroup of timeSeriesGroups) {\r\n        for (let timeSeries of timeSeriesGroup.timeSeriesArray) {\r\n            const {placeId, datasetId, variableName, valueDataKey, errorDataKey} = timeSeries.source;\r\n            placeIds.add(placeId);\r\n            const valueColName = `${datasetId}.${variableName}.${valueDataKey}`;\r\n            dataColNames.add(valueColName);\r\n            let errorColName: string | null = null;\r\n            if (Boolean(errorDataKey)) {\r\n                errorColName = `${datasetId}.${variableName}.${errorDataKey}`;\r\n                dataColNames.add(errorColName);\r\n            }\r\n            timeSeries.data.forEach(point => {\r\n                const time = utcTimeToIsoDateTimeString(point.time);\r\n                const timePlaceId = placeId + '-' + time;\r\n                const timePlaceRow = timePlaceRows[timePlaceId];\r\n                if (!timePlaceRow) {\r\n                    timePlaceRows[timePlaceId] = {placeId, time, [valueColName]: point[valueDataKey]};\r\n                } else {\r\n                    timePlaceRows[timePlaceId] = {...timePlaceRow, [valueColName]: point[valueDataKey]};\r\n                }\r\n                if (errorColName !== null) {\r\n                    timePlaceRows[timePlaceId][errorColName!] = point[errorDataKey!];\r\n                }\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    const colNames: string[] = ['placeId', 'time'].concat(Array.from(dataColNames).sort());\r\n    const dataRows: DataRow[] = [];\r\n\r\n    Object.keys(timePlaceRows).forEach(timePlaceId => {\r\n        const rowData = timePlaceRows[timePlaceId];\r\n        const dataRow = new Array<CellValue>(colNames.length);\r\n        colNames.forEach((colName, i) => {\r\n            dataRow[i] = rowData[colName];\r\n        })\r\n        dataRows.push(dataRow);\r\n    });\r\n\r\n    dataRows.sort((row1, row2) => {\r\n        const time1: string = row1[1] as string;\r\n        const time2: string = row2[1] as string;\r\n        const timeDelta = time1.localeCompare(time2);\r\n        if (timeDelta !== 0) {\r\n            return timeDelta;\r\n        }\r\n        const placeId1: string = row1[0] as string;\r\n        const placeId2: string = row2[0] as string;\r\n        return placeId1.localeCompare(placeId2);\r\n    });\r\n\r\n    const referencedPlaces: {[placeId: string]: Place} = {};\r\n    placeIds.forEach(placeId => {\r\n        referencedPlaces[placeId] = findPlaceInPlaceGroups(placeGroups, placeId)!;\r\n    })\r\n\r\n    return {colNames, dataRows, referencedPlaces};\r\n}\r\n\r\n\r\n\r\nexport function timeSeriesGroupsToGeoJSON(timeSeriesGroups: TimeSeriesGroup[]): geojson.FeatureCollection {\r\n    const features: geojson.Feature[] = [];\r\n    for (let timeSeriesGroup of timeSeriesGroups) {\r\n        for (let timeSeries of timeSeriesGroup.timeSeriesArray) {\r\n            features.push(timeSeriesToGeoJSON(timeSeries));\r\n        }\r\n    }\r\n    return {type: \"FeatureCollection\", features};\r\n}\r\n\r\n\r\nexport function timeSeriesToGeoJSON(timeSeries: TimeSeries): geojson.Feature {\r\n    return {\r\n        type: \"Feature\",\r\n        id: `${timeSeries.source.datasetId}-${timeSeries.source.variableName}-${timeSeries.source.placeId}`,\r\n        geometry: timeSeries.source.geometry,\r\n        properties: {\r\n            datasetId: timeSeries.source.datasetId,\r\n            variableName: timeSeries.source.variableName,\r\n            variableUnits: timeSeries.source.variableUnits,\r\n            placeId: timeSeries.source.placeId,\r\n            valueDataKey: timeSeries.source.valueDataKey,\r\n            errorDataKey: timeSeries.source.errorDataKey,\r\n            data: timeSeries.data.map(p => {\r\n                return {\r\n                    ...p,\r\n                    time: utcTimeToIsoDateTimeString(p.time)\r\n                };\r\n            })\r\n        }\r\n    };\r\n}\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { MessageType } from '../states/messageLogState';\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\nexport const POST_MESSAGE = 'POST_MESSAGE';\r\n\r\nexport interface PostMessage {\r\n    type: typeof POST_MESSAGE;\r\n    messageType: MessageType;\r\n    messageText: string;\r\n}\r\n\r\nexport function postMessage(messageType: MessageType, messageText: string | Error): PostMessage {\r\n    return {type: POST_MESSAGE, messageType, messageText: (messageText as any).message || messageText + ''};\r\n}\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\nexport const HIDE_MESSAGE = 'HIDE_MESSAGE';\r\n\r\nexport interface HideMessage {\r\n    type: typeof HIDE_MESSAGE;\r\n    messageId: number;\r\n}\r\n\r\nexport function hideMessage(messageId: number): HideMessage {\r\n    return {type: HIDE_MESSAGE, messageId};\r\n}\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\r\nexport type MessageLogAction = PostMessage | HideMessage;\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Dispatch } from 'redux';\nimport * as geojson from 'geojson';\nimport JSZip from 'jszip';\n\nimport * as api from '../api'\nimport i18n from '../i18n';\nimport { ApiServerConfig, ApiServerInfo } from '../model/apiServer';\nimport { ColorBars } from '../model/colorBar';\nimport { Dataset } from '../model/dataset';\nimport {\n    findPlaceInPlaceGroups,\n    getUserPlacesFromCsv,\n    getUserPlacesFromGeoJson,\n    getUserPlacesFromWkt,\n    Place,\n    PlaceGroup\n} from '../model/place';\nimport { TimeSeries, TimeSeriesGroup, timeSeriesGroupsToTable } from '../model/timeSeries';\nimport {\n    mapProjectionSelector,\n    selectedDatasetIdSelector,\n    selectedDatasetTimeDimensionSelector,\n    selectedDatasetVariableSelector,\n    selectedPlaceGroupPlacesSelector,\n    selectedPlaceGroupsSelector,\n    selectedPlaceIdSelector,\n    selectedPlaceSelector,\n    selectedServerSelector,\n    selectedTimeChunkSizeSelector,\n    userPlacesFormatNameSelector,\n    userPlacesFormatOptionsCsvSelector,\n    userPlacesFormatOptionsGeoJsonSelector,\n    userPlacesFormatOptionsWktSelector\n} from '../selectors/controlSelectors';\nimport { datasetsSelector, placeGroupsSelector, userPlaceGroupSelector } from '../selectors/dataSelectors';\nimport { AppState } from '../states/appState';\nimport {\n    AddActivity,\n    addActivity,\n    openDialog,\n    OpenDialog,\n    RemoveActivity,\n    removeActivity,\n    SelectDataset,\n    selectDataset,\n    selectPlace,\n    SelectPlace,\n    selectPlaceGroups,\n    SelectPlaceGroups,\n    UpdateSettings,\n} from './controlActions';\nimport { MessageLogAction, PostMessage, postMessage } from './messageLogActions';\n\nconst saveAs = require('file-saver');\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_SERVER_INFO = 'UPDATE_SERVER_INFO';\n\nexport interface UpdateServerInfo {\n    type: typeof UPDATE_SERVER_INFO;\n    serverInfo: ApiServerInfo;\n}\n\nexport function updateServerInfo() {\n    return (dispatch: Dispatch<UpdateServerInfo | AddActivity | RemoveActivity | MessageLogAction>, getState: () => AppState) => {\n        const apiServer = selectedServerSelector(getState());\n\n        dispatch(addActivity(UPDATE_SERVER_INFO, i18n.get('Connecting to server')));\n\n        api.getServerInfo(apiServer.url)\n            .then((serverInfo: ApiServerInfo) => {\n                dispatch(_updateServerInfo(serverInfo));\n            })\n            .catch(error => {\n                dispatch(postMessage('error', error));\n            })\n            // 'then' because Microsoft Edge does not understand method finally\n            .then(() => {\n                dispatch(removeActivity(UPDATE_SERVER_INFO));\n            });\n    };\n}\n\nexport function _updateServerInfo(serverInfo: ApiServerInfo): UpdateServerInfo {\n    return {type: UPDATE_SERVER_INFO, serverInfo};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_RESOURCES = 'UPDATE_RESOURCES';\n\nexport function updateResources() {\n    return (dispatch: Dispatch<UpdateDatasets | SelectDataset | AddActivity | RemoveActivity | MessageLogAction>, getState: () => AppState) => {\n        const apiServer = selectedServerSelector(getState());\n        dispatch(addActivity(UPDATE_RESOURCES, i18n.get('Updating resources')));\n        api.updateResources(apiServer.url, getState().userAuthState.accessToken)\n            .then(ok => {\n                if (ok) {\n                    window.location.reload();\n                }\n            })\n            .finally(() =>\n                dispatch(removeActivity(UPDATE_RESOURCES))\n            );\n    }\n}\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_DATASETS = 'UPDATE_DATASETS';\n\nexport interface UpdateDatasets {\n    type: typeof UPDATE_DATASETS;\n    datasets: Dataset[];\n}\n\nexport function updateDatasets() {\n    return (dispatch: Dispatch<UpdateDatasets | SelectDataset | AddActivity | RemoveActivity | MessageLogAction>, getState: () => AppState) => {\n        const apiServer = selectedServerSelector(getState());\n\n        dispatch(addActivity(UPDATE_DATASETS, i18n.get('Loading data')));\n\n        api.getDatasets(apiServer.url, getState().userAuthState.accessToken)\n            .then((datasets: Dataset[]) => {\n                dispatch(_updateDatasets(datasets));\n                if (datasets.length > 0) {\n                    const selectedDatasetId = getState().controlState.selectedDatasetId || datasets[0].id;\n                    dispatch(selectDataset(selectedDatasetId, datasets, true) as any);\n                }\n            })\n            .catch(error => {\n                dispatch(postMessage('error', error));\n                dispatch(_updateDatasets([]));\n            })\n            // 'then' because Microsoft Edge does not understand method finally\n            .then(() => {\n                dispatch(removeActivity(UPDATE_DATASETS));\n            });\n    };\n}\n\nexport function _updateDatasets(datasets: Dataset[]): UpdateDatasets {\n    return {type: UPDATE_DATASETS, datasets};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_DATASET_PLACE_GROUP = 'UPDATE_DATASET_PLACE_GROUP';\n\nexport interface UpdateDatasetPlaceGroup {\n    type: typeof UPDATE_DATASET_PLACE_GROUP;\n    datasetId: string;\n    placeGroup: PlaceGroup;\n}\n\nexport function updateDatasetPlaceGroup(datasetId: string,\n                                        placeGroup: PlaceGroup): UpdateDatasetPlaceGroup {\n    return {type: UPDATE_DATASET_PLACE_GROUP, datasetId, placeGroup};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const ADD_USER_PLACE = 'ADD_USER_PLACE';\n\nexport interface AddUserPlace {\n    type: typeof ADD_USER_PLACE;\n    id: string;\n    label: string;\n    color: string;\n    geometry: geojson.Geometry;\n    selectPlace: boolean;\n}\n\nexport function addUserPlace(id: string,\n                             label: string,\n                             color: string,\n                             geometry: geojson.Geometry,\n                             selectPlace: boolean) {\n    return (dispatch: Dispatch<AddUserPlace>, getState: () => AppState) => {\n        dispatch(_addUserPlace(id, label, color, geometry, selectPlace));\n        if (getState().controlState.autoShowTimeSeries) {\n            dispatch(addTimeSeries() as any);\n        }\n    };\n}\n\nexport function _addUserPlace(id: string,\n                              label: string,\n                              color: string,\n                              geometry: geojson.Geometry,\n                              selectPlace: boolean): AddUserPlace {\n    return {type: ADD_USER_PLACE, id, label, color, geometry, selectPlace};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const ADD_USER_PLACES = 'ADD_USER_PLACES';\n\nexport interface AddUserPlaces {\n    type: typeof ADD_USER_PLACES;\n    places: Place[];\n    mapProjection: string;\n    selectPlace: boolean;\n}\n\nexport function addUserPlaces(places: Place[],\n                              mapProjection: string,\n                              selectPlace: boolean): AddUserPlaces {\n    return {\n        type: ADD_USER_PLACES,\n        places: places,\n        mapProjection,\n        selectPlace\n    };\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ntype UserPlacesDispatch = Dispatch<AddUserPlaces\n    | SelectPlaceGroups\n    | SelectPlace\n    | UpdateSettings\n    | OpenDialog\n    | PostMessage>;\n\n\nexport function addUserPlacesFromText(text: string) {\n    return (dispatch: UserPlacesDispatch, getState: () => AppState) => {\n        const formatName = userPlacesFormatNameSelector(getState());\n        let places: Place[];\n        try {\n            if (formatName === 'csv') {\n                const options = userPlacesFormatOptionsCsvSelector(getState());\n                places = getUserPlacesFromCsv(text, options);\n            } else if (formatName === 'geojson') {\n                const options = userPlacesFormatOptionsGeoJsonSelector(getState());\n                places = getUserPlacesFromGeoJson(text, options);\n            } else if (formatName === 'wkt') {\n                const options = userPlacesFormatOptionsWktSelector(getState());\n                places = getUserPlacesFromWkt(text, options);\n            } else {\n                places = [];\n            }\n        } catch (e) {\n            dispatch(postMessage('error', e));\n            dispatch(openDialog('addUserPlacesFromText'));\n            places = [];\n        }\n        if (places.length) {\n            dispatch(addUserPlaces(places, mapProjectionSelector(getState()), true));\n            dispatch(selectPlaceGroups(['user']) as any);\n            if (places.length === 1) {\n                dispatch(selectPlace(\n                    places[0].id,\n                    selectedPlaceGroupPlacesSelector(getState()),\n                    true\n                ) as any);\n                if (getState().controlState.autoShowTimeSeries) {\n                    dispatch(addTimeSeries() as any);\n                }\n            }\n            dispatch(postMessage('info', i18n.get(`Imported ${places.length} place(s)`)));\n        } else {\n            dispatch(postMessage('warning', i18n.get('No places imported')));\n        }\n    };\n}\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const REMOVE_USER_PLACE = 'REMOVE_USER_PLACE';\n\nexport interface RemoveUserPlace {\n    type: typeof REMOVE_USER_PLACE;\n    id: string;\n    places: Place[];\n}\n\nexport function removeUserPlace(id: string, places: Place[]): RemoveUserPlace {\n    return {type: REMOVE_USER_PLACE, id, places};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const REMOVE_ALL_USER_PLACES = 'REMOVE_ALL_USER_PLACES';\n\nexport interface RemoveAllUserPlaces {\n    type: typeof REMOVE_ALL_USER_PLACES;\n}\n\nexport function removeAllUserPlaces(): RemoveAllUserPlaces {\n    return {type: REMOVE_ALL_USER_PLACES};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport function addTimeSeries() {\n    return (dispatch: Dispatch<UpdateTimeSeries | MessageLogAction>, getState: () => AppState) => {\n        const apiServer = selectedServerSelector(getState());\n\n        const selectedDatasetId = selectedDatasetIdSelector(getState());\n        const selectedDatasetTimeDim = selectedDatasetTimeDimensionSelector(getState());\n        const selectedVariable = selectedDatasetVariableSelector(getState());\n        const selectedPlaceId = selectedPlaceIdSelector(getState());\n        const selectedPlace = selectedPlaceSelector(getState())!;\n        const timeSeriesUpdateMode = getState().controlState.timeSeriesUpdateMode;\n        const useMedian = getState().controlState.showTimeSeriesMedian;\n        const inclStDev = getState().controlState.showTimeSeriesErrorBars;\n        let timeChunkSize = selectedTimeChunkSizeSelector(getState());\n\n        const placeGroups = placeGroupsSelector(getState());\n\n        if (selectedDatasetId && selectedVariable && selectedPlaceId && selectedDatasetTimeDim) {\n            const timeLabels = selectedDatasetTimeDim.labels;\n            const numTimeLabels = timeLabels.length;\n\n            timeChunkSize = timeChunkSize > 0 ? timeChunkSize:numTimeLabels;\n\n            let endTimeIndex = numTimeLabels - 1;\n            let startTimeIndex = endTimeIndex - timeChunkSize + 1;\n\n            const getTimeSeriesChunk = () => {\n                const startDateLabel = startTimeIndex >= 0 ? timeLabels[startTimeIndex]:null;\n                const endDateLabel = timeLabels[endTimeIndex];\n                return api.getTimeSeriesForGeometry(apiServer.url,\n                    selectedDatasetId,\n                    selectedVariable,\n                    selectedPlace.id,\n                    selectedPlace.geometry,\n                    startDateLabel,\n                    endDateLabel,\n                    useMedian,\n                    inclStDev,\n                    getState().userAuthState.accessToken);\n            };\n\n            const successAction = (timeSeries: TimeSeries | null) => {\n                if (timeSeries !== null && isValidPlace(placeGroups, selectedPlace.id)) {\n                    const hasMore = startTimeIndex > 0;\n                    const dataProgress = hasMore ? (numTimeLabels - startTimeIndex) / numTimeLabels:1.0;\n                    dispatch(updateTimeSeries({...timeSeries, dataProgress},\n                        timeSeriesUpdateMode,\n                        endTimeIndex === numTimeLabels - 1 ? 'new':'append'));\n                    if (hasMore && isValidPlace(placeGroups, selectedPlace.id)) {\n                        startTimeIndex -= timeChunkSize;\n                        endTimeIndex -= timeChunkSize;\n                        getTimeSeriesChunk().then(successAction);\n                    }\n                } else {\n                    dispatch(postMessage('info', 'No data found here'));\n                }\n            };\n\n            getTimeSeriesChunk()\n                .then(successAction)\n                .catch((error: any) => {\n                    dispatch(postMessage('error', error));\n                });\n        }\n    };\n}\n\nfunction isValidPlace(placeGroups: PlaceGroup[], placeId: string) {\n    return findPlaceInPlaceGroups(placeGroups, placeId) !== null;\n}\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_TIME_SERIES = 'UPDATE_TIME_SERIES';\n\nexport interface UpdateTimeSeries {\n    type: typeof UPDATE_TIME_SERIES;\n    timeSeries: TimeSeries;\n    updateMode: 'add' | 'replace' | 'remove';\n    dataMode: 'new' | 'append';\n}\n\nexport function updateTimeSeries(timeSeries: TimeSeries, updateMode: 'add' | 'replace' | 'remove', dataMode: 'new' | 'append'): UpdateTimeSeries {\n    return {type: UPDATE_TIME_SERIES, timeSeries, updateMode, dataMode};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const REMOVE_TIME_SERIES_GROUP = 'REMOVE_TIME_SERIES_GROUP';\n\nexport interface RemoveTimeSeriesGroup {\n    type: typeof REMOVE_TIME_SERIES_GROUP;\n    id: string;\n}\n\nexport function removeTimeSeriesGroup(id: string): RemoveTimeSeriesGroup {\n    return {type: REMOVE_TIME_SERIES_GROUP, id};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const REMOVE_ALL_TIME_SERIES = 'REMOVE_ALL_TIME_SERIES';\n\nexport interface RemoveAllTimeSeries {\n    type: typeof REMOVE_ALL_TIME_SERIES;\n}\n\nexport function removeAllTimeSeries(): RemoveAllTimeSeries {\n    return {type: REMOVE_ALL_TIME_SERIES};\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////\n\n\nexport const CONFIGURE_SERVERS = 'CONFIGURE_SERVERS';\n\nexport interface ConfigureServers {\n    type: typeof CONFIGURE_SERVERS;\n    servers: ApiServerConfig[];\n    selectedServerId: string;\n}\n\nexport function configureServers(servers: ApiServerConfig[], selectedServerId: string) {\n    return (dispatch: Dispatch<any>, getState: () => AppState) => {\n        if (getState().controlState.selectedServerId !== selectedServerId) {\n            dispatch(removeAllTimeSeries());\n            dispatch(_configureServers(servers, selectedServerId));\n            dispatch(syncWithServer());\n        } else if (getState().dataState.userServers !== servers) {\n            dispatch(_configureServers(servers, selectedServerId));\n        }\n    };\n}\n\nexport function _configureServers(servers: ApiServerConfig[], selectedServerId: string): ConfigureServers {\n    return {type: CONFIGURE_SERVERS, servers, selectedServerId};\n}\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport function syncWithServer() {\n    return (dispatch: Dispatch<any>) => {\n        dispatch(updateServerInfo());\n        dispatch(updateDatasets());\n        dispatch(updateColorBars());\n    };\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_COLOR_BARS = 'UPDATE_COLOR_BARS';\n\nexport interface UpdateColorBars {\n    type: typeof UPDATE_COLOR_BARS;\n    colorBars: ColorBars;\n}\n\nexport function updateColorBars() {\n    return (dispatch: Dispatch<UpdateColorBars | MessageLogAction>, getState: () => AppState) => {\n        const apiServer = selectedServerSelector(getState());\n\n        api.getColorBars(apiServer.url)\n            .then((colorBars: ColorBars) => {\n                dispatch(_updateColorBars(colorBars));\n            })\n            .catch(error => {\n                dispatch(postMessage('error', error));\n            });\n    };\n}\n\nexport function _updateColorBars(colorBars: ColorBars): UpdateColorBars {\n    return {type: UPDATE_COLOR_BARS, colorBars};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n\nexport const UPDATE_VARIABLE_COLOR_BAR = 'UPDATE_VARIABLE_COLOR_BAR';\n\nexport interface UpdateVariableColorBar {\n    type: typeof UPDATE_VARIABLE_COLOR_BAR;\n    datasetId: string;\n    variableName: string;\n    colorBarMinMax: [number, number];\n    colorBarName: string;\n    opacity: number;\n}\n\nexport function updateVariableColorBar(colorBarMinMax: [number, number],\n                                       colorBarName: string,\n                                       opacity: number) {\n    return (dispatch: Dispatch<UpdateVariableColorBar>, getState: () => AppState) => {\n        const selectedDatasetId = getState().controlState.selectedDatasetId;\n        const selectedVariableName = getState().controlState.selectedVariableName;\n        if (selectedDatasetId && selectedVariableName) {\n            dispatch(_updateVariableColorBar(\n                selectedDatasetId, selectedVariableName,\n                colorBarMinMax, colorBarName, opacity\n            ));\n        }\n    };\n}\n\nexport function _updateVariableColorBar(datasetId: string,\n                                        variableName: string,\n                                        colorBarMinMax: [number, number],\n                                        colorBarName: string,\n                                        opacity: number): UpdateVariableColorBar {\n    return {\n        type: UPDATE_VARIABLE_COLOR_BAR,\n        datasetId,\n        variableName,\n        colorBarMinMax,\n        colorBarName,\n        opacity\n    };\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport function exportData() {\n    return (dispatch: Dispatch<UpdateVariableColorBar>, getState: () => AppState) => {\n        const {\n            exportTimeSeries,\n            exportTimeSeriesSeparator,\n            exportPlaces,\n            exportPlacesAsCollection,\n            exportZipArchive,\n            exportFileName,\n        } = getState().controlState;\n\n        let placeGroups: PlaceGroup[] = [];\n\n        if (exportTimeSeries) {\n            // Time series may reference any place, so collect all known place groups.\n            placeGroups = [];\n            const datasets = datasetsSelector(getState());\n            datasets.forEach(dataset => {\n                if (dataset.placeGroups) {\n                    placeGroups = placeGroups.concat(dataset.placeGroups);\n                }\n            });\n            placeGroups.push(userPlaceGroupSelector(getState()));\n        } else if (exportPlaces) {\n            // Just export all visible places.\n            placeGroups = selectedPlaceGroupsSelector(getState());\n        }\n\n        _exportData(getState().dataState.timeSeriesGroups,\n            placeGroups,\n            {\n                includeTimeSeries: exportTimeSeries,\n                includePlaces: exportPlaces,\n                separator: exportTimeSeriesSeparator,\n                placesAsCollection: exportPlacesAsCollection,\n                zip: exportZipArchive,\n                fileName: exportFileName,\n            }\n        );\n    };\n}\n\n\nabstract class Exporter {\n    abstract write(path: string, content: string): any;\n\n    abstract close(): any;\n}\n\nclass ZipExporter extends Exporter {\n    fileName: string;\n    zipArchive: JSZip;\n\n    constructor(fileName: string) {\n        super();\n        this.fileName = fileName;\n        this.zipArchive = new JSZip();\n    }\n\n    write(path: string, content: string) {\n        this.zipArchive.file(path, content);\n    }\n\n    close() {\n        this.zipArchive.generateAsync({type: 'blob'})\n            .then((content) => saveAs(content, this.fileName));\n    }\n}\n\nclass FileExporter extends Exporter {\n\n    write(path: string, content: string) {\n        const blob = new Blob([content],\n            {type: 'text/plain;charset=utf-8'});\n        saveAs(blob, path);\n    }\n\n    close() {\n    }\n}\n\ninterface ExportOptions {\n    includeTimeSeries?: boolean;\n    separator?: string;\n    includePlaces?: boolean;\n    fileName?: string;\n    placesAsCollection?: boolean;\n    zip?: boolean;\n}\n\nfunction _exportData(timeSeriesGroups: TimeSeriesGroup[],\n                     placeGroups: PlaceGroup[],\n                     options: ExportOptions) {\n\n    let {\n        includeTimeSeries,\n        separator,\n        includePlaces,\n        fileName,\n        placesAsCollection,\n        zip,\n    } = options;\n\n    separator = separator || 'TAB';\n    if (separator.toUpperCase() === 'TAB') {\n        separator = '\\t';\n    }\n\n    fileName = fileName || 'export';\n\n    if (!includeTimeSeries && !includePlaces) {\n        return;\n    }\n\n    let exporter: Exporter;\n    if (zip) {\n        exporter = new ZipExporter(`${fileName}.zip`);\n    } else {\n        exporter = new FileExporter();\n    }\n\n    let placesToExport: { [placeId: string]: Place };\n\n    if (includeTimeSeries) {\n        const {colNames, dataRows, referencedPlaces} = timeSeriesGroupsToTable(timeSeriesGroups, placeGroups);\n        const validTypes: { [typeName: string]: boolean } = {number: true, string: true};\n        const csvHeaderRow = colNames.join(separator);\n        const csvDataRows = dataRows.map(row => row.map(value => validTypes[typeof value] ? value + '':'').join(separator));\n        const csvText = [csvHeaderRow].concat(csvDataRows).join('\\n');\n        exporter.write(`${fileName}.txt`, csvText);\n        placesToExport = referencedPlaces;\n    } else {\n        placesToExport = {};\n        placeGroups.forEach(placeGroup => {\n            if (placeGroup.features) {\n                placeGroup.features.forEach(place => {\n                    placesToExport[place.id] = place;\n                });\n            }\n        });\n    }\n\n    if (includePlaces) {\n        if (placesAsCollection) {\n            const collection = {\n                type: 'FeatureCollection',\n                features: Object.keys(placesToExport).map(placeId => placesToExport![placeId])\n            };\n            exporter.write(`${fileName}.geojson`,\n                JSON.stringify(collection, null, 2));\n        } else {\n            Object.keys(placesToExport).forEach(placeId => {\n                exporter.write(`${placeId}.geojson`,\n                    JSON.stringify(placesToExport![placeId], null, 2));\n            });\n        }\n    }\n\n    exporter.close();\n}\n\n/*\nfunction _downloadTimeSeriesGeoJSON(timeSeriesGroups: TimeSeriesGroup[],\n                                    placeGroups: PlaceGroup[],\n                                    format: 'GeoJSON' | 'CSV',\n                                    fileName: string = 'time-series',\n                                    multiFile: boolean = true,\n                                    zipArchive: boolean = true) {\n    const featureCollection = timeSeriesGroupsToGeoJSON(timeSeriesGroups);\n\n    if (format === 'GeoJSON') {\n        if (zipArchive) {\n            const zip = new JSZip();\n            if (multiFile) {\n                zip.file(`${fileName}.geojson`,\n                         JSON.stringify(featureCollection, null, 2));\n            } else {\n                for (let feature of featureCollection.features) {\n                    zip.file(`${feature.id}.geojson`,\n                             JSON.stringify(feature, null, 2));\n                }\n            }\n            zip.generateAsync({type: \"blob\"})\n               .then((content) => saveAs(content, `${fileName}.zip`));\n        } else {\n            if (multiFile) {\n                throw new Error('Cannot download multi-file exports');\n            }\n            const blob = new Blob([JSON.stringify(featureCollection, null, 2)],\n                                  {type: \"text/plain;charset=utf-8\"});\n            saveAs(blob, `${fileName}.geojson`);\n        }\n    } else {\n        // TODO (forman): implement CSV export\n        throw new Error(`Download as ${format} is not yet implemented`);\n    }\n\n}\n*/\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport type DataAction =\n    UpdateServerInfo\n    | UpdateDatasets\n    | UpdateDatasetPlaceGroup\n    | AddUserPlace\n    | AddUserPlaces\n    | RemoveUserPlace\n    | RemoveAllUserPlaces\n    | UpdateTimeSeries\n    | RemoveTimeSeriesGroup\n    | RemoveAllTimeSeries\n    | ConfigureServers\n    | UpdateColorBars\n    | UpdateVariableColorBar;\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { callJsonApi } from './callApi';\r\nimport { ApiServerInfo } from '../model/apiServer';\r\n\r\nexport function getServerInfo(apiServerUrl: string): Promise<ApiServerInfo> {\r\n    return callJsonApi<ApiServerInfo>(`${apiServerUrl}/`);\r\n}\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { callJsonApi, makeRequestInit, makeRequestUrl } from './callApi';\n\n\nexport function updateResources(apiServerUrl: string, accessToken: string | null): Promise<boolean> {\n    const url = makeRequestUrl(`${apiServerUrl}/maintenance/update`, []);\n    const init = makeRequestInit(accessToken);\n    try {\n        return callJsonApi<boolean>(url, init)\n            .then(() => {\n                return true;\n            })\n            .catch(error => {\n                console.error(error);\n                return false;\n            });\n    } catch (error) {\n        console.error(error);\n        return Promise.resolve(false);\n    }\n}\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as geojson from 'geojson';\r\n\r\nimport { Variable } from '../model/variable';\r\nimport { TimeSeries, TimeSeriesPoint } from '../model/timeSeries';\r\nimport { callJsonApi, makeRequestInit, makeRequestUrl, QueryComponent } from './callApi';\r\n\r\n\r\nexport function getTimeSeriesForGeometry(apiServerUrl: string,\r\n                                         datasetId: string,\r\n                                         variable: Variable,\r\n                                         placeId: string,\r\n                                         geometry: geojson.Geometry,\r\n                                         startDate: string | null,\r\n                                         endDate: string | null,\r\n                                         useMedian: boolean,\r\n                                         inclStDev: boolean,\r\n                                         accessToken: string | null): Promise<TimeSeries | null> {\r\n\r\n    let valueDataKey: keyof TimeSeriesPoint;\r\n    let errorDataKey: keyof TimeSeriesPoint | null = null;\r\n    const query: QueryComponent[] = [];\r\n    if (useMedian) {\r\n        query.push(['aggMethods', 'median']);\r\n        valueDataKey = 'median';\r\n    } else if (inclStDev) {\r\n        query.push(['aggMethods', 'mean,std']);\r\n        valueDataKey = 'mean';\r\n        errorDataKey = 'std';\r\n    } else {\r\n        query.push(['aggMethods', 'mean']);\r\n        valueDataKey = 'mean';\r\n    }\r\n    if (startDate) {\r\n        query.push(['startDate', startDate]);\r\n    }\r\n    if (endDate) {\r\n        query.push(['endDate', endDate]);\r\n    }\r\n    const dsId = encodeURIComponent(datasetId);\r\n    const variableName = encodeURIComponent(variable.name);\r\n    const url = makeRequestUrl(\r\n        `${apiServerUrl}/timeseries/${dsId}/${variableName}`,\r\n        query\r\n    );\r\n\r\n    const init = {\r\n        ...makeRequestInit(accessToken),\r\n        method: 'post',\r\n        body: JSON.stringify(geometry),\r\n    };\r\n\r\n    const convertTimeSeriesResult = (result: { [name: string]: any }) => {\r\n        result = result['result'];\r\n        if (!result || result.length === 0) {\r\n            return null;\r\n        }\r\n        const data = result.map((item: any) => {\r\n            return {...item, time: new Date(item.time).getTime()};\r\n        });\r\n        const source = {\r\n            datasetId,\r\n            variableName: variable.name,\r\n            variableUnits: variable.units || undefined,\r\n            placeId,\r\n            geometry,\r\n            valueDataKey,\r\n            errorDataKey,\r\n        };\r\n        return {source, data, color: \"green\"};\r\n    };\r\n\r\n    return callJsonApi<TimeSeries>(url, init)\r\n        .then(convertTimeSeriesResult);\r\n}\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Extent as OlExtent } from 'ol/extent';\nimport { default as OlGeoJSONFormat } from 'ol/format/GeoJSON';\nimport { Geometry as OlGeometry } from 'ol/geom';\nimport { Dispatch } from 'redux';\nimport * as api from '../api'\nimport i18n from '../i18n';\nimport { Dataset, findDataset } from '../model/dataset';\nimport { findPlaceInPlaceGroups, isValidPlaceGroup, Place, PlaceGroup } from '../model/place';\nimport { Time, TimeRange } from '../model/timeSeries';\n\nimport {\n    selectedDatasetIdSelector,\n    selectedDatasetSelectedPlaceGroupsSelector,\n    selectedDatasetSelector,\n    selectedPlaceGroupsSelector,\n    selectedPlaceIdSelector,\n    selectedServerSelector,\n} from '../selectors/controlSelectors';\nimport { datasetsSelector } from '../selectors/dataSelectors';\nimport { AppState } from '../states/appState';\nimport { ControlState, MapInteraction, TimeAnimationInterval } from '../states/controlState';\nimport { UPDATE_DATASET_PLACE_GROUP, updateDatasetPlaceGroup, UpdateDatasetPlaceGroup, } from './dataActions';\nimport { MessageLogAction, postMessage } from './messageLogActions';\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SELECT_DATASET = 'SELECT_DATASET';\n\nexport interface SelectDataset {\n    type: typeof SELECT_DATASET;\n    selectedDatasetId: string | null;\n    // TODO: Having datasets in here is ugly, but we need it in the reducer.\n    // See\n    // - https://medium.com/@williamjoshualacey/refactoring-redux-using-react-context-aa29fa16f4b7\n    // - https://codeburst.io/the-ugly-side-of-redux-6591fde68200\n    datasets: Dataset[];\n}\n\nexport function selectDataset(selectedDatasetId: string | null, datasets: Dataset[], showInMap: boolean) {\n    return (dispatch: Dispatch<SelectDataset>) => {\n        dispatch(_selectDataset(selectedDatasetId, datasets));\n        if (selectedDatasetId && showInMap) {\n            dispatch(flyToDataset(selectedDatasetId) as any);\n        }\n    }\n}\n\nexport function _selectDataset(selectedDatasetId: string | null, datasets: Dataset[]): SelectDataset {\n    return {type: SELECT_DATASET, selectedDatasetId, datasets};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport function flyToDataset(selectedDatasetId: string) {\n    return (dispatch: Dispatch<FlyTo>, getState: () => AppState) => {\n        const datasets = datasetsSelector(getState());\n        const dataset = findDataset(datasets, selectedDatasetId);\n        if (dataset && dataset.bbox) {\n            dispatch(flyTo(dataset.bbox));\n        }\n    }\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst SIMPLE_GEOMETRY_TYPES = [\n    'Point',\n    'LineString',\n    'LinearRing',\n    'Polygon',\n    'MultiPoint',\n    'MultiLineString',\n    'MultiPolygon',\n    'Circle'\n];\n\nexport function flyToPlace(selectedPlaceId: string) {\n    return (dispatch: Dispatch<FlyTo>, getState: () => AppState) => {\n        const placeGroups = selectedPlaceGroupsSelector(getState());\n        const place = findPlaceInPlaceGroups(placeGroups, selectedPlaceId);\n        if (place) {\n            if (place.bbox) {\n                dispatch(flyTo(place.bbox));\n            } else if (place.geometry && SIMPLE_GEOMETRY_TYPES.includes(place.geometry.type)) {\n                dispatch(flyTo(new OlGeoJSONFormat().readGeometry(place.geometry)));\n            }\n        }\n    }\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport function flyToSelectedObject() {\n    return (dispatch: Dispatch, getState: () => AppState) => {\n        const placeId = selectedPlaceIdSelector(getState());\n        const datasetId = selectedDatasetIdSelector(getState());\n        if (placeId) {\n            dispatch(flyToPlace(placeId) as any);\n        } else if (datasetId) {\n            dispatch(flyToDataset(datasetId) as any);\n        }\n    }\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const FLY_TO = 'FLY_TO';\n\nexport interface FlyTo {\n    type: typeof FLY_TO;\n    mapId: string;\n    location: OlGeometry | OlExtent | null;\n}\n\nexport function flyTo(location: OlGeometry | OlExtent | null): FlyTo {\n    return {type: FLY_TO, mapId: 'map', location};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SELECT_PLACE_GROUPS = 'SELECT_PLACE_GROUPS';\n\nexport interface SelectPlaceGroups {\n    type: typeof SELECT_PLACE_GROUPS;\n    selectedPlaceGroupIds: string[] | null;\n}\n\nexport function selectPlaceGroups(selectedPlaceGroupIds: string[] | null) {\n\n    return (dispatch: Dispatch<SelectPlaceGroups | UpdateDatasetPlaceGroup | AddActivity | RemoveActivity | MessageLogAction>, getState: () => AppState) => {\n        const apiServer = selectedServerSelector(getState());\n\n        dispatch(_selectPlaceGroups(selectedPlaceGroupIds));\n\n        const dataset = selectedDatasetSelector(getState());\n        const placeGroups = selectedDatasetSelectedPlaceGroupsSelector(getState());\n        if (dataset !== null && placeGroups.length > 0) {\n            for (let placeGroup of placeGroups) {\n                if (!isValidPlaceGroup(placeGroup)) {\n                    const datasetId = dataset!.id;\n                    const placeGroupId = placeGroup.id;\n                    const activityId = `${UPDATE_DATASET_PLACE_GROUP}-${datasetId}-${placeGroupId}`;\n                    dispatch(addActivity(activityId, i18n.get('Loading places')));\n                    api.getDatasetPlaceGroup(apiServer.url,\n                                             datasetId,\n                                             placeGroupId,\n                                             getState().userAuthState.accessToken)\n                       .then((placeGroup: PlaceGroup) => {\n                           dispatch(updateDatasetPlaceGroup(dataset!.id, placeGroup));\n                       })\n                       .catch(error => {\n                           dispatch(postMessage('error', error));\n                       })\n                       .finally(() => {\n                           dispatch(removeActivity(activityId));\n                       });\n                }\n            }\n        }\n    };\n}\n\nexport function _selectPlaceGroups(selectedPlaceGroupIds: string[] | null): SelectPlaceGroups {\n    return {type: SELECT_PLACE_GROUPS, selectedPlaceGroupIds};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SELECT_PLACE = 'SELECT_PLACE';\n\nexport interface SelectPlace {\n    type: typeof SELECT_PLACE;\n    selectedPlaceId: string | null;\n    // TODO: Having places in here is ugly, but we need it in the reducer.\n    places: Place[];\n}\n\n\nexport function selectPlace(selectedPlaceId: string | null, places: Place[], showInMap: boolean) {\n    return (dispatch: Dispatch<SelectPlace>) => {\n        dispatch(_selectPlace(selectedPlaceId, places));\n        if (showInMap && selectedPlaceId) {\n            dispatch(flyToPlace(selectedPlaceId) as any);\n        }\n    }\n}\n\nfunction _selectPlace(selectedPlaceId: string | null, places: Place[]): SelectPlace {\n    return {type: SELECT_PLACE, selectedPlaceId, places};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SET_RGB_LAYER_VISIBILITY = 'SET_RGB_LAYER_VISIBILITY';\n\nexport interface SetRgbLayerVisibility {\n    type: typeof SET_RGB_LAYER_VISIBILITY;\n    showRgbLayer: boolean;\n}\n\nexport function setRgbLayerVisibility(showRgbLayer: boolean): SetRgbLayerVisibility {\n    return {type: SET_RGB_LAYER_VISIBILITY, showRgbLayer};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SELECT_VARIABLE = 'SELECT_VARIABLE';\n\nexport interface SelectVariable {\n    type: typeof SELECT_VARIABLE;\n    selectedVariableName: string | null;\n}\n\nexport function selectVariable(selectedVariableName: string | null): SelectVariable {\n    return {type: SELECT_VARIABLE, selectedVariableName};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SELECT_TIME = 'SELECT_TIME';\n\nexport interface SelectTime {\n    type: typeof SELECT_TIME;\n    selectedTime: Time | null;\n}\n\nexport function selectTime(selectedTime: Time | null): SelectTime {\n    return {type: SELECT_TIME, selectedTime};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const INC_SELECTED_TIME = 'INC_SELECTED_TIME';\n\nexport interface IncSelectedTime {\n    type: typeof INC_SELECTED_TIME;\n    increment: -1 | 1;\n}\n\nexport function incSelectedTime(increment: -1 | 1): IncSelectedTime {\n    return {type: INC_SELECTED_TIME, increment};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SELECT_TIME_RANGE = 'SELECT_TIME_RANGE';\n\nexport interface SelectTimeRange {\n    type: typeof SELECT_TIME_RANGE;\n    selectedTimeRange: TimeRange | null;\n}\n\nexport function selectTimeRange(selectedTimeRange: TimeRange | null): SelectTimeRange {\n    return {type: SELECT_TIME_RANGE, selectedTimeRange};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n// TODO (forman): this action doesn't seem to be in use - remove!\n\nexport const SELECT_TIME_SERIES_UPDATE_MODE = 'SELECT_TIME_SERIES_UPDATE_MODE';\n\nexport interface SelectTimeSeriesUpdateMode {\n    type: typeof SELECT_TIME_SERIES_UPDATE_MODE;\n    timeSeriesUpdateMode: 'add' | 'replace';\n}\n\nexport function selectTimeSeriesUpdateMode(timeSeriesUpdateMode: 'add' | 'replace'): SelectTimeSeriesUpdateMode {\n    return {type: SELECT_TIME_SERIES_UPDATE_MODE, timeSeriesUpdateMode};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_TIME_ANIMATION = 'UPDATE_TIME_ANIMATION';\n\nexport interface UpdateTimeAnimation {\n    type: typeof UPDATE_TIME_ANIMATION;\n    timeAnimationActive: boolean;\n    timeAnimationInterval: TimeAnimationInterval;\n}\n\nexport function updateTimeAnimation(timeAnimationActive: boolean, timeAnimationInterval: TimeAnimationInterval): UpdateTimeAnimation {\n    return {type: UPDATE_TIME_ANIMATION, timeAnimationActive, timeAnimationInterval};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SET_MAP_INTERACTION = 'SET_MAP_INTERACTION';\n\nexport interface SetMapInteraction {\n    type: typeof SET_MAP_INTERACTION;\n    mapInteraction: MapInteraction;\n}\n\nexport function setMapInteraction(mapInteraction: MapInteraction): SetMapInteraction {\n    return {type: SET_MAP_INTERACTION, mapInteraction};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SHOW_INFO_CARD = 'SHOW_INFO_CARD';\n\nexport interface ShowInfoCard {\n    type: typeof SHOW_INFO_CARD;\n    infoCardOpen: boolean;\n}\n\nexport function showInfoCard(infoCardOpen: boolean): ShowInfoCard {\n    return {type: SHOW_INFO_CARD, infoCardOpen};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const SET_VISIBLE_INFO_CARD_ELEMENTS = 'SET_VISIBLE_INFO_CARD_ELEMENTS';\n\nexport interface SetVisibleInfoCardElements {\n    type: typeof SET_VISIBLE_INFO_CARD_ELEMENTS;\n    visibleElements: string[];\n}\n\nexport function setVisibleInfoCardElements(visibleElements: string[]): SetVisibleInfoCardElements {\n    return {type: SET_VISIBLE_INFO_CARD_ELEMENTS, visibleElements};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_INFO_CARD_ELEMENT_VIEW_MODE = 'UPDATE_INFO_CARD_ELEMENT_VIEW_MODE';\n\nexport interface UpdateInfoCardElementCodeMode {\n    type: typeof UPDATE_INFO_CARD_ELEMENT_VIEW_MODE;\n    elementType: string;\n    viewMode: string;\n}\n\nexport function updateInfoCardElementViewMode(elementType: string, viewMode: string): UpdateInfoCardElementCodeMode {\n    return {type: UPDATE_INFO_CARD_ELEMENT_VIEW_MODE, elementType, viewMode};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const ADD_ACTIVITY = 'ADD_ACTIVITY';\n\nexport interface AddActivity {\n    type: typeof ADD_ACTIVITY;\n    id: string;\n    message: string;\n}\n\nexport function addActivity(id: string, message: string): AddActivity {\n    return {type: ADD_ACTIVITY, id, message};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const REMOVE_ACTIVITY = 'REMOVE_ACTIVITY';\n\nexport interface RemoveActivity {\n    type: typeof REMOVE_ACTIVITY;\n    id: string;\n}\n\nexport function removeActivity(id: string): RemoveActivity {\n    return {type: REMOVE_ACTIVITY, id};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const CHANGE_LOCALE = 'CHANGE_LOCALE';\n\nexport interface ChangeLocale {\n    type: typeof CHANGE_LOCALE;\n    locale: string;\n}\n\nexport function changeLocale(locale: string): ChangeLocale {\n    return {type: CHANGE_LOCALE, locale};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const OPEN_DIALOG = 'OPEN_DIALOG';\n\nexport interface OpenDialog {\n    type: typeof OPEN_DIALOG;\n    dialogId: string;\n}\n\nexport function openDialog(dialogId: string): OpenDialog {\n    return {type: OPEN_DIALOG, dialogId};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const CLOSE_DIALOG = 'CLOSE_DIALOG';\n\nexport interface CloseDialog {\n    type: typeof CLOSE_DIALOG;\n    dialogId: string;\n}\n\nexport function closeDialog(dialogId: string): CloseDialog {\n    return {type: CLOSE_DIALOG, dialogId};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport const UPDATE_SETTINGS = 'UPDATE_SETTINGS';\n\nexport interface UpdateSettings {\n    type: typeof UPDATE_SETTINGS;\n    settings: Partial<ControlState>;\n}\n\nexport function updateSettings(settings: Partial<ControlState>): UpdateSettings {\n    return {type: UPDATE_SETTINGS, settings};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport type ControlAction =\n    SelectDataset\n    | UpdateDatasetPlaceGroup\n    | SelectVariable\n    | SelectPlaceGroups\n    | SelectPlace\n    | SelectTime\n    | SetRgbLayerVisibility\n    | IncSelectedTime\n    | SelectTimeRange\n    | SelectTimeSeriesUpdateMode\n    | UpdateTimeAnimation\n    | SetMapInteraction\n    | AddActivity\n    | RemoveActivity\n    | ChangeLocale\n    | UpdateSettings\n    | OpenDialog\n    | CloseDialog\n    | ShowInfoCard\n    | SetVisibleInfoCardElements\n    | UpdateInfoCardElementCodeMode\n    | FlyTo;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport Divider from '@mui/material/Divider';\nimport Grid from '@mui/material/Grid';\nimport List from '@mui/material/List';\nimport ListItem from '@mui/material/ListItem';\nimport ListItemText from '@mui/material/ListItemText';\nimport Paper from '@mui/material/Paper';\nimport {UserProfile as UserInfo} from \"oidc-client-ts\";\n\nimport i18n from '../i18n';\nimport {WithLocale} from '../util/lang';\n\n\ninterface UserProfileProps extends WithLocale {\n    userInfo: UserInfo;\n}\n\nconst UserProfile: React.FC<UserProfileProps> = ({userInfo}) => {\n\n    return (\n        <Grid container justifyContent=\"center\" spacing={1}>\n            <Grid item>\n                <img src={userInfo.picture} width={84} alt={i18n.get('User Profile')}/>\n            </Grid>\n            <Grid item>\n                <Paper elevation={3}>\n                    <List>\n                        <ListItem>\n                            <ListItemText\n                                primary={userInfo.name}\n                                secondary={i18n.get('User name')}/>\n                        </ListItem>\n                        <Divider light/>\n                        <ListItem>\n                            <ListItemText\n                                primary={`${userInfo.email} (${userInfo.email_verified ? i18n.get('verified') : i18n.get('not verified')})`}\n                                secondary={i18n.get('E-mail')}/>\n                        </ListItem>\n                        <Divider light/>\n                        <ListItem>\n                            <ListItemText\n                                primary={userInfo.nickname}\n                                secondary={i18n.get('Nickname')}/>\n                        </ListItem>\n                    </List>\n                </Paper>\n            </Grid>\n        </Grid>\n    );\n};\n\nexport default UserProfile;","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport Transition from 'react-transition-group/Transition';\nimport { useAuth } from \"react-oidc-context\";\nimport { Theme } from '@mui/material';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Avatar from '@mui/material/Avatar';\nimport Button from '@mui/material/Button';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport IconButton from '@mui/material/IconButton';\nimport Menu from '@mui/material/Menu';\nimport MenuItem from '@mui/material/MenuItem';\nimport PersonIcon from '@mui/icons-material/Person';\nimport i18n from '../i18n';\n\nimport { WithLocale } from '../util/lang';\nimport { Config } from '../config';\nimport UserProfile from '../components/UserProfile';\nimport { deepOrange } from '@mui/material/colors';\n\n\nconst styles = (theme: Theme) => createStyles(\n        {\n            imageAvatar: {\n                width: 32,\n                height: 32,\n                color: '#fff',\n                backgroundColor: deepOrange[300],\n            },\n            letterAvatar: {\n                width: 32,\n                height: 32,\n                color: '#fff',\n                backgroundColor: deepOrange[300],\n            },\n            signInWrapper: {\n                margin: theme.spacing(1),\n                position: 'relative',\n            },\n            signInProgress: {\n                color: deepOrange[300],\n                position: 'absolute',\n                top: '50%',\n                left: '50%',\n                zIndex: 1,\n                marginTop: -12,\n                marginLeft: -12,\n            },\n            iconButton: {\n                padding: 0,\n            }\n        }\n);\n\ninterface UserControlProps extends WithStyles<typeof styles>, WithLocale {\n    updateAccessToken: (accessToken: string | null) => any;\n}\n\nconst UserControlContent: React.FC<UserControlProps> = ({classes, updateAccessToken}) => {\n    const auth = useAuth();\n    const [userMenuAnchorEl, setUserMenuAnchorEl] = React.useState<null | HTMLElement>(null);\n    const [profileDialogOpen, setProfileDialogOpen] = React.useState(false);\n\n    if (process.env.NODE_ENV === 'development') {\n        console.debug('User: ', auth.user);\n    }\n\n    React.useEffect(() => {\n        console.log(\"User changed:\", auth.user);\n        if (auth.user && auth.user.access_token) {\n            updateAccessToken(auth.user.access_token);\n        } else {\n            updateAccessToken(null);\n        }\n    }, [auth.user, updateAccessToken]);\n\n    const handleUserProfileMenuItemClicked = () => {\n        handleUserMenuClose();\n        setProfileDialogOpen(true);\n    };\n\n    const handleUserProfileDialogClose = () => {\n        setProfileDialogOpen(false);\n    };\n\n    const handleUserMenuOpen = (event: React.MouseEvent<HTMLButtonElement>) => {\n        setUserMenuAnchorEl(event.currentTarget);\n    };\n\n    const handleUserMenuClose = () => {\n        setUserMenuAnchorEl(null);\n    };\n\n    const handleSignInButtonClicked = () => {\n        auth.signinRedirect().then(() => {\n            if (process.env.NODE_ENV === 'development') {\n                console.debug('Signed in:', auth.user);\n            }\n        }).catch(e => {\n            console.error(e);\n        });\n    };\n\n    const handleSignOutMenuItemClicked = () => {\n        handleUserMenuClose();\n        auth.signoutRedirect().then(() => {\n            if (process.env.NODE_ENV === 'development') {\n                console.debug('Signed out:', auth.user);\n            }\n        }).catch(e => {\n            console.error(e);\n        });\n    };\n\n    if (auth.user) {\n        const userInfo = auth.user.profile;\n        let avatar;\n        let avatarContent: React.ReactNode = <PersonIcon/>;\n        if (!userInfo) {\n            avatar = <Avatar className={classes.letterAvatar}>?</Avatar>;\n        } else if (userInfo.picture) {\n            avatar = <Avatar className={classes.imageAvatar} src={userInfo.picture} alt={userInfo.name}/>;\n        } else {\n            const name1 = userInfo.given_name || userInfo.name || userInfo.nickname;\n            const name2 = userInfo.family_name;\n            let letters: string | null = null;\n            if (name1 && name2) {\n                letters = name1[0] + name2[0];\n            } else if (name1) {\n                letters = name1[0];\n            } else if (name2) {\n                letters = name2[0];\n            }\n            if (letters !== null) {\n                avatarContent = letters.toUpperCase();\n            }\n            avatar = <Avatar className={classes.letterAvatar}>{avatarContent}</Avatar>;\n        }\n        return (\n                <React.Fragment>\n                    <IconButton\n                            onClick={handleUserMenuOpen}\n                            aria-controls=\"user-menu\"\n                            aria-haspopup=\"true\"\n                            size=\"small\"\n                            className={classes.iconButton}\n                    >\n                        {avatar}\n                    </IconButton>\n                    <Menu\n                            id=\"user-menu\"\n                            anchorEl={userMenuAnchorEl}\n                            keepMounted\n                            open={Boolean(userMenuAnchorEl)}\n                            onClose={handleUserMenuClose}\n                    >\n                        <MenuItem onClick={handleUserProfileMenuItemClicked}>{i18n.get('Profile')}</MenuItem>\n                        <MenuItem onClick={handleSignOutMenuItemClicked}>{i18n.get('Log out')}</MenuItem>\n                    </Menu>\n                    <Dialog\n                            open={profileDialogOpen}\n                            TransitionComponent={Transition as any}\n                            keepMounted\n                            onClose={handleUserProfileDialogClose}\n                            aria-labelledby=\"alert-dialog-slide-title\"\n                            aria-describedby=\"alert-dialog-slide-description\"\n                    >\n                        <DialogTitle id=\"alert-dialog-slide-title\">{i18n.get('User Profile')}</DialogTitle>\n                        <DialogContent>\n                            <UserProfile userInfo={auth.user.profile}/>\n                        </DialogContent>\n                        <DialogActions>\n                            <Button onClick={handleUserProfileDialogClose} color=\"primary\">\n                                OK\n                            </Button>\n                        </DialogActions>\n                    </Dialog>\n                </React.Fragment>\n        );\n    } else {\n        let userButton = (\n                <IconButton onClick={auth.isLoading ? undefined : handleSignInButtonClicked} size=\"small\">\n                    <PersonIcon/>\n                </IconButton>\n        );\n        if (auth.isLoading) {\n            userButton = (\n                    <div className={classes.signInWrapper}>\n                        {userButton}\n                        <CircularProgress size={24} className={classes.signInProgress}/>\n                    </div>\n            );\n        }\n        return userButton;\n    }\n};\n\nconst UserControl: React.FC<UserControlProps> = (props) => {\n    if (!Config.instance.authClient) {\n        return null;\n    }\n    return <UserControlContent {...props}/>\n}\n\nexport default withStyles(styles)(UserControl);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nimport { Dispatch } from \"redux\";\nimport { AppState } from \"../states/appState\";\nimport { updateDatasets } from \"./dataActions\";\n\nexport const UPDATE_ACCESS_TOKEN = 'UPDATE_ACCESS_TOKEN';\n\nexport interface UpdateAccessToken {\n    type: typeof UPDATE_ACCESS_TOKEN;\n    accessToken: string | null;\n}\n\nexport function updateAccessToken(accessToken: string | null) {\n    return (dispatch: Dispatch, getState: () => AppState) => {\n        const prevAccessToken = getState().userAuthState.accessToken;\n        if (prevAccessToken !== accessToken) {\n            dispatch(_updateAccessToken(accessToken));\n            if (accessToken === null  || prevAccessToken === null) {\n                dispatch(updateDatasets() as any);\n            }\n        }\n    }\n}\n\nfunction _updateAccessToken(accessToken: string | null): UpdateAccessToken {\n    return {type: UPDATE_ACCESS_TOKEN, accessToken};\n}\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nexport type UserAuthAction = UpdateAccessToken;\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\nimport { AppState } from '../states/appState';\r\nimport UserControl from '../components/UserControl';\r\nimport { updateAccessToken } from '../actions/userAuthActions';\r\n\r\n\r\n// noinspection JSUnusedLocalSymbols\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {};\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    updateAccessToken\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(UserControl);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { DialogContent } from '@mui/material';\nimport React, { useEffect, useState } from 'react';\nimport Markdown from 'react-markdown';\nimport { Theme } from '@mui/material/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport makeStyles from '@mui/styles/makeStyles';\nimport Dialog from '@mui/material/Dialog';\nimport AppBar from '@mui/material/AppBar';\nimport Toolbar from '@mui/material/Toolbar';\nimport IconButton from '@mui/material/IconButton';\nimport Typography from '@mui/material/Typography';\nimport CloseIcon from '@mui/icons-material/Close';\nimport Slide from '@mui/material/Slide';\n\n\nconst useStyles = makeStyles((theme: Theme) => createStyles(\n    {\n        dialog: {\n            backgroundColor: theme.palette.grey[600]\n        },\n        appBar: {\n            position: 'relative',\n        },\n        title: {\n            marginLeft: theme.spacing(2),\n            flex: 1,\n        },\n        text: {\n            marginTop: theme.spacing(4),\n            marginLeft: theme.spacing(40),\n            marginRight: theme.spacing(40),\n        }\n    }\n));\n\nconst Transition = React.forwardRef(function Transition(props, ref) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\ninterface MarkdownPageProps {\n    title: string;\n    href: string;\n    open: boolean;\n    onClose: () => void;\n}\n\nconst MarkdownPage: React.FC<MarkdownPageProps> = ({\n                                                       title,\n                                                       href,\n                                                       open,\n                                                       onClose\n                                                   }) => {\n    const [markdownText, setMarkdownText] = useState('');\n\n    useEffect(() => {\n        fetch(href)\n            .then(response => response.text())\n            .then(text => setMarkdownText(text));\n    });\n\n    const classes = useStyles();\n\n    return (\n        <Dialog fullScreen open={open} onClose={onClose} TransitionComponent={Transition as any}>\n            <AppBar className={classes.appBar}>\n                <Toolbar>\n                    <IconButton\n                        edge=\"start\"\n                        color=\"inherit\"\n                        onClick={onClose}\n                        aria-label=\"close\"\n                        size=\"large\">\n                        <CloseIcon/>\n                    </IconButton>\n                    <Typography variant=\"h6\" className={classes.title}>{title}</Typography>\n                </Toolbar>\n            </AppBar>\n            <DialogContent className={classes.dialog}>\n                <div className={classes.text}>\n                    <Markdown children={markdownText} linkTarget=\"_blank\"/>\n                </div>\n            </DialogContent>\n        </Dialog>\n    );\n};\n\nexport default MarkdownPage;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { AppBar, IconButton, Menu, MenuItem, Theme, Toolbar, Typography } from '@mui/material';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport HelpOutlineIcon from '@mui/icons-material/HelpOutline';\nimport SettingsIcon from '@mui/icons-material/Settings';\nimport RefreshIcon from '@mui/icons-material/Refresh';\nimport { deepOrange } from '@mui/material/colors';\nimport classNames from 'classnames';\n\nimport { Config } from '../config';\nimport i18n from '../i18n';\nimport { AppState } from '../states/appState';\nimport { WithLocale } from '../util/lang';\nimport UserControl from './UserControl';\nimport { openDialog } from '../actions/controlActions';\nimport { updateResources } from \"../actions/dataActions\";\nimport MarkdownPage from '../components/MarkdownPage';\n\n\ninterface AppBarProps extends WithStyles<typeof styles>, WithLocale {\n    appName: string;\n    openDialog: (dialogId: string) => any;\n    allowRefresh?: boolean;\n    updateResources: () => any;\n}\n\n\n// noinspection JSUnusedLocalSymbols\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        appName: Config.instance.branding.appBarTitle,\n        allowRefresh: Config.instance.branding.allowRefresh,\n    };\n};\n\nconst mapDispatchToProps = {\n    openDialog,\n    updateResources,\n};\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        toolbar: {\n            backgroundColor: Config.instance.branding.headerBackgroundColor,\n            paddingRight: theme.spacing(1),\n        },\n        appBar: {\n            zIndex: theme.zIndex.drawer + 1,\n            transition: theme.transitions.create(['width', 'margin'], {\n                easing: theme.transitions.easing.sharp,\n                duration: theme.transitions.duration.leavingScreen,\n            }),\n        },\n        logoAnchor: {\n            display: \"flex\",\n            alignItems: \"center\"\n        },\n        logo: {\n            marginLeft: theme.spacing(1),\n        },\n        title: {\n            flexGrow: 1,\n            marginLeft: theme.spacing(1),\n            ...Config.instance.branding.headerTitleStyle,\n        },\n        imageAvatar: {\n            width: 24,\n            height: 24,\n            color: '#fff',\n            backgroundColor: deepOrange[300],\n        },\n        letterAvatar: {\n            width: 24,\n            height: 24,\n            color: '#fff',\n            backgroundColor: deepOrange[300],\n        },\n        signInWrapper: {\n            margin: theme.spacing(1),\n            position: 'relative',\n        },\n        signInProgress: {\n            color: deepOrange[300],\n            position: 'absolute',\n            top: '50%',\n            left: '50%',\n            zIndex: 1,\n            marginTop: -12,\n            marginLeft: -12,\n        },\n        iconButton: {\n            marginLeft: theme.spacing(2),\n            ...Config.instance.branding.headerIconStyle,\n        }\n    }\n);\n\nconst _AppBar: React.FC<AppBarProps> = (\n    {\n        classes,\n        appName,\n        openDialog,\n        allowRefresh,\n        updateResources\n    }: AppBarProps) => {\n    const [helpMenuAnchorEl, setHelpMenuAnchorEl] = React.useState(null);\n    const [imprintOpen, setImprintOpen] = React.useState(false);\n    const [manualOpen, setManualOpen] = React.useState(false);\n\n    const handleSettingsButtonClicked = () => {\n        openDialog('settings');\n    };\n\n    const handleOpenHelpMenu = (event: any) => {\n        setHelpMenuAnchorEl(event.currentTarget);\n    };\n\n    const handleCloseHelpMenu = () => {\n        setHelpMenuAnchorEl(null);\n    };\n\n    const handleOpenManual = () => {\n        handleCloseHelpMenu();\n        setManualOpen(true);\n    };\n\n    const handleCloseManual = () => {\n        setManualOpen(false);\n    };\n\n    const handleOpenImprint = () => {\n        handleCloseHelpMenu();\n        setImprintOpen(true);\n    };\n\n    const handleCloseImprint = () => {\n        setImprintOpen(false);\n    };\n\n    return (\n        <AppBar\n            position=\"absolute\"\n            className={classNames(classes.appBar)}\n        >\n            <Toolbar disableGutters className={classes.toolbar} variant=\"dense\">\n                <a\n                    href={Config.instance.branding.organisationUrl || \"\"}\n                    target=\"_blank\"\n                    rel=\"noreferrer\"\n                    className={classes.logoAnchor}\n                >\n                    <img\n                        src={Config.instance.branding.logoImage}\n                        width={Config.instance.branding.logoWidth}\n                        alt={'xcube logo'}\n                        className={classes.logo}\n                    />\n                </a>\n                <Typography\n                    component=\"h1\"\n                    variant=\"h6\"\n                    color=\"inherit\"\n                    noWrap\n                    className={classes.title}\n                >\n                    {appName}\n                </Typography>\n                <UserControl/>\n                {allowRefresh &&\n                    <Tooltip arrow title={i18n.get('Refresh')}>\n                        <IconButton onClick={updateResources} size=\"small\" className={classes.iconButton}>\n                            <RefreshIcon/>\n                        </IconButton>\n                    </Tooltip>\n                }\n                <Tooltip arrow title={i18n.get('Help')}>\n                    <IconButton onClick={handleOpenHelpMenu} size=\"small\" className={classes.iconButton}>\n                        <HelpOutlineIcon/>\n                    </IconButton>\n                </Tooltip>\n                <Tooltip arrow title={i18n.get('Settings')}>\n                    <IconButton onClick={handleSettingsButtonClicked} size=\"small\" className={classes.iconButton}>\n                        <SettingsIcon/>\n                    </IconButton>\n                </Tooltip>\n            </Toolbar>\n            <Menu\n                id=\"simple-menu\"\n                anchorEl={helpMenuAnchorEl}\n                keepMounted\n                open={Boolean(helpMenuAnchorEl)}\n                onClose={handleCloseHelpMenu}\n                getContentAnchorEl={null}\n                anchorOrigin={{vertical: 'bottom', horizontal: 'center'}}\n                transformOrigin={{vertical: 'top', horizontal: 'center'}}\n            >\n                <MenuItem onClick={handleOpenManual}>{i18n.get('User Manual')}</MenuItem>\n                <MenuItem onClick={handleOpenImprint}>{i18n.get('Imprint')}</MenuItem>\n            </Menu>\n            <MarkdownPage title={i18n.get('User Manual')}\n                          href='manual.md'\n                          open={manualOpen} onClose={handleCloseManual}/>\n            <MarkdownPage title={i18n.get('Imprint')}\n                          href='imprint.md'\n                          open={imprintOpen} onClose={handleCloseImprint}/>\n        </AppBar>\n    );\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(_AppBar));\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { Theme } from '@mui/material/styles';\n\nimport { WithStyles } from '@mui/styles';\nimport withStyles from '@mui/styles/withStyles';\nimport createStyles from '@mui/styles/createStyles';\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        form: {\n            display: 'flex',\n            flexWrap: 'wrap',\n            paddingTop: theme.spacing(1),\n            paddingLeft: theme.spacing(1),\n            paddingRight: theme.spacing(1),\n            flexGrow: 0,\n        },\n    });\n\ninterface ControlBarProps extends WithStyles<typeof styles> {\n}\n\nconst ControlBar: React.FC<ControlBarProps> = ({classes, children}) => {\n    return (\n        <form className={classes.form} autoComplete=\"off\">\n            {children}\n        </form>\n    );\n};\n\nexport default withStyles(styles)(ControlBar);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport withStyles from '@mui/styles/withStyles';\nimport createStyles from '@mui/styles/createStyles';\nimport FormControl from '@mui/material/FormControl';\n\nimport { WithLocale } from '../util/lang';\nimport Box from '@mui/material/Box';\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        formControl: {\n            marginRight: theme.spacing(1),\n        }\n    }\n);\n\ninterface ControlBarItemProps extends WithStyles<typeof styles>, WithLocale {\n    label: React.ReactNode;\n    control: React.ReactNode;\n    actions?: React.ReactNode | null;\n}\n\nconst ControlBarItem: React.FC<ControlBarItemProps> = ({\n                                                           classes,\n                                                           label,\n                                                           control,\n                                                           actions\n                                                       }) => {\n    return (\n        <FormControl variant=\"standard\" className={classes.formControl}>\n            <Box>\n                {label}\n                {control}\n                {actions}\n            </Box>\n        </FormControl>\n    );\n};\n\nexport default withStyles(styles)(ControlBarItem);\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Input from '@mui/material/Input';\nimport InputLabel from '@mui/material/InputLabel';\nimport MenuItem from '@mui/material/MenuItem';\nimport Select from '@mui/material/Select';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport * as React from 'react';\nimport i18n from '../i18n';\n\nimport { Dataset } from '../model/dataset';\nimport { WithLocale } from '../util/lang';\nimport ControlBarItem from './ControlBarItem';\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        formControl: {\n            marginRight: theme.spacing(2),\n            marginBottom: theme.spacing(1),\n            minWidth: 120,\n        },\n        selectEmpty: {},\n    });\n\ninterface DatasetSelectProps extends WithStyles<typeof styles>, WithLocale {\n    selectedDatasetId: string | null;\n    datasets: Dataset[];\n    selectDataset: (datasetId: string | null, datasets: Dataset[], showInMap: boolean) => void;\n}\n\nconst DatasetSelect: React.FC<DatasetSelectProps> = ({\n                                                         classes,\n                                                         selectedDatasetId,\n                                                         datasets,\n                                                         selectDataset,\n                                                     }) => {\n\n    const handleDatasetChange = (event: React.ChangeEvent<{ name?: string; value: any; }>) => {\n        const datasetId = event.target.value || null;\n        selectDataset(datasetId, datasets, true);\n    };\n\n    selectedDatasetId = selectedDatasetId || '';\n    datasets = datasets || [];\n\n    const datasetSelectLabel = (\n        <InputLabel shrink htmlFor=\"dataset-select\">\n            {i18n.get('Dataset')}\n        </InputLabel>\n    );\n\n    const datasetSelect = (\n        <Select\n            variant=\"standard\"\n            value={selectedDatasetId}\n            onChange={handleDatasetChange}\n            input={<Input name=\"dataset\" id=\"dataset-select\"/>}\n            displayEmpty\n            name=\"dataset\"\n            className={classes.selectEmpty}>\n            {datasets.map(dataset => (\n                <MenuItem\n                    key={dataset.id}\n                    value={dataset.id}\n                    selected={dataset.id === selectedDatasetId}\n                >\n                    {dataset.title}\n                </MenuItem>\n            ))}\n        </Select>\n    );\n\n    return (\n        <ControlBarItem\n            label={datasetSelectLabel}\n            control={datasetSelect}\n        />\n    );\n};\n\nexport default withStyles(styles)(DatasetSelect);\n\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport DatasetSelect from \"../components/DatasetSelect\";\r\nimport { AppState } from '../states/appState';\r\nimport { selectDataset } from '../actions/controlActions';\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        locale: state.controlState.locale,\r\n        selectedDatasetId: state.controlState.selectedDatasetId,\r\n        datasets: state.dataState.datasets,\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    selectDataset\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(DatasetSelect);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport IconButton from '@mui/material/IconButton';\nimport Input from '@mui/material/Input';\nimport InputLabel from '@mui/material/InputLabel';\nimport MenuItem from '@mui/material/MenuItem';\nimport Select from '@mui/material/Select';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport TimelineIcon from '@mui/icons-material/Timeline';\nimport * as React from 'react';\nimport i18n from '../i18n';\n\nimport { Variable } from '../model/variable';\nimport { WithLocale } from '../util/lang';\nimport ControlBarItem from './ControlBarItem';\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        formControl: {\n            marginRight: theme.spacing(2),\n            marginBottom: theme.spacing(1),\n            minWidth: 120,\n        },\n        selectEmpty: {},\n        button: {\n            margin: theme.spacing(0.1),\n        },\n    });\n\ninterface VariableSelectProps extends WithStyles<typeof styles>, WithLocale {\n    selectedVariableName: string | null;\n    canAddTimeSeries: boolean;\n    variables: Variable[];\n    selectVariable: (variableName: string | null) => void;\n    addTimeSeries: () => void;\n}\n\nconst VariableSelect: React.FC<VariableSelectProps> = ({\n                                                           classes,\n                                                           canAddTimeSeries,\n                                                           selectedVariableName,\n                                                           variables,\n                                                           selectVariable,\n                                                           addTimeSeries\n                                                       }) => {\n\n    const handleVariableChange = (event: React.ChangeEvent<{ name?: string; value: any; }>) => {\n        selectVariable(event.target.value || null);\n    };\n\n    const handleAddTimeSeriesButtonClick = () => {\n        addTimeSeries();\n    };\n\n\n    selectedVariableName = selectedVariableName || '';\n    variables = variables || [];\n\n    const variableSelectLabel = (\n        <InputLabel shrink htmlFor=\"variable-select\">\n            {i18n.get('Variable')}\n        </InputLabel>\n    );\n\n    const variableSelect = (\n        <Select\n            variant=\"standard\"\n            className={classes.selectEmpty}\n            value={selectedVariableName}\n            onChange={handleVariableChange}\n            input={<Input name=\"variable\" id=\"variable-select\"/>}\n            displayEmpty\n            name=\"variable\">\n            {variables.map(variable => (\n                <MenuItem\n                    key={variable.name}\n                    value={variable.name}\n                    selected={variable.name === selectedVariableName}\n                >\n                    {variable.title || variable.name}\n                </MenuItem>\n            ))}\n        </Select>\n    );\n    const timeSeriesButton = (\n        <IconButton\n            className={classes.button}\n            disabled={!canAddTimeSeries}\n            onClick={handleAddTimeSeriesButtonClick}\n            size=\"large\">\n            <Tooltip arrow title={i18n.get('Show time-series diagram')}>\n                {<TimelineIcon/>}\n            </Tooltip>\n        </IconButton>\n    );\n\n    return (\n        <ControlBarItem\n            label={variableSelectLabel}\n            control={variableSelect}\n            actions={timeSeriesButton}\n        />\n    );\n};\n\nexport default withStyles(styles)(VariableSelect);\n\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport VariableSelect from \"../components/VariableSelect\";\r\nimport { AppState } from '../states/appState';\r\nimport { addTimeSeries } from \"../actions/dataActions\";\r\nimport { selectVariable } from '../actions/controlActions';\r\nimport { canAddTimeSeriesSelector, selectedDatasetVariablesSelector } from '../selectors/controlSelectors';\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        locale: state.controlState.locale,\r\n\r\n        selectedVariableName: state.controlState.selectedVariableName,\r\n        canAddTimeSeries: canAddTimeSeriesSelector(state),\r\n        variables: selectedDatasetVariablesSelector(state),\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    selectVariable,\r\n    addTimeSeries,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(VariableSelect);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport FormControlLabel from '@mui/material/FormControlLabel';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Switch from '@mui/material/Switch';\nimport Tooltip from '@mui/material/Tooltip';\nimport * as React from 'react';\nimport i18n from '../i18n';\n\nimport { RgbSchema } from '../model/dataset';\nimport { WithLocale } from '../util/lang';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {});\n\ninterface RgbSwitchProps extends WithStyles<typeof styles>, WithLocale {\n    showRgbLayer: boolean;\n    rgbSchema: RgbSchema | null;\n    setRgbLayerVisibility: (showRgbLayer: boolean) => void;\n}\n\nconst RgbSwitch: React.FC<RgbSwitchProps> = ({showRgbLayer, rgbSchema, setRgbLayerVisibility}) => {\n\n    const handleSwitchChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n        setRgbLayerVisibility(event.target.checked);\n    };\n\n    return (\n        <Tooltip arrow title={i18n.get('Show RGB layer instead')}>\n            <FormControlLabel label={i18n.get('RGB')} control={\n                <Switch\n                    color={'primary'}\n                    checked={rgbSchema !== null ? showRgbLayer : false}\n                    disabled={rgbSchema === null}\n                    onChange={handleSwitchChange}\n                />\n            }/>\n        </Tooltip>\n    );\n};\n\nexport default withStyles(styles)(RgbSwitch);\n\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport { AppState } from '../states/appState';\r\nimport { setRgbLayerVisibility } from '../actions/controlActions';\r\nimport { selectedDatasetRgbSchemaSelector } from '../selectors/controlSelectors';\r\nimport RgbSwitch from '../components/RgbSwitch';\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        locale: state.controlState.locale,\r\n        rgbSchema: selectedDatasetRgbSchemaSelector(state),\r\n        showRgbLayer: state.controlState.showRgbLayer,\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    setRgbLayerVisibility,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(RgbSwitch);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Checkbox from '@mui/material/Checkbox';\nimport IconButton from '@mui/material/IconButton';\nimport Input from '@mui/material/Input';\nimport InputLabel from '@mui/material/InputLabel';\nimport ListItemText from '@mui/material/ListItemText';\nimport MenuItem from '@mui/material/MenuItem';\nimport Select from '@mui/material/Select';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport RemoveCircleOutlineIcon from '@mui/icons-material/RemoveCircleOutline';\nimport * as React from 'react';\nimport i18n from '../i18n';\n\nimport { PlaceGroup } from '../model/place';\nimport { WithLocale } from '../util/lang';\nimport ControlBarItem from './ControlBarItem';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        select: {\n            minWidth: '5em',\n        },\n    });\n\ninterface PlaceGroupSelectProps extends WithStyles<typeof styles>, WithLocale {\n    selectedPlaceGroupIds: string[] | null;\n    placeGroups: PlaceGroup[];\n    selectPlaceGroups: (placeGroupIds: string[] | null) => void;\n    removeAllUserPlaces: () => void;\n\n    selectedPlaceGroupsTitle: string;\n\n    language?: string;\n}\n\nconst PlaceGroupsSelect: React.FC<PlaceGroupSelectProps> = ({\n                                                                classes,\n                                                                placeGroups,\n                                                                selectPlaceGroups,\n                                                                selectedPlaceGroupIds,\n                                                                selectedPlaceGroupsTitle,\n                                                                removeAllUserPlaces,\n                                                            }) => {\n\n    const handlePlaceGroupsChange = (event: React.ChangeEvent<{ name?: string; value: any; }>) => {\n        selectPlaceGroups(event.target.value as any as string[] || null);\n    };\n\n    const handleRemoveButtonClick = () => {\n        removeAllUserPlaces();\n    };\n\n    const renderSelectedPlaceGroupsTitle = () => {\n        return selectedPlaceGroupsTitle;\n    };\n\n    placeGroups = placeGroups || [];\n    selectedPlaceGroupIds = selectedPlaceGroupIds || [];\n\n    if (placeGroups.length === 0 || (placeGroups.length === 1 && placeGroups[0].id === 'user')) {\n        return null;\n    }\n\n    const placeGroupsSelectLabel = (\n        <InputLabel\n            shrink\n            htmlFor=\"place-groups-select\"\n        >\n            {i18n.get('Places')}\n        </InputLabel>\n    );\n\n    const placeGroupsSelect = (\n        <Select\n            variant=\"standard\"\n            multiple\n            displayEmpty\n            onChange={handlePlaceGroupsChange}\n            input={<Input name=\"place-groups\" id=\"place-groups-select\"/>}\n            value={selectedPlaceGroupIds}\n            renderValue={renderSelectedPlaceGroupsTitle}\n            name=\"place-groups\"\n            className={classes.select}>\n            {placeGroups.map(placeGroup => (\n                <MenuItem\n                    key={placeGroup.id}\n                    value={placeGroup.id}\n                >\n                    <Checkbox checked={selectedPlaceGroupIds!.indexOf(placeGroup.id) > -1}/>\n                    <ListItemText primary={placeGroup.title}/>\n                </MenuItem>\n            ))}\n        </Select>\n    );\n\n    const removeEnabled = selectedPlaceGroupIds.length === 1 && selectedPlaceGroupIds[0] === 'user';\n    const placeGroupRemoveButton = (\n        <IconButton disabled={!removeEnabled} onClick={handleRemoveButtonClick} size=\"large\">\n            <Tooltip arrow title={i18n.get('Remove places')}>\n                {<RemoveCircleOutlineIcon/>}\n            </Tooltip>\n        </IconButton>\n    );\n\n    return (\n        <ControlBarItem\n            label={placeGroupsSelectLabel}\n            control={placeGroupsSelect}\n            actions={placeGroupRemoveButton}\n        />\n    );\n};\n\nexport default withStyles(styles)(PlaceGroupsSelect);\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport PlaceGroupsSelect from \"../components/PlaceGroupsSelect\";\r\nimport { AppState } from '../states/appState';\r\nimport { removeAllUserPlaces } from '../actions/dataActions';\r\nimport { selectPlaceGroups } from '../actions/controlActions';\r\nimport {\r\n    placeGroupsSelector,\r\n    selectedPlaceGroupsTitleSelector\r\n} from '../selectors/controlSelectors';\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        locale: state.controlState.locale,\r\n\r\n        selectedPlaceGroupIds: state.controlState.selectedPlaceGroupIds,\r\n        placeGroups: placeGroupsSelector(state),\r\n        selectedPlaceGroupsTitle: selectedPlaceGroupsTitleSelector(state),\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    selectPlaceGroups,\r\n    removeAllUserPlaces,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(PlaceGroupsSelect);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport IconButton from '@mui/material/IconButton';\nimport Input from '@mui/material/Input';\nimport InputLabel from '@mui/material/InputLabel';\nimport MenuItem from '@mui/material/MenuItem';\nimport Select from '@mui/material/Select';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport RemoveCircleOutlineIcon from '@mui/icons-material/RemoveCircleOutline';\n\nimport i18n from '../i18n';\nimport { Dataset } from '../model/dataset';\nimport { Place, PlaceGroup } from '../model/place';\nimport { WithLocale } from '../util/lang';\nimport ControlBarItem from './ControlBarItem';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        select: {\n            minWidth: '5em',\n        },\n        button: {},\n    });\n\ninterface PlaceSelectProps extends WithStyles<typeof styles>, WithLocale {\n    datasets: Dataset[];\n    userPlaceGroup: PlaceGroup;\n\n    selectedPlaceGroupIds: string[] | null;\n    selectedPlaceId: string | null;\n    places: Place[];\n    placeLabels: string[];\n    selectPlace: (placeId: string | null, places: Place[], showInMap: boolean) => void;\n    removeUserPlace: (placeId: string, places: Place[]) => void;\n    openDialog: (dialogId: string) => void;\n}\n\nconst PlaceSelect: React.FC<PlaceSelectProps> = ({\n                                                     classes,\n                                                     selectPlace,\n                                                     placeLabels,\n                                                     selectedPlaceId,\n                                                     selectedPlaceGroupIds,\n                                                     removeUserPlace,\n                                                     places,\n                                                 }) => {\n\n    const handlePlaceChange = (event: React.ChangeEvent<{ name?: string; value: any; }>) => {\n        selectPlace(event.target.value || null, places, true);\n    };\n\n    const handleRemoveButtonClick = () => {\n        if (selectedPlaceId !== null) {\n            removeUserPlace(selectedPlaceId, places);\n        }\n    };\n\n    places = places || [];\n    placeLabels = placeLabels || [];\n    selectedPlaceId = selectedPlaceId || '';\n    selectedPlaceGroupIds = selectedPlaceGroupIds || [];\n\n    const placeSelectLabel = (\n        <InputLabel\n            shrink\n            htmlFor=\"place-select\"\n        >\n            {i18n.get('Place')}\n        </InputLabel>\n    );\n\n    const placeSelect = (\n        <Select\n            variant=\"standard\"\n            value={selectedPlaceId}\n            onChange={handlePlaceChange}\n            input={<Input name=\"place\" id=\"place-select\"/>}\n            displayEmpty\n            name=\"place\"\n            className={classes.select}\n            disabled={places.length === 0}\n        >\n            {places.map((place, i) => (\n                <MenuItem\n                    key={place.id}\n                    value={place.id}\n                    selected={place.id === selectedPlaceId}\n                >\n                    {placeLabels[i]}\n                </MenuItem>\n            ))}\n        </Select>\n    );\n\n    const removeEnabled = places.length > 0\n        && selectedPlaceGroupIds.length === 1\n        && selectedPlaceGroupIds[0] === 'user'\n        && selectedPlaceId !== '';\n    const placeRemoveButton = (\n        <IconButton\n            className={classes.button}\n            disabled={!removeEnabled}\n            onClick={handleRemoveButtonClick}\n            size=\"large\">\n            <Tooltip arrow title={i18n.get('Remove place')}>\n                {<RemoveCircleOutlineIcon/>}\n            </Tooltip>\n        </IconButton>\n    );\n\n    return (\n        <ControlBarItem\n            label={placeSelectLabel}\n            control={placeSelect}\n            actions={placeRemoveButton}\n        />\n    );\n};\n\nexport default withStyles(styles)(PlaceSelect);\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport PlaceSelect from \"../components/PlaceSelect\";\nimport { AppState } from '../states/appState';\nimport { removeUserPlace } from \"../actions/dataActions\";\nimport { selectPlace, openDialog } from '../actions/controlActions';\nimport {\n    selectedPlaceGroupPlacesSelector,\n    selectedPlaceGroupPlaceLabelsSelector\n} from '../selectors/controlSelectors';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n\n        datasets: state.dataState.datasets,\n        userPlaceGroup: state.dataState.userPlaceGroup,\n\n        selectedPlaceGroupIds: state.controlState.selectedPlaceGroupIds,\n        selectedPlaceId: state.controlState.selectedPlaceId,\n        places: selectedPlaceGroupPlacesSelector(state),\n        placeLabels: selectedPlaceGroupPlaceLabelsSelector(state),\n    };\n};\n\nconst mapDispatchToProps = {\n    selectPlace,\n    removeUserPlace,\n    openDialog,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(PlaceSelect);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport FormControl from '@mui/material/FormControl';\nimport makeStyles from '@mui/styles/makeStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport AddLocationIcon from '@mui/icons-material/AddLocation';\nimport CategoryIcon from '@mui/icons-material/Category';\nimport CenterFocusStrongIcon from '@mui/icons-material/CenterFocusStrong';\nimport FiberManualRecordIcon from '@mui/icons-material/FiberManualRecord';\nimport FileUploadIcon from '@mui/icons-material/CloudUpload';\nimport ToggleButton from '@mui/material/ToggleButton';\nimport ToggleButtonGroup from '@mui/material/ToggleButtonGroup';\n\nimport i18n from '../i18n';\nimport { MapInteraction } from \"../states/controlState\";\nimport { WithLocale } from '../util/lang';\n\n\nconst useStyles = makeStyles(theme => ({\n        formControl: {\n            marginTop: theme.spacing(1.5),\n            marginRight: theme.spacing(2),\n        },\n    }\n));\n\ninterface MapInteractionsBarProps extends WithLocale {\n    mapInteraction: MapInteraction;\n    setMapInteraction: (interaction: MapInteraction) => void;\n}\n\nexport default function MapInteractionsBar({mapInteraction, setMapInteraction}: MapInteractionsBarProps) {\n    const classes = useStyles();\n\n    function handleChange(event: React.MouseEvent<HTMLElement>, value: MapInteraction | null) {\n        if (value !== null) {\n            setMapInteraction(value);\n        } else {\n            setMapInteraction('Select');\n        }\n    }\n\n    return (\n        <FormControl variant=\"standard\" className={classes.formControl}>\n            <ToggleButtonGroup size=\"small\" value={mapInteraction} exclusive onChange={handleChange}>\n                <ToggleButton key={0} value=\"Select\">\n                    <Tooltip arrow title={i18n.get('Select a place in map')}>\n                        <CenterFocusStrongIcon/>\n                    </Tooltip>\n                </ToggleButton>\n                <ToggleButton key={1} value=\"Point\">\n                    <Tooltip arrow title={i18n.get('Add a point location in map')}>\n                        <AddLocationIcon/>\n                    </Tooltip>\n                </ToggleButton>\n                <ToggleButton key={2} value=\"Polygon\">\n                    <Tooltip arrow title={i18n.get('Draw a polygon area in map')}>\n                        <CategoryIcon/>\n                    </Tooltip>\n                </ToggleButton>\n                <ToggleButton key={3} value=\"Circle\">\n                    <Tooltip arrow title={i18n.get('Draw a circular area in map')}>\n                        <FiberManualRecordIcon/>\n                    </Tooltip>\n                </ToggleButton>\n                <ToggleButton key={4} value=\"Geometry\">\n                    <Tooltip arrow title={i18n.get('Import geometry')}>\n                        <FileUploadIcon/>\n                    </Tooltip>\n                </ToggleButton>\n            </ToggleButtonGroup>\n        </FormControl>\n    );\n}\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport MapInteractionsBar from '../components/MapInteractionsBar';\r\nimport { AppState } from '../states/appState';\r\nimport { setMapInteraction } from '../actions/controlActions';\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        mapInteraction: state.controlState.mapInteraction,\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    setMapInteraction,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(MapInteractionsBar);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { Theme } from '@mui/material';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport { WithStyles } from '@mui/styles';\nimport TextField from '@mui/material/TextField';\nimport InputLabel from '@mui/material/InputLabel/InputLabel';\nimport { LocalizationProvider } from '@mui/x-date-pickers/LocalizationProvider';\nimport { AdapterDateFns } from '@mui/x-date-pickers/AdapterDateFns';\nimport { DateTimePicker } from '@mui/x-date-pickers/DateTimePicker';\n\nimport i18n from '../i18n';\nimport { Time, TimeRange } from '../model/timeSeries';\nimport { WithLocale } from '../util/lang';\nimport { dateTimeToUtcTime, utcTimeToIsoDate } from '../util/time';\nimport ControlBarItem from './ControlBarItem';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {}\n);\n\ninterface TimeSelectProps extends WithStyles<typeof styles>, WithLocale {\n    hasTimeDimension?: boolean;\n    selectedTime: Time | null;\n    selectTime: (time: Time | null) => void;\n    selectedTimeRange: TimeRange | null;\n}\n\n\nconst TimeSelect: React.FC<TimeSelectProps> = ({\n                                                   hasTimeDimension,\n                                                   selectedTime,\n                                                   selectedTimeRange,\n                                                   selectTime\n                                               }) => {\n\n    const handleTimeChange = (date: Date | null) => {\n        selectTime(date !== null ? dateTimeToUtcTime(date!) : null);\n    };\n\n    const timeInputLabel = (\n        <InputLabel\n            shrink\n            htmlFor=\"time-select\"\n        >\n            {`${i18n.get('Time')} (UTC)`}\n        </InputLabel>\n    );\n\n    const isValid = typeof selectedTime === 'number';\n    const timeValue = isValid ? utcTimeToIsoDate(selectedTime!) : null;\n\n    let minTimeValue, maxTimeValue;\n    if (Array.isArray(selectedTimeRange)) {\n        minTimeValue = utcTimeToIsoDate(selectedTimeRange[0]);\n        maxTimeValue = utcTimeToIsoDate(selectedTimeRange[1]);\n    }\n\n    const timeInput = (\n        <LocalizationProvider dateAdapter={AdapterDateFns}>\n            <DateTimePicker\n                disabled={!hasTimeDimension}\n                variant=\"inline\"\n                emptyLabel={\n                    !hasTimeDimension\n                        ? i18n.get('Missing time axis')\n                        : undefined\n                }\n                inputFormat=\"yyyy-MM-dd hh:mm:ss\"\n                id=\"time-select\"\n                value={timeValue}\n                minDateTime={minTimeValue}\n                maxDateTime={maxTimeValue}\n                onChange={handleTimeChange}\n                ampm={false}\n                renderInput={(props: any) => (\n                    <TextField\n                        {...props}\n                        variant=\"standard\"\n                        size=\"small\"\n                    />\n                )}\n            />\n        </LocalizationProvider>\n    );\n\n    return (\n        <ControlBarItem\n            label={timeInputLabel}\n            control={timeInput}\n        />\n    );\n};\n\nexport default withStyles(styles)(TimeSelect);\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport { AppState } from '../states/appState';\r\nimport TimeSelect from '../components/TimeSelect';\r\nimport { selectTime } from '../actions/controlActions';\r\nimport { selectedDatasetTimeDimensionSelector } from \"../selectors/controlSelectors\";\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        locale: state.controlState.locale,\r\n\r\n        hasTimeDimension: !!selectedDatasetTimeDimensionSelector(state),\r\n        selectedTime: state.controlState.selectedTime,\r\n        selectedTimeRange: state.controlState.selectedTimeRange,\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    selectTime,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TimeSelect);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport { Theme } from '@mui/material';\nimport Box from '@mui/material/Box';\nimport Slider, { Mark } from '@mui/material/Slider';\nimport Tooltip from '@mui/material/Tooltip';\n\nimport i18n from '../i18n';\nimport { Time, TimeRange, UNIT } from '../model/timeSeries';\nimport { utcTimeToIsoDateString, utcTimeToIsoDateTimeString, } from '../util/time';\n\nconst HOR_MARGIN = 5;\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        box: {\n            marginTop: theme.spacing(2),\n            marginLeft: theme.spacing(HOR_MARGIN),\n            marginRight: theme.spacing(HOR_MARGIN),\n            minWidth: 200,\n        },\n        label: {\n            color: \"grey\",\n            fontSize: \"1em\",\n        }\n    }\n);\n\ninterface TimeSliderProps extends WithStyles<typeof styles> {\n    hasTimeDimension?: boolean;\n    selectedTime?: Time | null;\n    selectTime?: (time: Time | null) => void;\n    selectedTimeRange?: TimeRange | null;\n    selectTimeRange?: (timeRange: TimeRange | null) => void;\n}\n\n\nconst TimeSlider: React.FC<TimeSliderProps> = ({\n                                                   classes,\n                                                   hasTimeDimension,\n                                                   selectedTime,\n                                                   selectTime,\n                                                   selectedTimeRange\n                                               }) => {\n    const [selectedTime_, setSelectedTime_] = useState(selectedTime);\n\n    useEffect(() => {\n        setSelectedTime_(selectedTime || (selectedTimeRange ? selectedTimeRange[0] : 0));\n    }, [selectedTime, selectedTimeRange]);\n\n    if (!hasTimeDimension) {\n        return null;\n    }\n\n    const handleChange = (event: Event, value: number | number[]) => {\n        if (typeof value === 'number') {\n            setSelectedTime_(value);\n        }\n    };\n\n    const handleChangeCommitted = (event: Event | SyntheticEvent, value: number | number[]) => {\n        if (selectTime && typeof value === 'number') {\n            selectTime(value as number);\n        }\n    };\n\n    let selectedTimeRangeValid = Array.isArray(selectedTimeRange);\n    if (!selectedTimeRangeValid) {\n        selectedTimeRange = [Date.now() - 2 * UNIT.years, Date.now()];\n    }\n\n    const marks: Mark[] = [\n        {value: selectedTimeRange![0], label: utcTimeToIsoDateString(selectedTimeRange![0])},\n        {value: selectedTimeRange![1], label: utcTimeToIsoDateString(selectedTimeRange![1])},\n    ];\n\n    function valueLabelFormat(value: number) {\n        return utcTimeToIsoDateTimeString(value);\n    }\n\n    return (\n        <Box className={classes.box}>\n            <Tooltip arrow title={i18n.get('Select time in dataset')}>\n                <Slider\n                    disabled={!selectedTimeRangeValid}\n                    min={selectedTimeRange![0]}\n                    max={selectedTimeRange![1]}\n                    value={selectedTime_ || 0}\n                    valueLabelDisplay=\"off\"\n                    valueLabelFormat={valueLabelFormat}\n                    marks={marks}\n                    onChange={handleChange}\n                    onChangeCommitted={handleChangeCommitted}\n                    size=\"small\"\n                />\n            </Tooltip>\n        </Box>\n    );\n};\n\nexport default withStyles(styles)(TimeSlider);\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport { AppState } from '../states/appState';\r\nimport TimeSlider from '../components/TimeSlider';\r\nimport { selectTime, selectTimeRange } from '../actions/controlActions';\r\nimport { selectedDatasetTimeDimensionSelector } from '../selectors/controlSelectors';\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        locale: state.controlState.locale,\r\n\r\n        hasTimeDimension: !!selectedDatasetTimeDimensionSelector(state),\r\n        selectedTime: state.controlState.selectedTime,\r\n        selectedTimeRange: state.controlState.selectedTimeRange,\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    selectTime,\r\n    selectTimeRange,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TimeSlider);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Theme } from '@mui/material';\nimport Box from '@mui/material/Box';\nimport FormControl from '@mui/material/FormControl';\nimport IconButton from '@mui/material/IconButton';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport ChevronLeftIcon from '@mui/icons-material/ChevronLeft';\nimport ChevronRightIcon from '@mui/icons-material/ChevronRight';\nimport FirstPageIcon from '@mui/icons-material/FirstPage';\nimport LastPageIcon from '@mui/icons-material/LastPage';\nimport PauseCircleOutline from '@mui/icons-material/PauseCircleOutline';\nimport PlayCircleOutline from '@mui/icons-material/PlayCircleOutline';\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\nimport i18n from '../i18n';\n\nimport { Time, TimeRange } from '../model/timeSeries';\nimport { TimeAnimationInterval } from '../states/controlState';\nimport { WithLocale } from '../util/lang';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        formControl: {\n            marginTop: theme.spacing(1),\n            marginRight: theme.spacing(1),\n        },\n    }\n);\n\ninterface TimePlayerProps extends WithStyles<typeof styles>, WithLocale {\n    selectedTime: Time | null;\n    selectTime: (time: Time | null) => void;\n    incSelectedTime: (increment: -1 | 1) => void;\n    selectedTimeRange: TimeRange | null;\n    timeAnimationActive: boolean;\n    timeAnimationInterval: TimeAnimationInterval;\n    updateTimeAnimation: (active: boolean, interval: TimeAnimationInterval) => void;\n}\n\n\nconst TimePlayer: React.FC<TimePlayerProps> = ({\n                                                   classes,\n                                                   timeAnimationActive,\n                                                   timeAnimationInterval,\n                                                   updateTimeAnimation,\n                                                   selectedTime,\n                                                   selectedTimeRange,\n                                                   selectTime,\n                                                   incSelectedTime\n                                               }) => {\n\n    const intervalId = useRef<number | null>(null);\n\n    useEffect(() => {\n        playOrNot();\n        return uninstallTimer;\n    });\n\n    const handlePlayEvent = () => {\n        incSelectedTime(1);\n    };\n\n    const handlePlayButtonClick = () => {\n        updateTimeAnimation(!timeAnimationActive, timeAnimationInterval);\n    };\n\n    const handleNextTimeStepButtonClick = () => {\n        incSelectedTime(1);\n    };\n\n    const handlePrevTimeStepButtonClick = () => {\n        incSelectedTime(-1);\n    };\n\n    const handleFirstTimeStepButtonClick = () => {\n        selectTime(selectedTimeRange ? selectedTimeRange[0] : null);\n    };\n\n    const handleLastTimeStepButtonClick = () => {\n        selectTime(selectedTimeRange ? selectedTimeRange[1] : null);\n    };\n\n    const playOrNot = () => {\n        if (timeAnimationActive) {\n            installTimer();\n        } else {\n            uninstallTimer();\n        }\n    };\n\n    const installTimer = () => {\n        uninstallTimer();\n        intervalId.current = window.setInterval(handlePlayEvent, timeAnimationInterval);\n    };\n\n    const uninstallTimer = () => {\n        if (intervalId.current !== null) {\n            window.clearInterval(intervalId.current!);\n            intervalId.current = null;\n        }\n    };\n\n\n    const isValid = typeof selectedTime === 'number';\n\n    const playToolTip = i18n.get(timeAnimationActive ? 'Stop' : 'Start');\n    const playIcon = timeAnimationActive ? <PauseCircleOutline/> : <PlayCircleOutline/>;\n\n    const playButton = (\n        <IconButton\n            disabled={!isValid}\n            aria-label={playToolTip}\n            onClick={handlePlayButtonClick}\n            size=\"large\">\n            <Tooltip arrow title={i18n.get('Auto-step through times in the dataset')}>\n                {playIcon}\n            </Tooltip>\n        </IconButton>\n    );\n\n    const firstTimeStepButton = (\n        <IconButton\n            disabled={!isValid || timeAnimationActive}\n            onClick={handleFirstTimeStepButtonClick}\n            size=\"large\">\n            <FirstPageIcon/>\n        </IconButton>\n    );\n\n    const prevTimeStepButton = (\n        <IconButton\n            disabled={!isValid || timeAnimationActive}\n            onClick={handlePrevTimeStepButtonClick}\n            size=\"large\">\n            <ChevronLeftIcon/>\n        </IconButton>\n    );\n    const nextTimeStepButton = (\n        <IconButton\n            disabled={!isValid || timeAnimationActive}\n            onClick={handleNextTimeStepButtonClick}\n            size=\"large\">\n            <ChevronRightIcon/>\n        </IconButton>\n    );\n    const lastTimeStepButton = (\n        <IconButton\n            disabled={!isValid || timeAnimationActive}\n            onClick={handleLastTimeStepButtonClick}\n            size=\"large\">\n            <LastPageIcon/>\n        </IconButton>);\n\n    return (\n        <FormControl variant=\"standard\" className={classes.formControl}>\n            <Box>\n                {firstTimeStepButton}\n                {prevTimeStepButton}\n                {playButton}\n                {nextTimeStepButton}\n                {lastTimeStepButton}\n            </Box>\n        </FormControl>\n    );\n};\n\nexport default withStyles(styles)(TimePlayer);\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport { AppState } from '../states/appState';\r\nimport TimePlayer from '../components/TimePlayer';\r\nimport { selectTime, incSelectedTime, updateTimeAnimation } from '../actions/controlActions';\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        locale: state.controlState.locale,\r\n\r\n        selectedTime: state.controlState.selectedTime,\r\n        selectedTimeRange: state.controlState.selectedTimeRange,\r\n        timeAnimationActive: state.controlState.timeAnimationActive,\r\n        timeAnimationInterval: state.controlState.timeAnimationInterval,\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    selectTime,\r\n    incSelectedTime,\r\n    updateTimeAnimation,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TimePlayer);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Box from '@mui/material/Box';\nimport FormControl from '@mui/material/FormControl';\nimport IconButton from '@mui/material/IconButton';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Tooltip from '@mui/material/Tooltip';\nimport CloudDownloadIcon from '@mui/icons-material/CloudDownload';\nimport InfoIcon from '@mui/icons-material/Info';\nimport MyLocationIcon from '@mui/icons-material/MyLocation';\nimport * as React from 'react';\n\nimport { Config } from '../config';\nimport i18n from '../i18n';\nimport { TimeSeriesGroup } from '../model/timeSeries';\nimport { WithLocale } from '../util/lang';\nimport RefreshIcon from \"@mui/icons-material/Refresh\";\nimport SettingsIcon from \"@mui/icons-material/Settings\";\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        formControl: {\n            marginTop: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            marginLeft: 'auto',\n        },\n    });\n\ninterface ControlBarActionsProps extends WithStyles<typeof styles>, WithLocale {\n    visible: boolean;\n    flyToSelectedObject: () => void;\n    infoCardOpen: boolean;\n    showInfoCard: (open: boolean) => void;\n    timeSeriesGroups: TimeSeriesGroup[];\n    openDialog: (dialogId: string) => void;\n    allowRefresh?: boolean;\n    updateResources: () => any;\n    compact: boolean;\n}\n\nconst ControlBarActions: React.FC<ControlBarActionsProps> = (\n    {\n        classes,\n        visible,\n        flyToSelectedObject,\n        infoCardOpen,\n        showInfoCard,\n        timeSeriesGroups,\n        openDialog,\n        allowRefresh,\n        updateResources,\n        compact\n    }\n) => {\n    if (!visible) {\n        return null;\n    }\n\n    const canDownload = timeSeriesGroups.length > 0;\n\n    let downloadButton;\n    if (Config.instance.branding.allowDownloads) {\n        downloadButton = (\n            <IconButton disabled={!canDownload} onClick={() => openDialog('export')} size=\"small\">\n                <Tooltip arrow title={i18n.get('Export data')}>\n                    {<CloudDownloadIcon/>}\n                </Tooltip>\n            </IconButton>\n        );\n    }\n\n    const flyToButton = (\n        <IconButton onClick={flyToSelectedObject} size=\"small\">\n            <Tooltip arrow title={i18n.get('Show selected place in map')}>\n                <MyLocationIcon/>\n            </Tooltip>\n        </IconButton>\n    );\n\n    let infoButton = (\n        <IconButton onClick={() => showInfoCard(true)} disabled={infoCardOpen} size=\"small\">\n            <Tooltip arrow title={i18n.get('Open information panel')}>\n                {<InfoIcon/>}\n            </Tooltip>\n        </IconButton>\n    );\n\n\n    let refreshButton;\n    let settingsButton;\n\n    if (compact) {\n        if (allowRefresh) {\n            refreshButton = (\n                <IconButton onClick={updateResources} size=\"small\">\n                    <Tooltip arrow title={i18n.get('Refresh')}>\n                        <RefreshIcon/>\n                    </Tooltip>\n                </IconButton>\n            );\n        }\n        settingsButton = (\n            <IconButton onClick={() => openDialog('settings')} size=\"small\">\n                <Tooltip arrow title={i18n.get('Settings')}>\n                    <SettingsIcon/>\n                </Tooltip>\n            </IconButton>\n        );\n    }\n\n    return (\n        <FormControl variant=\"standard\" className={classes.formControl}>\n            <Box>\n                {refreshButton}\n                {downloadButton}\n                {flyToButton}\n                {infoButton}\n                {settingsButton}\n            </Box>\n        </FormControl>\n    );\n};\n\nexport default withStyles(styles)(ControlBarActions);\n\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport ControlBarActions from '../components/ControlBarActions';\nimport { showInfoCard, flyToSelectedObject, openDialog } from '../actions/controlActions';\nimport { Config } from \"../config\";\nimport { updateResources } from \"../actions/dataActions\";\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        visible: !!(state.controlState.selectedDatasetId || state.controlState.selectedPlaceId),\n        infoCardOpen: state.controlState.infoCardOpen,\n        timeSeriesGroups: state.dataState.timeSeriesGroups,\n        compact: Config.instance.branding.compact,\n        allowRefresh: Config.instance.branding.allowRefresh,\n    }\n};\n\nconst mapDispatchToProps = {\n    showInfoCard,\n    flyToSelectedObject,\n    openDialog,\n    updateResources,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ControlBarActions);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport ControlBar from '../components/ControlBar';\nimport { WithLocale } from '../util/lang';\nimport DatasetSelect from './DatasetSelect';\nimport VariableSelect from './VariableSelect';\nimport RgbSwitch from './RgbSwitch';\nimport PlaceGroupsSelect from './PlaceGroupsSelect';\nimport PlaceSelect from './PlaceSelect';\nimport MapInteractionsBar from './MapInteractionsBar';\nimport TimeSelect from './TimeSelect';\nimport TimeSlider from './TimeSlider';\nimport TimePlayer from './TimePlayer';\nimport ControlBarActions from './ControlBarActions';\n\ninterface ControlBarProps extends WithLocale {\n    show: boolean;\n}\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        show: state.dataState.datasets.length > 0,\n    };\n};\n\nconst mapDispatchToProps = {};\n\nconst _ControlBar: React.FC<ControlBarProps> = ({show}) => {\n    if (!show) {\n        return null;\n    }\n    return (\n        <ControlBar>\n            <DatasetSelect/>\n            <VariableSelect/>\n            <RgbSwitch/>\n            <PlaceGroupsSelect/>\n            <PlaceSelect/>\n            <MapInteractionsBar/>\n            <TimeSelect/>\n            <TimePlayer/>\n            <TimeSlider/>\n            <ControlBarActions/>\n        </ControlBar>\n    );\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(_ControlBar);\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as React from 'react';\r\nimport i18n from '../i18n';\r\nimport { WithLocale } from '../util/lang';\r\n\r\nimport './ErrorBoundary.css';\r\n\r\n\r\ninterface ErrorBoundaryProps extends WithLocale {\r\n}\r\n\r\ninterface ErrorBoundaryState {\r\n    error: Error | null;\r\n}\r\n\r\n/**\r\n * An error boundary is used to catch JavaScript errors anywhere in their child component tree, log those errors,\r\n * and display a fallback UI (see https://reactjs.org/docs/error-boundaries.html).\r\n */\r\nexport default class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\r\n    constructor(props: object) {\r\n        super(props);\r\n        this.state = {error: null};\r\n    }\r\n\r\n    static getDerivedStateFromError(error: Error): ErrorBoundaryState {\r\n        // Update state so the next render will show the fallback UI.\r\n        return {error};\r\n    }\r\n\r\n    componentDidCatch(error: Error, errorInfo: React.ErrorInfo): void {\r\n        // log error information here, e.g. send info to API\r\n        console.error(error);\r\n        if (errorInfo.componentStack) {\r\n            console.error(errorInfo.componentStack);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        if (!this.props.children) {\r\n            throw new Error('An ErrorBoundary requires at least one child');\r\n        }\r\n\r\n        if (!this.state.error) {\r\n            return this.props.children;\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <h2 className=\"errorBoundary-header\">{i18n.get(\"Something went wrong.\")}</h2>\r\n                <details className=\"errorBoundary-details\" style={{whiteSpace: 'pre-wrap'}}>\r\n                    {this.state.error.toString()}\r\n                    <br/>\r\n                </details>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { default as OlMap } from 'ol/Map';\r\nimport { Control as OlControl } from 'ol/control';\r\n\r\nimport { MapComponent, MapComponentProps } from \"../MapComponent\";\r\n\r\n\r\ninterface ControlProps extends MapComponentProps {\r\n    style?: React.CSSProperties;\r\n    className?: string;\r\n}\r\n\r\nexport class Control extends MapComponent<OlControl, ControlProps> {\r\n    divRef: HTMLDivElement | null = null;\r\n\r\n    handleDivRef = (divRef: HTMLDivElement | null) => {\r\n        this.divRef = divRef;\r\n    };\r\n\r\n    addMapObject(map: OlMap): OlControl {\r\n        // console.log(`Control: added control '${this.props.id}'`);\r\n        const control = new OlControl({element: this.divRef!});\r\n        map.addControl(control);\r\n        return control;\r\n    }\r\n\r\n    updateMapObject(map: OlMap, control: OlControl, prevProps: Readonly<ControlProps>): OlControl {\r\n        return control;\r\n    }\r\n\r\n    removeMapObject(map: OlMap, control: OlControl): void {\r\n        for (let addedControl of map.getControls().getArray()) {\r\n            if (addedControl === control) {\r\n                // console.log(`Control: removing control '${this.props.id}'`);\r\n                map.removeControl(control);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const {children, style, className} = this.props;\r\n        const _className = (className ? className + ' ' : '') + 'ol-unselectable ol-control';\r\n        return <div style={style} className={_className} ref={this.handleDivRef}>{children}</div>;\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { default as OlMap } from 'ol/Map';\r\nimport { default as OlScaleLineControl } from 'ol/control/ScaleLine';\r\nimport { Options as OlScaleLineControlOptions} from 'ol/control/ScaleLine';\r\n\r\nimport { MapComponent, MapComponentProps } from '../MapComponent';\r\n\r\n\r\ninterface ScaleLineProps extends MapComponentProps, OlScaleLineControlOptions {\r\n    bar?: boolean;\r\n    steps?: number;\r\n    text?: boolean;\r\n}\r\n\r\nexport class ScaleLine extends MapComponent<OlScaleLineControl, ScaleLineProps> {\r\n\r\n    addMapObject(map: OlMap): OlScaleLineControl {\r\n        const control = new OlScaleLineControl(this.getOptions());\r\n        map.addControl(control);\r\n        return control;\r\n    }\r\n\r\n    updateMapObject(map: OlMap, control: OlScaleLineControl, prevProps: Readonly<ScaleLineProps>): OlScaleLineControl {\r\n        control.setProperties(this.getOptions());\r\n        return control;\r\n    }\r\n\r\n    removeMapObject(map: OlMap, control: OlScaleLineControl): void {\r\n        map.removeControl(control);\r\n    }\r\n}\r\n\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { default as OlMap } from 'ol/Map';\r\nimport { default as OlVectorLayer } from 'ol/layer/Vector';\r\nimport { default as OlDrawInteraction } from 'ol/interaction/Draw';\r\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\r\nimport { Options as OlDrawInteractionOptions } from 'ol/interaction/Draw';\r\n\r\nimport { MapComponent, MapComponentProps } from '../MapComponent';\r\n\r\nexport type DrawEvent = OlDrawEvent;\r\nexport type DrawListener = ((event: DrawEvent) => void) | ((event: DrawEvent) => boolean);\r\n\r\ninterface DrawProps extends MapComponentProps, OlDrawInteractionOptions {\r\n    layerId?: string;\r\n    active?: boolean;\r\n    onDrawStart?: DrawListener;\r\n    onDrawEnd?: DrawListener;\r\n}\r\n\r\nexport class Draw extends MapComponent<OlDrawInteraction, DrawProps> {\r\n\r\n    addMapObject(map: OlMap): OlDrawInteraction {\r\n        const draw = new OlDrawInteraction(this.getOptions());\r\n        let active = !!this.props.active;\r\n        draw.setActive(active);\r\n        map.addInteraction(draw);\r\n        if (active) {\r\n            this.listen(draw, this.props);\r\n        }\r\n        return draw;\r\n    }\r\n\r\n    updateMapObject(map: OlMap, draw: OlDrawInteraction, prevProps: Readonly<DrawProps>): OlDrawInteraction {\r\n        draw.setProperties(this.getOptions());\r\n        let active = !!this.props.active;\r\n        draw.setActive(active);\r\n        this.unlisten(draw, prevProps);\r\n        if (active) {\r\n            this.listen(draw, this.props);\r\n        }\r\n        return draw;\r\n    }\r\n\r\n    removeMapObject(map: OlMap, draw: OlDrawInteraction): void {\r\n        this.unlisten(draw, this.props);\r\n        map.removeInteraction(draw);\r\n    }\r\n\r\n    getOptions(): OlDrawInteractionOptions {\r\n        let options = super.getOptions();\r\n        delete options['layerId'];\r\n        delete options['active'];\r\n        delete options['onDrawStart'];\r\n        delete options['onDrawEnd'];\r\n        const layerId = this.props.layerId;\r\n        if (layerId && !options.source) {\r\n            const vectorLayer = this.getMapObject(layerId);\r\n            if (vectorLayer) {\r\n                options['source'] = (vectorLayer as OlVectorLayer).getSource();\r\n            }\r\n        }\r\n        return options;\r\n    }\r\n\r\n    private listen(draw: OlDrawInteraction, props: Readonly<DrawProps>) {\r\n        const {onDrawStart, onDrawEnd} = props;\r\n        if (onDrawStart) {\r\n            draw.on('drawstart', onDrawStart);\r\n        }\r\n        if (onDrawEnd) {\r\n            draw.on('drawend', onDrawEnd);\r\n        }\r\n    }\r\n\r\n    private unlisten(draw: OlDrawInteraction, props: Readonly<DrawProps>) {\r\n        const {onDrawStart, onDrawEnd} = props;\r\n        if (onDrawStart) {\r\n            draw.un('drawstart', onDrawStart);\r\n        }\r\n        if (onDrawEnd) {\r\n            draw.un('drawend', onDrawEnd);\r\n        }\r\n    }\r\n}\r\n\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport {default as OlMap} from 'ol/Map';\r\nimport {default as OlView, ViewOptions as OlViewOptions} from 'ol/View';\r\nimport { default as OlVectorLayer } from 'ol/layer/Vector';\r\nimport {ProjectionLike as OlProjectionLike, transform as olTransform} from 'ol/proj';\r\n\r\nimport {MapComponent, MapComponentProps} from \"./MapComponent\";\r\n\r\ninterface ViewProps extends MapComponentProps, OlViewOptions {\r\n}\r\n\r\nexport class View extends MapComponent<OlView, ViewProps> {\r\n\r\n    addMapObject(map: OlMap): OlView {\r\n        return this.updateView(map);\r\n    }\r\n\r\n    removeMapObject(map: OlMap, object: OlView): void {\r\n    }\r\n\r\n    updateMapObject(map: OlMap, object: OlView): OlView {\r\n        return this.updateView(map);\r\n    }\r\n\r\n    updateView(map: OlMap): OlView {\r\n        const newProjection = this.props.projection;\r\n        let oldProjection: OlProjectionLike = map.getView().getProjection();\r\n        if (typeof newProjection === 'string') {\r\n            if (oldProjection) {\r\n                oldProjection = oldProjection.getCode();\r\n            }\r\n        }\r\n        if (newProjection && newProjection !== oldProjection) {\r\n            const oldView = map.getView();\r\n            const newView = new OlView({\r\n                ...this.props,\r\n                center: olTransform(oldView.getCenter() || [0, 0],\r\n                    oldProjection,\r\n                    newProjection\r\n                ),\r\n                minZoom: oldView.getMinZoom(),\r\n                zoom: oldView.getZoom(),\r\n            });\r\n            map.getLayers().forEach(layer => {\r\n                if (layer instanceof OlVectorLayer) {\r\n                    layer.getSource().forEachFeature(feature => {\r\n                        feature.getGeometry()?.transform(oldProjection, newProjection);\r\n                    });\r\n                }\r\n            })\r\n            map.setView(newView);\r\n        } else {\r\n            map.getView().setProperties(this.props);\r\n        }\r\n        return map.getView();\r\n    }\r\n}\r\n\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { default as OlStyle } from \"ol/style/Style\";\nimport { default as  OlFeature} from \"ol/Feature\";\nimport { default as OlFillStyle } from \"ol/style/Fill\";\nimport { default as OlStrokeStyle } from \"ol/style/Stroke\";\nimport { default as OlCircleStyle } from \"ol/style/Circle\";\nimport { Color as OlColor } from \"ol/color\";\nimport { default as OlPoint } from \"ol/geom/Point\";\nimport rgba from \"color-rgba\";\n\n\nexport function setFeatureStyle(feature: OlFeature, color: string, fillOpacity?: number) {\n    if (feature.getGeometry() instanceof OlPoint) {\n        feature.setStyle(createPointGeometryStyle(7, color, 'white', 1));\n    } else {\n        fillOpacity = typeof fillOpacity === \"number\" ? fillOpacity : 0.25;\n        let fillColorRgba = rgba(color);\n        if (Array.isArray(fillColorRgba)) {\n            fillColorRgba = [fillColorRgba[0], fillColorRgba[1], fillColorRgba[2], fillOpacity];\n        } else {\n            fillColorRgba = [255, 255, 255, fillOpacity];\n        }\n        feature.setStyle(createGeometryStyle(fillColorRgba, color, 2));\n    }\n}\n\n\nexport function createPointGeometryStyle(radius: number,\n                                         fillColor: string,\n                                         strokeColor: string,\n                                         strokeWidth: number): OlStyle {\n    const fill = new OlFillStyle(\n        {\n            color: fillColor,\n        });\n    const stroke = new OlStrokeStyle(\n        {\n            color: strokeColor,\n            width: strokeWidth,\n        }\n    );\n    return new OlStyle(\n        {\n            image: new OlCircleStyle({radius, fill, stroke})\n        }\n    );\n}\n\nexport function createGeometryStyle(fillColor: string | OlColor,\n                                    strokeColor: string | OlColor,\n                                    strokeWidth: number): OlStyle {\n    const fill = new OlFillStyle(\n        {\n            color: fillColor,\n        });\n    const stroke = new OlStrokeStyle(\n        {\n            color: strokeColor,\n            width: strokeWidth,\n        }\n    );\n    return new OlStyle({fill, stroke});\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport * as geojson from 'geojson';\nimport { default as OlFeature } from 'ol/Feature';\nimport { default as OlGeoJSONFormat } from 'ol/format/GeoJSON';\nimport { default as OlCircleGeometry } from 'ol/geom/Circle';\nimport { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport { fromCircle as olPolygonFromCircle } from 'ol/geom/Polygon';\nimport { default as OlVectorLayer } from 'ol/layer/Vector';\nimport { default as OlMap } from 'ol/Map';\nimport { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\nimport { default as OlVectorSource } from 'ol/source/Vector';\nimport { default as OlTileLayer } from 'ol/layer/Tile';\nimport { default as OlCircleStyle } from 'ol/style/Circle';\nimport { default as OlFillStyle } from 'ol/style/Fill';\nimport { default as OlStrokeStyle } from 'ol/style/Stroke';\nimport { default as OlStyle } from 'ol/style/Style';\n\nimport { Config, getUserPlaceColor, getUserPlaceColorName } from '../config';\nimport i18n from '../i18n';\nimport { Place, PlaceGroup } from '../model/place';\nimport { MAP_OBJECTS, MapInteraction } from '../states/controlState';\nimport { newId } from '../util/id';\nimport { GEOGRAPHIC_CRS } from '../model/proj';\nimport ErrorBoundary from './ErrorBoundary';\nimport { Control } from './ol/control/Control';\nimport { ScaleLine } from './ol/control/ScaleLine';\nimport { Draw, DrawEvent } from './ol/interaction/Draw';\nimport { Layers } from './ol/layer/Layers';\nimport { Vector } from './ol/layer/Vector';\nimport { Map, MapElement } from './ol/Map';\nimport { View } from './ol/View';\nimport { setFeatureStyle } from './ol/style';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles({});\n\n// TODO (forman): no good design, store in some state instead:\nconst USER_LAYER_SOURCE = new OlVectorSource();\nconst SELECTION_LAYER_SOURCE = new OlVectorSource();\n\n// TODO (forman): move all map styles into dedicated module, so settings will be easier to find & adjust\n\nconst COLOR_LEGEND_STYLE: React.CSSProperties = {zIndex: 1000, right: 272, top: 10};\n\nconst SELECTION_LAYER_STROKE = new OlStrokeStyle({\n    color: [255, 200, 0, 1.0],\n    width: 3\n});\nconst SELECTION_LAYER_FILL = new OlFillStyle({\n    color: [255, 200, 0, 0.05]\n});\nconst SELECTION_LAYER_STYLE = new OlStyle({\n    stroke: SELECTION_LAYER_STROKE,\n    fill: SELECTION_LAYER_FILL,\n    image: new OlCircleStyle({\n        radius: 10,\n        stroke: SELECTION_LAYER_STROKE,\n        fill: SELECTION_LAYER_FILL,\n    })\n});\n\n\ninterface ViewerProps extends WithStyles<typeof styles> {\n    theme: Theme;\n    mapId: string;\n    mapInteraction: MapInteraction;\n    mapProjection: string;\n    baseMapLayer?: MapElement;\n    rgbLayer?: MapElement;\n    variableLayer?: MapElement;\n    datasetBoundaryLayer?: MapElement;\n    placeGroupLayers?: MapElement;\n    colorBarLegend?: MapElement;\n    addUserPlace?: (id: string, label: string, color: string, geometry: geojson.Geometry, selectPlace: boolean) => void;\n    userPlaceGroup: PlaceGroup;\n    selectPlace?: (placeId: string | null, places: Place[], showInMap: boolean) => void;\n    selectedPlaceId?: string | null;\n    places: Place[];\n    imageSmoothing?: boolean;\n    onMapRef: (map: OlMap | null) => void;\n    addUserPlacesFromText?: (text: string) => any;\n}\n\nconst Viewer: React.FC<ViewerProps> = ({\n                                           theme,\n                                           mapId,\n                                           mapInteraction,\n                                           mapProjection,\n                                           baseMapLayer,\n                                           rgbLayer,\n                                           variableLayer,\n                                           datasetBoundaryLayer,\n                                           placeGroupLayers,\n                                           colorBarLegend,\n                                           addUserPlace,\n                                           addUserPlacesFromText,\n                                           userPlaceGroup,\n                                           selectPlace,\n                                           selectedPlaceId,\n                                           places,\n                                           imageSmoothing,\n                                           onMapRef,\n                                       }) => {\n\n    const [map, setMap] = useState<OlMap | null>(null);\n    const [selectedPlaceIdPrev, setSelectedPlaceIdPrev] = useState<string | null>(selectedPlaceId || null);\n\n    useEffect(() => {\n        if (map) {\n            const selectedPlaceIdCurr = selectedPlaceId || null;\n            if (selectedPlaceIdCurr !== selectedPlaceIdPrev) {\n                SELECTION_LAYER_SOURCE.clear();\n                if (selectedPlaceIdCurr) {\n                    const selectedFeature = findFeatureById(map, selectedPlaceIdCurr);\n                    if (selectedFeature) {\n                        // We clone features, so we can set a new ID and clear the style, so the selection\n                        // layer style is used instead as default.\n                        const displayFeature = selectedFeature.clone();\n                        displayFeature.setId('Select-' + selectedFeature.getId());\n                        displayFeature.setStyle(undefined);\n                        SELECTION_LAYER_SOURCE.addFeature(displayFeature);\n                    }\n                }\n                setSelectedPlaceIdPrev(selectedPlaceIdCurr);\n            }\n        }\n    }, [map, selectedPlaceId, selectedPlaceIdPrev]);\n\n    useEffect(() => {\n        // Force layer source updates after imageSmoothing change\n        if (map) {\n            map.getLayers().forEach(layer => {\n                if (layer instanceof OlTileLayer) {\n                    layer.getSource().changed();\n                } else {\n                    layer.changed();\n                }\n            });\n        }\n    }, [map, imageSmoothing]);\n\n    const handleMapClick = (event: OlMapBrowserEvent) => {\n        if (mapInteraction === 'Select') {\n            const map = event.map;\n            let selectedPlaceId: string | null = null;\n            const features = map.getFeaturesAtPixel(event.pixel);\n            if (features) {\n                for (let f of features) {\n                    if (typeof f['getId'] === 'function') {\n                        selectedPlaceId = f['getId']() + '';\n                        break;\n                    }\n                }\n            }\n            if (selectPlace) {\n                selectPlace(selectedPlaceId, places, false);\n            }\n        }\n    };\n\n    const handleDrawEnd = (event: DrawEvent) => {\n        // TODO (forman): too much logic here! put the following code into an action + reducer.\n        if (map !== null && addUserPlace && mapInteraction !== 'Select') {\n            const feature = event.feature;\n            let geometry = feature.getGeometry();\n            if (!geometry) {\n                return;\n            }\n\n            const placeId = `User-${mapInteraction}-${newId()}`;\n            const projection = map.getView().getProjection();\n\n            if (geometry instanceof OlCircleGeometry) {\n                const polygon = olPolygonFromCircle(geometry as OlCircleGeometry);\n                feature.setGeometry(polygon);\n            }\n\n            // Beware: transform() is an in-place op\n            geometry = feature.clone().getGeometry()!.transform(projection, GEOGRAPHIC_CRS);\n            const geoJSONGeometry = new OlGeoJSONFormat().writeGeometryObject(geometry) as any;\n            feature.setId(placeId);\n            let colorIndex = 0;\n            if (MAP_OBJECTS.userLayer) {\n                const features = USER_LAYER_SOURCE.getFeatures();\n                colorIndex = features.length;\n            }\n            const color = getUserPlaceColorName(colorIndex);\n            const shadedColor = getUserPlaceColor(color, theme.palette.mode);\n            setFeatureStyle(feature, shadedColor, Config.instance.branding.polygonFillOpacity);\n\n            const nameBase = i18n.get(mapInteraction);\n            let label: string = '';\n            for (let index = 1; ; index++) {\n                label = `${nameBase} ${index}`;\n                // eslint-disable-next-line\n                if (!userPlaceGroup.features.find(p => (p.properties || {})['label'] === label)) {\n                    break;\n                }\n            }\n\n            addUserPlace(placeId, label, color, geoJSONGeometry as geojson.Geometry, true);\n        }\n        return true;\n    };\n\n    function handleMapRef(map: OlMap | null) {\n        if (onMapRef) {\n            onMapRef(map);\n        }\n        setMap(map);\n    }\n\n    let colorBarControl = null;\n    if (colorBarLegend) {\n        colorBarControl = (\n            <Control id=\"legend\" style={COLOR_LEGEND_STYLE}>\n                {colorBarLegend}\n            </Control>\n        );\n    }\n\n    // TODO (forman): fix me! this is a workaround to avoid that rgbLayer is never visible.\n    if (rgbLayer !== null) {\n        variableLayer = rgbLayer;\n    }\n\n    const handleDropFiles = (files: File[]) => {\n        if (addUserPlacesFromText) {\n            files.forEach(file => {\n                const reader = new FileReader();\n                reader.onloadend = () => {\n                    if (typeof reader.result === 'string') {\n                        addUserPlacesFromText(reader.result);\n                    }\n                };\n                reader.readAsText(file, \"UTF-8\");\n            });\n        }\n    };\n\n    return (\n        <ErrorBoundary>\n            <Map\n                id={mapId}\n                onClick={(event) => handleMapClick(event)}\n                onMapRef={handleMapRef}\n                mapObjects={MAP_OBJECTS}\n                isStale={true}\n                onDropFiles={handleDropFiles}\n            >\n                <View id=\"view\" projection={mapProjection}/>\n                <Layers>\n                    {baseMapLayer}\n                    {variableLayer}\n                    {datasetBoundaryLayer}\n                    <Vector\n                        id='userLayer'\n                        opacity={1}\n                        zIndex={500}\n                        source={USER_LAYER_SOURCE}\n                    />\n                    <Vector\n                        id='selectionLayer'\n                        opacity={0.7}\n                        zIndex={510}\n                        style={SELECTION_LAYER_STYLE}\n                        source={SELECTION_LAYER_SOURCE}\n                    />\n                </Layers>\n                {placeGroupLayers}\n                {/*<Select id='select' selectedFeaturesIds={selectedFeaturesId} onSelect={handleSelect}/>*/}\n                <Draw\n                    id=\"drawPoint\"\n                    layerId={'userLayer'}\n                    active={mapInteraction === 'Point'}\n                    type={OlGeometryType.POINT}\n                    wrapX={true}\n                    stopClick={true}\n                    onDrawEnd={handleDrawEnd}\n                />\n                <Draw\n                    id=\"drawPolygon\"\n                    layerId={'userLayer'}\n                    active={mapInteraction === 'Polygon'}\n                    type={OlGeometryType.POLYGON}\n                    wrapX={true}\n                    stopClick={true}\n                    onDrawEnd={handleDrawEnd}\n                />\n                <Draw\n                    id=\"drawCircle\"\n                    layerId={'userLayer'}\n                    active={mapInteraction === 'Circle'}\n                    type={OlGeometryType.CIRCLE}\n                    wrapX={true}\n                    stopClick={true}\n                    onDrawEnd={handleDrawEnd}\n                />\n                {colorBarControl}\n                <ScaleLine bar={false}/>\n            </Map>\n        </ErrorBoundary>\n    );\n};\n\nexport default withStyles(styles, {withTheme: true})(Viewer);\n\n\nfunction findFeatureById(map: OlMap, featureId: string | number): OlFeature | null {\n    for (let layer of map.getLayers().getArray()) {\n        if (layer instanceof OlVectorLayer) {\n            const vectorLayer = layer as OlVectorLayer;\n            const feature = vectorLayer.getSource().getFeatureById(featureId);\n            if (feature) {\n                return feature;\n            }\n        }\n    }\n    return null;\n}","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport interface ColorBars {\n    groups: ColorBarGroup[];\n    images: { [name: string]: string };\n}\n\nexport interface ColorBarGroup {\n    title: string;\n    description: string;\n    names: string[];\n}\n\nexport const CB_ALPHA_SUFFIX = '_alpha';\nexport const CB_REVERSE_SUFFIX = '_r';\n\n\nexport interface ColorBar {\n    baseName: string;\n    isAlpha: boolean;\n    isReversed: boolean;\n}\n\nexport function parseColorBar(name: string): ColorBar {\n    let baseName = name;\n\n    const isAlpha = baseName.endsWith(CB_ALPHA_SUFFIX);\n    if (isAlpha) {\n        baseName = baseName.slice(0, baseName.length - CB_ALPHA_SUFFIX.length);\n    }\n\n    const isReversed = baseName.endsWith(CB_REVERSE_SUFFIX);\n    if (isReversed) {\n        baseName = baseName.slice(0, baseName.length - CB_REVERSE_SUFFIX.length);\n    }\n\n    return {baseName, isAlpha, isReversed};\n}\n\nexport function formatColorBar(colorBar: ColorBar): string {\n    let name = colorBar.baseName;\n    if (colorBar.isReversed) {\n        name += CB_REVERSE_SUFFIX;\n    }\n    if (colorBar.isAlpha) {\n        name += CB_ALPHA_SUFFIX;\n    }\n    return name;\n}","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nexport function getLabelsFromArray(values: number[]): string[] {\r\n    const min = values[0];\r\n    const max = values[values.length - 1];\r\n    const fractionDigits = Math.min(10, Math.max(2, Math.round(-Math.log10(max - min))));\r\n    function _formatValue(value: number): string {\r\n        return formatValue(value, fractionDigits);\r\n    }\r\n    return values.map(_formatValue);\r\n}\r\n\r\nexport function getLabelsFromRange(minValue: number, maxValue: number, count: number = 5): string[] {\r\n    return getLabelsFromArray(arange(minValue, maxValue, count));\r\n}\r\n\r\nfunction formatValue(value: number, fractionDigits: number): string {\r\n    const valueRounded = Math.round(value);\r\n    if (Math.abs(valueRounded - value) < 1e-8) {\r\n        return valueRounded + '';\r\n    } else {\r\n        return value.toFixed(fractionDigits);\r\n    }\r\n}\r\n\r\nexport function arange(minValue: number, maxValue: number, count: number): number[] {\r\n    const delta = (maxValue - minValue) / (count - 1);\r\n    const ticks = new Array<number>(count);\r\n    for (let i = 0; i < count; i++) {\r\n        ticks[i] = minValue + i * delta;\r\n    }\r\n    return ticks;\r\n}\r\n\r\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURcDAwP///ytph7QAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAUSURBVBjTYwABQSCglEENMxgYGAAynwRB8BEAgQAAAABJRU5ErkJggg==\"","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { useEffect, useRef } from 'react';\n\nimport i18n from '../i18n';\nimport { ColorBar } from '../model/colorBar';\n\nimport bgImageData from \"./bg.png\";\n\nconst bgImage = new Image();\nbgImage.src = bgImageData;\n\n\ninterface ColorBarCanvasProps {\n    colorBar: ColorBar;\n    imageData: string;\n    opacity: number;\n    width: number | string | undefined;\n    height: number | string | undefined;\n    onOpenEditor: (event: React.MouseEvent<HTMLCanvasElement>) => void;\n}\n\nexport const ColorBarCanvas: React.FC<ColorBarCanvasProps> = (\n        {\n            colorBar,\n            imageData,\n            opacity,\n            width,\n            height,\n            onOpenEditor\n        }\n) => {\n    const canvasRef = useRef<HTMLCanvasElement | null>(null);\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (canvas === null) {\n            return;\n        }\n        const image = new Image();\n        image.onload = () => {\n            renderColorBar(colorBar, opacity, canvas, image);\n        };\n        image.src = `data:image/png;base64,${imageData}`;\n    }, [colorBar, imageData, opacity]);\n\n    return <>\n        {Boolean(imageData) ? (\n                <canvas\n                        ref={canvasRef}\n                        width={width || 240}\n                        height={height || 24}\n                        onClick={onOpenEditor}\n                />\n        ) : (\n                <div>{i18n.get('Unknown color bar') + `: ${colorBar.baseName}`}</div>\n        )}\n    </>;\n}\n\n\nfunction renderColorBar(colorBar: ColorBar,\n                        opacity: number,\n                        canvas: HTMLCanvasElement,\n                        image: HTMLImageElement) {\n    const offscreenCanvas = document.createElement('canvas');\n    offscreenCanvas.width = image.width;\n    offscreenCanvas.height = image.height;\n    const ctx = offscreenCanvas.getContext(\"2d\");\n    if (ctx === null) {\n        return;\n    }\n    ctx.drawImage(image, 0, 0);\n    const imageData = ctx.getImageData(\n            0, 0,\n            offscreenCanvas.width,\n            offscreenCanvas.height\n    );\n\n    let rgbaArray = imageData.data;\n    rgbaArray = rgbaArray.slice(0, rgbaArray.length / 2);\n\n    if (colorBar.isReversed) {\n        const reversedRgbaArray = new Uint8ClampedArray(rgbaArray.length);\n        for (let i = 0; i < rgbaArray.length; i += 4) {\n            const j = rgbaArray.length - i - 4;\n            reversedRgbaArray[j] = rgbaArray[i];\n            reversedRgbaArray[j + 1] = rgbaArray[i + 1];\n            reversedRgbaArray[j + 2] = rgbaArray[i + 2];\n            reversedRgbaArray[j + 3] = rgbaArray[i + 3];\n        }\n        rgbaArray = reversedRgbaArray;\n    }\n\n    if (colorBar.isAlpha) {\n        const factor = 256 * 2 / rgbaArray.length;\n        for (let i = 0; i < rgbaArray.length / 2; i += 4) {\n            rgbaArray[i + 3] = factor * i;\n        }\n    }\n\n    if (opacity < 1.0) {\n        for (let i = 0; i < rgbaArray.length; i += 4) {\n            rgbaArray[i + 3] *= opacity;\n        }\n    }\n\n    Promise.resolve(\n            createImageBitmap(\n                    new ImageData(rgbaArray,\n                            rgbaArray.length / 4,\n                            1)\n            )\n    ).then(imageBitmap => {\n        const ctx = canvas.getContext(\"2d\");\n        if (ctx !== null) {\n            const pattern = ctx.createPattern(bgImage, \"repeat\");\n            if (pattern !== null) {\n                ctx.fillStyle = pattern;\n            } else {\n                ctx.fillStyle = \"#ffffff\";\n            }\n            ctx.fillRect(\n                    0, 0,\n                    canvas.width, canvas.height\n            );\n            ctx.drawImage(\n                    imageBitmap,\n                    0, 0,\n                    canvas.width, canvas.height\n            );\n        }\n    });\n}\n\n\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport makeStyles from '@mui/styles/makeStyles';\nimport TextField from '@mui/material/TextField';\nimport Box from '@mui/material/Box';\nimport Checkbox from '@mui/material/Checkbox';\nimport Popover from '@mui/material/Popover';\nimport Slider, { Mark } from '@mui/material/Slider';\nimport Tooltip from '@mui/material/Tooltip';\n\nimport i18n from '../i18n';\nimport { ColorBars, formatColorBar, parseColorBar } from '../model/colorBar';\nimport { getLabelsFromArray, getLabelsFromRange } from '../util/label'\nimport { ColorBarCanvas } from \"./ColorBarCanvas\";\nimport { SyntheticEvent } from \"react\";\n\nconst HOR_SLIDER_MARGIN = 5;\nconst COLOR_BAR_BOX_MARGIN = 1;\nconst COLOR_BAR_ITEM_BOX_MARGIN = 0.2;\n\nconst useStyles = makeStyles(theme => ({\n        title: {\n            fontSize: 'x-small',\n            fontWeight: 'bold',\n            width: '100%',\n            display: 'flex',\n            flexWrap: 'nowrap',\n            justifyContent: 'center',\n            paddingBottom: theme.spacing(0.5),\n        },\n        label: {\n            fontSize: 'x-small',\n            fontWeight: 'bold',\n            width: '100%',\n            display: 'flex',\n            flexWrap: 'nowrap',\n            justifyContent: 'space-between',\n        },\n        container: {\n            paddingLeft: theme.spacing(1.5),\n            paddingRight: theme.spacing(1.5),\n            paddingBottom: theme.spacing(0.5),\n            paddingTop: theme.spacing(0.5),\n            color: 'black',\n        },\n        sliderBox: {\n            marginTop: theme.spacing(1),\n            marginLeft: theme.spacing(HOR_SLIDER_MARGIN),\n            marginRight: theme.spacing(HOR_SLIDER_MARGIN),\n            minWidth: 320,\n            width: `calc(100% - ${theme.spacing(2 * (HOR_SLIDER_MARGIN + 1))}px)`,\n        },\n        colorBarBox: {\n            marginTop: theme.spacing(COLOR_BAR_BOX_MARGIN - 2 * COLOR_BAR_ITEM_BOX_MARGIN),\n            marginLeft: theme.spacing(COLOR_BAR_BOX_MARGIN),\n            marginRight: theme.spacing(COLOR_BAR_BOX_MARGIN),\n            marginBottom: theme.spacing(COLOR_BAR_BOX_MARGIN),\n        },\n        colorBarGroupTitle: {\n            marginTop: theme.spacing(2 * COLOR_BAR_ITEM_BOX_MARGIN),\n            color: theme.palette.grey[400],\n        },\n        colorBarGroupItemBox: {\n            marginTop: theme.spacing(COLOR_BAR_ITEM_BOX_MARGIN),\n        },\n        colorBarMinMaxEditor: {\n            marginTop: theme.spacing(2),\n            marginBottom: theme.spacing(2),\n        },\n        minMaxBox: {\n            display: 'flex',\n            justifyContent: 'center'\n        },\n        minTextField: {\n            maxWidth: '8em',\n            paddingRight: 2,\n        },\n        maxTextField: {\n            maxWidth: '8em',\n            paddingLeft: 2,\n        },\n    }\n));\n\n\ninterface ColorBarLegendProps {\n    variableName: string | null;\n    variableUnits: string;\n    variableColorBarMinMax: [number, number];\n    variableColorBarName: string;\n    variableOpacity: number;\n    updateVariableColorBar: (colorBarMinMax: [number, number], colorBarName: string, opacity: number) => void;\n    colorBars: ColorBars | null;\n    width?: number | string;\n    height?: number | string;\n    numTicks?: number;\n}\n\nexport default function ColorBarLegend({\n                                           variableName,\n                                           variableUnits,\n                                           variableColorBarMinMax,\n                                           variableColorBarName,\n                                           variableOpacity,\n                                           updateVariableColorBar,\n                                           colorBars,\n                                           width, height,\n                                           numTicks\n                                       }: ColorBarLegendProps) {\n    const classes = useStyles();\n    const [colorBarMinMaxAnchorEl, setColorBarMinMaxAnchorEl] = React.useState<HTMLDivElement | null>(null);\n    const [colorBarNameAnchorEl, setColorBarNameAnchorEl] = React.useState<HTMLCanvasElement | null>(null);\n    const [currentColorBarMinMax, setCurrentColorBarMinMax] = React.useState<[number, number]>(variableColorBarMinMax);\n    const [originalColorBarMinMax, setOriginalColorBarMinMax] = React.useState<[number, number]>(variableColorBarMinMax);\n    const [enteredColorBarMinMax, setEnteredColorBarMinMax] = React.useState<[string, string]>(\n        minMaxToText(variableColorBarMinMax)\n    );\n    const [enteredColorBarMinMaxError, setEnteredColorBarMinMaxError] = React.useState<[boolean, boolean]>(\n        [false, false]\n    );\n\n    React.useEffect(() => {\n        setEnteredColorBarMinMax(minMaxToText(variableColorBarMinMax));\n    }, [variableColorBarMinMax]);\n\n    const colorBarMinMaxEditorOpen = Boolean(colorBarMinMaxAnchorEl);\n    const colorBarNameEditorOpen = Boolean(colorBarNameAnchorEl);\n\n    if (!variableName || !colorBars) {\n        return null;\n    }\n\n    const variableColorBar = parseColorBar(variableColorBarName);\n\n    const imageData = colorBars.images[variableColorBar.baseName];\n\n    const handleOpenColorBarMinMaxEditor = (event: React.MouseEvent<HTMLDivElement>) => {\n        setColorBarMinMaxAnchorEl(event.currentTarget);\n        setCurrentColorBarMinMax(variableColorBarMinMax);\n        setOriginalColorBarMinMax(variableColorBarMinMax);\n    };\n\n    const handleCloseColorBarMinMaxEditor = () => {\n        setColorBarMinMaxAnchorEl(null);\n    };\n\n    const handleColorBarMinMaxChange = (event: Event, value: number | number[]) => {\n        if (Array.isArray(value)) {\n            setCurrentColorBarMinMax([value[0], value[1]]);\n        }\n    };\n\n    const handleColorBarMinMaxChangeCommitted = (event: Event | SyntheticEvent, value: number | number[]) => {\n        if (Array.isArray(value)) {\n            updateVariableColorBar([value[0], value[1]], variableColorBarName, variableOpacity);\n        }\n    };\n\n    const handleOpenColorBarNameEditor = (event: React.MouseEvent<HTMLCanvasElement>) => {\n        setColorBarNameAnchorEl(event.currentTarget);\n    };\n\n    const handleCloseColorBarNameEditor = () => {\n        setColorBarNameAnchorEl(null);\n    };\n\n    const handleColorBarNameChange = (baseName: string) => {\n        variableColorBarName = formatColorBar({...variableColorBar, baseName});\n        updateVariableColorBar(variableColorBarMinMax, variableColorBarName, variableOpacity);\n    };\n\n    const handleColorBarAlpha = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const isAlpha = event.currentTarget.checked;\n        variableColorBarName = formatColorBar({...variableColorBar, isAlpha});\n        updateVariableColorBar(\n            variableColorBarMinMax,\n            variableColorBarName,\n            variableOpacity\n        );\n    };\n\n    const handleColorBarReversed = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const isReversed = event.currentTarget.checked;\n        variableColorBarName = formatColorBar({...variableColorBar, isReversed});\n        updateVariableColorBar(\n            variableColorBarMinMax,\n            variableColorBarName,\n            variableOpacity\n        );\n    };\n\n    const handleVariableOpacity = (event: Event, value: number | number[]) => {\n        updateVariableColorBar(\n            variableColorBarMinMax,\n            variableColorBarName,\n            value as number\n        );\n    }\n\n    const handleEnteredColorBarMinChange = (event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n        const enteredValue = event.target.value;\n        setEnteredColorBarMinMax([enteredValue, enteredColorBarMinMax[1]]);\n        const minValue = Number.parseFloat(enteredValue);\n        let error = false;\n        if (!Number.isNaN(minValue) && minValue < currentColorBarMinMax[1]) {\n            if (minValue !== currentColorBarMinMax[0]) {\n                const newMinMax: [number, number] = [minValue, currentColorBarMinMax[1]];\n                setCurrentColorBarMinMax(newMinMax);\n                setOriginalColorBarMinMax(newMinMax);\n                updateVariableColorBar(newMinMax, variableColorBarName, variableOpacity);\n            }\n        } else {\n            error = true;\n        }\n        setEnteredColorBarMinMaxError([error, enteredColorBarMinMaxError[1]])\n    }\n\n    const handleEnteredColorBarMaxChange = (event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n        const enteredValue = event.target.value;\n        setEnteredColorBarMinMax([enteredColorBarMinMax[0], enteredValue]);\n        const maxValue = Number.parseFloat(enteredValue);\n        let error = false;\n        if (!Number.isNaN(maxValue) && maxValue > currentColorBarMinMax[0]) {\n            if (maxValue !== currentColorBarMinMax[1]) {\n                const newMinMax: [number, number] = [currentColorBarMinMax[0], maxValue]\n                setCurrentColorBarMinMax(newMinMax);\n                setOriginalColorBarMinMax(newMinMax);\n                updateVariableColorBar(newMinMax, variableColorBarName, variableOpacity);\n            }\n        } else {\n            error = true;\n        }\n        setEnteredColorBarMinMaxError([enteredColorBarMinMaxError[0], error])\n    }\n\n    const title = `${variableName} (${variableUnits || '-'})`;\n\n    let colorBarMinMaxEditor;\n    if (colorBarMinMaxEditorOpen) {\n\n        const [original1, original2] = originalColorBarMinMax;\n        const dist = original1 < original2 ? (original2 - original1):1;\n        const distExp = Math.floor(Math.log10(dist));\n        const distNorm = dist * Math.pow(10, -distExp);\n\n        let numStepsInner = null;\n        for (let delta of [0.25, 0.2, 0.15, 0.125, 0.1]) {\n            let numStepsFloat = distNorm / delta;\n            let numStepsInt = Math.floor(numStepsFloat);\n            if (Math.abs(numStepsInt - numStepsFloat) < 1e-10) {\n                numStepsInner = numStepsInt;\n                break;\n            }\n        }\n\n        let numStepsOuter;\n        if (numStepsInner !== null && numStepsInner >= 2) {\n            numStepsOuter = Math.max(2, Math.round(numStepsInner / 2));\n        } else {\n            numStepsOuter = 4;\n            numStepsInner = 8;\n        }\n\n        const delta = original1 < original2 ? dist / numStepsInner:0.5;\n        const numSteps = numStepsInner + 2 * numStepsOuter;\n        const total1 = original1 - numStepsOuter * delta;\n        const total2 = original2 + numStepsOuter * delta;\n        const step = (total2 - total1) / numSteps;\n\n        const values = [\n            total1,\n            original1,\n            original2,\n            total2,\n        ];\n\n        const marks: Mark[] = getLabelsFromArray(values).map((label, i) => {\n            return {value: values[i], label};\n        });\n\n        colorBarMinMaxEditor = (\n            <div className={classes.colorBarMinMaxEditor}>\n                <span style={{paddingLeft: 14}}>{title}</span>\n                <Box className={classes.sliderBox}>\n                    <Slider\n                        min={total1}\n                        max={total2}\n                        value={currentColorBarMinMax}\n                        marks={marks}\n                        step={step}\n                        onChange={handleColorBarMinMaxChange}\n                        onChangeCommitted={handleColorBarMinMaxChangeCommitted}\n                        valueLabelDisplay=\"auto\"\n                        size=\"small\"\n                    />\n                </Box>\n                <Box component=\"form\" className={classes.minMaxBox}>\n                    <TextField\n                        className={classes.minTextField}\n                        label=\"Minimum\"\n                        variant=\"filled\"\n                        size=\"small\"\n                        value={enteredColorBarMinMax[0]}\n                        error={enteredColorBarMinMaxError[0]}\n                        onChange={evt => handleEnteredColorBarMinChange(evt)}\n                    />\n                    <TextField\n                        className={classes.maxTextField}\n                        label=\"Maximum\"\n                        variant=\"filled\"\n                        size=\"small\"\n                        value={enteredColorBarMinMax[1]}\n                        error={enteredColorBarMinMaxError[1]}\n                        onChange={evt => handleEnteredColorBarMaxChange(evt)}\n                    />\n                </Box>\n            </div>\n        );\n    }\n\n    let colorBarNameEditor;\n    if (colorBarNameEditorOpen) {\n        let key = 0;\n        const entries = [];\n        for (let cbg of colorBars.groups) {\n            if (!cbg.names || cbg.names.length === 0) {\n                continue;\n            }\n            entries.push(\n                <Tooltip arrow key={key++} title={cbg.description} placement=\"left\">\n                    <Box className={classes.colorBarGroupTitle}>\n                        {cbg.title}\n                    </Box>\n                </Tooltip>\n            );\n            for (let name of cbg.names) {\n                entries.push(\n                    <Box\n                        key={key++}\n                        className={classes.colorBarGroupItemBox}\n                        border={1}\n                        borderColor={name === variableColorBar.baseName ? 'orange':'black'}\n                        width={240}\n                        height={20}\n                    >\n                        <Tooltip arrow title={name} placement=\"left\">\n                            <img\n                                src={`data:image/png;base64,${colorBars.images[name]}`}\n                                alt={'Color Bar'}\n                                width={'100%'}\n                                height={'100%'}\n                                onClick={() => {\n                                    handleColorBarNameChange(name);\n                                }}\n                            />\n                        </Tooltip>\n                    </Box>\n                );\n            }\n        }\n        colorBarNameEditor = (\n            <Box className={classes.colorBarBox}>\n                <Box component=\"span\">\n                    <Checkbox color=\"primary\"\n                              checked={variableColorBar.isAlpha}\n                              onChange={handleColorBarAlpha}\n                              size=\"small\"\n                              style={{\n                                  paddingLeft: 0,\n                                  paddingRight: 2,\n                                  paddingTop: 4,\n                                  paddingBottom: 4\n                              }}\n                    />\n                    <Box component=\"span\">{i18n.get('Hide small values')}</Box>\n                    <Checkbox color=\"primary\"\n                              checked={variableColorBar.isReversed}\n                              onChange={handleColorBarReversed}\n                              size=\"small\"\n                              style={{\n                                  paddingLeft: 10,\n                                  paddingRight: 2,\n                                  paddingTop: 4,\n                                  paddingBottom: 4\n                              }}\n                    />\n                    <Box component=\"span\">{i18n.get('Reverse')}</Box>\n                </Box>\n                <Box component=\"div\" style={{display: 'flex', alignItems: 'center'}}>\n                    <span>{i18n.get('Opacity')}</span>\n                    <Slider\n                        min={0}\n                        max={1}\n                        value={variableOpacity}\n                        step={0.01}\n                        style={{flexGrow: 1, marginLeft: 10, marginRight: 10}}\n                        onChange={handleVariableOpacity}\n                        size=\"small\"\n                    />\n                </Box>\n                {entries}\n            </Box>\n        );\n    }\n\n    return (\n        <div className={'ol-control ' + classes.container}>\n            <div className={classes.title}>\n                <span>{title}</span>\n            </div>\n            <ColorBarCanvas\n                colorBar={variableColorBar}\n                imageData={imageData}\n                opacity={variableOpacity}\n                width={width}\n                height={height}\n                onOpenEditor={handleOpenColorBarNameEditor}\n            />\n            <div\n                className={classes.label}\n                onClick={handleOpenColorBarMinMaxEditor}\n            >\n                <Labels minValue={variableColorBarMinMax[0]} maxValue={variableColorBarMinMax[1]}\n                        count={numTicks || 5}/>\n            </div>\n            <Popover\n                anchorEl={colorBarMinMaxAnchorEl}\n                open={colorBarMinMaxEditorOpen}\n                onClose={handleCloseColorBarMinMaxEditor}\n                anchorOrigin={{\n                    vertical: 'bottom',\n                    horizontal: 'left',\n                }}\n                transformOrigin={{\n                    vertical: 'top',\n                    horizontal: 'center',\n                }}\n            >\n                {colorBarMinMaxEditor}\n            </Popover>\n            <Popover\n                anchorEl={colorBarNameAnchorEl}\n                open={colorBarNameEditorOpen}\n                onClose={handleCloseColorBarNameEditor}\n                anchorOrigin={{\n                    vertical: 'bottom',\n                    horizontal: 'left',\n                }}\n                transformOrigin={{\n                    vertical: 'top',\n                    horizontal: 'left',\n                }}\n            >\n                {colorBarNameEditor}\n            </Popover>\n        </div>\n    );\n}\n\n\ninterface LabelsProps {\n    minValue: number;\n    maxValue: number;\n    count: number;\n}\n\nfunction Labels({minValue, maxValue, count}: LabelsProps) {\n    return (\n        <React.Fragment>\n            {getLabelsFromRange(minValue, maxValue, count).map((label, i) => <span key={i}>{label}</span>)}\n        </React.Fragment>\n    );\n}\n\nfunction minMaxToText(minMaxValue: [number, number]): [string, string] {\n    return [minMaxValue[0] + '', minMaxValue[1] + ''];\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport {\n    selectedVariableNameSelector,\n    selectedVariableUnitsSelector,\n    selectedVariableColorBarNameSelector,\n    selectedVariableColorBarMinMaxSelector, selectedVariableOpacitySelector,\n} from '../selectors/controlSelectors';\nimport { updateVariableColorBar } from '../actions/dataActions';\nimport ColorBarLegend from '../components/ColorBarLegend';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        variableName: selectedVariableNameSelector(state),\n        variableUnits: selectedVariableUnitsSelector(state),\n        variableColorBarMinMax: selectedVariableColorBarMinMaxSelector(state),\n        variableColorBarName: selectedVariableColorBarNameSelector(state),\n        variableOpacity: selectedVariableOpacitySelector(state),\n        colorBars: state.dataState.colorBars,\n    }\n};\n\nconst mapDispatchToProps = {\n    updateVariableColorBar,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ColorBarLegend);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport {connect} from 'react-redux';\nimport { default as OlMap } from \"ol/Map\";\n\nimport {AppState} from '../states/appState';\nimport {\n    baseMapLayerSelector,\n    imageSmoothingSelector,\n    mapProjectionSelector,\n    selectedDatasetBoundaryLayerSelector,\n    selectedDatasetPlaceGroupLayersSelector,\n    selectedDatasetRgbLayerSelector,\n    selectedDatasetVariableLayerSelector,\n    selectedPlaceGroupPlacesSelector\n} from '../selectors/controlSelectors';\nimport { addUserPlace, addUserPlacesFromText } from '../actions/dataActions';\nimport Viewer from '../components/Viewer';\nimport {userPlaceGroupSelector} from \"../selectors/dataSelectors\";\nimport {selectPlace} from \"../actions/controlActions\";\nimport ColorBarLegend from \"./ColorBarLegend\";\n\n\ninterface OwnProps {\n    onMapRef?: (map: OlMap | null) => void;\n}\n\nconst mapStateToProps = (state: AppState, ownProps: OwnProps) => {\n    return {\n        locale: state.controlState.locale,\n        variableLayer: selectedDatasetVariableLayerSelector(state),\n        rgbLayer: selectedDatasetRgbLayerSelector(state),\n        datasetBoundaryLayer: selectedDatasetBoundaryLayerSelector(state),\n        placeGroupLayers: selectedDatasetPlaceGroupLayersSelector(state),\n        colorBarLegend: <ColorBarLegend/>,\n        userPlaceGroup: userPlaceGroupSelector(state),\n        mapId: 'map',\n        mapInteraction: state.controlState.mapInteraction,\n        mapProjection: mapProjectionSelector(state),\n        selectedPlaceId: state.controlState.selectedPlaceId,\n        places: selectedPlaceGroupPlacesSelector(state),\n        baseMapLayer: baseMapLayerSelector(state),\n        imageSmoothing: imageSmoothingSelector(state),\n        onMapRef: ownProps.onMapRef,\n    }\n};\n\nconst mapDispatchToProps = {\n    addUserPlace,\n    addUserPlacesFromText,\n    selectPlace,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Viewer);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Box from '@mui/material/Box';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport IconButton from '@mui/material/IconButton';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Typography from '@mui/material/Typography';\nimport AllOutIcon from '@mui/icons-material/AllOut';\nimport CloseIcon from '@mui/icons-material/Close';\nimport * as React from 'react';\nimport { useState } from 'react';\nimport {\n    AxisDomain,\n    CartesianGrid,\n    DotProps,\n    ErrorBar,\n    Legend,\n    Line,\n    LineChart,\n    ReferenceArea,\n    ReferenceLine,\n    ResponsiveContainer,\n    Tooltip,\n    TooltipPayload,\n    TooltipProps,\n    XAxis,\n    YAxis\n} from 'recharts';\nimport { getUserPlaceColor } from '../config';\nimport i18n from '../i18n';\nimport { Place, PlaceInfo } from '../model/place';\n\nimport { equalTimeRanges, Time, TimeRange, TimeSeries, TimeSeriesGroup, TimeSeriesPoint } from '../model/timeSeries';\nimport { WithLocale } from '../util/lang';\nimport { utcTimeToIsoDateString, utcTimeToIsoDateTimeString } from '../util/time';\n\nconst INVISIBLE_LINE_COLOR = '#00000000';\nconst SUBSTITUTE_LABEL_COLOR = '#FAFFDD';\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        chartContainer: {\n            userSelect: 'none',\n            marginTop: theme.spacing(1),\n            width: '99%',\n            height: '32vh',\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'flex-stretch',\n        },\n        responsiveContainer: {\n            flexGrow: 1,\n        },\n        actionButton: {\n            zIndex: 1000,\n            opacity: 0.8,\n        },\n        toolTipContainer: {\n            backgroundColor: 'black',\n            opacity: 0.8,\n            color: 'white',\n            border: '2px solid black',\n            borderRadius: theme.spacing(2),\n            padding: theme.spacing(1.5),\n        },\n        toolTipValue: {\n            fontWeight: 'bold',\n        },\n        toolTipLabel: {\n            fontWeight: 'bold',\n            paddingBottom: theme.spacing(1),\n        },\n        chartTitle: {}\n    });\n\n\ninterface TimeSeriesChartProps extends WithStyles<typeof styles>, WithLocale {\n    theme: Theme;\n    timeSeriesGroup: TimeSeriesGroup;\n    selectedTime?: Time | null;\n    selectTime?: (time: Time | null) => void;\n\n    dataTimeRange?: TimeRange | null;\n    selectedTimeRange?: TimeRange | null;\n    selectTimeRange?: (timeRange: TimeRange | null) => void;\n\n    showPointsOnly: boolean;\n    showErrorBars: boolean;\n\n    selectTimeSeries?: (timeSeriesGroupId: string, timeSeriesIndex: number, timeSeries: TimeSeries) => void;\n\n    removeTimeSeriesGroup?: (id: string) => void;\n    completed: number[];\n\n    placeInfos?: { [placeId: string]: PlaceInfo };\n\n    selectPlace: (placeId: string | null, places: Place[], showInMap: boolean) => void;\n    places: Place[];\n}\n\n\nconst X_AXIS_DOMAIN: [AxisDomain, AxisDomain] = ['dataMin', 'dataMax'];\nconst Y_AXIS_DOMAIN: [AxisDomain, AxisDomain] = ['auto', 'auto'];\n\n\ninterface TimeRangeSelection {\n    firstTime?: number;\n    secondTime?: number;\n}\n\nconst TimeSeriesChart: React.FC<TimeSeriesChartProps> = ({\n                                                             classes,\n                                                             timeSeriesGroup,\n                                                             selectTimeSeries,\n                                                             selectedTime,\n                                                             selectTime,\n                                                             selectedTimeRange,\n                                                             selectTimeRange,\n                                                             places,\n                                                             selectPlace,\n                                                             placeInfos,\n                                                             dataTimeRange,\n                                                             theme,\n                                                             showErrorBars,\n                                                             showPointsOnly,\n                                                             removeTimeSeriesGroup,\n                                                             completed,\n                                                         }) => {\n    const [\n        timeRangeSelection,\n        setTimeRangeSelection\n    ] = useState<TimeRangeSelection>({});\n\n    const clearTimeRangeSelection = () => {\n        setTimeRangeSelection({});\n    };\n\n    const paletteType = theme.palette.mode;\n    const lightStroke = theme.palette.primary.light;\n    const mainStroke = theme.palette.primary.main;\n    const labelTextColor = theme.palette.primary.contrastText;\n\n    let isZoomedIn = false, time1: number | null = null, time2: number | null = null;\n    if (selectedTimeRange) {\n        isZoomedIn = !equalTimeRanges(selectedTimeRange, dataTimeRange || null);\n        [time1, time2] = selectedTimeRange;\n    }\n\n    const tickFormatter = (value: any) => {\n        if (typeof value !== 'number' || !Number.isFinite(value)) {\n            return null;\n        }\n        return utcTimeToIsoDateString(value);\n    };\n\n    const handleClick = (event: any) => {\n        if (event && selectTime && event.activeLabel !== null && Number.isFinite(event.activeLabel)) {\n            selectTime(event.activeLabel!);\n        }\n        clearTimeRangeSelection()\n    };\n\n    const handleTimeSeriesClick = (timeSeriesGroupId: string, timeSeriesIndex: number, timeSeries: TimeSeries) => {\n        if (!!selectTimeSeries) {\n            selectTimeSeries(timeSeriesGroupId, timeSeriesIndex, timeSeries);\n        }\n        selectPlace(timeSeries.source.placeId, places, true);\n    };\n\n    const handleMouseDown = (event: any) => {\n        const firstTime = event && event.activeLabel;\n        setTimeRangeSelection({firstTime});\n    };\n\n    const handleMouseMove = (event: any) => {\n        const firstTime = timeRangeSelection.firstTime;\n        if (firstTime !== undefined) {\n            const secondTime = event && event.activeLabel;\n            setTimeRangeSelection({...timeRangeSelection, secondTime});\n        }\n    };\n\n    const handleMouseUp = (event: any) => {\n        zoomIn();\n    };\n\n    const handleMouseEnter = () => {\n        clearTimeRangeSelection();\n    }\n\n    const handleMouseLeave = () => {\n        clearTimeRangeSelection();\n    }\n\n    const handleZoomOutButtonClick = () => {\n        zoomOut();\n    };\n\n    const handleRemoveTimeSeriesGroupClick = () => {\n        if (removeTimeSeriesGroup) {\n            removeTimeSeriesGroup(timeSeriesGroup.id);\n        }\n    };\n\n    const zoomIn = () => {\n        const {firstTime, secondTime} = timeRangeSelection;\n        console.log(\"zoomIn:\", firstTime, secondTime)\n        if (firstTime === secondTime\n            || firstTime === undefined\n            || secondTime === undefined) {\n            clearTimeRangeSelection();\n            return;\n        }\n        let [minTime, maxTime] = [firstTime, secondTime];\n        if (minTime > maxTime) {\n            [minTime, maxTime] = [maxTime, minTime];\n        }\n        clearTimeRangeSelection();\n        if (selectTimeRange) {\n            selectTimeRange([minTime, maxTime]);\n        }\n    };\n\n    const zoomOut = () => {\n        clearTimeRangeSelection();\n        if (selectTimeRange) {\n            selectTimeRange(dataTimeRange || null);\n        }\n    };\n\n    let commonValueDataKey: keyof TimeSeriesPoint | null = null;\n\n    const lines = timeSeriesGroup.timeSeriesArray.map((ts, i) => {\n        const source = ts.source;\n        const valueDataKey = source.valueDataKey;\n        let lineName = source.variableName;\n        let lineColor = 'yellow';\n        if (placeInfos) {\n            const placeInfo = placeInfos[source.placeId];\n            if (placeInfo) {\n                const {place, label, color} = placeInfo;\n                if (place.geometry.type === 'Point') {\n                    const lon = place.geometry.coordinates[0];\n                    const lat = place.geometry.coordinates[1];\n                    lineName += ` (${label}: ${lat.toFixed(5)},${lon.toFixed(5)})`;\n                } else {\n                    lineName += ` (${label})`;\n                }\n                lineColor = color;\n            }\n        }\n\n        const data: TimeSeriesPoint[] = [];\n        ts.data.forEach(point => {\n            if (point[valueDataKey] !== null) {\n                let time1Ok = true;\n                let time2Ok = true;\n                if (time1 !== null) {\n                    time1Ok = point.time >= time1;\n                }\n                if (time2 !== null) {\n                    time2Ok = point.time <= time2;\n                }\n                if (time1Ok && time2Ok) {\n                    data.push(point);\n                }\n            }\n        });\n        if (commonValueDataKey === null) {\n            commonValueDataKey = valueDataKey;\n        }\n        const shadedLineColor = getUserPlaceColor(lineColor, paletteType);\n        let errorBar;\n        if (valueDataKey && showErrorBars && source.errorDataKey) {\n            errorBar = (\n                <ErrorBar\n                    dataKey={source.errorDataKey}\n                    width={4}\n                    strokeWidth={1}\n                    stroke={shadedLineColor}\n                />\n            );\n        }\n        return (\n            <Line\n                key={i}\n                type=\"monotone\"\n                name={lineName}\n                unit={source.variableUnits}\n                data={data}\n                dataKey={valueDataKey}\n                dot={<CustomizedDot radius={3} stroke={shadedLineColor} fill={'white'} strokeWidth={2}/>}\n                activeDot={<CustomizedDot radius={3} stroke={'white'} fill={shadedLineColor} strokeWidth={2}/>}\n                stroke={shadedLineColor}\n                strokeOpacity={showPointsOnly ? 0 : ts.dataProgress}\n                // strokeWidth={2 * (ts.dataProgress || 1)}\n                // See https://github.com/recharts/recharts/issues/1624#issuecomment-474119055\n                // isAnimationActive={ts.dataProgress === 1.0}\n                isAnimationActive={false}\n                onClick={() => handleTimeSeriesClick(timeSeriesGroup.id, i, ts)}\n            >\n                {errorBar}\n            </Line>\n        );\n    });\n\n    let referenceLine = null;\n    if (selectedTime !== null) {\n        referenceLine =\n            <ReferenceLine\n                isFront={true}\n                x={selectedTime}\n                stroke={mainStroke}\n                strokeWidth={3}\n                strokeOpacity={0.5}\n            />;\n    }\n\n    const {firstTime, secondTime} = timeRangeSelection;\n    let referenceArea = null;\n    if (firstTime !== undefined && secondTime !== undefined) {\n        referenceArea =\n            <ReferenceArea\n                x1={firstTime}\n                x2={secondTime}\n                strokeOpacity={0.3}\n                fill={lightStroke}\n                fillOpacity={0.3}\n            />;\n    }\n\n    const actionButtons = [];\n\n    if (isZoomedIn) {\n        const zoomOutButton = (\n            <IconButton\n                key={'zoomOutButton'}\n                className={classes.actionButton}\n                aria-label=\"Zoom Out\"\n                onClick={handleZoomOutButtonClick}\n                size=\"large\">\n                <AllOutIcon/>\n            </IconButton>\n        );\n        actionButtons.push(zoomOutButton);\n    }\n    const progress = completed.reduce((a: number, b: number) => a + b, 0) / completed.length;\n    const loading = (progress > 0 && progress < 100);\n\n    let removeAllButton;\n    if (loading) {\n        removeAllButton = (\n            <CircularProgress\n                key={'loadingTimeSeriesGroup'}\n                size={24}\n                className={classes.actionButton}\n                color={'secondary'}\n            />\n        );\n    } else {\n        removeAllButton = (\n            <IconButton\n                key={'removeTimeSeriesGroup'}\n                className={classes.actionButton}\n                aria-label=\"Close\"\n                onClick={handleRemoveTimeSeriesGroupClick}\n                size=\"large\">\n                <CloseIcon/>\n            </IconButton>\n        );\n    }\n\n    actionButtons.push(removeAllButton);\n\n    const timeSeriesText = i18n.get('Time-Series');\n    const unitsText = timeSeriesGroup.variableUnits || i18n.get('unknown units');\n    const chartTitle = `${timeSeriesText} (${unitsText})`;\n\n    // 99% per https://github.com/recharts/recharts/issues/172\n    return (\n        <div className={classes.chartContainer}>\n            <Box display='flex' flexDirection='row' alignItems='center' justifyContent='space-between'>\n                <Typography className={classes.chartTitle}>{chartTitle}</Typography>\n                <Box display='flex' flexDirection='row' flexWrap='nowrap' alignItems='center'>\n                    {actionButtons}\n                </Box>\n            </Box>\n            <ResponsiveContainer width=\"99%\" className={classes.responsiveContainer}>\n                <LineChart\n                    onMouseDown={handleMouseDown}\n                    onMouseMove={handleMouseMove}\n                    onMouseUp={handleMouseUp}\n                    onMouseEnter={handleMouseEnter}\n                    onMouseLeave={handleMouseLeave}\n                    onClick={handleClick}\n                    syncId=\"anyId\"\n                    style={{color: labelTextColor}}\n                >\n                    <XAxis\n                        dataKey=\"time\"\n                        type=\"number\"\n                        tickCount={6}\n                        domain={selectedTimeRange || X_AXIS_DOMAIN}\n                        tickFormatter={tickFormatter}\n                        stroke={labelTextColor}\n                        allowDuplicatedCategory={false}\n                    />\n                    <YAxis\n                        dataKey={commonValueDataKey || \"mean\"}\n                        type=\"number\"\n                        domain={Y_AXIS_DOMAIN}\n                        stroke={labelTextColor}\n                    />\n                    <CartesianGrid strokeDasharray=\"3 3\"/>\n                    <Tooltip content={<CustomTooltip/>}/>\n                    <Legend/>\n                    {lines}\n                    {referenceArea}\n                    {referenceLine}\n                </LineChart>\n            </ResponsiveContainer>\n        </div>\n    );\n};\n\nexport default withStyles(styles, {withTheme: true})(TimeSeriesChart);\n\n\ninterface _CustomTooltipProps extends TooltipProps, WithStyles<typeof styles> {\n}\n\nconst _CustomTooltip: React.FC<_CustomTooltipProps> = (\n    {\n        classes,\n        active,\n        label,\n        payload\n    }\n) => {\n    if (!active) {\n        return null;\n    }\n    if (typeof label !== 'number') {\n        return null;\n    }\n    if (!payload || payload.length === 0) {\n        return null;\n    }\n    const items = payload.map((p: TooltipPayload, index: number) => {\n        //console.log(\"payload:\", p);\n        let {name, value, color, unit, dataKey} = p;\n        if (typeof value !== 'number') {\n            return null;\n        }\n        // let valueText;\n        // if (typeof p.std === 'number') {\n        //     valueText = `${value.toFixed(2)} ±${p.std.toFixed(2)} (std)`;\n        // } else {\n        //     valueText = value.toFixed(3);\n        // }\n        const valueText = value.toFixed(3);\n        if (color === INVISIBLE_LINE_COLOR) {\n            color = SUBSTITUTE_LABEL_COLOR;\n        }\n        const isPoint = name.indexOf(':') !== -1;\n        const suffix = isPoint ? '' : ` (${dataKey})`;\n        return (\n            <div key={index}>\n                <span>{name}:&nbsp;</span>\n                <span className={classes.toolTipValue} style={{color}}>{valueText}</span>\n                <span>&nbsp;{`${unit} ${suffix}`}</span>\n            </div>\n        );\n    });\n\n    if (!items) {\n        return null;\n    }\n\n    return (\n        <div className={classes.toolTipContainer}>\n            <span className={classes.toolTipLabel}>{`${utcTimeToIsoDateTimeString(label)} UTC`}</span>\n            {items}\n        </div>\n    );\n};\n\nconst CustomTooltip = withStyles(styles)(_CustomTooltip);\n\ninterface CustomizedDotProps extends DotProps {\n    radius: number;\n    stroke: string;\n    strokeWidth: number;\n    fill: string;\n}\n\n\nconst CustomizedDot = (props: CustomizedDotProps) => {\n\n    const {cx, cy, radius, stroke, fill, strokeWidth} = props;\n\n    const vpSize = 1024;\n    const totalRadius = radius + 0.5 * strokeWidth;\n    const totalDiameter = 2 * totalRadius;\n\n    const r = Math.floor(100 * radius / totalDiameter + 0.5) + '%';\n    const sw = Math.floor(100 * strokeWidth / totalDiameter + 0.5) + '%';\n\n    // noinspection SuspiciousTypeOfGuard\n    if (typeof cx === 'number' && typeof cy === 'number') {\n        return (\n            <svg\n                x={cx - totalRadius}\n                y={cy - totalRadius}\n                width={totalDiameter}\n                height={totalDiameter}\n                viewBox={`0 0 ${vpSize} ${vpSize}`}\n            >\n                <circle\n                    cx='50%'\n                    cy='50%'\n                    r={r}\n                    strokeWidth={sw}\n                    stroke={stroke}\n                    fill={fill}\n                />\n            </svg>\n        );\n    }\n\n    return null;\n};\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport { Theme } from '@mui/material';\nimport Slider, { Mark } from '@mui/material/Slider';\nimport Box from '@mui/material/Box';\n\nimport { TimeRange, UNIT } from '../model/timeSeries';\nimport { utcTimeToIsoDateString, utcTimeToIsoDateTimeString } from '../util/time';\n\nconst HOR_MARGIN = 5;\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        box: {\n            marginTop: theme.spacing(1),\n            marginLeft: theme.spacing(HOR_MARGIN),\n            marginRight: theme.spacing(HOR_MARGIN),\n            width: `calc(100% - ${theme.spacing(3 * (HOR_MARGIN + 1))})`,\n            height: '5em',\n            display: \"flex\",\n            alignItems: \"flex-end\"\n        },\n    }\n);\n\ninterface TimeRangeSliderProps extends WithStyles<typeof styles> {\n    dataTimeRange?: TimeRange | null;\n    selectedTimeRange?: TimeRange | null;\n    selectTimeRange?: (timeRange: TimeRange | null) => void;\n    updateVisibleTimeRange?: (timeRange: TimeRange | null) => void;\n}\n\nconst TimeRangeSlider: React.FC<TimeRangeSliderProps> = ({classes, dataTimeRange, selectedTimeRange, selectTimeRange}) => {\n    const [selectedTimeRange_, setSelectedTimeRange_] = useState(selectedTimeRange);\n\n    useEffect(() => {\n        setSelectedTimeRange_(selectedTimeRange);\n    }, [selectedTimeRange]);\n\n    const handleChange = (event: Event, value: number | number[]) => {\n        if (Array.isArray(value)) {\n            setSelectedTimeRange_([value[0], value[1]]);\n        }\n    };\n\n    const handleChangeCommitted = (event: React.SyntheticEvent | Event, value: number | number[]) => {\n        if (selectTimeRange && Array.isArray(value)) {\n            selectTimeRange([value[0], value[1]]);\n        }\n    };\n\n    function valueLabelFormat(value: number) {\n        return utcTimeToIsoDateTimeString(value);\n    }\n\n    const dataTimeRangeValid = Array.isArray(dataTimeRange);\n    if (!dataTimeRangeValid) {\n        dataTimeRange = [Date.now() - 2 * UNIT.years, Date.now()];\n    }\n\n    const marks: Mark[] = [\n        {value: dataTimeRange![0], label: utcTimeToIsoDateString(dataTimeRange![0])},\n        {value: dataTimeRange![1], label: utcTimeToIsoDateString(dataTimeRange![1])},\n    ];\n\n    return (\n        <Box className={classes.box}>\n            <Slider\n                disabled={!dataTimeRangeValid}\n                min={dataTimeRange![0]}\n                max={dataTimeRange![1]}\n                value={selectedTimeRange_!}\n                marks={marks}\n                onChange={handleChange}\n                onChangeCommitted={handleChangeCommitted}\n                size=\"small\"\n                valueLabelDisplay=\"on\"\n                valueLabelFormat={valueLabelFormat}\n            />\n        </Box>\n    );\n};\n\nexport default withStyles(styles)(TimeRangeSlider);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport { Theme } from '@mui/material';\n\nimport { WithLocale } from '../util/lang';\nimport TimeSeriesChart from './TimeSeriesChart';\nimport { Time, TimeRange, TimeSeriesGroup } from '../model/timeSeries';\nimport { Place, PlaceInfo } from '../model/place';\nimport TimeRangeSlider from './TimeRangeSlider';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        chartContainer: {\n            display: 'flex',\n            flexDirection: 'column',\n            flexWrap: 'wrap',\n            flexFlow: 'flex-start',\n            alignItems: 'center',\n        },\n        noChartsCard: {\n            width: '20em',\n        },\n        noChartsTitle: {\n            fontSize: 14,\n        },\n    });\n\n\ninterface TimeSeriesChartsProps extends WithStyles<typeof styles>, WithLocale {\n    theme: Theme;\n    timeSeriesGroups: TimeSeriesGroup[];\n    selectedTime?: Time | null;\n    selectTime?: (time: Time | null) => void;\n\n    showPointsOnly: boolean;\n    showErrorBars: boolean;\n\n    dataTimeRange?: TimeRange | null;\n    selectedTimeRange?: TimeRange | null;\n    selectTimeRange?: (timeRange: TimeRange | null) => void;\n\n    removeTimeSeriesGroup?: (id: string) => void;\n    placeInfos?: { [placeId: string]: PlaceInfo };\n    selectPlace: (placeId: string | null, places: Place[], showInMap: boolean) => void;\n    places: Place[];\n}\n\nconst TimeSeriesCharts: React.FC<TimeSeriesChartsProps> = ({\n                                                               classes, locale,\n                                                               timeSeriesGroups,\n                                                               selectedTime, selectedTimeRange,\n                                                               dataTimeRange, selectTime, selectTimeRange,\n                                                               removeTimeSeriesGroup, showPointsOnly, showErrorBars,\n                                                               placeInfos, places, selectPlace\n                                                           }) => {\n\n\n    const charts = timeSeriesGroups.map((timeSeriesGroup: TimeSeriesGroup) => {\n        const completed = timeSeriesGroup.timeSeriesArray.map(item => (\n            item.dataProgress ? 100 * item.dataProgress : 0\n        ));\n\n        return (\n            <TimeSeriesChart\n                key={timeSeriesGroup.id}\n                locale={locale}\n                timeSeriesGroup={timeSeriesGroup}\n                selectedTime={selectedTime}\n                selectedTimeRange={selectedTimeRange}\n                dataTimeRange={dataTimeRange}\n                selectTime={selectTime}\n                selectTimeRange={selectTimeRange}\n                removeTimeSeriesGroup={removeTimeSeriesGroup}\n                completed={completed}\n                showPointsOnly={showPointsOnly}\n                showErrorBars={showErrorBars}\n                placeInfos={placeInfos}\n                places={places}\n                selectPlace={selectPlace}\n            />\n        );\n    });\n\n    if (charts.length === 0) {\n        return null;\n    }\n\n    return (\n        <div className={classes.chartContainer}>\n            <TimeRangeSlider\n                selectedTimeRange={selectedTimeRange}\n                dataTimeRange={dataTimeRange}\n                selectTimeRange={selectTimeRange}\n            />\n            {charts}\n        </div>\n    );\n};\n\nexport default withStyles(styles, {withTheme: true})(TimeSeriesCharts);\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport { AppState } from '../states/appState';\r\nimport TimeSeriesCharts from '../components/TimeSeriesCharts';\r\nimport { removeTimeSeriesGroup } from \"../actions/dataActions\";\r\nimport { selectPlace, selectTime, selectTimeRange } from \"../actions/controlActions\";\r\nimport {\r\n    selectedDatasetTimeRangeSelector,\r\n    selectedPlaceGroupPlacesSelector,\r\n    timeSeriesPlaceInfosSelector\r\n} from '../selectors/controlSelectors';\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        locale: state.controlState.locale,\r\n        timeSeriesGroups: state.dataState.timeSeriesGroups,\r\n        selectedTime: state.controlState.selectedTime,\r\n        selectedTimeRange: state.controlState.selectedTimeRange,\r\n        dataTimeRange: selectedDatasetTimeRangeSelector(state),\r\n        showPointsOnly: state.controlState.showTimeSeriesPointsOnly,\r\n        showErrorBars: state.controlState.showTimeSeriesErrorBars,\r\n        placeInfos: timeSeriesPlaceInfosSelector(state),\r\n        places: selectedPlaceGroupPlacesSelector(state),\r\n    }\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    selectTime,\r\n    selectTimeRange,\r\n    removeTimeSeriesGroup,\r\n    selectPlace,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TimeSeriesCharts);\r\n","export default __webpack_public_path__ + \"static/media/python-bw.071ec04f.png\";","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport Card from '@mui/material/Card';\nimport CardActions from '@mui/material/CardActions';\nimport CardContent from '@mui/material/CardContent';\nimport CardHeader from '@mui/material/CardHeader';\nimport CardMedia from '@mui/material/CardMedia';\nimport Collapse from '@mui/material/Collapse';\nimport IconButton from '@mui/material/IconButton';\nimport Link from '@mui/material/Link';\nimport Paper from '@mui/material/Paper';\nimport { Theme } from '@mui/material/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport makeStyles from '@mui/styles/makeStyles';\nimport Table from '@mui/material/Table';\nimport TableBody from '@mui/material/TableBody';\nimport TableCell from '@mui/material/TableCell';\nimport TableContainer from '@mui/material/TableContainer';\nimport TableRow from '@mui/material/TableRow';\nimport Tooltip from '@mui/material/Tooltip';\nimport Typography from '@mui/material/Typography';\nimport CloseIcon from '@mui/icons-material/Close';\nimport JsonIcon from '@mui/icons-material/DataObject';\nimport InfoIcon from '@mui/icons-material/Info';\nimport LayersIcon from '@mui/icons-material/Layers';\nimport ListAltIcon from '@mui/icons-material/ListAlt';\nimport PlaceIcon from '@mui/icons-material/Place';\nimport TextFieldsIcon from '@mui/icons-material/TextFields';\nimport WidgetsIcon from '@mui/icons-material/Widgets';\nimport ToggleButton from '@mui/material/ToggleButton';\nimport ToggleButtonGroup from '@mui/material/ToggleButtonGroup';\nimport CodeMirror from '@uiw/react-codemirror';\nimport { json } from '@codemirror/lang-json';\nimport { python } from '@codemirror/lang-python';\nimport i18n from '../i18n';\nimport { Dataset } from '../model/dataset';\nimport { PlaceInfo } from '../model/place';\nimport { Variable } from '../model/variable';\nimport { WithLocale } from '../util/lang';\nimport pythonLogo from '../resources/python-bw.png'\nimport { ApiServerConfig } from \"../model/apiServer\";\nimport { Config } from \"../config\";\nimport { Extension } from \"@codemirror/state\";\nimport { Time } from \"../model/timeSeries\";\nimport { utcTimeToIsoDateTimeString } from '../util/time';\n\ntype ViewMode = 'text' | 'list' | 'code' | 'python';\n\nconst useStyles = makeStyles((theme: Theme) => createStyles(\n    {\n        card: {\n            maxWidth: '100%',\n            marginBottom: theme.spacing(1),\n            marginRight: theme.spacing(1),\n        },\n        info: {\n            marginRight: theme.spacing(1),\n        },\n        close: {\n            marginLeft: 'auto',\n        },\n        table: {},\n        keyValueTableContainer: {\n            background: theme.palette.divider,\n        },\n        variableHtmlReprContainer: {\n            background: theme.palette.divider,\n            padding: theme.spacing(1),\n            marginTop: theme.spacing(1),\n            marginBottom: theme.spacing(1),\n        },\n        media: {\n            height: 200,\n        },\n        cardContent: {\n            padding: 8,\n        },\n        code: {\n            fontFamily: 'Monospace'\n        },\n    }\n));\n\n\ninterface InfoCardProps extends WithLocale {\n    infoCardOpen: boolean;\n    showInfoCard: (infoCardOpen: boolean) => void;\n    visibleInfoCardElements: string[];\n    setVisibleInfoCardElements: (visibleInfoCardElements: string[]) => void;\n    infoCardElementViewModes: { [elementType: string]: ViewMode };\n    updateInfoCardElementViewMode: (elementType: string, viewMode: ViewMode) => void;\n    selectedDataset: Dataset | null;\n    selectedVariable: Variable | null;\n    selectedPlaceInfo: PlaceInfo | null;\n    selectedTime: Time | null;\n    serverConfig: ApiServerConfig;\n    allowViewModePython: boolean;\n}\n\nconst InfoCard: React.FC<InfoCardProps> = ({\n                                               infoCardOpen,\n                                               showInfoCard,\n                                               visibleInfoCardElements,\n                                               setVisibleInfoCardElements,\n                                               infoCardElementViewModes,\n                                               updateInfoCardElementViewMode,\n                                               selectedDataset,\n                                               selectedVariable,\n                                               selectedPlaceInfo,\n                                               selectedTime,\n                                               serverConfig,\n                                               allowViewModePython\n                                           }) => {\n    const classes = useStyles();\n\n    if (!infoCardOpen) {\n        return null;\n    }\n\n    const handleInfoElementsChanges = (event: React.MouseEvent<HTMLElement>, visibleElementTypes: string[]) => {\n        setVisibleInfoCardElements(visibleElementTypes);\n    };\n\n    const handleInfoCardClose = () => {\n        showInfoCard(false);\n    };\n\n    // TODO (forman): fix ugly code duplication below!\n    let datasetInfoContent;\n    let variableInfoContent;\n    let placeInfoContent;\n    if (selectedDataset) {\n        const elementType = 'dataset';\n        const viewMode = infoCardElementViewModes[elementType];\n        const setViewMode = (viewMode: ViewMode) => updateInfoCardElementViewMode(elementType, viewMode);\n        const isVisible = visibleInfoCardElements.includes(elementType);\n        datasetInfoContent = (\n            <DatasetInfoContent\n                isIn={isVisible}\n                viewMode={viewMode}\n                setViewMode={setViewMode}\n                dataset={selectedDataset}\n                serverConfig={serverConfig}\n                hasPython={allowViewModePython}\n            />\n        );\n    }\n    if (selectedDataset && selectedVariable) {\n        const elementType = 'variable';\n        const viewMode = infoCardElementViewModes[elementType];\n        const setViewMode = (viewMode: ViewMode) => updateInfoCardElementViewMode(elementType, viewMode);\n        const isVisible = visibleInfoCardElements.includes(elementType);\n        variableInfoContent = (\n            <VariableInfoContent\n                isIn={isVisible}\n                viewMode={viewMode}\n                setViewMode={setViewMode}\n                variable={selectedVariable}\n                time={selectedTime}\n                serverConfig={serverConfig}\n                hasPython={allowViewModePython}\n            />\n        );\n    }\n    if (selectedPlaceInfo) {\n        const elementType = 'place';\n        const viewMode = infoCardElementViewModes[elementType];\n        const setViewMode = (viewMode: ViewMode) => updateInfoCardElementViewMode(elementType, viewMode);\n        const isVisible = visibleInfoCardElements.includes(elementType);\n        placeInfoContent = (\n            <PlaceInfoContent\n                isIn={isVisible}\n                viewMode={viewMode}\n                setViewMode={setViewMode}\n                placeInfo={selectedPlaceInfo}\n            />\n        );\n    }\n\n    return (\n        <Card className={classes.card}>\n            <CardActions disableSpacing>\n                <InfoIcon fontSize={'large'} className={classes.info}/>\n                <ToggleButtonGroup key={0} size=\"small\" value={visibleInfoCardElements}\n                                   onChange={handleInfoElementsChanges}>\n                    <ToggleButton key={0} value=\"dataset\" disabled={selectedDataset === null}>\n                        <Tooltip arrow title={i18n.get('Dataset information')}>\n                            <WidgetsIcon/>\n                        </Tooltip>\n                    </ToggleButton>\n                    <ToggleButton key={1} value=\"variable\" disabled={selectedVariable === null}>\n                        <Tooltip arrow title={i18n.get('Variable information')}>\n                            <LayersIcon/>\n                        </Tooltip>\n                    </ToggleButton>\n                    <ToggleButton key={2} value=\"place\" disabled={selectedPlaceInfo === null}>\n                        <Tooltip arrow title={i18n.get('Place information')}>\n                            <PlaceIcon/>\n                        </Tooltip>\n                    </ToggleButton>\n                </ToggleButtonGroup>\n                <IconButton\n                    key={1}\n                    onClick={handleInfoCardClose}\n                    className={classes.close}\n                    size=\"large\">\n                    {<CloseIcon/>}\n                </IconButton>\n            </CardActions>\n            {datasetInfoContent}\n            {variableInfoContent}\n            {placeInfoContent}\n        </Card>\n    );\n};\n\nexport default InfoCard;\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ninterface DatasetInfoContentProps {\n    isIn: boolean;\n    viewMode: ViewMode;\n    setViewMode: (viewMode: ViewMode) => void;\n    dataset: Dataset;\n    serverConfig: ApiServerConfig;\n    hasPython: boolean;\n}\n\nconst DatasetInfoContent: React.FC<DatasetInfoContentProps> = (\n    {\n        isIn,\n        viewMode,\n        setViewMode,\n        dataset,\n        serverConfig,\n        hasPython\n    }\n) => {\n    // const classes = useStyles();\n    let content;\n    if (viewMode === 'code') {\n        const jsonDimensions = selectObj(dataset.dimensions, ['name', 'size', 'dtype']);\n        const jsonDataset = selectObj(dataset, ['id', 'title', 'bbox', 'attrs']);\n        jsonDataset['dimensions'] = jsonDimensions;\n        content = (\n            <JsonCodeContent code={JSON.stringify(jsonDataset, null, 2)}/>\n        );\n    } else if (viewMode === 'list') {\n        content = (\n            <CardContent2>\n                <KeyValueTable\n                    data={Object.getOwnPropertyNames(dataset.attrs || {}).map(name => [name, dataset.attrs[name]])}\n                />\n            </CardContent2>\n        );\n    } else if (viewMode === 'text') {\n        const data: KeyValue[] = [\n            [i18n.get('Dimension names'), dataset.dimensions.map(d => d.name).join(', ')],\n            [i18n.get('Dimension data types'), dataset.dimensions.map(d => d.dtype).join(', ')],\n            [i18n.get('Dimension lengths'), dataset.dimensions.map(d => d.size).join(', ')],\n            [i18n.get('Geographical extent') + ' (x1, y1, x2, y2)', dataset.bbox.map(x => x + '').join(', ')],\n            [i18n.get('Spatial reference system'), dataset.spatialRef],\n        ];\n        content = (\n            <CardContent2>\n                <KeyValueTable data={data}/>\n            </CardContent2>\n        );\n    } else if (viewMode === 'python') {\n        content = (\n            <PythonCodeContent code={getDatasetPythonCode(serverConfig, dataset)}/>\n        );\n    }\n    return (\n        <InfoCardContent\n            title={dataset.title || '?'}\n            subheader={dataset.title && `ID: ${dataset.id}`}\n            isIn={isIn}\n            viewMode={viewMode}\n            setViewMode={setViewMode}\n            hasPython={hasPython}\n        >\n            {content}\n        </InfoCardContent>\n    );\n};\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ninterface VariableInfoContentProps {\n    isIn: boolean;\n    viewMode: ViewMode;\n    setViewMode: (viewMode: ViewMode) => void;\n    variable: Variable;\n    time: Time | null,\n    serverConfig: ApiServerConfig;\n    hasPython: boolean;\n}\n\nconst VariableInfoContent: React.FC<VariableInfoContentProps> = (\n    {\n        isIn,\n        viewMode,\n        setViewMode,\n        variable,\n        time,\n        serverConfig,\n        hasPython\n    }\n) => {\n    const classes = useStyles();\n    let content;\n    let htmlReprPaper;\n    if (viewMode === 'code') {\n        const jsonVariable = selectObj(variable, [\n            'id', 'name', 'title', 'units', 'shape', 'dtype', 'shape',\n            'timeChunkSize',\n            'colorBarMin',\n            'colorBarMax',\n            'colorBarName',\n            'attrs'\n        ]);\n        content = (\n            <JsonCodeContent code={JSON.stringify(jsonVariable, null, 2)}/>\n        );\n    } else if (viewMode === 'list') {\n        content = (\n            <CardContent2>\n                <KeyValueTable\n                    data={Object.getOwnPropertyNames(variable.attrs || {}).map(name => [name, variable.attrs[name]])}\n                />\n            </CardContent2>\n        );\n        if (variable.htmlRepr) {\n            const handleRef = (element: HTMLDivElement | null) => {\n                if (element && variable.htmlRepr) {\n                    element.innerHTML = variable.htmlRepr;\n                }\n            };\n            htmlReprPaper = (\n                <CardContent2>\n                    <Paper ref={handleRef} className={classes.variableHtmlReprContainer}/>\n                </CardContent2>\n            );\n        }\n    } else if (viewMode === 'text') {\n        const data: KeyValue[] = [\n            [i18n.get('Title'), variable.title],\n            [i18n.get('Name'), variable.name],\n            [i18n.get('Units'), variable.units],\n            [i18n.get('Data type'), variable.dtype],\n            [i18n.get('Dimension names'), variable.dims.join(', ')],\n            [i18n.get('Dimension lengths'), variable.shape.map(s => s + '').join(', ')],\n            [i18n.get('Time chunk size'), variable.timeChunkSize],\n        ];\n        content = (\n            <CardContent2>\n                <KeyValueTable data={data}/>\n            </CardContent2>\n        );\n    } else if (viewMode === 'python') {\n        content = (\n            <PythonCodeContent code={getVariablePythonCode(serverConfig, variable, time)}/>\n        );\n    }\n    return (\n        <InfoCardContent\n            title={variable.title || variable.name}\n            subheader={`${i18n.get('Name')}: ${variable.name}`}\n            isIn={isIn}\n            viewMode={viewMode}\n            setViewMode={setViewMode}\n            hasPython={hasPython}\n        >\n            {htmlReprPaper}\n            {content}\n        </InfoCardContent>\n    );\n};\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ninterface PlaceInfoContentProps {\n    isIn: boolean;\n    viewMode: ViewMode;\n    setViewMode: (viewMode: ViewMode) => void;\n    placeInfo: PlaceInfo;\n}\n\nconst PlaceInfoContent: React.FC<PlaceInfoContentProps> = (\n    {\n        isIn,\n        viewMode,\n        setViewMode,\n        placeInfo\n    }\n) => {\n    const classes = useStyles();\n    const place = placeInfo.place;\n    let content;\n    let image;\n    let description;\n    if (viewMode === 'code') {\n        content = (\n            <JsonCodeContent code={JSON.stringify(place, null, 2)}/>\n        );\n    } else if (viewMode === 'list') {\n        if (!!place.properties) {\n            const data: KeyValue[] = Object.getOwnPropertyNames(place.properties).map(\n                (name: any) => [name, place.properties![name]]\n            );\n            content = (\n                <CardContent2>\n                    <KeyValueTable data={data}/>\n                </CardContent2>\n            );\n        } else {\n            content = (\n                <CardContent2>\n                    <Typography>{i18n.get('There is no information available for this location.')}</Typography>\n                </CardContent2>\n            );\n        }\n    } else {\n        if (placeInfo.image && placeInfo.image.startsWith('http')) {\n            image = (\n                <CardMedia className={classes.media} image={placeInfo.image} title={placeInfo.label}/>\n            );\n        }\n        if (placeInfo.description) {\n            description = (\n                <CardContent2>\n                    <Typography>{placeInfo.description}</Typography>\n                </CardContent2>\n            );\n        }\n    }\n    return (\n        <InfoCardContent\n            title={placeInfo.label}\n            subheader={`${i18n.get('Geometry type')}: ${i18n.get(place.geometry.type)}`}\n            isIn={isIn}\n            viewMode={viewMode}\n            setViewMode={setViewMode}\n        >\n            {image}\n            {description}\n            {content}\n        </InfoCardContent>\n    );\n};\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ninterface InfoCardContentProps {\n    isIn: boolean;\n    title: React.ReactNode;\n    subheader?: React.ReactNode;\n    viewMode: ViewMode;\n    setViewMode: (viewMode: ViewMode) => void;\n    hasPython?: boolean;\n}\n\nconst InfoCardContent: React.FC<InfoCardContentProps> = ({\n                                                             isIn,\n                                                             title,\n                                                             subheader,\n                                                             viewMode,\n                                                             setViewMode,\n                                                             hasPython,\n                                                             children,\n                                                         }) => {\n\n    const handleViewModeChange = (event: React.MouseEvent<HTMLElement>, viewMode: ViewMode) => {\n        setViewMode(viewMode);\n    };\n\n    return (\n        <Collapse in={isIn} timeout=\"auto\" unmountOnExit>\n            <CardHeader\n                title={title}\n                subheader={subheader}\n                action={\n                    <ToggleButtonGroup\n                        key={0}\n                        size=\"small\"\n                        value={viewMode}\n                        exclusive={true}\n                        onChange={handleViewModeChange}\n                    >\n                        <ToggleButton key={0} value=\"text\">\n                            <TextFieldsIcon/>\n                        </ToggleButton>\n                        <ToggleButton key={1} value=\"list\">\n                            <ListAltIcon/>\n                        </ToggleButton>\n                        <ToggleButton key={2} value=\"code\">\n                            <JsonIcon/>\n                        </ToggleButton>\n                        {\n                            hasPython && (\n                                <ToggleButton key={3} value=\"python\">\n                                    <img src={pythonLogo} width={24} alt=\"python logo\"/>\n                                </ToggleButton>\n                            )\n                        }\n                    </ToggleButtonGroup>\n                }\n            />\n            {children}\n        </Collapse>\n    );\n};\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ntype KeyValue = [any, any];\n\ninterface KeyValueTableProps {\n    data: KeyValue[];\n}\n\nconst KeyValueTable: React.FC<KeyValueTableProps> = ({data}) => {\n    const classes = useStyles();\n    return (\n        <TableContainer component={Paper} className={classes.keyValueTableContainer}>\n            <Table className={classes.table} size=\"small\">\n                <TableBody>\n                    {\n                        data.map((kv, index) => {\n                            const [key, value] = kv;\n                            let renderedValue = value;\n                            if (typeof value === 'string'\n                                && (value.startsWith('http://')\n                                    || value.startsWith('https://'))) {\n                                renderedValue = (\n                                    <Link\n                                        href={value}\n                                        target='_blank'\n                                        rel='noreferrer'\n                                    >\n                                        {value}\n                                    </Link>);\n                            } else if (Array.isArray(value)) {\n                                renderedValue = '[' + value.map(v => v + '').join(', ') + ']';\n                            }\n                            return (\n                                <TableRow key={index}>\n                                    <TableCell>{key}</TableCell>\n                                    <TableCell align=\"right\">{renderedValue}</TableCell>\n                                </TableRow>\n                            );\n                        })\n                    }\n                </TableBody>\n            </Table>\n        </TableContainer>\n    );\n};\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst CardContent2: React.FC = ({children}) => {\n    const classes = useStyles();\n    return <CardContent className={classes.cardContent}>{children}</CardContent>\n};\n\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\ninterface CodeContentBaseProps {\n    code: string;\n}\n\ninterface CodeContentProps extends CodeContentBaseProps {\n    extension: Extension;\n}\n\nconst CodeContent: React.FC<CodeContentProps> = ({code, extension}) => {\n    return (\n        <CardContent2>\n            <CodeMirror\n                theme={Config.instance.branding.themeName || 'light'}\n                height=\"320px\"\n                extensions={[extension]}\n                value={code}\n                readOnly={true}\n            />\n        </CardContent2>\n    );\n};\n\nconst JsonCodeContent: React.FC<CodeContentBaseProps> = ({code}) => {\n    return (\n        <CodeContent code={code} extension={json()}/>\n    );\n};\n\nconst PythonCodeContent: React.FC<CodeContentBaseProps> = ({code}) => {\n    return (\n        <CodeContent code={code} extension={python()}/>\n    );\n};\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nfunction selectObj(obj: any, keys: string[]): any {\n    const newObj: { [name: string]: any } = {};\n    for (let key of keys) {\n        if (key in obj) {\n            newObj[key] = obj[key];\n        }\n    }\n    return newObj;\n}\n\nfunction getDatasetPythonCode(serverConfig: ApiServerConfig,\n                              dataset: Dataset) {\n    return [\n        'from xcube.core.store import new_data_store',\n        '',\n        'store = new_data_store(',\n        '    \"s3\",',\n        '    root=\"datasets\",  # can also use \"pyramids\" here',\n        '    storage_options={',\n        '        \"anon\": True,',\n        '        \"client_kwargs\": {',\n        `            \"endpoint_url\": \"${serverConfig.url}/s3\"`,\n        '        }',\n        '    }',\n        ')',\n        `# list(store.get_data_ids())`,\n        `dataset = store.open_data(\"${dataset.id}.zarr\")`,\n    ].join(\"\\n\");\n}\n\n\nfunction getVariablePythonCode(serverConfig: ApiServerConfig,\n                               variable: Variable,\n                               time: Time | null) {\n    const name = variable.name;\n    const vmin = variable.colorBarMin;\n    const vmax = variable.colorBarMax;\n    const cmap = variable.colorBarName;\n    let timeSel = '';\n    if (time !== null) {\n        timeSel = `.sel(time=\"${utcTimeToIsoDateTimeString(time)}\", method=\"nearest\")`;\n    }\n    return [\n        `var = dataset.${name}${timeSel}`,\n        `var.plot.imshow(vmin=${vmin}, vmax=${vmax}, cmap=\"${cmap}\")`,\n    ].join(\"\\n\");\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\nimport {\n    infoCardElementViewModesSelector,\n    selectedDatasetSelector,\n    selectedPlaceInfoSelector, selectedServerSelector, selectedTimeSelector,\n    selectedVariableSelector,\n    visibleInfoCardElementsSelector\n} from '../selectors/controlSelectors';\n\nimport { AppState } from '../states/appState';\nimport {\n    setVisibleInfoCardElements,\n    showInfoCard,\n    updateInfoCardElementViewMode,\n} from '../actions/controlActions';\nimport InfoCard from '../components/InfoCard';\nimport { Config } from \"../config\";\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        infoCardOpen: state.controlState.infoCardOpen,\n        visibleInfoCardElements: visibleInfoCardElementsSelector(state),\n        infoCardElementViewModes: infoCardElementViewModesSelector(state),\n        selectedDataset: selectedDatasetSelector(state),\n        selectedVariable: selectedVariableSelector(state),\n        selectedPlaceInfo: selectedPlaceInfoSelector(state),\n        selectedTime: selectedTimeSelector(state),\n        serverConfig: selectedServerSelector(state),\n        allowViewModePython: Config.instance.branding.allowViewModePython,\n    }\n};\n\nconst mapDispatchToProps = {\n    showInfoCard,\n    setVisibleInfoCardElements,\n    updateInfoCardElementViewMode,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(InfoCard);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react'\nimport { Theme } from \"@mui/material/styles\";\n\n\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        hor: {\n            flex: \"none\",\n            border: \"none\",\n            outline: \"none\",\n            width: \"8px\",\n            minHeight: \"100%\",\n            maxHeight: \"100%\",\n            cursor: \"col-resize\",\n\n            backgroundColor: theme.palette.mode === \"dark\" ? \"white\" : \"black\",\n            opacity: 0.0,\n        },\n        ver: {\n            flex: \"none\",\n            border: \"none\",\n            outline: \"none\",\n            height: \"8px\",\n            minWidth: \"100%\",\n            maxWidth: \"100%\",\n            cursor: \"row-resize\",\n\n            backgroundColor: theme.palette.mode === \"dark\" ? \"white\" : \"black\",\n            opacity: 0.0,\n        }\n    });\n\nexport type SplitDir = 'hor' | 'ver';\n\ninterface ISplitterProps extends WithStyles<typeof styles> {\n    dir?: SplitDir;\n    onChange: (delta: number) => any;\n}\n\ninterface IButtonEvent {\n    button: number;\n    buttons: number;\n}\n\ninterface IScreenEvent {\n    screenX: number;\n    screenY: number;\n}\n\ntype EventListenerItem = [string, (e: any) => any];\n\n\n/**\n * A splitter component.\n * In order to work properly, clients must provide the onChange which is a callback that receives the delta position\n * either in x-direction if direction is \"hor\" or y-direction if direction is \"ver\". The callback must then\n * adjust either a container's width if direction is \"hor\" or its height if direction is \"ver\".\n */\nclass Splitter extends React.PureComponent<ISplitterProps, any> {\n    private lastPosition: null | number = null;\n    private bodyEventListeners: Array<EventListenerItem>;\n\n    constructor(props: ISplitterProps) {\n        super(props);\n        if (!props.onChange) {\n            throw Error('onChange property must be provided');\n        }\n        this.onMouseDown = this.onMouseDown.bind(this);\n        this.bodyEventListeners = [\n            ['mousemove', this.onBodyMouseMove.bind(this)],\n            ['mouseup', this.onBodyMouseUp.bind(this)],\n            ['onmouseenter', this.onBodyMouseEnter.bind(this)],\n            ['onmouseleave', this.onBodyMouseLeave.bind(this)],\n        ];\n    }\n\n    componentWillUnmount() {\n        this.removeBodyMouseListeners();\n    }\n\n    render() {\n        return (\n            <div\n                className={this.props.dir === 'hor' ? this.props.classes.hor : this.props.classes.ver}\n                onMouseDown={this.onMouseDown}\n            />\n        );\n    }\n\n    private onMouseDown(event: React.MouseEvent<HTMLDivElement>) {\n        if (this.isButton1Pressed(event)) {\n            this.lastPosition = this.getCurrentPosition(event);\n            this.removeBodyMouseListeners();\n            this.addBodyMouseListeners();\n        } else {\n            this.lastPosition = null;\n        }\n    }\n\n    private onBodyMouseMove(event: MouseEvent) {\n        if (this.lastPosition === null || !this.isButton1Pressed(event)) {\n            return;\n        }\n        const currentPosition = this.getCurrentPosition(event);\n        const positionDelta = currentPosition - this.lastPosition;\n        this.lastPosition = currentPosition;\n        if (positionDelta !== 0) {\n            this.props.onChange(positionDelta);\n        }\n    }\n\n    //noinspection JSUnusedLocalSymbols\n    private onBodyMouseUp(event: MouseEvent) {\n        // console.log(\"onBodyMouseUp: \", event, this);\n        this.endDragging();\n    }\n\n    //noinspection JSUnusedLocalSymbols\n    private onBodyMouseEnter(event: MouseEvent) {\n        // console.log(\"onBodyMouseEnter: \", event, this);\n        this.endDragging();\n    }\n\n    //noinspection JSUnusedLocalSymbols\n    private onBodyMouseLeave(event: MouseEvent) {\n        // console.log(\"onBodyMouseLeave: \", event, this);\n        this.endDragging();\n    }\n\n    //noinspection JSMethodCanBeStatic\n    private isButton1Pressed(event: IButtonEvent) {\n        return event.button === 0 && event.buttons === 1;\n    }\n\n    private getCurrentPosition(event: IScreenEvent) {\n        return this.props.dir === 'hor' ? event.screenX:event.screenY;\n    }\n\n    private endDragging() {\n        this.removeBodyMouseListeners();\n        this.lastPosition = null;\n    }\n\n    private addBodyMouseListeners() {\n        this.bodyEventListeners.forEach((pair: EventListenerItem) =>\n            document.body.addEventListener(pair[0], pair[1]));\n    }\n\n    private removeBodyMouseListeners() {\n        this.bodyEventListeners.forEach((pair: EventListenerItem) =>\n            document.body.removeEventListener(pair[0], pair[1]));\n    }\n}\n\nexport default withStyles(styles)(Splitter);","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react'\nimport Splitter, { SplitDir } from './Splitter';\nimport { Theme } from \"@mui/material/styles\";\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport classNames from 'classnames';\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        hor: {\n            display: \"flex\",\n            flexFlow: \"row nowrap\",\n            flex: \"auto\",  // same as \"flex: 1 1 auto;\"\n        },\n        ver: {\n            // width: \"100%\",\n            height: \"100%\",\n            display: \"flex\",\n            flexFlow: \"column nowrap\",\n            flex: \"auto\",  // same as \"flex: 1 1 auto;\"\n        },\n        childHor: {\n            flex: \"none\",\n        },\n        childVer: {\n            flex: \"none\",\n        },\n    });\n\nexport interface ISplitPaneProps extends WithStyles<typeof styles> {\n    dir: SplitDir;\n    initialSize?: number;\n    onChange?: (newSize: number, oldSize: number) => void;\n    style?: React.CSSProperties;\n    child1Style?: React.CSSProperties;\n    child2Style?: React.CSSProperties;\n    className?: string;\n    child1ClassName?: string;\n    child2ClassName?: string;\n}\n\nexport interface ISplitPaneState {\n    size: number;\n}\n\n/**\n * A simple SplitPane component which must have exactly two child elements.\n *\n * Properties:\n * - dir: the split direction, either \"hor\" or \"ver\"\n * - initialSize: the initial width (\"hor\") or height (\"ver\") of the first child's container\n */\nclass SplitPane extends React.PureComponent<ISplitPaneProps, ISplitPaneState> {\n\n    constructor(props: ISplitPaneProps) {\n        super(props);\n        this.handleSplitDelta = this.handleSplitDelta.bind(this);\n        this.state = {size: props.initialSize || 50};\n    }\n\n    private handleSplitDelta(delta: number) {\n        this.setState((state: ISplitPaneState) => {\n            const oldSize = state.size;\n            const newSize = oldSize + delta;\n            if (this.props.onChange) {\n                this.props.onChange(newSize, oldSize);\n            }\n            return {size: newSize};\n        });\n    }\n\n    render() {\n        const children = this.props.children;\n        if (!children || !Array.isArray(children)) {\n            return children;\n        }\n        if (children.length === 1) {\n            return children[0];\n        }\n        if (children.length > 2) {\n            throw new Error(\"SplitPane expects not more than two children\");\n        }\n        let className;\n        let childClassName;\n        let child1Style;\n        let child2Style;\n        if (this.props.dir === 'hor') {\n            const width1 = this.state.size;\n            className = this.props.classes.hor;\n            childClassName = this.props.classes.childVer;\n            child1Style = {width: width1, ...this.props.child1Style};\n            child2Style = this.props.child2Style;\n        } else {\n            const height1 = this.state.size;\n            className = this.props.classes.ver;\n            childClassName = this.props.classes.childVer;\n            child1Style = {height: height1, ...this.props.child1Style};\n            child2Style = this.props.child2Style;\n        }\n        return (\n            <div\n                    id='SplitPane'\n                    className={classNames(className, this.props.className)}\n                    style={this.props.style}\n            >\n                <div\n                        id='SplitPane-Child-1'\n                        className={classNames(childClassName, this.props.child1ClassName)}\n                        style={child1Style}\n                >\n                    {children[0]}\n                </div>\n                <Splitter\n                        dir={this.props.dir}\n                        onChange={this.handleSplitDelta}\n                />\n                <div\n                        id='SplitPane-Child-2'\n                        className={classNames(childClassName, this.props.child2ClassName)}\n                        style={child2Style}\n                >\n                    {children[1]}\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default withStyles(styles)(SplitPane);","// noinspection JSUnusedLocalSymbols\n\n/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { Theme } from '@mui/material';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport { default as OlMap } from 'ol/Map';\n\nimport { AppState } from '../states/appState';\nimport Viewer from './Viewer';\nimport TimeSeriesCharts from './TimeSeriesCharts';\nimport InfoCard from './InfoCard';\nimport SplitPane from \"../components/SplitPane\";\n\n\n// Adjust for debugging split pane style\nconst mapExtraStyle: React.CSSProperties = {padding: 0};\n\nconst styles = (theme: Theme) => createStyles(\n    {\n\n        splitPaneHor: {\n            flexGrow: 1,\n            overflow: \"hidden\",\n        },\n        splitPaneVer: {\n            flexGrow: 1,\n            overflowX: \"hidden\",\n            overflowY: \"auto\"\n        },\n\n        mapPaneHor: {\n            height: \"100%\",\n            overflow: \"hidden\",\n            ...mapExtraStyle\n        },\n        mapPaneVer: {\n            width: \"100%\",\n            overflow: \"hidden\",\n            ...mapExtraStyle\n        },\n\n        detailsPaneHor: {\n            flex: \"auto\",\n            overflowX: \"hidden\",\n            overflowY: \"auto\",\n        },\n        detailsPaneVer: {\n            width: '100%',\n            overflow: \"hidden\",\n        },\n\n        viewerContainer: {\n            overflow: 'hidden',\n            width: '100%',\n            height: '100%',\n        },\n    });\n\ninterface WorkspaceProps extends WithStyles<typeof styles> {\n    hasInfoCard: boolean;\n    hasTimeseries: boolean;\n}\n\n// noinspection JSUnusedLocalSymbols\nconst mapStateToProps = (state: AppState) => {\n    return {\n        hasInfoCard: state.controlState.infoCardOpen\n            && state.controlState.selectedDatasetId !== null\n            && state.dataState.datasets.length > 0,\n        hasTimeseries: state.dataState.timeSeriesGroups.length > 0,\n    };\n};\n\nconst mapDispatchToProps = {};\n\n\ntype Layout = \"hor\" | \"ver\";\nconst getLayout = (): Layout => {\n    return window.innerWidth / window.innerHeight >= 1 ? \"hor\":\"ver\";\n};\n\nconst Workspace: React.FC<WorkspaceProps> = ({\n                                                 classes,\n                                                 hasInfoCard,\n                                                 hasTimeseries,\n                                             }) => {\n    const [map, setMap] = React.useState<OlMap | null>(null);\n    const [layout, setLayout] = React.useState<Layout>(getLayout());\n\n    React.useEffect(() => {\n        updateLayout();\n        window.onresize = updateLayout;\n    }, []);\n\n    const updateLayout = () => {\n        setLayout(getLayout());\n    };\n\n    function handleResize(size: number) {\n        if (map) {\n            map.updateSize();\n        }\n    }\n\n    if (hasInfoCard || hasTimeseries) {\n        const splitPaneClassName = layout === \"hor\" ? classes.splitPaneHor:classes.splitPaneVer;\n        const mapPaneClassName = layout === \"hor\" ? classes.mapPaneHor:classes.mapPaneVer;\n        const detailsPaneClassName = layout === \"hor\" ? classes.detailsPaneHor:classes.detailsPaneVer;\n        return (\n            <SplitPane\n                dir={layout}\n                initialSize={Math.max(window.innerWidth, window.innerHeight) / 2}\n                onChange={handleResize}\n                className={splitPaneClassName}\n                child1ClassName={mapPaneClassName}\n                child2ClassName={detailsPaneClassName}\n            >\n                <Viewer onMapRef={setMap}/>\n                <div>\n                    <InfoCard/>\n                    <TimeSeriesCharts/>\n                </div>\n            </SplitPane>\n        );\n    } else {\n        return (\n            <div className={classes.viewerContainer}>\n                <Viewer onMapRef={setMap}/>\n            </div>\n        );\n    }\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(Workspace));","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { Theme, Toolbar } from '@mui/material';\n\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\n\nimport { AppState } from '../states/appState';\nimport ControlBar from './ControlBar';\nimport Workspace from './Workspace';\nimport { Config } from \"../config\";\n\n\ninterface AppPaneProps extends WithStyles<typeof styles> {\n    hasConsent: boolean;\n    compact: boolean;\n}\n\n// noinspection JSUnusedLocalSymbols\nconst mapStateToProps = (state: AppState) => {\n    return {\n        locale: state.controlState.locale,\n        hasConsent: state.controlState.privacyNoticeAccepted,\n        compact: Config.instance.branding.compact\n    };\n};\n\nconst mapDispatchToProps = {};\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        main: {\n            padding: 0,\n            width: '100vw',\n            height: '100vh',\n            overflow: 'hidden',\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'stretch',\n            [theme.breakpoints.up('md')]: {\n                overflow: 'hidden',\n            },\n        },\n    });\n\nconst AppPane: React.FC<AppPaneProps> = ({classes, hasConsent, compact}) => {\n    // <Toolbar/>: Empty toolbar is a spacer, see docs https://material-ui.com/components/app-bar/\n    return (\n        <main className={classes.main}>\n            {!compact && <Toolbar variant=\"dense\"/>}\n            {\n                hasConsent && (\n                    <>\n                        <ControlBar/>\n                        <Workspace/>\n                    </>\n                )\n            }\n        </main>\n    );\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(styles)(AppPane));","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport Markdown from 'react-markdown';\nimport Button from '@mui/material/Button';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogContentText from '@mui/material/DialogContentText';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport makeStyles from '@mui/styles/makeStyles';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport CheckIcon from '@mui/icons-material/Check';\n\nimport i18n from '../i18n';\nimport { ControlState } from '../states/controlState';\n\n\nconst useStyles = makeStyles(theme => ({\n        icon: {\n            marginRight: theme.spacing(2),\n        },\n    }\n));\n\ninterface LegalAgreementDialogProps {\n    open: boolean;\n    settings: ControlState;\n    updateSettings: (settings: ControlState) => void;\n    syncWithServer: () => void;\n}\n\nexport default function LegalAgreementDialog(\n    {\n        open,\n        settings,\n        updateSettings,\n        syncWithServer\n    }: LegalAgreementDialogProps) {\n    const [markdownText, setMarkdownText] = useState<string | null>(null);\n\n    useEffect(() => {\n        const href = i18n.get(\"legal/privacy-note.en.md\")\n        // fetch(window.location.href + href)\n        fetch(href)\n            .then(response => response.text())\n            .then(text => setMarkdownText(text));\n    });\n\n    const classes = useStyles();\n\n    if (!open) {\n        return null;\n    }\n\n    function handleConfirm() {\n        updateSettings({...settings, privacyNoticeAccepted: true});\n        syncWithServer();\n    }\n\n    function handleLeave() {\n        try {\n            if (window.history.length > 0) {\n                window.history.back();\n            } else if (typeof (window as any).home === 'function') {\n                (window as any).home();\n            } else {\n                window.location.href = 'about:home';\n            }\n        } catch (e) {\n            console.error(e);\n        }\n    }\n\n    return (\n        <Dialog\n            open={open}\n            disableEscapeKeyDown={true}\n            keepMounted={true}\n            scroll='body'\n        >\n            <DialogTitle>{i18n.get(\"Privacy Notice\")}</DialogTitle>\n            <DialogContent>\n                <DialogContentText>\n                    {\n                        markdownText === null\n                            ? <CircularProgress/>\n                            :<Markdown children={markdownText} linkTarget=\"_blank\"/>\n                    }\n                </DialogContentText>\n            </DialogContent>\n\n            <DialogActions>\n                <Button onClick={handleConfirm} color=\"primary\">\n                    <CheckIcon className={classes.icon}/>\n                    {i18n.get('Accept and continue')}\n                </Button>\n                <Button onClick={handleLeave}>\n                    {i18n.get('Leave')}\n                </Button>\n            </DialogActions>\n\n        </Dialog>\n    );\n}\n\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport LegalAgreementDialog from '../components/LegalAgreementDialog';\nimport { updateSettings } from '../actions/controlActions';\nimport { syncWithServer } from '../actions/dataActions';\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        open: !state.controlState.privacyNoticeAccepted,\n        settings: state.controlState,\n    };\n};\n\nconst mapDispatchToProps = {\n    updateSettings,\n    syncWithServer\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(LegalAgreementDialog);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport CircularProgress from '@mui/material/CircularProgress';\nimport Dialog from '@mui/material/Dialog';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Typography from '@mui/material/Typography';\nimport * as React from 'react';\nimport i18n from '../i18n';\n\nimport { WithLocale } from '../util/lang';\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        progress: {\n            margin: theme.spacing(2),\n        },\n        message: {\n            margin: theme.spacing(1),\n        },\n        contentContainer: {\n            margin: theme.spacing(1),\n            textAlign: 'center',\n            display: 'flex',\n            alignItems: 'center',\n            flexDirection: 'column',\n        },\n    });\n\ninterface LoadingDialogProps extends WithStyles<typeof styles>, WithLocale {\n    messages: string[];\n}\n\nconst LoadingDialog: React.FC<LoadingDialogProps> = ({classes, messages}) => {\n\n    if (messages.length === 0) {\n        return null;\n    }\n\n    return (\n        <Dialog open={true} aria-labelledby=\"loading\">\n            <DialogTitle id=\"loading\">{i18n.get('Please wait...')}</DialogTitle>\n            <div className={classes.contentContainer}>\n                <CircularProgress className={classes.progress}/>\n                {messages.map((message, i) => (\n                    <Typography component=\"div\" key={i}\n                                className={classes.message}>{message}</Typography>\n                ))}\n            </div>\n        </Dialog>\n    );\n};\n\nexport default withStyles(styles)(LoadingDialog);\n\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport { AppState } from '../states/appState';\r\nimport LoadingDialog from \"../components/LoadingDialog\";\r\nimport { activityMessagesSelector } from \"../selectors/controlSelectors\";\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        locale: state.controlState.locale,\r\n        messages: activityMessagesSelector(state),\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(LoadingDialog);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport { Theme } from '@mui/material/styles';\nimport { WithStyles } from '@mui/styles';\nimport createStyles from '@mui/styles/createStyles';\nimport withStyles from '@mui/styles/withStyles';\nimport Snackbar from '@mui/material/Snackbar';\nimport { SnackbarOrigin } from '@mui/material/Snackbar/Snackbar';\nimport SnackbarContent from '@mui/material/SnackbarContent';\nimport IconButton from '@mui/material/IconButton';\nimport CloseIcon from '@mui/icons-material/Close';\nimport ErrorIcon from '@mui/icons-material/Error';\nimport WarningIcon from '@mui/icons-material/Warning';\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\nimport InfoIcon from '@mui/icons-material/Info';\n\nimport { MessageLogEntry } from '../states/messageLogState';\n\n\nimport { green, amber } from '@mui/material/colors';\n\n\nconst variantIcon = {\n    success: CheckCircleIcon,\n    warning: WarningIcon,\n    error: ErrorIcon,\n    info: InfoIcon,\n};\n\n\nconst styles = (theme: Theme) => createStyles(\n    {\n        close: {\n            padding: theme.spacing(0.5),\n        },\n        success: {\n            color: theme.palette.error.contrastText,\n            backgroundColor: green[600],\n        },\n        error: {\n            color: theme.palette.error.contrastText,\n            backgroundColor: theme.palette.error.dark,\n        },\n        info: {\n            color: theme.palette.error.contrastText,\n            backgroundColor: theme.palette.primary.dark,\n        },\n        warning: {\n            color: theme.palette.error.contrastText,\n            backgroundColor: amber[700],\n        },\n        icon: {\n            fontSize: 20,\n        },\n        iconVariant: {\n            opacity: 0.9,\n            marginRight: theme.spacing(1),\n        },\n        message: {\n            display: 'flex',\n            alignItems: 'center',\n        },\n    });\n\ninterface MessageLogProps extends WithStyles<typeof styles> {\n    message: MessageLogEntry | null;\n    hideMessage: (messageId: number) => void;\n    className?: string;\n}\n\nconst SNACKBAR_ANCHOR_ORIGIN: SnackbarOrigin = {\n    vertical: 'bottom',\n    horizontal: 'center',\n};\n\n\nconst MessageLog: React.FC<MessageLogProps> = ({classes, className, message, hideMessage}) => {\n\n    const handleClose = () => {\n        hideMessage(message!.id);\n    };\n\n    if (!message) {\n        return null;\n    }\n\n    const MessageIcon = variantIcon[message.type];\n\n    return (\n        <Snackbar\n            key={message.type + ':' + message.text}\n            open={true}\n            anchorOrigin={SNACKBAR_ANCHOR_ORIGIN}\n            autoHideDuration={5000}\n            onClose={handleClose}>\n            <SnackbarContent\n                className={classNames(classes[message.type], className)}\n                aria-describedby=\"client-snackbar\"\n                message={\n                    <span id=\"client-snackbar\" className={classes.message}>\n                            <MessageIcon className={classNames(classes.icon, classes.iconVariant)}/>\n                        {message.text}\n                        </span>\n                }\n                action={[\n                    <IconButton\n                        key=\"close\"\n                        aria-label=\"Close\"\n                        color=\"inherit\"\n                        className={classes.close}\n                        onClick={handleClose}\n                        size=\"large\">\n                        <CloseIcon className={classes.icon}/>\n                    </IconButton>,\n                ]}\n            />\n        </Snackbar>\n    );\n};\n\nexport default withStyles(styles)(MessageLog);","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport { AppState } from '../states/appState';\r\nimport MessageLog from '../components/MessageLog';\r\nimport { hideMessage } from '../actions/messageLogActions';\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    let newEntries = state.messageLogState.newEntries;\r\n    return {\r\n        locale: state.controlState.locale,\r\n        message: newEntries.length > 0 ? newEntries[0] : null,\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    hideMessage,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(MessageLog);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from \"react\";\nimport { AuthProvider } from \"react-oidc-context\";\nimport { User } from \"oidc-client-ts\";\nimport { Config } from '../config';\nimport ErrorBoundary from \"./ErrorBoundary\";\n\n\ninterface AuthWrapperProps {\n}\n\nconst AuthWrapper: React.FC<React.PropsWithChildren<AuthWrapperProps>> = ({children}) => {\n    const authClient = Config.instance.authClient;\n    if (!authClient) {\n        return <>{children}</>;\n    }\n\n    const handleSigninCallback = (_user: User | void): void => {\n        console.info(\"handleSigninCallback:\", _user);\n        window.history.replaceState(\n                {},\n                document.title,\n                window.location.pathname\n        )\n    }\n\n    const handleRemoveUser = (): void => {\n        console.info(\"handleRemoveUser\");\n        // go home after logout\n        window.location.pathname = \"/\";\n    }\n\n    // TODO (forman): check whether we can (should?) use\n    //   baseUrl.href (from util/baseurl.ts) here\n    // const redirectUri = baseUrl.href;\n    const redirectUri = window.location.origin;\n\n    return (\n            <ErrorBoundary>\n                <AuthProvider\n                        {...authClient}\n                        loadUserInfo={true}\n                        scope=\"openid email profile\"\n                        automaticSilentRenew={true}\n                        redirect_uri={redirectUri}\n                        post_logout_redirect_uri={redirectUri}\n                        popup_post_logout_redirect_uri={redirectUri}\n                        onSigninCallback={handleSigninCallback}\n                        onRemoveUser={handleRemoveUser}\n                >\n                    {children}\n                </AuthProvider>\n            </ErrorBoundary>\n    );\n}\n\nexport default AuthWrapper;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { Theme } from '@mui/material';\nimport { WithStyles } from '@mui/styles';\nimport Button from '@mui/material/Button';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport FormControl from '@mui/material/FormControl';\nimport FormHelperText from '@mui/material/FormHelperText';\nimport IconButton from '@mui/material/IconButton';\nimport InputLabel from '@mui/material/InputLabel/InputLabel';\nimport MenuItem from '@mui/material/MenuItem';\nimport Select from '@mui/material/Select';\nimport withStyles from '@mui/styles/withStyles';\nimport createStyles from '@mui/styles/createStyles';\nimport TextField from '@mui/material/TextField';\nimport AddIcon from '@mui/icons-material/Add';\nimport DeleteIcon from '@mui/icons-material/Delete';\nimport EditIcon from '@mui/icons-material/Edit';\nimport * as React from 'react';\nimport { useEffect, useRef, useState } from 'react';\nimport i18n from '../i18n';\nimport { ApiServerConfig } from '../model/apiServer';\nimport { newId } from '../util/id';\n\nimport { WithLocale } from '../util/lang';\n\n\n// noinspection JSUnusedLocalSymbols\nconst styles = (theme: Theme) => createStyles(\n    {\n        formControl: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            width: 200,\n        },\n        textField: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            width: 200,\n        },\n        textField2: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            width: 400,\n        },\n        button: {\n            margin: 0.1 * theme.spacing(1),\n        },\n    });\n\n\ninterface ServerDialogProps extends WithStyles<typeof styles>, WithLocale {\n    open: boolean;\n    servers: ApiServerConfig[];\n    selectedServer: ApiServerConfig;\n    configureServers: (servers: ApiServerConfig[], selectedServerId: string) => void;\n    closeDialog: (dialogId: string) => void;\n}\n\nconst ServerDialog: React.FC<ServerDialogProps> = ({classes, open, servers, selectedServer, closeDialog, configureServers}) => {\n    const ref = useRef(false);\n    const [servers_, setServers_] = useState(servers);\n    const [selectedServer_, setSelectedServer_] = useState(selectedServer);\n    const [dialogMode, setDialogMode] = useState('select');\n\n    useEffect(() => {\n        if (ref.current) {\n            setServers_(servers);\n            setSelectedServer_(selectedServer);\n        }\n        ref.current = true;\n    }, [servers, selectedServer]);\n\n    const handleConfirm = () => {\n        if (dialogMode === 'select') {\n            closeDialog('server');\n            configureServers(servers_, selectedServer_.id);\n        } else if (dialogMode === 'add') {\n            doAddServer();\n        } else if (dialogMode === 'edit') {\n            doEditServer();\n        }\n    };\n\n    const handleCancel = () => {\n        if (dialogMode === 'select') {\n            doClose();\n        } else {\n            cancelAddOrEditMode();\n        }\n    };\n\n    const handleClose = () => {\n        doClose();\n    };\n\n    const handleSelectServer = (event: React.ChangeEvent<{ name?: string; value: any; }>) => {\n        const selectedServerId = event.target.value;\n        const selectedServer = servers_.find(server => server.id === selectedServerId)!;\n        setSelectedServer_(selectedServer);\n    };\n\n    const handleServerNameChange = (event: any) => {\n        const selectedServerName = event.target.value;\n        const selectedServer = {...selectedServer_, name: selectedServerName};\n        setSelectedServer_(selectedServer);\n    };\n\n    const handleServerURLChange = (event: any) => {\n        const selectedServerURL = event.target.value;\n        const selectedServer = {...selectedServer_, url: selectedServerURL};\n        setSelectedServer_(selectedServer);\n    };\n\n    const handleAddMode = () => {\n        setDialogMode('add');\n    };\n\n    const handleEditMode = () => {\n        setDialogMode('edit');\n    };\n\n    const handleRemoveServer = () => {\n        doRemoveServer();\n    };\n\n    const doClose = () => {\n        closeDialog('server');\n    };\n\n    const getSelectedServerIndex = (): number => {\n        const selectedServerId = selectedServer_.id;\n        return servers_.findIndex(server => server.id === selectedServerId)!;\n    };\n\n    const setSelectedServer = (selectedServerIndex: number, selectedServer: ApiServerConfig) => {\n        const servers = [...servers_];\n        servers[selectedServerIndex] = selectedServer;\n        setServers_(servers);\n        setSelectedServer_(selectedServer);\n        setDialogMode('select');\n    };\n\n    const setServers = (servers: ApiServerConfig[], selectedServer: ApiServerConfig) => {\n        setServers_(servers);\n        setSelectedServer_(selectedServer);\n        setDialogMode('select');\n    };\n\n    const doAddServer = () => {\n        const selectedServer = {...selectedServer_, id: newId()};\n        const servers = [...servers_, selectedServer];\n        setServers(servers, selectedServer);\n    };\n\n    const doEditServer = () => {\n        setSelectedServer(getSelectedServerIndex(), {...selectedServer_});\n    };\n\n    const cancelAddOrEditMode = () => {\n        const selectedServerIndex = getSelectedServerIndex();\n        setSelectedServer(getSelectedServerIndex(), servers_[selectedServerIndex]);\n    };\n\n    const doRemoveServer = () => {\n        const servers = [...servers_];\n        if (servers.length < 2) {\n            throw new Error('internal error: server list cannot be emptied');\n        }\n        const selectedServerIndex = getSelectedServerIndex();\n        const selectedServer = servers[selectedServerIndex + (selectedServerIndex > 0 ? -1 : 1)];\n        servers.splice(selectedServerIndex, 1);\n        setServers(servers, selectedServer);\n    };\n\n    const menuItems = servers_.map((server, index) => (\n        <MenuItem key={index} value={server.id}>{server.name}</MenuItem>\n    ));\n\n    let okButtonName;\n    if (dialogMode === 'add') {\n        okButtonName = i18n.get('Add');\n    } else if (dialogMode === 'edit') {\n        okButtonName = i18n.get('Save');\n    } else {\n        okButtonName = i18n.get('OK');\n    }\n\n    let dialogTitle;\n    if (dialogMode === 'add') {\n        dialogTitle = i18n.get('Add Server');\n    } else if (dialogMode === 'edit') {\n        dialogTitle = i18n.get('Edit Server');\n    } else {\n        dialogTitle = i18n.get('Select Server');\n    }\n\n    let dialogContent;\n    if (dialogMode === 'add' || dialogMode === 'edit') {\n        dialogContent = (\n            <DialogContent dividers>\n                <TextField\n                    variant=\"standard\"\n                    required\n                    id=\"server-name\"\n                    label=\"Name\"\n                    className={classes.textField}\n                    margin=\"normal\"\n                    value={selectedServer_.name}\n                    onChange={handleServerNameChange} />\n                <br/>\n                <TextField\n                    variant=\"standard\"\n                    required\n                    id=\"server-url\"\n                    label=\"URL\"\n                    className={classes.textField2}\n                    margin=\"normal\"\n                    value={selectedServer_.url}\n                    onChange={handleServerURLChange} />\n            </DialogContent>\n        );\n    } else {\n        dialogContent = (\n            <DialogContent dividers>\n                <div>\n                    <FormControl variant=\"standard\" className={classes.formControl}>\n                        <InputLabel htmlFor=\"server-name\">Name</InputLabel>\n                        <Select\n                            variant=\"standard\"\n                            value={selectedServer_.id}\n                            onChange={handleSelectServer}\n                            inputProps={{\n                                name: 'server-name',\n                                id: 'server-name',\n                            }}>\n                            {menuItems}\n                        </Select>\n                        <FormHelperText>{selectedServer_.url}</FormHelperText>\n                    </FormControl>\n                    <IconButton\n                        className={classes.button}\n                        aria-label=\"Add\"\n                        color=\"primary\"\n                        onClick={handleAddMode}\n                        size=\"large\">\n                        <AddIcon fontSize=\"small\"/>\n                    </IconButton>\n                    <IconButton\n                        className={classes.button}\n                        aria-label=\"Edit\"\n                        onClick={handleEditMode}\n                        size=\"large\">\n                        <EditIcon fontSize=\"small\"/>\n                    </IconButton>\n                    <IconButton\n                        className={classes.button}\n                        aria-label=\"Delete\"\n                        disabled={servers_.length < 2}\n                        onClick={handleRemoveServer}\n                        size=\"large\">\n                        <DeleteIcon fontSize=\"small\"/>\n                    </IconButton>\n                </div>\n            </DialogContent>\n        );\n    }\n\n    return (\n        <Dialog\n            open={open}\n            onClose={handleClose}\n            aria-labelledby=\"server-dialog-title\"\n        >\n            <DialogTitle id=\"server-dialog-title\">{dialogTitle}</DialogTitle>\n            {dialogContent}\n            <DialogActions>\n                <Button onClick={handleCancel}>{i18n.get('Cancel')}</Button>\n                <Button onClick={handleConfirm} autoFocus color=\"primary\">{okButtonName}</Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n\nexport default withStyles(styles)(ServerDialog);\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport { AppState } from '../states/appState';\r\nimport ServerDialog from '../components/ServerDialog';\r\nimport { closeDialog } from \"../actions/controlActions\";\r\nimport { configureServers } from \"../actions/dataActions\";\r\nimport { selectedServerSelector } from \"../selectors/controlSelectors\";\r\nimport { userServersSelector } from \"../selectors/dataSelectors\";\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        open: !!state.controlState.dialogOpen[\"server\"],\r\n        servers: userServersSelector(state),\r\n        selectedServer: selectedServerSelector(state),\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    closeDialog,\r\n    configureServers,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ServerDialog);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport Typography from '@mui/material/Typography';\nimport { darken, lighten } from '@mui/material/styles';\nimport makeStyles from '@mui/styles/makeStyles';\nimport Divider from '@mui/material/Divider';\nimport List from '@mui/material/List';\nimport Paper from '@mui/material/Paper';\nimport Box from '@mui/material/Box';\n\n\nconst useStyles = makeStyles(theme => ({\n        settingsPanelTitle: {\n            marginBottom: theme.spacing(1),\n        },\n        settingsPanelPaper: {\n            backgroundColor: (theme.palette.mode === 'dark' ? lighten : darken)(theme.palette.background.paper, 0.1),\n            marginBottom: theme.spacing(2),\n        },\n        settingsPanelList: {\n            margin: 0,\n        },\n    }\n));\n\ninterface SettingsPanelProps {\n    title?: string;\n}\n\nexport const SettingsPanel: React.FC<SettingsPanelProps> = (\n    {\n        title,\n        children\n    }\n) => {\n    const classes = useStyles();\n\n    const childCount = React.Children.count(children);\n\n    const listItems: React.ReactNode[] = [];\n    React.Children.forEach(children, (child: React.ReactNode, index: number) => {\n        listItems.push(child);\n        if (index < childCount - 1) {\n            listItems.push(<Divider key={childCount + index} variant=\"fullWidth\" component=\"li\"/>);\n        }\n    });\n\n    return (\n        <Box>\n            {title && title !== '' && (\n                <Typography variant='body1' className={classes.settingsPanelTitle}>\n                    {title}\n                </Typography>\n            )}\n            <Paper elevation={4} className={classes.settingsPanelPaper}>\n                <List component=\"nav\" dense={true} className={classes.settingsPanelList}>\n                    {listItems}\n                </List>\n            </Paper>\n        </Box>\n    );\n};\n\nexport default SettingsPanel;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport ListItemText from '@mui/material/ListItemText';\nimport ListItem from '@mui/material/ListItem';\nimport ListItemSecondaryAction from '@mui/material/ListItemSecondaryAction';\n\n\ninterface SettingsSubPanelProps {\n    label: string;\n    value?: string | number;\n    onClick?: (event: any) => void;\n}\n\nconst SettingsSubPanel: React.FC<SettingsSubPanelProps> = (\n    {\n        label,\n        value,\n        onClick,\n        children,\n    }\n) => {\n\n    let listItemStyle;\n    if (!value) {\n        listItemStyle = {marginBottom: 10};\n    }\n\n    const listItemText = (<ListItemText primary={label} secondary={value}/>);\n\n    let listItemSecondaryAction;\n    if (children) {\n        listItemSecondaryAction = (\n            <ListItemSecondaryAction>\n                {children}\n            </ListItemSecondaryAction>\n        );\n    }\n\n    if (!!onClick) {\n        return (\n            <ListItem style={listItemStyle} button onClick={onClick}>\n                {listItemText}\n                {listItemSecondaryAction}\n            </ListItem>\n        );\n    }\n\n    return (\n        <ListItem style={listItemStyle}>\n            {listItemText}\n            {listItemSecondaryAction}\n        </ListItem>\n    );\n};\n\nexport default SettingsSubPanel;","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport Switch from '@mui/material/Switch';\n\nimport { ControlState } from '../states/controlState';\n\n\ninterface ToggleSettingProps {\n    propertyName: keyof ControlState;\n    settings: ControlState;\n    updateSettings: (settings: ControlState) => void;\n    disabled?: boolean;\n}\n\nconst ToggleSetting: React.FC<ToggleSettingProps> = (\n    {\n        propertyName,\n        settings,\n        updateSettings,\n        disabled\n    }\n) => {\n    return (\n        <Switch\n            checked={!!settings[propertyName]}\n            onChange={() => updateSettings({...settings, [propertyName]: !settings[propertyName]})}\n            disabled={disabled}\n        />\n    );\n};\n\nexport default ToggleSetting;","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React from 'react';\nimport Radio from '@mui/material/Radio';\nimport RadioGroup from '@mui/material/RadioGroup';\n\nimport {ControlState} from '../states/controlState';\nimport {FormControlLabel} from \"@mui/material\";\n\n\ninterface RadioSettingProps {\n    propertyName: keyof ControlState;\n    settings: ControlState;\n    updateSettings: (settings: ControlState) => void;\n    options: Array<[string, string | number]>;\n    disabled?: boolean;\n}\n\nconst RadioSetting: React.FC<RadioSettingProps> = (\n    {\n        propertyName,\n        settings,\n        updateSettings,\n        options,\n        disabled,\n    }\n) => {\n    const handleChange = (event: React.ChangeEvent<HTMLInputElement>, value: string) => {\n        updateSettings({...settings, [propertyName]: value});\n    };\n    return (\n        <RadioGroup\n            row\n            value={settings[propertyName]}\n            onChange={handleChange}\n        >\n            {\n                options.map(([label, value]) => (\n                    <FormControlLabel\n                        key={label}\n                        control={<Radio/>}\n                        value={value}\n                        label={label}\n                        disabled={disabled}\n                    />\n                ))\n            }\n        </RadioGroup>\n    );\n};\n\nexport default RadioSetting;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport React, { ChangeEvent } from 'react';\nimport Dialog from '@mui/material/Dialog';\nimport DialogContent from '@mui/material/DialogContent';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport ListItemText from '@mui/material/ListItemText';\nimport ListSubheader from \"@mui/material/ListSubheader\";\nimport Menu from '@mui/material/Menu';\nimport MenuItem from '@mui/material/MenuItem';\nimport makeStyles from '@mui/styles/makeStyles';\nimport TextField from '@mui/material/TextField';\nimport Button from '@mui/material/Button';\n\nimport i18n from '../i18n';\nimport { ApiServerConfig, ApiServerInfo } from '../model/apiServer';\nimport { ControlState, TIME_ANIMATION_INTERVALS, TimeAnimationInterval } from '../states/controlState';\nimport { MapGroup, maps, MapSource } from '../util/maps';\nimport SettingsPanel from './SettingsPanel';\nimport SettingsSubPanel from './SettingsSubPanel';\nimport ToggleSetting from './ToggleSetting';\nimport RadioSetting from './RadioSetting';\nimport { GEOGRAPHIC_CRS, WEB_MERCATOR_CRS } from '../model/proj';\n\n\nconst useStyles = makeStyles(theme => ({\n        textField: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            fontSize: theme.typography.fontSize / 2\n        },\n        intTextField: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            fontSize: theme.typography.fontSize / 2,\n            width: theme.spacing(6),\n        },\n        localeAvatar: {\n            margin: 10,\n        }\n    }\n));\n\ninterface SettingsDialogProps {\n    open: boolean;\n    closeDialog: (dialogId: string) => void;\n\n    settings: ControlState;\n    selectedServer: ApiServerConfig;\n    viewerVersion: string;\n    updateSettings: (settings: Partial<ControlState>) => void;\n    changeLocale: (locale: string) => void;\n    openDialog: (dialogId: string) => void;\n    serverInfo: ApiServerInfo | null;\n}\n\n\nconst SettingsDialog: React.FC<SettingsDialogProps> = ({\n                                                           open,\n                                                           closeDialog,\n                                                           settings,\n                                                           selectedServer,\n                                                           updateSettings,\n                                                           changeLocale,\n                                                           openDialog,\n                                                           viewerVersion,\n                                                           serverInfo\n                                                       }) => {\n    const [languageMenuAnchor, setLanguageMenuAnchor] = React.useState(null);\n    const [baseMapMenuAnchor, setBaseMapMenuAnchor] = React.useState(null);\n    const [timeChunkSize, setTimeChunkSize] = React.useState(settings.timeChunkSize + '');\n    const classes = useStyles();\n\n    React.useEffect(() => {\n        const newTimeChunkSize = parseInt(timeChunkSize);\n        if (!Number.isNaN(newTimeChunkSize) && newTimeChunkSize !== settings.timeChunkSize) {\n            updateSettings({timeChunkSize: newTimeChunkSize});\n        }\n    }, [timeChunkSize, settings, updateSettings]);\n\n    if (!open) {\n        return null;\n    }\n\n    function handleCloseDialog() {\n        closeDialog('settings');\n    }\n\n    function handleOpenServerDialog() {\n        openDialog('server');\n    }\n\n    function handleTimeAnimationIntervalChange(event: ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) {\n        updateSettings({timeAnimationInterval: parseInt(event.target.value) as TimeAnimationInterval});\n    }\n\n    function handleTimeChunkSizeChange(event: ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) {\n        setTimeChunkSize(event.target.value);\n    }\n\n    let localeMenuItems = null;\n    if (Boolean(languageMenuAnchor)) {\n        localeMenuItems = Object.getOwnPropertyNames(i18n.languages).map(langLocale => {\n            const langName = i18n.languages[langLocale];\n            return (\n                <MenuItem\n                    key={langLocale}\n                    selected={langLocale === settings.locale}\n                    onClick={() => changeLocale(langLocale)}\n                >\n                    <ListItemText primary={langName}/>\n                </MenuItem>\n            );\n        });\n    }\n\n    function handleLanguageMenuOpen(event: any) {\n        setLanguageMenuAnchor(event.currentTarget);\n    }\n\n    function handleLanguageMenuClose() {\n        setLanguageMenuAnchor(null);\n    }\n\n    let baseMapMenuItems: null | React.ReactElement[] = null;\n    if (Boolean(baseMapMenuAnchor)) {\n        baseMapMenuItems = [];\n        maps.forEach((mapGroup: MapGroup, i: number) => {\n            baseMapMenuItems!.push(<ListSubheader key={i} disableSticky={true}>{mapGroup.name}</ListSubheader>);\n            mapGroup.datasets.forEach((mapSource: MapSource, j: number) => {\n                baseMapMenuItems!.push(\n                    <MenuItem\n                        key={i + '.' + j}\n                        selected={settings.baseMapUrl === mapSource.endpoint}\n                        onClick={() => updateSettings({baseMapUrl: mapSource.endpoint})}>\n                        <ListItemText primary={mapSource.name}/>\n                    </MenuItem>\n                );\n            });\n        });\n    }\n\n    function handleBaseMapMenuOpen(event: any) {\n        setBaseMapMenuAnchor(event.currentTarget);\n    }\n\n    function handleBaseMapMenuClose() {\n        setBaseMapMenuAnchor(null);\n    }\n\n    let baseMapLabel = settings.baseMapUrl;\n    maps.forEach((mapGroup: MapGroup) => {\n        mapGroup.datasets.forEach((mapSource: MapSource) => {\n            if (mapSource.endpoint === settings.baseMapUrl) {\n                baseMapLabel = `${mapGroup.name} / ${mapSource.name}`;\n            }\n        });\n    });\n\n    return (\n        <div>\n            <Dialog\n                open={open}\n                fullWidth\n                maxWidth={'sm'}\n                onClose={handleCloseDialog}\n                scroll=\"body\"\n            >\n                <DialogTitle>{i18n.get('Settings')}</DialogTitle>\n                <DialogContent>\n\n                    <SettingsPanel title={i18n.get('General')}>\n                        <SettingsSubPanel\n                            label={i18n.get('Server')}\n                            value={selectedServer.name}\n                            onClick={handleOpenServerDialog}>\n                        </SettingsSubPanel>\n                        <SettingsSubPanel\n                            label={i18n.get('Language')}\n                            value={i18n.languages[settings.locale]}\n                            onClick={handleLanguageMenuOpen}>\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Time interval of the player')}>\n                            <TextField\n                                variant=\"standard\"\n                                select\n                                className={classes.textField}\n                                value={settings.timeAnimationInterval}\n                                onChange={handleTimeAnimationIntervalChange}\n                                margin=\"normal\">\n                                {TIME_ANIMATION_INTERVALS.map((value, i) => (\n                                    <MenuItem key={i} value={value}>{value + ' ms'}</MenuItem>\n                                ))}\n                            </TextField>\n                        </SettingsSubPanel>\n                    </SettingsPanel>\n\n                    <SettingsPanel title={i18n.get('Time-Series')}>\n                        <SettingsSubPanel label={i18n.get('Show graph after adding a place')}\n                                          value={getOnOff(settings.autoShowTimeSeries)}>\n                            <ToggleSetting\n                                propertyName={'autoShowTimeSeries'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Show dots only, hide lines')}\n                                          value={getOnOff(settings.showTimeSeriesPointsOnly)}>\n                            <ToggleSetting\n                                propertyName={'showTimeSeriesPointsOnly'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Show error bars')}\n                                          value={getOnOff(settings.showTimeSeriesErrorBars)}>\n                            <ToggleSetting\n                                propertyName={'showTimeSeriesErrorBars'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Show median instead of mean (disables error bars)')}\n                                          value={getOnOff(settings.showTimeSeriesMedian)}>\n                            <ToggleSetting\n                                propertyName={'showTimeSeriesMedian'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Minimal number of data points in a time series update')}>\n                            <TextField\n                                variant=\"standard\"\n                                className={classes.intTextField}\n                                value={timeChunkSize}\n                                onChange={handleTimeChunkSizeChange}\n                                margin=\"normal\"\n                                size={'small'}/>\n                        </SettingsSubPanel>\n                    </SettingsPanel>\n\n                    <SettingsPanel title={i18n.get('Map')}>\n                        <SettingsSubPanel\n                            label={i18n.get('Base map')}\n                            value={baseMapLabel}\n                            onClick={handleBaseMapMenuOpen}>\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Projection')}>\n                            <RadioSetting\n                                propertyName={'mapProjection'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                                options={[\n                                    [i18n.get('Geographic'), GEOGRAPHIC_CRS],\n                                    [i18n.get('Mercator'), WEB_MERCATOR_CRS],\n                                ]}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Image smoothing')}\n                                          value={getOnOff(settings.imageSmoothingEnabled)}>\n                            <ToggleSetting\n                                propertyName={'imageSmoothingEnabled'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('Show dataset boundaries')}\n                                          value={getOnOff(settings.showDatasetBoundaries)}>\n                            <ToggleSetting\n                                propertyName={'showDatasetBoundaries'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                    </SettingsPanel>\n\n                    <SettingsPanel title={i18n.get(\"Legal Agreement\")}>\n                        <Button\n                            onClick={() => {\n                                updateSettings({privacyNoticeAccepted: false});\n                                window.location.reload();\n                            }}\n                        >\n                            {i18n.get(\"Revoke consent\")}\n                        </Button>\n                    </SettingsPanel>\n\n                    <SettingsPanel title={i18n.get('System Information')}>\n                        <SettingsSubPanel\n                            label={`xcube Viewer ${i18n.get('version')}`}\n                            value={viewerVersion}\n                        />\n                        <SettingsSubPanel\n                            label={`xcube Server ${i18n.get('version')}`}\n                            value={serverInfo ? serverInfo.version:i18n.get('Cannot reach server')}\n                        />\n                    </SettingsPanel>\n                </DialogContent>\n            </Dialog>\n\n            <Menu\n                anchorEl={languageMenuAnchor}\n                keepMounted\n                open={Boolean(languageMenuAnchor)}\n                onClose={handleLanguageMenuClose}\n            >\n                {localeMenuItems}\n            </Menu>\n\n            <Menu\n                anchorEl={baseMapMenuAnchor}\n                keepMounted\n                open={Boolean(baseMapMenuAnchor)}\n                onClose={handleBaseMapMenuClose}\n            >\n                {baseMapMenuItems}\n            </Menu>\n\n        </div>\n    );\n};\n\nexport default SettingsDialog;\n\nconst getOnOff = (state: boolean): string => {\n    return state ? i18n.get('On'):i18n.get('Off');\n};\n\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\nimport { changeLocale, closeDialog, openDialog, updateSettings } from '../actions/controlActions';\r\nimport SettingsDialog from '../components/SettingsDialog';\r\nimport { selectedServerSelector } from \"../selectors/controlSelectors\";\r\n\r\nimport { AppState } from '../states/appState';\r\nimport version from '../version';\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        locale: state.controlState.locale,\r\n        open: state.controlState.dialogOpen['settings'],\r\n        settings: state.controlState,\r\n        selectedServer: selectedServerSelector(state),\r\n        viewerVersion: version,\r\n        serverInfo: state.dataState.serverInfo,\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    closeDialog,\r\n    updateSettings,\r\n    changeLocale,\r\n    openDialog,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(SettingsDialog);\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nconst version = '0.13.0-dev.2';\r\n\r\nexport default version;\r\n\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Button from '@mui/material/Button';\nimport Dialog from '@mui/material/Dialog';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport makeStyles from '@mui/styles/makeStyles';\nimport TextField from '@mui/material/TextField';\nimport React, { ChangeEvent } from 'react';\nimport i18n from '../i18n';\nimport { ControlState } from '../states/controlState';\nimport SettingsPanel from './SettingsPanel';\nimport SettingsSubPanel from './SettingsSubPanel';\nimport ToggleSetting from './ToggleSetting';\n\nconst useStyles = makeStyles(theme => ({\n        separatorTextField: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            fontSize: theme.typography.fontSize / 2,\n            maxWidth: '6em',\n        },\n        fileNameTextField: {\n            marginLeft: theme.spacing(1),\n            marginRight: theme.spacing(1),\n            fontSize: theme.typography.fontSize / 2\n        },\n    }\n));\n\ninterface ExportDialogProps {\n    open: boolean;\n    closeDialog: (dialogId: string) => any;\n    settings: ControlState;\n    updateSettings: (settings: Partial<ControlState>) => any;\n    downloadTimeSeries: () => any;\n}\n\nconst ExportDialog: React.FC<ExportDialogProps> = ({\n                                                       open,\n                                                       closeDialog,\n                                                       settings,\n                                                       updateSettings,\n                                                       downloadTimeSeries,\n                                                   }) => {\n    const classes = useStyles();\n\n    const handleCloseDialog = () => {\n        closeDialog('export');\n    }\n\n    function handleFileNameChange(event: ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) {\n        updateSettings({exportFileName: event.target.value});\n    }\n\n    function handleSeparatorChange(event: ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) {\n        updateSettings({exportTimeSeriesSeparator: event.target.value});\n    }\n\n    const handleDoExport = () => {\n        handleCloseDialog();\n        downloadTimeSeries();\n    }\n\n    return (\n        <div>\n            <Dialog\n                open={open}\n                fullWidth\n                maxWidth={'xs'}\n                onClose={handleCloseDialog}\n                scroll='body'\n            >\n                <DialogContent>\n                    <SettingsPanel title={i18n.get('Export Settings')}>\n                        <SettingsSubPanel\n                            label={i18n.get('Include time-series data') + ' (*.txt)'}\n                            value={getOnOff(settings.exportTimeSeries)}\n                        >\n                            <ToggleSetting\n                                propertyName={'exportTimeSeries'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel\n                            label={i18n.get('Separator for time-series data')}\n                        >\n                            <TextField\n                                variant=\"standard\"\n                                className={classes.separatorTextField}\n                                value={settings.exportTimeSeriesSeparator}\n                                onChange={handleSeparatorChange}\n                                disabled={!settings.exportTimeSeries}\n                                margin=\"normal\"\n                                size={'small'} />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel\n                            label={i18n.get('Include places data') + ' (*.geojson)'}\n                            value={getOnOff(settings.exportPlaces)}\n                        >\n                            <ToggleSetting\n                                propertyName={'exportPlaces'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel\n                            label={i18n.get('Combine place data in one file')}\n                            value={getOnOff(settings.exportPlacesAsCollection)}\n                        >\n                            <ToggleSetting\n                                propertyName={'exportPlacesAsCollection'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                                disabled={!settings.exportPlaces}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel\n                            label={i18n.get('As ZIP archive')}\n                            value={getOnOff(settings.exportZipArchive)}\n                        >\n                            <ToggleSetting\n                                propertyName={'exportZipArchive'}\n                                settings={settings}\n                                updateSettings={updateSettings}\n                            />\n                        </SettingsSubPanel>\n                        <SettingsSubPanel label={i18n.get('File name')}>\n                            <TextField\n                                variant=\"standard\"\n                                className={classes.fileNameTextField}\n                                value={settings.exportFileName}\n                                onChange={handleFileNameChange}\n                                margin=\"normal\"\n                                size={'small'} />\n                        </SettingsSubPanel>\n                    </SettingsPanel>\n                </DialogContent>\n\n                <DialogActions>\n                    <Button\n                        onClick={handleDoExport}\n                        color={'primary'}\n                        disabled={!canDownload(settings)}\n                    >\n                        {i18n.get('Download')}\n                    </Button>\n                </DialogActions>\n\n            </Dialog>\n\n\n        </div>\n    );\n}\n\nexport default ExportDialog;\n\n\nconst getOnOff = (state: boolean): string => {\n    return state ? i18n.get('On') : i18n.get('Off');\n};\n\nconst isValidFileName = (fileName: string) => {\n    return /^[0-9a-zA-Z_-]+$/.test(fileName);\n}\n\nconst isValidSeparator = (separator: string) => {\n    return separator.toUpperCase() === 'TAB' || separator.length === 1;\n}\n\nconst canDownload = (settings: ControlState) => {\n    return (settings.exportTimeSeries || settings.exportPlaces)\n           && isValidFileName(settings.exportFileName)\n           && (!settings.exportTimeSeries || isValidSeparator(settings.exportTimeSeriesSeparator));\n}\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { connect } from 'react-redux';\r\n\r\nimport { AppState } from '../states/appState';\r\nimport ExportDialog from '../components/ExportDialog';\r\nimport { closeDialog, updateSettings } from '../actions/controlActions';\r\nimport { exportData } from '../actions/dataActions';\r\n\r\n\r\nconst mapStateToProps = (state: AppState) => {\r\n    return {\r\n        locale: state.controlState.locale,\r\n        open: Boolean(state.controlState.dialogOpen['export']),\r\n        settings: state.controlState,\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n    closeDialog,\r\n    updateSettings,\r\n    downloadTimeSeries: exportData,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ExportDialog);\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from \"react\";\nimport Button from '@mui/material/Button';\n\n\ninterface FileUploadProps {\n    title: string;\n    accept?: string;\n    multiple?: boolean;\n    disabled?: boolean;\n    onSelect: (selection: File[]) => any;\n    className?: string;\n}\n\nexport const FileUpload: React.FC<FileUploadProps> = (\n    {\n        title,\n        accept,\n        multiple,\n        disabled,\n        onSelect,\n        className\n    }\n) => {\n    const fileInput = React.useRef<HTMLInputElement | null>(null)\n\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (e.target.files !== null && e.target.files.length) {\n            const files: File[] = [];\n            for (let i = 0; i < e.target.files.length; i++) {\n                files.push(e.target.files[i]);\n            }\n            onSelect(files);\n        }\n    }\n\n    const handleButtonClick = () => {\n        if (fileInput.current !== null) {\n            fileInput.current.click();\n        }\n    }\n\n    return (\n        <>\n            <input\n                type=\"file\"\n                accept={accept}\n                multiple={multiple}\n                ref={fileInput}\n                hidden\n                onChange={handleFileChange}\n                disabled={disabled}\n            />\n            <Button\n                onClick={handleButtonClick}\n                disabled={disabled}\n                className={className}\n                variant=\"outlined\"\n                size=\"small\"\n            >\n                {title}\n            </Button>\n        </>\n    );\n}","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport TextField from '@mui/material/TextField';\n\nimport i18n from '../../i18n';\nimport { GeoJsonOptions } from '../../model/user-place/geojson';\n\n\ninterface GeoJsonOptionsEditorProps {\n    options: GeoJsonOptions;\n    updateOptions: (options: Partial<GeoJsonOptions>) => any;\n    className: string;\n}\n\nconst GeoJsonOptionsEditor: React.FC<GeoJsonOptionsEditorProps> = (\n        {\n            options,\n            updateOptions,\n            className\n        }\n) => {\n    function handleLabelNamesChange(e: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) {\n        updateOptions({labelNames: e.target.value});\n    }\n\n    function handleFallbackNamePrefixChange(e: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) {\n        updateOptions({labelPrefix: e.target.value});\n    }\n\n    return (\n            <div className={className}>\n                <TextField\n                        label={i18n.get('Label property names')}\n                        value={options.labelNames}\n                        onChange={handleLabelNamesChange}\n                        size=\"small\"\n                        variant=\"standard\"\n                        style={{flexGrow: 1, marginRight: 10}}\n                />\n                <TextField\n                        label={i18n.get('Label prefix (used as fallback)')}\n                        value={options.labelPrefix}\n                        onChange={handleFallbackNamePrefixChange}\n                        size=\"small\"\n                        variant=\"standard\"\n                        style={{flexGrow: 1}}\n                />\n            </div>\n    );\n}\n\nexport default GeoJsonOptionsEditor;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport TextField from '@mui/material/TextField';\n\nimport i18n from '../../i18n';\nimport { CsvOptions } from '../../model/user-place/csv';\n\n\ninterface CsvOptionsEditorProps {\n    options: CsvOptions;\n    updateOptions: (options: Partial<CsvOptions>) => any;\n    optionName: keyof CsvOptions;\n    label: string;\n}\n\nconst CsvTextFieldEditor: React.FC<CsvOptionsEditorProps> = (\n    {\n        options,\n        updateOptions,\n        optionName,\n        label\n    }\n) => {\n    return (\n        <TextField\n            label={i18n.get(label)}\n            value={options[optionName]}\n            onChange={e => updateOptions({[optionName]: e.target.value})}\n            size=\"small\"\n            variant=\"standard\"\n        />\n    );\n}\n\nexport default CsvTextFieldEditor;\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport Checkbox from \"@mui/material/Checkbox\";\n\nimport { CsvOptions } from '../../model/user-place/csv';\nimport CsvTextFieldEditor from \"./CsvTextFieldEditor\";\n\n\ninterface CsvOptionsEditorProps {\n    options: CsvOptions;\n    updateOptions: (options: Partial<CsvOptions>) => any;\n    className: string;\n}\n\nconst CsvOptionsEditor: React.FC<CsvOptionsEditorProps> = (\n    {\n        options,\n        updateOptions,\n        className\n    }\n) => {\n\n    return (\n        <div>\n            <div style={{display: \"grid\", gap: 12, paddingTop: 12, gridTemplateColumns: \"auto auto\"}}>\n                <CsvTextFieldEditor\n                    optionName={'xName'}\n                    label={'X/longitude column name'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'yName'}\n                    label={'Y/latitude column name'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <span>\n                    <Checkbox\n                        checked={options.forceGeometry}\n                        onChange={e => updateOptions({forceGeometry: e.target.checked})}\n                        size=\"small\"\n                    />\n                    <span>{'Use geometry column'}</span>\n                </span>\n                <CsvTextFieldEditor\n                    optionName={'geometryName'}\n                    label={'Geometry column name'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'labelName'}\n                    label={'Label column name'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'labelPrefix'}\n                    label={'Label prefix (used as fallback)'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n            </div>\n            <div style={{display: \"grid\", gap: 12, paddingTop: 12,\n                gridTemplateColumns: \"auto auto auto\"}}>\n                <CsvTextFieldEditor\n                    optionName={'separator'}\n                    label={'Separator character'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'comment'}\n                    label={'Comment character'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'quote'}\n                    label={'Quote character'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'escape'}\n                    label={'Escape character'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <div/>\n                <span>\n                    <Checkbox\n                        checked={options.trim}\n                        onChange={e => updateOptions({trim: e.target.checked})}\n                        size=\"small\"\n                    />\n                    <span>Remove whitespaces</span>\n                </span>\n                <CsvTextFieldEditor\n                    optionName={'nanToken'}\n                    label={'Not-a-number token'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'trueToken'}\n                    label={'True token'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n                <CsvTextFieldEditor\n                    optionName={'falseToken'}\n                    label={'False token'}\n                    options={options}\n                    updateOptions={updateOptions}\n                />\n            </div>\n        </div>\n    );\n}\n\nexport default CsvOptionsEditor;","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport TextField from '@mui/material/TextField';\n\nimport { WktOptions } from '../../model/user-place/wkt';\nimport i18n from '../../i18n';\n\n\ninterface WktOptionsEditorProps {\n    options: WktOptions;\n    updateOptions: (options: Partial<WktOptions>) => any;\n    className: string;\n}\n\nconst WktOptionsEditor: React.FC<WktOptionsEditorProps> = (\n        {\n            options,\n            updateOptions,\n            className\n        }\n) => {\n    function handleLabelChange(e: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) {\n        updateOptions({label: e.target.value});\n    }\n\n    function handleLabelPrefixChange(e: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) {\n        updateOptions({labelPrefix: e.target.value});\n    }\n\n    return (\n            <div className={className}>\n                <TextField\n                        label={i18n.get('Label')}\n                        value={options.label}\n                        onChange={handleLabelChange}\n                        size=\"small\"\n                        variant=\"standard\"\n                        style={{flexGrow: 1, marginRight: 10}}\n                />\n                <TextField\n                        label={i18n.get('Label prefix (used as fallback)')}\n                        value={options.labelPrefix}\n                        onChange={handleLabelPrefixChange}\n                        size=\"small\"\n                        variant=\"standard\"\n                        style={{flexGrow: 1}}\n                />\n            </div>\n    );\n}\n\nexport default WktOptionsEditor;","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n\nexport interface Format {\n    name: string;\n    fileExt: string;\n    checkError: (text: string) => string | null;\n}\n\n\nconst WKT_GEOM_NAMES = [\n    \"Point\",\n    \"LineString\",\n    \"Polygon\",\n    \"MultiPoint\",\n    \"MultiLineString\",\n    \"MultiPolygon\",\n    \"GeometryCollection\",\n].map(k => k.toLowerCase());\n\n\nexport function detectFormatName(text: string): \"csv\" | \"geojson\" | \"wkt\" {\n    text = text.trim();\n    if (text === \"\") {\n        return \"csv\";\n    }\n\n    if (text[0] === \"{\") {\n        return \"geojson\";\n    }\n\n    const marker = text.substr(0, 20).toLowerCase();\n    const geomName = WKT_GEOM_NAMES.find(\n        geomName => marker.startsWith(geomName)\n            && (marker.length === geomName.length\n                || \"\\n\\t (\".indexOf(marker[geomName.length]) >= 0)\n    );\n    if (geomName) {\n        return \"wkt\";\n    }\n\n    return \"csv\";\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2022 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport makeStyles from '@mui/styles/makeStyles';\nimport DialogTitle from '@mui/material/DialogTitle';\nimport Box from '@mui/material/Box';\nimport Dialog from '@mui/material/Dialog';\nimport Button from '@mui/material/Button';\nimport DialogActions from '@mui/material/DialogActions';\nimport DialogContent from '@mui/material/DialogContent';\nimport Radio from '@mui/material/Radio';\nimport RadioGroup from '@mui/material/RadioGroup';\nimport Collapse from '@mui/material/Collapse';\nimport Typography from '@mui/material/Typography';\nimport FormControlLabel from '@mui/material/FormControlLabel';\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\nimport ExpandLessIcon from '@mui/icons-material/ExpandLess';\nimport CodeMirror from '@uiw/react-codemirror';\nimport { Extension } from '@codemirror/state';\nimport { json } from '@codemirror/lang-json';\n\nimport { WithLocale } from '../util/lang';\nimport i18n from '../i18n';\nimport { Config } from '../config';\nimport { FileUpload } from './FileUpload';\nimport { ControlState, MapInteraction, UserPlacesFormatName, UserPlacesFormatOptions } from '../states/controlState';\nimport GeoJsonOptionsEditor from './user-place/GeoJsonOptionsEditor';\nimport CsvOptionsEditor from './user-place/CsvOptionsEditor';\nimport WktOptionsEditor from './user-place/WktOptionsEditor';\nimport { csvFormat, CsvOptions } from '../model/user-place/csv';\nimport { geoJsonFormat, GeoJsonOptions } from '../model/user-place/geojson';\nimport { wktFormat, WktOptions } from '../model/user-place/wkt';\nimport { detectFormatName, Format } from '../model/user-place/common';\n\n\ninterface FormatWithCodeExt extends Format {\n    codeExt: Extension[];\n}\n\nconst formats: { [k: string]: FormatWithCodeExt } = {\n    csv: {...csvFormat, codeExt: []},\n    geojson: {...geoJsonFormat, codeExt: [json()]},\n    wkt: {...wktFormat, codeExt: []}\n};\n\n\n// noinspection JSUnusedLocalSymbols\nconst useStyles = makeStyles(theme => (\n    {\n        spacer: {\n            flexGrow: 1.0,\n        },\n        actionBox: {\n            paddingTop: theme.spacing(0.5),\n            display: 'flex',\n            flexDirection: 'row',\n            alignItems: 'center',\n        },\n        actionButton: {\n            marginRight: theme.spacing(1),\n        },\n        error: {\n            fontSize: 'small'\n        }\n    }\n));\n\ninterface UserPlacesDialogProps extends WithLocale {\n    open: boolean;\n    closeDialog: (dialogId: string) => void;\n    userPlacesFormatName: UserPlacesFormatName,\n    userPlacesFormatOptions: UserPlacesFormatOptions;\n    updateSettings: (settings: Partial<ControlState>) => void;\n    addUserPlacesFromText: (userPlacesText: string) => void;\n    nextMapInteraction: MapInteraction;\n    setMapInteraction: (mapInteraction: MapInteraction) => any;\n}\n\nconst UserPlacesDialog: React.FC<UserPlacesDialogProps> = (\n    {\n        open,\n        closeDialog,\n        userPlacesFormatName,\n        userPlacesFormatOptions,\n        updateSettings,\n        addUserPlacesFromText,\n        nextMapInteraction,\n        setMapInteraction\n    }) => {\n\n    const [text, setText] = React.useState('');\n    const [error, setError] = React.useState<string | null>(null);\n    const [loading, setLoading] = React.useState(false);\n    const [expanded, setExpanded] = React.useState(false);\n    const [_userPlacesFormatName, setUserPlacesFormatName] = React.useState(userPlacesFormatName);\n    const [_userPlacesFormatOptions, setUserPlacesFormatOptions] = React.useState(userPlacesFormatOptions);\n    const classes = useStyles();\n\n    React.useEffect(() => {\n        setUserPlacesFormatName(userPlacesFormatName);\n    }, [userPlacesFormatName]);\n\n    React.useEffect(() => {\n        setUserPlacesFormatOptions(userPlacesFormatOptions);\n    }, [userPlacesFormatOptions]);\n\n    if (!open) {\n        return null;\n    }\n\n    const handleConfirm = () => {\n        setMapInteraction('Select');\n        closeDialog('addUserPlacesFromText');\n        updateSettings({\n            userPlacesFormatName: _userPlacesFormatName,\n            userPlacesFormatOptions: _userPlacesFormatOptions,\n        });\n        addUserPlacesFromText(text);\n    };\n\n    const handleClose = () => {\n        setMapInteraction(nextMapInteraction);\n        closeDialog('addUserPlacesFromText');\n    };\n\n    const handleClearText = () => {\n        setText('');\n    };\n\n    const handleFileSelect = (selection: File[]) => {\n        const file = selection[0];\n        setLoading(true);\n        const reader = new FileReader();\n        reader.onloadend = () => {\n            const text = reader.result as string;\n            setUserPlacesFormatName(detectFormatName(text));\n            setText(text);\n            setLoading(false);\n        };\n        reader.onabort = reader.onerror = () => {\n            setLoading(false);\n        };\n        reader.readAsText(file, 'UTF-8');\n    };\n\n    const handleCodeDrop = () => {\n        setText('');\n    };\n\n    const handleCodePaste = () => {\n        console.info(\"PASTE!\", text);\n    };\n\n    const handleCodeChange = (value: string) => {\n        let formatName = _userPlacesFormatName;\n        if (text === \"\" && value.length > 10) {\n            // Pasted some text\n            formatName = detectFormatName(value);\n            setUserPlacesFormatName(formatName);\n        }\n        setText(value);\n        setError(formats[formatName].checkError(value));\n    };\n\n    function handleFormatNameChange(e: React.ChangeEvent<HTMLInputElement>) {\n        setUserPlacesFormatName(e.target.value as UserPlacesFormatName);\n    }\n\n    function updateCsvOptions(options: Partial<CsvOptions>) {\n        setUserPlacesFormatOptions({\n            ..._userPlacesFormatOptions,\n            csv: {\n                ..._userPlacesFormatOptions.csv,\n                ...options\n            }\n        });\n    }\n\n    function updateGeoJsonOptions(options: Partial<GeoJsonOptions>) {\n        setUserPlacesFormatOptions({\n            ..._userPlacesFormatOptions,\n            geojson: {\n                ..._userPlacesFormatOptions.geojson,\n                ...options\n            }\n        });\n    }\n\n    function updateWktOptions(options: Partial<WktOptions>) {\n        setUserPlacesFormatOptions({\n            ..._userPlacesFormatOptions,\n            wkt: {\n                ..._userPlacesFormatOptions.wkt,\n                ...options\n            }\n        });\n    }\n\n    let formatOptionsEditor;\n    if (_userPlacesFormatName === 'csv') {\n        formatOptionsEditor = (\n            <CsvOptionsEditor\n                options={_userPlacesFormatOptions.csv}\n                updateOptions={updateCsvOptions}\n                className={classes.actionBox}\n            />\n        );\n    } else if (_userPlacesFormatName === 'geojson') {\n        formatOptionsEditor = (\n            <GeoJsonOptionsEditor\n                options={_userPlacesFormatOptions.geojson}\n                updateOptions={updateGeoJsonOptions}\n                className={classes.actionBox}\n            />\n        );\n    } else {\n        formatOptionsEditor = (\n            <WktOptionsEditor\n                options={_userPlacesFormatOptions.wkt}\n                updateOptions={updateWktOptions}\n                className={classes.actionBox}\n            />\n        );\n    }\n\n    return (\n        <Dialog\n            fullWidth\n            open={open}\n            onClose={handleClose}\n            aria-labelledby=\"server-dialog-title\"\n        >\n            <DialogTitle id=\"server-dialog-title\">{i18n.get('Add Places')}</DialogTitle>\n            <DialogContent dividers>\n                <RadioGroup\n                    row\n                    value={_userPlacesFormatName}\n                    onChange={e => handleFormatNameChange(e)}\n                >\n                    <FormControlLabel\n                        key={'csv'}\n                        value={'csv'}\n                        label={i18n.get(csvFormat.name)}\n                        control={<Radio/>}\n                    />\n                    <FormControlLabel\n                        key={'geojson'}\n                        value={'geojson'}\n                        label={i18n.get(geoJsonFormat.name)}\n                        control={<Radio/>}\n                    />\n                    <FormControlLabel\n                        key={'wkt'}\n                        value={'wkt'}\n                        label={i18n.get(wktFormat.name)}\n                        control={<Radio/>}\n                    />\n                </RadioGroup>\n                <CodeMirror\n                    theme={Config.instance.branding.themeName || 'light'}\n                    placeholder={i18n.get('Enter text or drag & drop a text file.')}\n                    autoFocus\n                    height=\"400px\"\n                    extensions={formats[_userPlacesFormatName].codeExt}\n                    value={text}\n                    onChange={handleCodeChange}\n                    onDrop={handleCodeDrop}\n                    onPaste={handleCodePaste}\n                    onPasteCapture={handleCodePaste}\n                />\n                {error && <Typography color=\"error\" className={classes.error}>{error}</Typography>}\n                <div className={classes.actionBox}>\n                    <FileUpload\n                        title={i18n.get('From File') + '...'}\n                        accept={formats[_userPlacesFormatName].fileExt}\n                        multiple={false}\n                        onSelect={handleFileSelect}\n                        disabled={loading}\n                        className={classes.actionButton}\n                    />\n                    <Button\n                        onClick={handleClearText}\n                        disabled={text.trim() === '' || loading}\n                        className={classes.actionButton}\n                        variant=\"outlined\"\n                        size=\"small\"\n                    >\n                        {i18n.get('Clear')}\n                    </Button>\n                    <Box className={classes.spacer}/>\n                    <Button\n                        onClick={() => setExpanded(!expanded)}\n                        endIcon={expanded ? <ExpandLessIcon/>:<ExpandMoreIcon/>}\n                        variant=\"outlined\"\n                        size=\"small\"\n                    >\n                        {i18n.get('Options')}\n                    </Button>\n                </div>\n                <Collapse in={expanded} timeout=\"auto\" unmountOnExit>\n                    {formatOptionsEditor}\n                </Collapse>\n            </DialogContent>\n            <DialogActions>\n                <Button\n                    onClick={handleClose}\n                    variant=\"text\"\n                >\n                    {i18n.get('Cancel')}\n                </Button>\n                <Button\n                    onClick={handleConfirm}\n                    disabled={text.trim() === '' || error !== null || loading}\n                    color=\"primary\"\n                    variant=\"text\"\n                >\n                    {i18n.get('OK')}\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n}\n\n\nexport default UserPlacesDialog;\n","import { connect } from 'react-redux';\n\nimport { AppState } from '../states/appState';\nimport UserPlacesDialog from '../components/UserPlacesDialog';\nimport { closeDialog, updateSettings, setMapInteraction } from '../actions/controlActions';\nimport { addUserPlacesFromText } from '../actions/dataActions';\n\n\nconst mapStateToProps = (state: AppState) => {\n    return {\n        open: !!state.controlState.dialogOpen['addUserPlacesFromText'],\n        userPlacesFormatName: state.controlState.userPlacesFormatName,\n        userPlacesFormatOptions: state.controlState.userPlacesFormatOptions,\n        nextMapInteraction: state.controlState.lastMapInteraction,\n    };\n};\n\nconst mapDispatchToProps = {\n    closeDialog,\n    updateSettings,\n    setMapInteraction,\n    addUserPlacesFromText,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(UserPlacesDialog);\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { adaptV4Theme, createTheme, CssBaseline, StyledEngineProvider, ThemeProvider, } from '@mui/material';\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { Config } from '../config';\n\nimport { AppState } from '../states/appState';\nimport AppBar from './AppBar';\nimport AppPane from './AppPane';\nimport LegalAgreementDialog from './LegalAgreementDialog';\nimport LoadingDialog from './LoadingDialog';\nimport MessageLog from './MessageLog';\nimport AuthWrapper from \"../components/AuthWrapper\";\nimport ServerDialog from \"./ServerDialog\";\nimport SettingsDialog from \"./SettingsDialog\";\nimport ExportDialog from \"./ExportDialog\";\nimport AddPlaceDialog from \"./UserPlacesDialog\";\n\n\ninterface AppProps {\n    compact: boolean;\n}\n\n// noinspection JSUnusedLocalSymbols\nconst mapStateToProps = (state: AppState) => {\n    return {\n        compact: Config.instance.branding.compact\n    };\n};\n\nconst mapDispatchToProps = {};\n\nconst newTheme = () => createTheme(\n    adaptV4Theme({\n        typography: {\n            fontSize: 12,\n            htmlFontSize: 14,\n        },\n        palette: {\n            mode: Config.instance.branding.themeName,\n            primary: Config.instance.branding.primaryColor,\n            secondary: Config.instance.branding.secondaryColor,\n        },\n    }));\n\nconst App: React.FC<AppProps> = ({compact}) => {\n    return (\n        <AuthWrapper>\n            <StyledEngineProvider injectFirst>\n                <ThemeProvider theme={newTheme()}>\n                    <CssBaseline/>\n                    {!compact && <AppBar/>}\n                    <AppPane/>\n                    <>\n                        <LoadingDialog/>\n                        <ServerDialog/>\n                        <SettingsDialog/>\n                        <ExportDialog/>\n                        <AddPlaceDialog/>\n                        <LegalAgreementDialog/>\n                        <MessageLog/>\n                    </>\n                </ThemeProvider>\n            </StyledEngineProvider>\n        </AuthWrapper>\n    );\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { Config } from '../config';\r\nimport i18n from '../i18n';\r\nimport { ApiServerConfig, ApiServerInfo } from \"../model/apiServer\";\r\nimport { ColorBars } from '../model/colorBar';\r\nimport { Dataset } from '../model/dataset';\r\nimport { Place, PlaceGroup, } from '../model/place';\r\nimport { TimeSeriesGroup } from '../model/timeSeries';\r\nimport { loadUserServers } from './userSettings';\r\n\r\nexport interface DataState {\r\n    serverInfo: ApiServerInfo | null;\r\n    datasets: Dataset[];\r\n    colorBars: ColorBars | null;\r\n    timeSeriesGroups: TimeSeriesGroup[];\r\n    userPlaceGroup: PlaceGroup;\r\n    userServers: ApiServerConfig[];\r\n}\r\n\r\nexport function newDataState(): DataState {\r\n    const extraUserServers = loadUserServers();\r\n    const userServers = [\r\n        {...Config.instance.server},\r\n    ];\r\n    extraUserServers.forEach(extraUserServer => {\r\n        if (!userServers.find(userServer => userServer.id === extraUserServer.id)) {\r\n            userServers.push(extraUserServer);\r\n        }\r\n    });\r\n    return {\r\n        serverInfo: null,\r\n        datasets: [],\r\n        colorBars: null,\r\n        timeSeriesGroups: [],\r\n        userPlaceGroup: {\r\n            id: 'user',\r\n            title: i18n.get('My places'),\r\n            type: \"FeatureCollection\",\r\n            features: [] as Array<Place>\r\n        },\r\n        userServers,\r\n    };\r\n}\r\n\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { default as OlVectorLayer } from 'ol/layer/Vector';\nimport { default as OlGeoJSONFormat } from 'ol/format/GeoJSON';\n\nimport { DataState, newDataState } from '../states/dataState';\nimport { storeUserServers } from '../states/userSettings';\nimport {\n    DataAction,\n    CONFIGURE_SERVERS,\n    ADD_USER_PLACE,\n    ADD_USER_PLACES,\n    REMOVE_ALL_TIME_SERIES,\n    REMOVE_TIME_SERIES_GROUP,\n    UPDATE_COLOR_BARS,\n    UPDATE_DATASETS,\n    UPDATE_TIME_SERIES,\n    UPDATE_DATASET_PLACE_GROUP,\n    REMOVE_USER_PLACE,\n    REMOVE_ALL_USER_PLACES,\n    UPDATE_SERVER_INFO,\n    UPDATE_VARIABLE_COLOR_BAR,\n} from '../actions/dataActions';\nimport { MAP_OBJECTS } from '../states/controlState';\nimport { newId } from '../util/id';\nimport { Place } from '../model/place';\nimport { TimeSeries, TimeSeriesGroup } from '../model/timeSeries';\nimport { setFeatureStyle } from \"../components/ol/style\";\nimport { Config } from \"../config\";\n\n\nexport function dataReducer(state: DataState | undefined, action: DataAction): DataState {\n    if (state === undefined) {\n        state = newDataState();\n    }\n    switch (action.type) {\n        case UPDATE_SERVER_INFO: {\n            return {...state, serverInfo: action.serverInfo};\n        }\n        case UPDATE_DATASETS: {\n            return {...state, datasets: action.datasets};\n        }\n        case UPDATE_VARIABLE_COLOR_BAR: {\n            const datasetIndex = state.datasets.findIndex(ds => ds.id === action.datasetId);\n            if (datasetIndex >= 0) {\n                let dataset = state.datasets[datasetIndex];\n                const variableIndex = dataset.variables.findIndex(v => v.name === action.variableName);\n                if (variableIndex >= 0) {\n                    let variable = dataset.variables[variableIndex];\n                    let datasets = state.datasets.slice();\n                    let variables = dataset.variables.slice();\n                    variables[variableIndex] = {\n                        ...variable,\n                        colorBarMin: action.colorBarMinMax[0],\n                        colorBarMax: action.colorBarMinMax[1],\n                        colorBarName: action.colorBarName,\n                        opacity: action.opacity,\n                    };\n                    datasets[datasetIndex] = {...dataset, variables};\n                    return {...state, datasets};\n                }\n            }\n            return state;\n        }\n        case UPDATE_DATASET_PLACE_GROUP: {\n            // Issue #208:\n            // We no longer set individual dataset place groups.\n            // That's why action.datasetId is no longer used here.\n            // Instead, we update all datasets that refer to the\n            // place group with the given ID.\n            const placeGroup = action.placeGroup;\n            const datasets = state.datasets.map(dataset => {\n                if (dataset.placeGroups) {\n                    const placeGroupIndex = dataset.placeGroups.findIndex(pg => pg.id === placeGroup.id);\n                    if (placeGroupIndex >= 0) {\n                        const placeGroups = [...dataset.placeGroups];\n                        placeGroups[placeGroupIndex] = placeGroup;\n                        return {...dataset, placeGroups};\n                    }\n                }\n                return dataset;\n            });\n            return {...state, datasets};\n        }\n        case ADD_USER_PLACE: {\n            const {id, label, color, geometry} = action;\n            const place: Place = {\n                type: 'Feature',\n                id,\n                geometry,\n                properties: {label, color},\n            };\n            const features = [...state.userPlaceGroup.features, place];\n            const userPlaceGroup = {...state.userPlaceGroup, features};\n            return {\n                ...state,\n                userPlaceGroup,\n            };\n        }\n        case ADD_USER_PLACES: {\n            const {places, mapProjection} = action;\n            places.forEach(place => addUserPlaceToLayer(place, mapProjection));\n            const features = [...state.userPlaceGroup.features, ...places];\n            const userPlaceGroup = {...state.userPlaceGroup, features};\n            return {\n                ...state,\n                userPlaceGroup,\n            };\n        }\n        case REMOVE_USER_PLACE: {\n            const {id} = action;\n            const index = state.userPlaceGroup.features.findIndex(p => p.id === id);\n            if (index >= 0) {\n                removeUserPlacesFromLayer([id]);\n                const features = [...state.userPlaceGroup.features];\n                features.splice(index, 1);\n                const userPlaceGroup = {...state.userPlaceGroup, features};\n                const timeSeriesArray = getTimeSeriesArray(state.timeSeriesGroups, [id]);\n                let timeSeriesGroups = state.timeSeriesGroups;\n                timeSeriesArray.forEach(ts => {\n                    timeSeriesGroups = updateTimeSeriesGroups(timeSeriesGroups,\n                                                              ts, 'remove', 'append');\n                });\n                return {\n                    ...state,\n                    userPlaceGroup,\n                    timeSeriesGroups\n                };\n            }\n            return state;\n        }\n        case REMOVE_ALL_USER_PLACES: {\n            const userPlaces = state.userPlaceGroup.features as Place[];\n            const userPlaceIds = userPlaces.map(p => p.id);\n            removeUserPlacesFromLayer(userPlaceIds);\n            const userPlaceGroup = {...state.userPlaceGroup, features: []};\n            const timeSeriesArray = getTimeSeriesArray(state.timeSeriesGroups, userPlaceIds);\n            let timeSeriesGroups = state.timeSeriesGroups;\n            timeSeriesArray.forEach(ts => {\n                timeSeriesGroups = updateTimeSeriesGroups(timeSeriesGroups,\n                                                          ts, 'remove', 'append');\n            });\n            return {\n                ...state,\n                userPlaceGroup,\n                timeSeriesGroups,\n            };\n        }\n        case UPDATE_COLOR_BARS: {\n            return {...state, colorBars: action.colorBars};\n        }\n        case UPDATE_TIME_SERIES: {\n            const {timeSeries, updateMode, dataMode} = action;\n            const timeSeriesGroups = updateTimeSeriesGroups(state.timeSeriesGroups,\n                                                            timeSeries, updateMode, dataMode);\n            if (timeSeriesGroups !== state.timeSeriesGroups) {\n                return {...state, timeSeriesGroups};\n            }\n            return state;\n        }\n        case REMOVE_TIME_SERIES_GROUP: {\n            let tsgIndex = state.timeSeriesGroups.findIndex(tsg => tsg.id === action.id);\n            if (tsgIndex >= 0) {\n                const timeSeriesGroups = [...state.timeSeriesGroups];\n                timeSeriesGroups.splice(tsgIndex, 1);\n                return {...state, timeSeriesGroups};\n            }\n            return state;\n        }\n        case REMOVE_ALL_TIME_SERIES: {\n            return {...state, timeSeriesGroups: []};\n        }\n        case CONFIGURE_SERVERS: {\n            if (state.userServers !== action.servers) {\n                storeUserServers(action.servers);\n                return {...state, userServers: action.servers};\n            }\n            return state;\n        }\n    }\n\n    return state!;\n}\n\nfunction addUserPlaceToLayer(place: Place, mapProjection: string) {\n    if (MAP_OBJECTS.userLayer) {\n        const userLayer = MAP_OBJECTS.userLayer as OlVectorLayer;\n        const source = userLayer.getSource();\n        const feature = new OlGeoJSONFormat().readFeature(place,\n            {\n                dataProjection: 'EPSG:4326',\n                featureProjection: mapProjection\n            });\n        const color = (place.properties || {}).color || 'red';\n        setFeatureStyle(feature, color, Config.instance.branding.polygonFillOpacity);\n        source.addFeature(feature);\n        userLayer.changed();\n    }\n}\n\nfunction removeUserPlacesFromLayer(userPlaceIds: string[]) {\n    if (MAP_OBJECTS.userLayer) {\n        const userLayer = MAP_OBJECTS.userLayer as OlVectorLayer;\n        const source = userLayer.getSource();\n        userPlaceIds.forEach(placeId => {\n            const feature = source.getFeatureById(placeId);\n            if (feature) {\n                source.removeFeature(feature);\n            }\n        });\n    }\n}\n\n\nfunction updateTimeSeriesGroups(timeSeriesGroups: TimeSeriesGroup[],\n                                timeSeries: TimeSeries,\n                                updateMode: 'add' | 'replace' | 'remove',\n                                dataMode: 'append' | 'new'): TimeSeriesGroup[] {\n    let currentTimeSeries = timeSeries;\n\n    let newTimeSeriesGroups;\n    const tsgIndex = timeSeriesGroups.findIndex(tsg => tsg.variableUnits === currentTimeSeries.source.variableUnits);\n    if (tsgIndex >= 0) {\n        const timeSeriesGroup = timeSeriesGroups[tsgIndex];\n        const timeSeriesArray = timeSeriesGroup.timeSeriesArray;\n        const tsIndex = timeSeriesArray.findIndex(ts => ts.source.datasetId === currentTimeSeries.source.datasetId\n                                                        && ts.source.variableName === currentTimeSeries.source.variableName\n                                                        && ts.source.placeId === currentTimeSeries.source.placeId);\n        let newTimeSeriesArray;\n        if (tsIndex >= 0) {\n            const oldTimeSeries = timeSeriesArray[tsIndex];\n            if (dataMode === 'append') {\n                currentTimeSeries = {\n                    ...currentTimeSeries,\n                    data: [...currentTimeSeries.data, ...oldTimeSeries.data]\n                };\n            }\n            if (updateMode === 'replace') {\n                newTimeSeriesArray = [currentTimeSeries];\n            } else if (updateMode === 'add') {\n                newTimeSeriesArray = timeSeriesArray.slice();\n                newTimeSeriesArray[tsIndex] = currentTimeSeries;\n            } else /*if (action.updateMode === 'remove')*/ {\n                newTimeSeriesArray = timeSeriesArray.slice();\n                newTimeSeriesArray.splice(tsIndex, 1);\n            }\n        } else {\n            if (updateMode === 'replace') {\n                newTimeSeriesArray = [currentTimeSeries];\n            } else if (updateMode === 'add') {\n                newTimeSeriesArray = [currentTimeSeries, ...timeSeriesArray];\n            } else /*if (action.updateMode === 'remove')*/ {\n                // Nothing to do here.\n                newTimeSeriesArray = timeSeriesArray;\n            }\n        }\n        if (updateMode === 'replace') {\n            newTimeSeriesGroups = [{...timeSeriesGroup, timeSeriesArray: newTimeSeriesArray}];\n        } else if (updateMode === 'add') {\n            newTimeSeriesGroups = timeSeriesGroups.slice();\n            newTimeSeriesGroups[tsgIndex] = {...timeSeriesGroup, timeSeriesArray: newTimeSeriesArray};\n        } else /*if (action.updateMode === 'remove')*/ {\n            if (newTimeSeriesArray.length >= 0) {\n                newTimeSeriesGroups = timeSeriesGroups.slice();\n                newTimeSeriesGroups[tsgIndex] = {...timeSeriesGroup, timeSeriesArray: newTimeSeriesArray};\n            } else {\n                newTimeSeriesGroups = timeSeriesGroups.slice();\n                newTimeSeriesGroups.splice(tsgIndex, 1)\n            }\n        }\n    } else {\n        if (updateMode === 'replace') {\n            const newTimeSeriesGroup = {\n                id: newId(),\n                variableUnits: currentTimeSeries.source.variableUnits,\n                timeSeriesArray: [currentTimeSeries],\n            };\n            newTimeSeriesGroups = [newTimeSeriesGroup];\n        } else if (updateMode === 'add') {\n            const newTimeSeriesGroup = {\n                id: newId(),\n                variableUnits: currentTimeSeries.source.variableUnits,\n                timeSeriesArray: [currentTimeSeries],\n            };\n            newTimeSeriesGroups = [newTimeSeriesGroup, ...timeSeriesGroups];\n        } else /*if (action.updateMode === 'remove')*/ {\n            // Nothing to do here.\n            newTimeSeriesGroups = timeSeriesGroups;\n        }\n    }\n\n    return newTimeSeriesGroups;\n}\n\n\nfunction getTimeSeriesArray(timeSeriesGroups: TimeSeriesGroup[], placeIds: string[]): TimeSeries[] {\n    const timeSeriesArray: TimeSeries[] = [];\n    timeSeriesGroups.forEach(tsg => {\n        tsg.timeSeriesArray.forEach(ts => {\n            placeIds.forEach(placeId => {\n                if (ts.source.placeId === placeId) {\n                    timeSeriesArray.push(ts);\n                }\n            });\n        })\n    });\n    return timeSeriesArray;\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { default as OlSimpleGeometry } from 'ol/geom/SimpleGeometry';\nimport { default as OlMap } from 'ol/Map';\nimport { transformExtent as olProjTransformExtent } from 'ol/proj';\nimport {\n    ADD_ACTIVITY,\n    CHANGE_LOCALE,\n    CLOSE_DIALOG,\n    ControlAction,\n    FLY_TO,\n    INC_SELECTED_TIME,\n    OPEN_DIALOG,\n    REMOVE_ACTIVITY,\n    SELECT_DATASET,\n    SELECT_PLACE,\n    SELECT_PLACE_GROUPS,\n    SELECT_TIME,\n    SELECT_TIME_RANGE,\n    SELECT_TIME_SERIES_UPDATE_MODE,\n    SELECT_VARIABLE,\n    SET_MAP_INTERACTION,\n    SET_RGB_LAYER_VISIBILITY,\n    SET_VISIBLE_INFO_CARD_ELEMENTS,\n    SHOW_INFO_CARD,\n    UPDATE_INFO_CARD_ELEMENT_VIEW_MODE,\n    UPDATE_SETTINGS,\n    UPDATE_TIME_ANIMATION,\n} from '../actions/controlActions';\nimport {\n    ADD_USER_PLACE,\n    ADD_USER_PLACES,\n    CONFIGURE_SERVERS,\n    DataAction,\n    REMOVE_USER_PLACE,\n    UPDATE_DATASETS\n} from '../actions/dataActions';\nimport i18n from '../i18n';\n\nimport { findDataset, findDatasetVariable, getDatasetTimeRange } from '../model/dataset';\nimport { selectedTimeIndexSelector, timeCoordinatesSelector } from '../selectors/controlSelectors';\nimport { AppState } from '../states/appState';\nimport { ControlState, MAP_OBJECTS, newControlState } from '../states/controlState';\nimport { storeUserSettings } from '../states/userSettings';\nimport { findIndexCloseTo } from '../util/find';\nimport { GEOGRAPHIC_CRS } from \"../model/proj\";\nimport { appParams } from \"../config\";\n\n// TODO (forman): Refactor reducers for UPDATE_DATASETS, SELECT_DATASET, SELECT_PLACE, SELECT_VARIABLE\n//                so they produce a consistent state. E.g. on selected dataset change, ensure selected\n//                places and variables are still valid. Write tests for that.\n//                We currently still receiving error logs from Material-UI, e.g.:\n//                  SelectInput.js:304 Material-UI: you have provided an out-of-range value `local`\n//                  for the select (name=\"dataset\") component.\n//                  Consider providing a value that matches one of the available options or ''.\n//                  The available values are \"\".\n\nexport function controlReducer(state: ControlState | undefined,\n                               action: ControlAction | DataAction,\n                               appState: AppState | undefined): ControlState {\n    if (state === undefined) {\n        state = newControlState();\n    }\n    switch (action.type) {\n        case UPDATE_SETTINGS: {\n            const settings = {...state, ...action.settings};\n            storeUserSettings(settings);\n            return settings;\n        }\n        case UPDATE_DATASETS: {\n            let selectedDatasetId = state!.selectedDatasetId || appParams.get(\"dataset\");\n            let selectedVariableName = state!.selectedVariableName || appParams.get(\"variable\");\n            let mapInteraction = state!.mapInteraction;\n            let selectedDataset = findDataset(action.datasets, selectedDatasetId);\n            const selectedVariable = (selectedDataset\n                    && findDatasetVariable(selectedDataset, selectedVariableName))\n                || null;\n            if (selectedDataset) {\n                if (!selectedVariable) {\n                    selectedVariableName = selectedDataset.variables.length ? selectedDataset.variables[0].name : null;\n                }\n            } else {\n                selectedDatasetId = null;\n                selectedVariableName = null;\n                selectedDataset = action.datasets.length ? action.datasets[0] : null;\n                if (selectedDataset) {\n                    selectedDatasetId = selectedDataset.id;\n                    if (selectedDataset.variables.length > 0) {\n                        selectedVariableName = selectedDataset.variables[0].name;\n                    }\n                }\n            }\n            if (!selectedDatasetId) {\n                mapInteraction = 'Select';\n            }\n            return {...state, selectedDatasetId, selectedVariableName, mapInteraction};\n        }\n        case SELECT_DATASET: {\n            let selectedVariableName = state.selectedVariableName;\n            const selectedDataset = findDataset(action.datasets, action.selectedDatasetId)!;\n            const selectedVariable = findDatasetVariable(selectedDataset, selectedVariableName);\n            if (!selectedVariable && selectedDataset.variables.length > 0) {\n                selectedVariableName = selectedDataset.variables[0].name;\n            }\n            const selectedDatasetId = action.selectedDatasetId;\n            const selectedTimeRange = getDatasetTimeRange(selectedDataset);\n            const selectedTime = selectedTimeRange ? selectedTimeRange[1] : null;\n            return {\n                ...state,\n                selectedDatasetId,\n                selectedVariableName,\n                selectedTimeRange,\n                selectedTime,\n            };\n        }\n        case FLY_TO: {\n            const mapObject = MAP_OBJECTS[action.mapId];\n            const flyToCurr = action.location;\n            if (mapObject instanceof OlMap && flyToCurr !== null) {\n                const map = mapObject;\n                const projection = map.getView().getProjection();\n                let flyToTarget;\n                // noinspection JSDeprecatedSymbols\n                if (Array.isArray(flyToCurr)) {\n                    // Fly to extent (bounding box)\n                    flyToTarget = olProjTransformExtent(flyToCurr, GEOGRAPHIC_CRS, projection);\n                    map.getView().fit(flyToTarget, {size: map.getSize()});\n                } else {\n                    // Transform Geometry object\n                    flyToTarget = flyToCurr.transform(GEOGRAPHIC_CRS, projection) as OlSimpleGeometry;\n                    if (flyToTarget.getType() === 'Point') {\n                        // Points don't fly. Just reset map center. Not ideal, but better than zooming in too deep (see #54)\n                        map.getView().setCenter(flyToTarget.getFirstCoordinate());\n                    } else {\n                        // Fly to shape\n                        map.getView().fit(flyToTarget, {size: map.getSize()});\n                    }\n                }\n            }\n            if (state.flyTo !== action.location) {\n                return {\n                    ...state,\n                    flyTo: action.location,\n                };\n            }\n            return state;\n        }\n        case SELECT_PLACE_GROUPS: {\n            const selectedPlaceGroupIds = action.selectedPlaceGroupIds;\n            const selectedPlaceId = null;\n            return {\n                ...state,\n                selectedPlaceGroupIds,\n                selectedPlaceId,\n            };\n        }\n        case SELECT_PLACE: {\n            const selectedPlaceId = action.selectedPlaceId;\n            return {\n                ...state,\n                selectedPlaceId,\n            };\n        }\n        case SELECT_VARIABLE: {\n            return {\n                ...state,\n                selectedVariableName: action.selectedVariableName,\n            };\n        }\n        case SET_RGB_LAYER_VISIBILITY: {\n            return {\n                ...state,\n                showRgbLayer: action.showRgbLayer,\n            };\n        }\n        case SELECT_TIME: {\n            let {selectedTime} = action;\n            if (selectedTime !== null && appState) {\n                const timeCoordinates = timeCoordinatesSelector(appState)!;\n                const index = timeCoordinates ? findIndexCloseTo(timeCoordinates, selectedTime) : -1;\n                if (index >= 0) {\n                    selectedTime = timeCoordinates[index];\n                }\n            }\n            if (state.selectedTime !== selectedTime) {\n                return {\n                    ...state,\n                    selectedTime,\n                };\n            }\n            return state;\n        }\n        case INC_SELECTED_TIME: {\n            if (appState) {\n                let index = selectedTimeIndexSelector(appState);\n                if (index >= 0) {\n                    const timeCoordinates = timeCoordinatesSelector(appState)!;\n                    index += action.increment;\n                    if (index < 0) {\n                        index = timeCoordinates.length - 1;\n                    }\n                    if (index > timeCoordinates.length - 1) {\n                        index = 0;\n                    }\n                    let selectedTime = timeCoordinates[index];\n                    let selectedTimeRange = state.selectedTimeRange;\n                    if (selectedTimeRange !== null) {\n                        if (selectedTime < selectedTimeRange[0]) {\n                            selectedTime = selectedTimeRange[0];\n                        }\n                        if (selectedTime > selectedTimeRange[1]) {\n                            selectedTime = selectedTimeRange[1];\n                        }\n                    }\n                    if (state.selectedTime !== selectedTime) {\n                        return {\n                            ...state,\n                            selectedTime,\n                        };\n                    }\n                }\n            }\n            return state;\n        }\n        case SELECT_TIME_RANGE: {\n            return {\n                ...state,\n                selectedTimeRange: action.selectedTimeRange,\n            };\n        }\n        case SELECT_TIME_SERIES_UPDATE_MODE: {\n            return {\n                ...state,\n                timeSeriesUpdateMode: action.timeSeriesUpdateMode,\n            };\n        }\n        case UPDATE_TIME_ANIMATION: {\n            return {\n                ...state,\n                timeAnimationActive: action.timeAnimationActive,\n                timeAnimationInterval: action.timeAnimationInterval,\n            };\n        }\n        case ADD_USER_PLACE: {\n            if (action.selectPlace) {\n                return selectPlace(state, action.id);\n            }\n            return state;\n        }\n        case ADD_USER_PLACES: {\n            if (action.selectPlace && action.places.length) {\n                return selectPlace(state, action.places[0].id);\n            }\n            return state;\n        }\n        case REMOVE_USER_PLACE: {\n            const {id, places} = action;\n            if (id === state.selectedPlaceId) {\n                let selectedPlaceId = null;\n                const index = places.findIndex(p => p.id === id);\n                if (index >= 0) {\n                    if (index < places.length - 1) {\n                        selectedPlaceId = places[index + 1].id;\n                    } else if (index > 0) {\n                        selectedPlaceId = places[index - 1].id;\n                    }\n                }\n                return {\n                    ...state,\n                    selectedPlaceId\n                };\n            }\n            return state;\n        }\n        case SET_MAP_INTERACTION: {\n            let newState = {\n                ...state,\n                mapInteraction: action.mapInteraction,\n                lastMapInteraction: state.mapInteraction,\n            };\n            if (action.mapInteraction === 'Geometry') {\n                newState = {\n                    ...newState,\n                    dialogOpen: {\n                        ...state.dialogOpen,\n                        addUserPlacesFromText: true\n                    },\n                };\n            }\n            return newState;\n        }\n        case SHOW_INFO_CARD: {\n            state = {\n                ...state,\n                infoCardOpen: action.infoCardOpen,\n            };\n            storeUserSettings(state);\n            return state;\n        }\n        case SET_VISIBLE_INFO_CARD_ELEMENTS: {\n            const infoCardElementStates = {...state.infoCardElementStates};\n            Object.getOwnPropertyNames(infoCardElementStates).forEach(e => {\n                infoCardElementStates[e] = {...infoCardElementStates[e], visible: action.visibleElements.includes(e)};\n            });\n            state = {\n                ...state,\n                infoCardElementStates,\n            };\n            storeUserSettings(state);\n            return state;\n        }\n        case UPDATE_INFO_CARD_ELEMENT_VIEW_MODE: {\n            state = {\n                ...state,\n                infoCardElementStates: {\n                    ...state.infoCardElementStates,\n                    [action.elementType]: {\n                        ...state.infoCardElementStates[action.elementType],\n                        viewMode: action.viewMode\n                    }\n                },\n            };\n            storeUserSettings(state);\n            return state;\n        }\n        case ADD_ACTIVITY: {\n            return {\n                ...state,\n                activities: {...state.activities, [action.id]: action.message},\n            };\n        }\n        case REMOVE_ACTIVITY: {\n            const activities = {...state.activities};\n            delete activities[action.id];\n            return {\n                ...state,\n                activities,\n            };\n        }\n        case CHANGE_LOCALE: {\n            const locale = action.locale;\n            i18n.locale = locale;\n            if (locale !== state.locale) {\n                state = {...state, locale};\n                storeUserSettings(state);\n            }\n            return state;\n        }\n        case OPEN_DIALOG: {\n            const dialogId = action.dialogId;\n            return {\n                ...state,\n                dialogOpen: {...state.dialogOpen, [dialogId]: true},\n            };\n        }\n        case CLOSE_DIALOG: {\n            const dialogId = action.dialogId;\n            return {\n                ...state,\n                dialogOpen: {...state.dialogOpen, [dialogId]: false},\n            };\n        }\n        case CONFIGURE_SERVERS: {\n            if (state.selectedServerId !== action.selectedServerId) {\n                return {...state, selectedServerId: action.selectedServerId};\n            }\n        }\n    }\n    return state;\n}\n\nfunction selectPlace(state: ControlState, selectedPlaceId: string): ControlState {\n    let selectedPlaceGroupIds;\n    if (!state.selectedPlaceGroupIds || state.selectedPlaceGroupIds.length === 0) {\n        selectedPlaceGroupIds = ['user'];\n    } else if (state.selectedPlaceGroupIds.find(id => id === 'user')) {\n        selectedPlaceGroupIds = state.selectedPlaceGroupIds;\n    } else {\n        selectedPlaceGroupIds = [...state.selectedPlaceGroupIds, 'user']\n    }\n    return {\n        ...state,\n        selectedPlaceGroupIds,\n        selectedPlaceId,\n    };\n}","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { MessageLogState, newMessageLogState } from '../states/messageLogState';\r\n\r\nimport { HIDE_MESSAGE, MessageLogAction, POST_MESSAGE } from \"../actions/messageLogActions\";\r\n\r\nlet numMessages = 0;\r\n\r\nexport function messageLogReducer(state: MessageLogState | undefined, action: MessageLogAction): MessageLogState  {\r\n    if (state === undefined) {\r\n        state = newMessageLogState();\r\n    }\r\n    const newMessageLogEntries = state.newEntries;\r\n    switch (action.type) {\r\n        case POST_MESSAGE: {\r\n            const type = action.messageType;\r\n            const text = action.messageText;\r\n            let latestEntry = newMessageLogEntries.length ? newMessageLogEntries[0] : null;\r\n            if (latestEntry && type === latestEntry.type && text === latestEntry.text) {\r\n                return state;\r\n            }\r\n            latestEntry = {id: ++numMessages, type, text};\r\n            return {...state, newEntries: [latestEntry, ...newMessageLogEntries]}\r\n        }\r\n        case HIDE_MESSAGE: {\r\n            const i = newMessageLogEntries.findIndex(e => e.id === action.messageId);\r\n            if (i >= 0) {\r\n                const hiddenEntry = newMessageLogEntries[i];\r\n                const newEntries = [...newMessageLogEntries];\r\n                newEntries.splice(i, 1);\r\n                const oldEntries = [hiddenEntry, ...state.oldEntries];\r\n                return {...state, newEntries, oldEntries}\r\n            }\r\n        }\r\n    }\r\n    return state;\r\n}\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nexport type MessageType = \"error\" | \"warning\" | \"info\" | \"success\";\r\n\r\nexport interface MessageLogEntry {\r\n    id: number;\r\n    type: MessageType;\r\n    text: string;\r\n}\r\n\r\nexport interface MessageLogState {\r\n    newEntries: MessageLogEntry[];\r\n    oldEntries: MessageLogEntry[];\r\n}\r\n\r\nexport function newMessageLogState() {\r\n    return {\r\n        newEntries: [],\r\n        oldEntries: [],\r\n    }\r\n}\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { UPDATE_ACCESS_TOKEN, UserAuthAction } from '../actions/userAuthActions';\r\nimport { newUserAuthState, UserAuthState } from '../states/userAuthState';\r\n\r\n\r\nexport function userAuthReducer(state: UserAuthState | undefined, action: UserAuthAction): UserAuthState {\r\n    if (state === undefined) {\r\n        state = newUserAuthState();\r\n    }\r\n    switch (action.type) {\r\n        case UPDATE_ACCESS_TOKEN:\r\n            return {\r\n                ...state,\r\n                accessToken: action.accessToken,\r\n            };\r\n    }\r\n    return state!;\r\n}\r\n\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nexport interface UserAuthState {\r\n    accessToken: string | null;\r\n}\r\n\r\nexport function newUserAuthState(): UserAuthState {\r\n    return {\r\n        accessToken: null,\r\n    }\r\n}\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { AppState } from '../states/appState';\r\n\r\nimport { dataReducer } from './dataReducer';\r\nimport { DataAction } from \"../actions/dataActions\";\r\n\r\nimport { controlReducer } from './controlReducer';\r\nimport { ControlAction } from \"../actions/controlActions\";\r\n\r\nimport { messageLogReducer } from './messageLogReducer';\r\nimport { MessageLogAction } from \"../actions/messageLogActions\";\r\n\r\nimport { userAuthReducer } from './userAuthReducer';\r\nimport { UserAuthAction } from '../actions/userAuthActions';\r\n\r\n\r\nexport function appReducer(state: AppState | undefined,\r\n                           action: DataAction\r\n                               & ControlAction\r\n                               & MessageLogAction\r\n                               & UserAuthAction): AppState {\r\n    // Not using redux.combineReducers(), because we need to pass app state into controlReducer()\r\n    return {\r\n        dataState: dataReducer(state && state.dataState, action),\r\n        controlState: controlReducer(state && state.controlState, action, state),\r\n        messageLogState: messageLogReducer(state && state.messageLogState, action),\r\n        userAuthState: userAuthReducer(state && state.userAuthState, action),\r\n    };\r\n}\r\n\r\n","/*\r\n * The MIT License (MIT)\r\n *\r\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n * of the Software, and to permit persons to whom the Software is furnished to do\r\n * so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\n// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      process.env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker === null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 by the xcube development team and contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport * as Redux from 'redux';\nimport * as ReduxLogger from 'redux-logger';\nimport thunk from 'redux-thunk';\n\nimport './index.css';\nimport { changeLocale } from './actions/controlActions';\nimport { syncWithServer } from './actions/dataActions';\nimport { Config } from './config';\nimport App from './connected/App';\nimport { appReducer } from './reducers/appReducer';\nimport * as serviceWorker from './serviceWorker';\n\n\nConfig.load().then(() => {\n    const logger = ReduxLogger.createLogger({collapsed: true, diff: false});\n    const store = Redux.createStore(appReducer, Redux.applyMiddleware(thunk, logger));\n\n    store.dispatch(changeLocale(store.getState().controlState.locale) as any);\n\n    if (store.getState().controlState.privacyNoticeAccepted) {\n        store.dispatch(syncWithServer() as any);\n    }\n\n    ReactDOM.render(\n        <Provider store={store}>{<App/>}</Provider>,\n        document.getElementById('root') as HTMLElement\n    );\n\n    // If you want your app to work offline and load faster, you can change\n    // unregister() to register() below. Note this comes with some pitfalls.\n    // Learn more about service workers: https://bit.ly/CRA-PWA\n    serviceWorker.unregister();\n});\n"],"sourceRoot":""}