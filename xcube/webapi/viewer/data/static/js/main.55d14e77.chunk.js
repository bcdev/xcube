(this["webpackJsonpxcube-viewer"]=this["webpackJsonpxcube-viewer"]||[]).push([[0],{327:function(e){e.exports=JSON.parse('{"name":"default","server":{"id":"local","name":"Local Server","url":"http://localhost:8080"},"branding":{"appBarTitle":"xcube Viewer","windowTitle":"xcube Viewer","windowIcon":null,"compact":false,"themeName":"light","primaryColor":"blue","secondaryColor":"pink","organisationUrl":"https://xcube.readthedocs.io/","logoImage":"images/logo.png","logoWidth":32,"baseMapUrl":"https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}","defaultAgg":"mean","polygonFillOpacity":0.2,"mapProjection":"EPSG:3857","allowDownloads":true,"allowRefresh":true,"allowViewModePython":true,"allow3D":true}}')},516:function(e){e.exports=JSON.parse('{"languages":{"en":"English","de":"Deutsch","se":"Svenska"},"dictionary":[{"en":"OK","de":"OK","se":"OK"},{"en":"Cancel","de":"Abbrechen","se":"Avbryt"},{"en":"Save","de":"Speichern","se":"Spara"},{"en":"Select","de":"Ausw\xe4hlen","se":"V\xe4lj"},{"en":"Add","de":"Hinzuf\xfcgen","se":"L\xe4gg till"},{"en":"Edit","de":"Bearbeiten","se":"Redigera"},{"en":"Remove","de":"Entfernen","se":"Ta bort"},{"en":"Dataset","de":"Datensatz","se":"Dataset"},{"en":"Variable","de":"Variable","se":"Variabel"},{"en":"My places","de":"Meine Orte","se":"Mina platser"},{"en":"Loading places","de":"Lade Orte","se":"Laddar platser"},{"en":"Places","de":"Orte","se":"Platser"},{"en":"Place","de":"Ort","se":"Plats"},{"en":"Time","de":"Zeit","se":"Tid"},{"en":"Missing time axis","de":"Fehlende Zeitachse","se":"Saknar tidsaxel"},{"en":"Geometry type","de":"Geometry-Typ","se":"Geometri typ"},{"en":"Point","de":"Punkt","se":"Punkt"},{"en":"Polygon","de":"Polygon","se":"Polygon"},{"en":"Circle","de":"Kreis","se":"Cirkel"},{"en":"Multi","de":"Multi","se":"Multi"},{"en":"Something went wrong.","de":"Irgendetwas lief schief.","se":"N\xe5got gick fel."},{"en":"Time-Series","de":"Zeitserie","se":"Tidsserier"},{"en":"unknown units","de":"unbekannte Einheiten","se":"ok\xe4nda enheter"},{"en":"Values","de":"Werte","se":"V\xe4rden"},{"en":"Start","de":"Start","se":"Start"},{"en":"Stop","de":"Stopp","se":"Stopp"},{"en":"Please wait...","de":"Bitte warten...","se":"V\xe4nta ..."},{"en":"Loading data","de":"Lade Daten","se":"Laddar data"},{"en":"Connecting to server","de":"Verbindung zum Server wird hergestellt","se":"Ansluta till servern"},{"en":"Cannot reach server","de":"Kann Server nicht erreichen","se":"Kan inte n\xe5 servern"},{"en":"Language","de":"Sprache","se":"Spr\xe5k"},{"en":"Settings","de":"Einstellungen","se":"Inst\xe4llningar"},{"en":"General","de":"Allgemein","se":"Allm\xe4nhet"},{"en":"System Information","de":"Systeminformation","se":"Systeminformation"},{"en":"version","de":"Version","se":"Version"},{"en":"Server","de":"Server","se":"Server"},{"en":"Add Server","de":"Server hinzuf\xfcgen","se":"L\xe4gg till server"},{"en":"Edit Server","de":"Server bearbeiten","se":"Redigera server"},{"en":"Select Server","de":"Server ausw\xe4hlen","se":"V\xe4lj server"},{"en":"On","de":"An","se":"P\xe5"},{"en":"Off","de":"Aus","se":"Av"},{"en":"Time interval of the player","de":"Zeitintervall des Abspielers","se":"Spelarens tidsintervall"},{"en":"Show graph after adding a place","de":"Graph anzeigen, nachdem ein Ort hinzugef\xfcgt wurde","se":"Visa diagram efter att du har lagt till en plats"},{"en":"Show dots only, hide lines","de":"Nur Punkte anzeigen, Linien ausblenden","se":"Visa bara punkter, d\xf6lj linjer"},{"en":"Show error bars","de":"Fehlerbalken anzeigen","se":"Visa felstaplar"},{"en":"Show median instead of mean (disables error bars)","de":"Median statt Mittelwert anzeigen (deaktiviert Fehlerbalken)","se":"Visa median i st\xe4llet f\xf6r medelv\xe4rde (inaktiverar felf\xe4lt)"},{"en":"Minimal number of data points in a time series update","de":"Minimale Anzahl Datenpunkte in einer Zeitreihen-Aktualisierung","se":"Minimalt antal datapunkter i en tidsserieuppdatering"},{"en":"Map","de":"Karte","se":"Karta"},{"en":"Projection","de":"Projektion","se":"Projektion"},{"en":"Geographic","de":"Geografisch","se":"Geografiskt"},{"en":"Mercator","de":"Mercator","se":"Mercator"},{"en":"Image smoothing","de":"Bildgl\xe4ttung","se":"Bildutj\xe4mning"},{"en":"Show dataset boundaries","de":"Datensatzgrenzen anzeigen","se":"Visa dataupps\xe4ttningsgr\xe4nser"},{"en":"Base map","de":"Basiskarte","se":"Grundkarta"},{"en":"Hide small values","de":"Kleine Werte ausblenden","se":"D\xf6lja sm\xe5 v\xe4rden"},{"en":"Reverse","de":"Umkehren","se":"Omv\xe4nt"},{"en":"Opacity","de":"Opazit\xe4t","se":"Opacitet"},{"en":"Dataset information","de":"Informationen zum Datensatz","se":"Information om dataset"},{"en":"Variable information","de":"Informationen zur Variablen","se":"Information om variabeln"},{"en":"Place information","de":"Informationen zum Ort","se":"Platsinformation"},{"en":"Dimension names","de":"Namen der Dimensionen","se":"Dimensioner namn"},{"en":"Dimension data types","de":"Datentypen der Dimensionen","se":"Dimensionsdatatyper"},{"en":"Dimension lengths","de":"L\xe4nge der Dimensionen","se":"M\xe5ttl\xe4ngder"},{"en":"Time chunk size","de":"Zeitblockgr\xf6\xdfe","se":"Tidsblockstorlek"},{"en":"Geographical extent","de":"Geografische Ausdehnung","se":"Geografisk omfattning"},{"en":"Spatial reference system","de":"R\xe4umliches Bezugssystem","se":"Rumsligt referenssystem"},{"en":"Name","de":"Name","se":"Namn"},{"en":"Title","de":"Titel","se":"Titel"},{"en":"Units","de":"Einheiten","se":"Enheter"},{"en":"Data type","de":"Datentyp","se":"Datatyp"},{"en":"There is no information available for this location.","de":"Zu diesem Ort sind keine keine Informationen vorhanden.","se":"Det finns ingen information tillg\xe4nglig f\xf6r den h\xe4r platsen."},{"en":"Log out","de":"Abmelden","se":"Logga ut"},{"en":"Profile","de":"Profil","se":"Profil"},{"en":"User Profile","de":"Nutzerprofil","se":"Anv\xe4ndarprofil"},{"en":"User name","de":"Nutzername","se":"Anv\xe4ndarnamn"},{"en":"E-mail","de":"E-mail","se":"E-post"},{"en":"Nickname","de":"Spitzname","se":"Smeknamn"},{"en":"verified","de":"verifiziert","se":"verified"},{"en":"not verified","de":"nicht verifiziert","se":"inte verifierad"},{"en":"RGB","de":"RGB","se":"RGB"},{"en":"Imprint","de":"Impressum","se":"Avtryck"},{"en":"User Manual","de":"Benutzerhandbuch","se":"Anv\xe4ndarmanual"},{"en":"Show time-series diagram","de":"Zeitserien-Diagramm anzeigen","se":"Visa tidsseriediagram"},{"en":"Help","de":"Hilfe","se":"Hj\xe4lp"},{"en":"Export data","de":"Daten exportieren","se":"Exportera data"},{"en":"Export Settings","de":"Export-Einstellungen","se":"Exportera Inst\xe4llningar"},{"en":"Include time-series data","de":"Zeitseriendaten einschlie\xdfen","se":"Inkludera tidsseriedata"},{"en":"Include places data","de":"Ortsdaten einschlie\xdfen","se":"Inkludera platsdata"},{"en":"File name","de":"Dateiname","se":"Filnamn"},{"en":"Separator for time-series data","de":"Trennzeichen f\xfcr Zeitreihendaten","se":"Separator f\xf6r tidsseriedata"},{"en":"Combine place data in one file","de":"Ortsdaten in einer Datei zusammenfassen","se":"Kombinera platsdata i en fil"},{"en":"As ZIP archive","de":"Als ZIP-Archiv","se":"Som ett ZIP-arkiv"},{"en":"Download","de":"Herunterladen","se":"Ladda ner"},{"en":"Show selected place in map","de":"Ausgew\xe4hlten Ort in der Karte anzeigen","se":"Visa vald plats p\xe5 kartan"},{"en":"Open information panel","de":"Informationsfeld \xf6ffnen","se":"\xd6ppet informationsf\xe4lt"},{"en":"Select a place in map","de":"Ort in der Karte ausw\xe4hlen","se":"V\xe4lj plats p\xe5 kartan"},{"en":"Add a point location in map","de":"Punkt zur Karte hinzuf\xfcgen","se":"L\xe4gg till punkt p\xe5 kartan"},{"en":"Draw a polygon area in map","de":"Polygonale Fl\xe4che in der Karte zeichnen","se":"Rita en polygonal yta p\xe5 kartan"},{"en":"Draw a circular area in map","de":"Kreisf\xf6rmige Fl\xe4che in der Karte zeichnen","se":"Rita ett cirkul\xe4rt omr\xe5de p\xe5 kartan"},{"en":"Remove place","de":"Ort entfernen","se":"Ta bort plats"},{"en":"Remove places","de":"Orte entfernen","se":"Ta bort platser"},{"en":"Show RGB layer instead","de":"Stattdessen RGB-Layer anzeigen","se":"Visa RGB-lager ist\xe4llet"},{"en":"Auto-step through times in the dataset","de":"Zeiten im Datensatz automatisch durchlaufen","se":"K\xf6r automatiskt genom tider i dataposten"},{"en":"Select time in dataset","de":"Datensatz-Zeit ausw\xe4hlen","se":"V\xe4lj tid i dataset"},{"en":"Refresh","de":"Aktualisieren","se":"Att uppdatera"},{"en":"Accept and continue","de":"Akzeptieren und weiter","se":"Acceptera och forts\xe4tt"},{"en":"Leave","de":"Verlassen","se":"L\xe4mna"},{"en":"Import geometry","de":"Import geometry","se":"Importera geometri"},{"en":"Add Places","de":"Orte hinzuf\xfcgen","se":"L\xe4gg till Platser"},{"en":"Text/CSV","de":"Text/CSV","se":"Text/CSV"},{"en":"GeoJSON","de":"GeoJSON","se":"GeoJSON"},{"en":"WKT","de":"WKT","se":"WKT"},{"en":"Enter text or drag & drop a text file.","de":"Text eingeben oder Textdatei per Drag & Drop einf\xfcgen.","se":"Skriv in text eller dra och sl\xe4pp en textfil."},{"en":"From File","de":"Aus Datei","se":"Fr\xe5n fil"},{"en":"Clear","de":"L\xf6schen","se":"T\xf6mma"},{"en":"Options","de":"Optionen","se":"Alternativ"},{"en":"Label","de":"Label","se":"Etikett"},{"en":"Label property names","de":"Eigenschaftsnamen f\xfcr Label","se":"Etikett egendomsnamn"},{"en":"Label prefix (used as fallback)","de":"Label-Pr\xe4fix (als Fallback verwendet)","se":"Etikettprefix (anv\xe4nds som reserv)"},{"en":"X/longitude column name","de":"Spaltenname f\xfcr y/L\xe4ngengrad","se":"X/longitud kolumnnamn"},{"en":"Y/latitude column name","de":"Spaltenname f\xfcr y/Breitengrad","se":"Y/latitud kolumnnamn"},{"en":"Geometry column name","de":"Spaltenname f\xfcr Geometrie","se":"Geometrikolumnnamn"},{"en":"Label column name","de":"Spaltenname f\xfcr Label","se":"Etikettkolumnnamn"},{"en":"Separator character","de":"Trennzeichen","se":"Skiljetecken"},{"en":"Comment character","de":"Kommentar-Zeichen","se":"Kommentar karakt\xe4r"},{"en":"Quote character","de":"Zitierzeichen","se":"Citat karakt\xe4r"},{"en":"Escape character","de":"Escape character","se":"Escape karakt\xe4r"},{"en":"Not-a-number token","de":"Token f\xfcr \'keine Zahl\'","se":"Not-a-number token"},{"en":"True token","de":"Token f\xfcr \'wahr\'","se":"Sann token"},{"en":"False token","de":"Token f\xfcr \'falsch\'","se":"Falsk token"},{"en":"Revoke consent","de":"Zustimmung widerrufen","se":"\xc5terkalla samtycke "},{"en":"Legal Agreement","de":"Rechtliches \xdcbereinkommen","se":"Laglig \xd6verenskommelse"},{"en":"Privacy Notice","de":"Datenschutzhinweis","se":"Sekretessmeddelande"},{"en":"legal/privacy-note.en.md","de":"legal/privacy-note.de.md","se":"legal/privacy-note.se.md"}]}')},520:function(e){e.exports=JSON.parse('[{"name":"OpenStreetMap","link":"https://openstreetmap.org","datasets":[{"name":"OSM Mapnik","endpoint":"https://a.tile.osm.org/{z}/{x}/{y}.png"},{"name":"OSM Humanitarian","endpoint":"https://a.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"}],"overlays":[]},{"name":"ESRI","link":"https://services.arcgisonline.com/arcgis/rest/services","datasets":[{"name":"Dark Gray Base","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}"},{"name":"Light Gray Base","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}"},{"name":"World Hillshade","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}"},{"name":"World Ocean Base","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}"},{"name":"DeLorme World Base Map","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/Specialty/DeLorme_World_Base_Map/MapServer/tile/{z}/{y}/{x}"},{"name":"World Street Map","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"},{"name":"World Navigation Charts","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/Specialty/World_Navigation_Charts/MapServer/tile/{z}/{y}/{x}"},{"name":"National Geographic","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}"},{"name":"World Imagery","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"},{"name":"World Physical Map","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}"},{"name":"World Shaded Relief","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}"},{"name":"World Terrain","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}"},{"name":"World Topo Map","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"}],"overlays":[{"name":"Dark Gray Reference","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}"},{"name":"Light Gray Reference","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}"},{"name":"World Ocean Reference","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}"},{"name":"World Boundaries & Places","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}"},{"name":"World Reference Overlay","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}"},{"name":"World Transportation","endpoint":"https://services.arcgisonline.com/arcgis/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}"}]},{"name":"CartoDB","link":"https://cartodb.com/basemaps/","datasets":[{"name":"Positron","endpoint":"https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"},{"name":"Dark Matter","endpoint":"https://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png"},{"name":"Positron (No Labels)","endpoint":"https://a.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png"},{"name":"Dark Matter (No Labels)","endpoint":"https://a.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}.png"}],"overlays":[{"name":"Positron Labels","endpoint":"https://a.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png"},{"name":"Dark Matter Labels","endpoint":"https://a.basemaps.cartocdn.com/dark_only_labels/{z}/{x}/{y}.png"}]}]')},680:function(e,t,n){},684:function(e,t,n){},711:function(e,t){},751:function(e,t,n){},884:function(e,t,n){},885:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(112),o=n(45),s=n(454),c=n(514),l=n(515),u=(n(680),n(7)),d=n(149),p=n(2),m=n(4),h=function(){function e(t){Object(p.a)(this,e),this._languages=void 0,this._content=void 0,this._locale=void 0;var n=Object.getOwnPropertyNames(t.languages);if(n.findIndex((function(e){return"en"===e}))<0)throw new Error('Internal error: locale "en" must be included in supported languages');var a={};t.dictionary.forEach((function(e,t){n.forEach((function(n){if(!e[n])throw new Error("Internal error: invalid entry at index ".concat(t,' in "./resources/lang.json":')+' missing translation for locale: "'.concat(n,'": ').concat(e))}));var r=f(e.en);a[r]&&console.warn('Translation already defined for "'.concat(e.en,'".')),a[r]=e})),this._languages=t.languages,this._content=a,this._locale="en"}return Object(m.a)(e,[{key:"languages",get:function(){return this._languages}},{key:"locale",get:function(){return this._locale},set:function(e){var t=Object.getOwnPropertyNames(this._languages);if(t.findIndex((function(t){return t===e}))<0){var n=e.split("-")[0];if(t.findIndex((function(e){return e===n}))<0)return void console.error('No translation found for locale "'.concat(e,'", staying with "').concat(this._locale,'".'));console.warn('No translation found for locale "'.concat(e,'", falling back to "').concat(n,'".')),e=n}this._locale=e}},{key:"get",value:function(e,t){var n,a=f(e),r=this._content[a];return r?(n=r[this._locale])||(console.warn('missing translation of phrase "'.concat(e,'" for locale "').concat(this._locale,'"')),n=e):(console.warn('missing translation for phrase "'.concat(e,'"')),n=e),t&&Object.keys(t).forEach((function(e){n=n.replace("${"+e+"}","".concat(t[e]))})),n}}]),e}(),f=function(e){return e.toLowerCase()},b=new h(n(516));b.locale=(navigator.languages&&navigator.languages.length>0?navigator.languages[0]:navigator.language||navigator.userLanguage||navigator.browserLanguage||"en").split("-")[0];var v=b,g=n(9),j=n(10),O=n(171),x=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(e,a){var r;return Object(p.a)(this,n),(r=t.call(this,a)).statusCode=void 0,r.statusCode=e,r}return n}(Object(O.a)(Error));function y(e){return e?{headers:[["Authorization","Bearer ".concat(e)]]}:{}}function w(e,t){if(t.length>0){var n=t.map((function(e){return e.map(encodeURIComponent).join("=")})).join("&");return e.includes("?")?e.endsWith("&")?e+n:e+"&"+n:e+"?"+n}return e}function S(e,t){return function(e,t){return fetch(e,t).then((function(e){if(!e.ok)throw new x(e.status,e.statusText);return e})).catch((function(t){throw t instanceof TypeError?(console.error("Server did not respond for ".concat(e,". ")+"May be caused by timeout, refused connection, network error, etc.",t),new Error(v.get("Cannot reach server"))):(console.error(t),t)}))}(e,t).then((function(e){return e.json()}))}function T(e){var t=[],n={};return e.forEach((function(e){var a=e[0],r=e[1],i=[];e[2].forEach((function(e){var t=e[0],a=e[1];i.push(t),n[t]=a})),t.push({title:a,description:r,names:i})})),{groups:t,images:n}}var C=n(8),k=n(26);function P(e){return e.map(E)}function E(e){if(e.dimensions&&e.dimensions.length){var t=e.dimensions,n=t.findIndex((function(e){return"time"===e.name}));if(n>-1){var a=t[n],r=a.coordinates;if(r&&r.length&&"string"===typeof r[0]){var i=r,o=i.map((function(e){return new Date(e).getTime()}));return(t=Object(k.a)(t))[n]=Object(C.a)(Object(C.a)({},a),{},{coordinates:o,labels:i}),Object(C.a)(Object(C.a)({},e),{},{dimensions:t})}}}return e}function _(e,t,n,a){var r=y(a),i=encodeURIComponent(t),o=encodeURIComponent(n);return S("".concat(e,"/datasets/").concat(i,"/places/").concat(o),r)}var I=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return n}(Object(O.a)(Error));function N(e,t){!function(e,t){if(null===e)throw new I("assertion failed: ".concat(t," must not be null"))}(e,t),function(e,t){if("undefined"===typeof e)throw new I("assertion failed: ".concat(t," must not be undefined"))}(e,t)}function M(e,t){if(function(e,t){if(!Array.isArray(e))throw new I("assertion failed: ".concat(t," must be an array"))}(e,t),0===e.length)throw new I("assertion failed: ".concat(t," must be a non-empty array"))}function A(e,t){return t&&e.find((function(e){return e.id===t}))||null}function L(e,t){return t&&e.variables.find((function(e){return e.name===t}))||null}function R(e){N(e,"dataset"),M(e.dimensions,"dataset.dimensions");var t=e.dimensions.find((function(e){return"time"===e.name}));return t?(M(t.coordinates,"timeDimension.coordinates"),M(t.labels,"timeDimension.labels"),t):null}function D(e){var t=R(e);if(!t)return null;var n=t.coordinates;return[n[0],n[n.length-1]]}var z=n(58),B=n(455),F=n(99),V=n(142),G=n(11),U=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return n}(Object(O.a)(Error)),W={separator:",",comment:"#",quote:'"',escape:"\\",trim:!0,nanToken:"NaN",trueToken:"true",falseToken:"false"};function H(e,t){return new K(t).parse(e)}var K=function(){function e(t){Object(p.a)(this,e),this.options=void 0,this.options=Object(C.a)(Object(C.a)({},W),t),this.parseLine=this.parseLine.bind(this)}return Object(m.a)(e,[{key:"parse",value:function(e){return this.parseText(e).map(this.parseLine)}},{key:"parseText",value:function(e){var t=this.options,n=t.comment,a=t.trim;return e.split("\n").map((function(e,t){return a&&(e=e.trim()),[e,t]})).filter((function(e){var t=Object(G.a)(e,2),a=t[0];t[1];return""!==a.trim()&&!a.startsWith(n)}))}},{key:"parseLine",value:function(e){for(var t,n,a=Object(G.a)(e,2),r=a[0],i=a[1],o=this.options,s=o.separator,c=o.quote,l=o.escape,u=!1,d=[],p=0,m=0;m<r.length;m++){var h=r[m];h===l?m++:u?h===c&&(u=!1):h===c?u=!0:h===s&&(this.collectValue(r,p,m,d),p=m+1)}if(u)throw t="missing quote character [".concat(this.options.quote,"]"),n=p,new U("line ".concat(i+1,", column ").concat(n+1,": ").concat(t));return this.collectValue(r,p,m,d),d}},{key:"collectValue",value:function(e,t,n,a){var r=e.slice(t,n);a.push(this.parseToken(r))}},{key:"parseToken",value:function(e){var t=this.options;if(t.trim&&(e=e.trim()),""===e)return null;if(e.startsWith(t.quote))e=e.substring(1,e.length-1);else{if(e===t.trueToken)return!0;if(e===t.falseToken)return!1;if(e===t.nanToken)return Number.NaN;var n=parseFloat(e);if(!Number.isNaN(n))return n}return function(e,t){var n=e.indexOf(t);if(n<0)return e;for(var a=0,r="";n<e.length;n++)e[n]===t&&(r+=e.substring(a,n)+e.substring(n+1,n+2),a=n+=2);return r+=e.substring(a,e.length)}(e,t.escape)}}]),e}();var Z={name:"Text/CSV",fileExt:".txt,.csv",checkError:function(e){if(""!==e.trim())try{H(e)}catch(t){return console.error(t),"".concat(t)}return null}},Y=Object(C.a)(Object(C.a)({},W),{},{xName:"longitude",yName:"latitude",forceGeometry:!1,geometryName:"geometry",labelName:"name",labelPrefix:"CSV-"}),q={name:"GeoJSON",fileExt:".json,.geojson",checkError:function(e){if(""!==e.trim())try{JSON.parse(e)}catch(t){return console.error(t),"".concat(t)}return null}},X={labelNames:"label, name, title, id",labelPrefix:"GeoJSON-"},J={name:"WKT",fileExt:".txt,.wkt",checkError:function(e){return null}},Q={label:"",labelPrefix:"WKT-"};function $(){return(Math.random().toString(16).substr(2)+"-"+Date.now().toString(16)).toUpperCase()}var ee=n(70),te=n.n(ee),ne=n(201),ae=n(971),re=n(252),ie=n(969),oe=n(250),se=n(249),ce=n(288),le=n(968),ue=n(251),de=n(966),pe=n(963),me=n(965),he=n(327),fe=n(960),be=n(248),ve=n(961),ge=n(962),je=n(964),Oe=n(517),xe=n(967),ye=n(970);var we=function(){var e=new URL(window.location.href),t=e.pathname.split("/"),n=t.length;return n>0?"index.html"===t[n-1]?new URL(t.slice(0,n-1).join("/"),window.location.origin):new URL(e.pathname,window.location.origin):new URL(window.location.origin)}(),Se=we;function Te(e){for(var t=e,n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];for(var i=0,o=a;i<o.length;i++){var s=o[i];""!==s&&(t.endsWith("/")?s.startsWith("/")?t+=s.substr(1):t+=s:s.startsWith("/")?t+=s:t+="/"+s)}return t}console.log("baseUrl = ",we.href);var Ce={amber:fe.a,blue:be.a,blueGrey:ve.a,brown:ge.a,cyan:pe.a,deepOrange:je.a,deepPurple:me.a,green:se.a,grey:Oe.a,indigo:de.a,lightBlue:oe.a,lightGreen:xe.a,lime:le.a,orange:ce.a,pink:ie.a,purple:ue.a,red:re.a,teal:ye.a,yellow:ae.a};function ke(e,t){var n=e[t],a=null;if("string"===typeof n?null!==(a=Ce[n]||null)||!n.startsWith("#")||7!==n.length&&9!==n.length||(a={main:n}):"object"===typeof n&&n.hasOwnProperty("main")&&(a=n),null===a)throw new Error("Value of branding.".concat(t," is invalid: ").concat(n));e[t]=a}function Pe(e,t){return ke(e=Object(C.a)({},e),"primaryColor"),ke(e,"secondaryColor"),function(e,t,n){var a=e[t];"string"===typeof a&&(e[t]=Te(Se.href,n,a))}(e,"logoImage",t),e}var Ee=new URLSearchParams(window.location.search),_e=function(){function e(t,n,a,r){Object(p.a)(this,e),this.name=void 0,this.server=void 0,this.branding=void 0,this.authClient=void 0,this.name=t,this.server=n,this.branding=a,this.authClient=r}return Object(m.a)(e,null,[{key:"load",value:function(){var t=Object(ne.a)(te.a.mark((function t(){var n,a,r,i,o,s,c;return te.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ee.get("configPath")||"config",t.next=3,this.loadRawConfig(n);case 3:return(a=t.sent)===he&&(n=""),r=a.name||"default",i=this.getAuthConfig(a),o=this.getServerConfig(a),s=0!==parseInt(Ee.get("compact")||"0"),(c=Pe(Object(C.a)(Object(C.a)(Object(C.a)({},he.branding),a.branding),{},{compact:s||!!a.branding.compact}),n)).allow3D=!!parseInt(Ee.get("allow3D")||"0")||c.allow3D,e._instance=new e(r,o,c,i),c.windowTitle&&this.changeWindowTitle(c.windowTitle),c.windowIcon&&this.changeWindowIcon(c.windowIcon),t.abrupt("return",e._instance);case 16:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getAuthConfig",value:function(t){var n=t.authClient&&Object(C.a)({},t.authClient),a=e.getAuthClientFromEnv();return!n&&a.authority&&a.clientId&&(n={authority:a.authority,client_id:a.clientId}),n&&(a.authority&&(n=Object(C.a)(Object(C.a)({},n),{},{authority:a.authority})),a.clientId&&(n=Object(C.a)(Object(C.a)({},n),{},{client_id:a.clientId})),a.audience&&(n=Object(C.a)(Object(C.a)({},n),{},{extraQueryParams:Object(C.a)(Object(C.a)({},n.extraQueryParams),{},{audience:a.audience})}))),n}},{key:"getServerConfig",value:function(t){var n=Object(C.a)(Object(C.a)({},he.server),t.server),a=e.getApiServerFromEnv();return n.id=Ee.get("serverId")||a.id||n.id,n.name=Ee.get("serverName")||a.name||n.name,n.url=Ee.get("serverUrl")||a.url||n.url,n}},{key:"loadRawConfig",value:function(){var e=Object(ne.a)(te.a.mark((function e(t){var n,a,r,i,o;return te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,null,a=Te(Se.href,t,"config.json"),e.prev=3,e.next=6,fetch(a);case 6:if(!(r=e.sent).ok){e.next=14;break}return e.next=10,r.json();case 10:n=e.sent,e.next=17;break;case 14:i=r.status,o=r.statusText,"HTTP status ".concat(i),o&&" (".concat(o,")");case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(3),n=null,"".concat(e.t0);case 23:return null===n&&(n=he),e.abrupt("return",n);case 25:case"end":return e.stop()}}),e,null,[[3,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"instance",get:function(){return e.assertConfigLoaded(),e._instance}},{key:"assertConfigLoaded",value:function(){if(!e._instance)throw new Error("internal error: configuration not available yet")}},{key:"changeWindowTitle",value:function(e){document.title=e}},{key:"changeWindowIcon",value:function(e){var t=document.querySelector('link[rel="icon"]');null!==t?t.href=e:((t=document.createElement("link")).rel="icon",t.href=e,document.head.appendChild(t))}},{key:"getAuthClientFromEnv",value:function(){return{authority:Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_OAUTH2_AUTHORITY,clientId:Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_OAUTH2_CLIENT_ID,audience:Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_OAUTH2_AUDIENCE}}},{key:"getApiServerFromEnv",value:function(){return{id:Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SERVER_ID,name:Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SERVER_NAME,url:Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SERVER_URL}}}]),e}();_e._instance=void 0;var Ie=[["yellow",ae.a],["red",re.a],["pink",ie.a],["lightBlue",oe.a],["green",se.a],["orange",ce.a],["lime",le.a],["purple",ue.a],["indigo",de.a],["cyan",pe.a],["deepPurple",me.a]],Ne=function(){var e={};return Ie.forEach((function(t){var n=Object(G.a)(t,2),a=n[0],r=n[1];e[a]=r})),e}(),Me=Ie.map((function(e){var t=Object(G.a)(e,2),n=t[0];t[1];return n}));function Ae(e){return Me[e%Me.length]}function Le(e,t){var n=function(e){return"light"===e?800:400}(t);return Ne[e][n]}var Re={Mapbox:{param:"access_token",token:"pk.eyJ1IjoiZm9ybWFuIiwiYSI6ImNrM2JranV0bDBtenczb2szZG84djh6bWUifQ.q0UKwf4CWt5fcQwIDwF8Bg"}};var De=We(["label","title","name","id"]),ze=We(["description","desc","abstract","comment"]),Be=We(["color"]),Fe=We(["image","img","picture","pic"]);var Ve=Object(z.b)((function(e,t){var n={};return Ge(n,e,t,"label",t.id+"",De),Ge(n,e,t,"color",Ae(function(e){var t,n=e.id+"",a=0;if(0===n.length)return a;for(t=0;t<n.length;t++)a=(a<<5)-a+n.charCodeAt(t),a|=0;return a}(t)),Be),Ge(n,e,t,"image",null,Fe),Ge(n,e,t,"description",null,ze),Object(C.a)({placeGroup:e,place:t},n)}));function Ge(e,t,n,a,r,i){var o,s=t.propertyMapping&&t.propertyMapping[a];if(s){if(s.includes("${"))return void(e[a]=function(e,t){var n=t;if(e.properties){var a,r=Object(u.a)(Object.getOwnPropertyNames(e.properties));try{for(r.s();!(a=r.n()).done;){var i=a.value;if(!n.includes("${"))break;var o="${"+i+"}";n.includes(o)&&(n=n.replace(o,"".concat(e.properties[i])))}}catch(s){r.e(s)}finally{r.f()}}return n}(n,s));i.length>0&&i[0]!==s&&(i=[s].concat(Object(k.a)(i)))}n.properties&&(o=Ue(n.properties,i)),void 0===o&&(o=Ue(n,i)),e[a]=o||r}function Ue(e,t){var n,a=Object(u.a)(t);try{for(a.s();!(n=a.n()).done;){var r=n.value;if(r in e)return e[r]}}catch(i){a.e(i)}finally{a.f()}}function We(e){var t,n=[],a=Object(u.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;n=n.concat(r.toLowerCase(),r.toUpperCase(),r[0].toUpperCase()+r.substr(1).toLowerCase())}}catch(i){a.e(i)}finally{a.f()}return n}function He(e,t){e.forEach((function(e){Ke(e)&&e.features.forEach((function(n){t(e,n)}))}))}function Ke(e){return!!e.features}function Ze(e,t){if(!t||!Ke(e))return null;var n=e.features.find((function(e){return e.id===t}));if(n)return n;var a=e.placeGroups;if(a)for(var r in a){var i=Ze(a[r],t);if(i)return i}return null}function Ye(e,t){if(t){var n,a=Object(u.a)(e);try{for(a.s();!(n=a.n()).done;){var r=Ze(n.value,t);if(null!==r)return r}}catch(i){a.e(i)}finally{a.f()}}return null}var qe=0,Xe=0,Je=0;function Qe(e,t){return{type:"Feature",id:$(),geometry:(new d.a).writeGeometryObject(e),properties:t}}var $e=n(226),et=n(179),tt=n(196),nt=n(162),at=n(143),rt=n(140),it=n(315),ot=n(1);function st(e){return Object(ot.jsx)(a.Fragment,{children:e.children})}var ct=n(400),lt=n(326),ut=n(518),dt=n(323),pt=n(277),mt=(n(683),n(684),"EPSG:4326"),ht="EPSG:3857",ft=ht,bt=a.createContext({mapObjects:{}}),vt={width:"100%",height:"100%"},gt=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(e){var a;Object(p.a)(this,n),(a=t.call(this,e)).contextValue=void 0,a.clickEventsKey=null,a.handleClick=function(e){var t=a.props.onClick;t&&t(e)},a.handleDrop=function(e){if(a.props.onDropFiles){e.preventDefault();var t=[];if(e.dataTransfer.items)for(var n=0;n<e.dataTransfer.items.length;n++){var r=e.dataTransfer.items[n];if("file"===r.kind){var i=r.getAsFile();null!==i&&t.push(i)}}else if(e.dataTransfer.files)for(var o=0;o<e.dataTransfer.files.length;o++){var s=e.dataTransfer.files[o];null!==s&&t.push(s)}t.length&&a.props.onDropFiles(t)}},a.handleDragOver=function(e){a.props.onDropFiles&&e.preventDefault()},a.handleRef=function(e){a.contextValue.mapDiv=e},a.handleResize=function(){var e=a.contextValue.mapDiv,t=a.contextValue.map;if(e&&t){t.updateSize();var n=t.getView(),r=a.getMinZoom(e);r!==n.getMinZoom()&&n.setMinZoom(r)}},a.getMinZoom=function(e){var t=e.clientWidth,n=Math.LOG2E*Math.log(t/256);return n>=0?n:0};var r=e.id,i=e.mapObjects;return a.contextValue=i?{map:i[r]||void 0,mapObjects:i}:{mapObjects:{}},a}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.id,t=this.contextValue.mapDiv,n=null;if(this.props.isStale){var a=this.contextValue.mapObjects[e];a instanceof dt.a&&((n=a).setTarget(t),this.clickEventsKey&&n.un("click",this.clickEventsKey.listener))}if(!n){var r=this.getMinZoom(t),i=new pt.a({projection:ft,center:[0,0],minZoom:r,zoom:r});n=new dt.a(Object(C.a)(Object(C.a)({view:i},this.getMapOptions()),{},{target:t}))}this.contextValue.map=n,this.contextValue.mapObjects[e]=n,this.clickEventsKey=n.on("click",this.handleClick),n.updateSize(),this.forceUpdate(),window.addEventListener("resize",this.handleResize);var o=this.props.onMapRef;o&&o(n)}},{key:"componentDidUpdate",value:function(e){var t=this.contextValue.map,n=this.contextValue.mapDiv,a=this.getMapOptions();t.setProperties(Object(C.a)({},a)),t.setTarget(n),t.updateSize()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize);var e=this.props.onMapRef;e&&e(null)}},{key:"render",value:function(){var e;return this.contextValue.map&&(e=Object(ot.jsx)(bt.Provider,{value:this.contextValue,children:this.props.children})),Object(ot.jsx)("div",{ref:this.handleRef,style:vt,onDragOver:this.handleDragOver,onDrop:this.handleDrop,children:e})}},{key:"getMapOptions",value:function(){var e=Object(C.a)({},this.props);return delete e.children,delete e.onClick,delete e.onDropFiles,e}}]),n}(a.Component),jt=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).context={},e.object=null,e}return Object(m.a)(n,[{key:"getMapObject",value:function(e){return this.context.mapObjects&&this.context.mapObjects[e]||null}},{key:"getOptions",value:function(){var e=Object(C.a)({},this.props);return delete e.id,e}},{key:"componentDidMount",value:function(){this._updateMapObject(this.addMapObject(this.context.map))}},{key:"componentDidUpdate",value:function(e){this._updateMapObject(this.updateMapObject(this.context.map,this.object,e))}},{key:"componentWillUnmount",value:function(){var e=this.context.map;this.removeMapObject(e,this.object),this.props.id&&delete this.context.mapObjects[this.props.id],this.object=null}},{key:"_updateMapObject",value:function(e){null!=e&&this.props.id&&(e.set("objectId",this.props.id),this.context.mapObjects[this.props.id]=e),this.object=e}},{key:"render",value:function(){return null}}]),n}(a.PureComponent);jt.contextType=bt;var Ot;Ot=function(){};var xt=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"addMapObject",value:function(e){var t=new ct.a(this.props);return e.getLayers().push(t),t}},{key:"updateMapObject",value:function(e,t,n){var a=t.getSource(),r=this.props.source;if(r&&a!==r){var i=!0;if(a instanceof lt.a&&r instanceof lt.a){var o=a,s=r;if(function(e,t){if(Ot("tile grid:",e,t),Ot("min zoom:",e.getMinZoom(),t.getMinZoom()),Ot("max zoom:",e.getMaxZoom(),t.getMaxZoom()),e.getMinZoom()!==t.getMinZoom()||e.getMaxZoom()!==t.getMaxZoom())return!1;var n=e.getExtent(),a=t.getExtent();Ot("extent:",n,a);for(var r=0;r<n.length;r++)if(n[r]!==a[r])return!1;var i=e.getResolutions(),o=t.getResolutions();Ot("resolutions:",i,o);var s=i.length;if(s!==o.length)return!1;for(var c=0;c<s;c++){var l=e.getResolution(c),u=t.getResolution(c);if(Ot("resolution ".concat(c,":"),l,u),l!==u)return!1;var d=e.getOrigin(c),p=t.getOrigin(c);Ot("origin ".concat(c,":"),d,p);for(var m=0;m<d.length;m++)if(d[m]!==p[m])return!1;var h=e.getTileSize(c),f=t.getTileSize(c);Ot("tile size ".concat(c,":"),h,f);for(var b=0;b<d.length;b++)if("number"===typeof h&&(h=[h,h]),"number"===typeof f&&(f=[f,f]),h[0]!==f[0]||h[1]!==f[1])return!1;var v=e.getFullTileRange(c),g=t.getFullTileRange(c);if(Ot("tile range ".concat(c,":"),v,g),v&&g){if(v.getWidth()!==g.getWidth()||v.getHeight()!==g.getHeight())return!1}else if(v||g)return!1}return!0}(o.getTileGrid(),s.getTileGrid())){Ot("--\x3e Equal tile grids!");var c=o.getUrls(),l=s.getUrls();c===l||!l||null!==c&&c[0]===l[0]||(o.setUrls(l),i=!1);var u=o.getTileLoadFunction(),d=s.getTileLoadFunction();u!==d&&(o.setTileLoadFunction(d),i=!1);var p=o.getTileUrlFunction(),m=s.getTileUrlFunction();p!==m&&(o.setTileUrlFunction(m),i=!1)}else Ot("--\x3e Tile grids are not equal!")}var h=a.getContextOptions(),f=r.getContextOptions();("object"!==typeof h||h.imageSmoothing)!==("object"!==typeof f||f.imageSmoothing)&&(i=!0),i?(t.setSource(r),Ot("--\x3e Replaced source (expect flickering!)")):Ot("--\x3e Updated source (check, is it still flickering?)")}return this.props.visible&&this.props.visible!==n.visible&&t.setVisible(this.props.visible),this.props.opacity&&this.props.opacity!==n.opacity&&t.setOpacity(this.props.opacity),this.props.zIndex&&this.props.zIndex!==n.zIndex&&t.setZIndex(this.props.zIndex),this.props.minResolution&&this.props.minResolution!==n.minResolution&&t.setMinResolution(this.props.minResolution),this.props.maxResolution&&this.props.maxResolution!==n.maxResolution&&t.setMaxResolution(this.props.maxResolution),t}},{key:"removeMapObject",value:function(e,t){e.getLayers().remove(t)}}]),n}(jt);new et.a({url:"https://a.tiles.mapbox.com/v3/mapbox.natural-earth-2/{z}/{x}/{y}.png",attributions:["&copy; <a href=&quot;https://www.naturalearthdata.com/&quot;>MapBox</a>","&copy; <a href=&quot;https://www.mapbox.com/&quot;>MapBox</a> and contributors"]}),new et.a({url:"https://gis.ngdc.noaa.gov/arcgis/rest/services/web_mercator/gebco_2014_contours/MapServer/tile/{z}/{y}/{x}",attributions:["&copy; <a href=&quot;https://www.gebco.net/data_and_products/gridded_bathymetry_data/&quot;>GEBCO</a>","&copy; <a href=&quot;https://maps.ngdc.noaa.gov/&quot;>NOAHH</a> and contributors"]}),new ut.a,new et.a({url:"https://tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",attributions:["&copy; <a href=&quot;https://www.openstreetmap.org/copyright&quot;>OpenStreetMap</a> contributors"]});var yt=n(222),wt=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"addMapObject",value:function(e){var t=new yt.a(this.props);return e.getLayers().push(t),t}},{key:"updateMapObject",value:function(e,t,n){return this.props.source!==n.source&&this.props.source&&t.setSource(this.props.source),this.props.visible&&this.props.visible!==n.visible&&t.setVisible(this.props.visible),this.props.opacity&&this.props.opacity!==n.opacity&&t.setOpacity(this.props.opacity),this.props.zIndex&&this.props.zIndex!==n.zIndex&&t.setZIndex(this.props.zIndex),this.props.minResolution&&this.props.minResolution!==n.minResolution&&t.setMinResolution(this.props.minResolution),this.props.maxResolution&&this.props.maxResolution!==n.maxResolution&&t.setMaxResolution(this.props.maxResolution),t}},{key:"removeMapObject",value:function(e,t){e.getLayers().remove(t)}}]),n}(jt),St=n(519),Tt=n.n(St);function Ct(e,t){var n=e.length;if(0===n)return-1;if(1===n)return 0;var a=0,r=n-1;if(t<=e[a])return a;if(t>=e[r])return r;for(var i,o=Math.floor(n/2),s=0;s<n;s++){if(t<(i=e[o])){var c=[Math.floor((a+o)/2),o];o=c[0],r=c[1]}else{if(!(t>i))return o;var l=[o,Math.floor((o+r)/2)];a=l[0],o=l[1]}if(a===o||o===r)return Math.abs(e[a]-t)<=Math.abs(e[r]-t)?a:r}return-1}var kt=n(520),Pt=function(e){return e.dataState.datasets||[]},Et=function(e){return e.dataState.timeSeriesGroups},_t=function(e){return e.dataState.userPlaceGroup},It=function(e){return e.dataState.userServers||[]},Nt=Object(z.a)(Pt,_t,(function(e,t){var n={},a=[t];return e.forEach((function(e){e.placeGroups&&e.placeGroups.forEach((function(e){n[e.id]||(n[e.id]=e,a.push(e))}))})),a}));function Mt(e){return At("localStorage",e)}function At(e,t){try{var n=window[e],a="__storage_test__";return n.setItem(a,a),n.removeItem(a),new Lt(n,t)}catch(r){return null}}var Lt=function(){function e(t,n){Object(p.a)(this,e),this.nativeStorage=void 0,this.brandingName=void 0,this.nativeStorage=t,this.brandingName=n}return Object(m.a)(e,[{key:"getItem",value:function(e,t,n){var a=this.nativeStorage.getItem(this.makeKey(e));return null!==a?n?n(a):a:t}},{key:"getObjectItem",value:function(e,t){return this.getItem(e,t,(function(e){return JSON.parse(e)}))}},{key:"getBooleanProperty",value:function(e,t,n){this.getProperty(e,t,n,(function(e){return"true"===e}))}},{key:"getIntProperty",value:function(e,t,n){this.getProperty(e,t,n,parseInt)}},{key:"getStringProperty",value:function(e,t,n){this.getProperty(e,t,n,(function(e){return e}))}},{key:"getObjectProperty",value:function(e,t,n){this.getProperty(e,t,n,(function(e){return JSON.parse(e)}))}},{key:"getProperty",value:function(e,t,n,a){t[e]=this.getItem(e,n[e],a)}},{key:"setItem",value:function(e,t,n){if("undefined"===typeof t||null===t)this.nativeStorage.removeItem(this.makeKey(e));else{var a=n?n(t):t+"";this.nativeStorage.setItem(this.makeKey(e),a)}}},{key:"setObjectItem",value:function(e,t){this.setItem(e,t,(function(e){return JSON.stringify(e)}))}},{key:"setPrimitiveProperty",value:function(e,t){this.setItem(e,t[e])}},{key:"setObjectProperty",value:function(e,t){this.setObjectItem(e,t[e])}},{key:"makeKey",value:function(e){return"xcube.".concat(this.brandingName,".").concat(e)}}]),e}();function Rt(e){var t=Mt(_e.instance.name);if(t)try{t.setPrimitiveProperty("locale",e),t.setPrimitiveProperty("privacyNoticeAccepted",e),t.setPrimitiveProperty("autoShowTimeSeries",e),t.setPrimitiveProperty("showTimeSeriesErrorBars",e),t.setPrimitiveProperty("showTimeSeriesPointsOnly",e),t.setPrimitiveProperty("showTimeSeriesMedian",e),t.setPrimitiveProperty("timeAnimationInterval",e),t.setPrimitiveProperty("timeChunkSize",e),t.setPrimitiveProperty("volumeCardOpen",e),t.setPrimitiveProperty("volumeRenderMode",e),t.setPrimitiveProperty("infoCardOpen",e),t.setObjectProperty("infoCardElementStates",e),t.setPrimitiveProperty("imageSmoothingEnabled",e),t.setPrimitiveProperty("mapProjection",e),t.setPrimitiveProperty("baseMapUrl",e),t.setPrimitiveProperty("exportTimeSeries",e),t.setPrimitiveProperty("exportTimeSeriesSeparator",e),t.setPrimitiveProperty("exportPlaces",e),t.setPrimitiveProperty("exportPlacesAsCollection",e),t.setPrimitiveProperty("exportZipArchive",e),t.setPrimitiveProperty("exportFileName",e),t.setPrimitiveProperty("userPlacesFormatName",e),t.setObjectProperty("userPlacesFormatOptions",e)}catch(n){console.warn("failed to store user settings: ".concat(n))}}var Dt=[250,500,1e3,2500];function zt(){var e=_e.instance.branding;return function(e){var t=Mt(_e.instance.name);if(t){var n=Object(C.a)({},e);try{t.getStringProperty("locale",n,e),t.getBooleanProperty("privacyNoticeAccepted",n,e),t.getBooleanProperty("autoShowTimeSeries",n,e),t.getBooleanProperty("showTimeSeriesErrorBars",n,e),t.getBooleanProperty("showTimeSeriesPointsOnly",n,e),t.getBooleanProperty("showTimeSeriesMedian",n,e),t.getIntProperty("timeAnimationInterval",n,e),t.getIntProperty("timeChunkSize",n,e),t.getBooleanProperty("volumeCardOpen",n,e),t.getStringProperty("volumeRenderMode",n,e),t.getBooleanProperty("infoCardOpen",n,e),t.getObjectProperty("infoCardElementStates",n,e),t.getBooleanProperty("imageSmoothingEnabled",n,e),t.getStringProperty("mapProjection",n,e),t.getStringProperty("baseMapUrl",n,e),t.getBooleanProperty("exportTimeSeries",n,e),t.getStringProperty("exportTimeSeriesSeparator",n,e),t.getBooleanProperty("exportPlaces",n,e),t.getBooleanProperty("exportPlacesAsCollection",n,e),t.getBooleanProperty("exportZipArchive",n,e),t.getStringProperty("exportFileName",n,e),t.getStringProperty("userPlacesFormatName",n,e),t.getObjectProperty("userPlacesFormatOptions",n,e)}catch(a){console.warn("Failed to load user settings: ".concat(a))}return n}return console.warn("User settings not found or access denied"),e}({selectedDatasetId:null,selectedVariableName:null,selectedPlaceGroupIds:["user"],selectedPlaceId:null,selectedUserPlaceId:null,selectedServerId:_e.instance.server.id,selectedTime:null,selectedTimeRange:null,timeSeriesUpdateMode:"add",timeAnimationActive:!1,timeAnimationInterval:1e3,timeChunkSize:20,autoShowTimeSeries:!0,showTimeSeriesPointsOnly:!1,showTimeSeriesErrorBars:!0,showTimeSeriesMedian:"median"===e.defaultAgg,userPlacesFormatName:"csv",userPlacesFormatOptions:{geojson:Object(C.a)({},X),csv:Object(C.a)({},Y),wkt:Object(C.a)({},Q)},flyTo:null,activities:{},locale:"en",dialogOpen:{},privacyNoticeAccepted:!1,mapInteraction:"Point",lastMapInteraction:"Point",showRgbLayer:!1,volumeCardOpen:!1,volumeRenderMode:"mip",volumeStates:{},infoCardOpen:!1,infoCardElementStates:{dataset:{visible:!0,viewMode:"text"},variable:{visible:!0,viewMode:"text"},place:{visible:!0,viewMode:"text"}},mapProjection:e.mapProjection||ft,imageSmoothingEnabled:!1,showDatasetBoundaries:!1,baseMapUrl:e.baseMapUrl||"http://a.tile.osm.org/{z}/{x}/{y}.png",exportTimeSeries:!0,exportTimeSeriesSeparator:"TAB",exportPlaces:!0,exportPlacesAsCollection:!0,exportZipArchive:!0,exportFileName:"export"})}var Bt={},Ft="_alpha",Vt="_r",Gt=new Image;function Ut(e){var t=e.baseName;return e.isReversed&&(t+=Vt),e.isAlpha&&(t+=Ft),t}function Wt(e,t,n){(function(e,t){return function(e,t){return new Promise((function(n,a){(t=t||new Image).onload=function(){n(t)},t.src="data:image/png;base64,".concat(e.imageData)}))}(e).then((function(n){var a=function(e,t,n){var a=document.createElement("canvas");a.width=n.width,a.height=n.height;var r=a.getContext("2d");if(null===r)return null;r.drawImage(n,0,0);var i=r.getImageData(0,0,a.width,a.height).data;if(e.isReversed){for(var o=new Uint8ClampedArray(i.length),s=0;s<i.length;s+=4){var c=i.length-s-4;o[c]=i[s],o[c+1]=i[s+1],o[c+2]=i[s+2],o[c+3]=i[s+3]}i=o}if(e.isAlpha)for(var l=512/i.length,u=0;u<i.length/2;u+=4)i[u+3]=l*u;if(t<1)for(var d=0;d<i.length;d+=4)i[d+3]*=t;return new ImageData(i,i.length/4,1)}(e,t,n);if(null!==a)return a;throw new Error("failed to retrieve 2d context")}))})(e,t).then((function(e){Promise.resolve(createImageBitmap(e)).then((function(e){var t=n.getContext("2d");if(null!==t){var a=t.createPattern(Gt,"repeat");t.fillStyle=null!==a?a:"#ffffff",t.fillRect(0,0,n.width,n.height),t.drawImage(e,0,0,n.width,n.height)}}))}))}Gt.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURcDAwP///ytph7QAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAUSURBVBjTYwABQSCglEENMxgYGAAynwRB8BEAgQAAAABJRU5ErkJggg==";var Ht=function(e){return e.controlState.selectedDatasetId},Kt=function(e){return e.controlState.selectedVariableName},Zt=function(e){return e.controlState.selectedPlaceGroupIds},Yt=function(e){return e.controlState.selectedPlaceId},qt=function(e){return e.controlState.selectedTime},Xt=function(e){return e.controlState.timeAnimationActive},Jt=function(e){return e.controlState.imageSmoothingEnabled},Qt=function(e){return e.controlState.infoCardElementStates},$t=function(e){return e.controlState.mapProjection},en=Object(z.a)(Pt,Ht,A),tn=Object(z.a)(en,(function(e){return e&&e.variables||[]})),nn=Object(z.a)(en,Kt,(function(e,t){return e&&t&&e.variables.find((function(e){return e.name===t}))||null})),an=Object(z.a)(nn,(function(e){return e&&e.units||"-"})),rn=Object(z.a)(nn,(function(e){return e?[e.colorBarMin,e.colorBarMax]:[0,1]})),on=Object(z.a)(nn,(function(e){return e&&e.colorBarName||"viridis"})),sn=Object(z.a)(on,(function(e){return e.dataState.colorBars}),(function(e,t){return function(e,t){var n=e,a=n.endsWith(Ft);a&&(n=n.slice(0,n.length-Ft.length));var r=n.endsWith(Vt);return r&&(n=n.slice(0,n.length-Vt.length)),{baseName:n,isAlpha:a,isReversed:r,imageData:t&&t.images[n]||null}}(e,t)})),cn=Object(z.a)(nn,(function(e){return e&&"number"==typeof e.opacity?e.opacity:1})),ln=Object(z.a)(en,(function(e){return null!==e?D(e):null})),un=Object(z.a)(en,(function(e){return null!==e&&e.rgbSchema||null})),dn=Object(z.a)(en,(function(e){return e&&e.placeGroups||[]})),pn=Object(z.a)(dn,_t,(function(e,t){return t.features&&0!==t.features.length?e.concat([t]):e}));function mn(e,t){var n=[];return null!==t&&t.length>0&&e.forEach((function(e){t.indexOf(e.id)>-1&&n.push(e)})),n}var hn=Object(z.a)(dn,Zt,mn),fn=Object(z.a)(pn,Zt,mn),bn=Object(z.a)(fn,(function(e){return e.map((function(e){return e.title||e.id})).join(", ")})),vn=Object(z.a)(fn,(function(e){var t,n=e.map((function(e){return Ke(e)?e.features:[]}));return(t=[]).concat.apply(t,Object(k.a)(n))})),gn=Object(z.a)(vn,Yt,(function(e,t){return e.find((function(e){return e.id===t}))||null})),jn=Object(z.a)(fn,Yt,(function(e,t){return 0===e.length||null===t?null:function(e,t){var n,a=Object(u.a)(e);try{var r=function(){var e=n.value;if(Ke(e)){var a=e.features.find((function(n){return t(e,n)}));if(a)return{v:Ve(e,a)}}};for(a.s();!(n=a.n()).done;){var i=r();if("object"===typeof i)return i.v}}catch(o){a.e(o)}finally{a.f()}return null}(e,(function(e,n){return n.id===t}))})),On=Object(z.a)(Ht,Kt,gn,(function(e,t,n){if(e&&t){if(!n)return"".concat(e,"-").concat(t,"-all");if("Polygon"===n.geometry.type||"MultiPolygon"===n.geometry.type)return"".concat(e,"-").concat(t,"-").concat(n.id)}return null})),xn=Object(z.a)(Et,Ht,Kt,Yt,(function(e,t,n,a){if(!t||!n||!a)return!1;var r,i=Object(u.a)(e);try{for(i.s();!(r=i.n()).done;){var o,s=r.value,c=Object(u.a)(s.timeSeriesArray);try{for(c.s();!(o=c.n()).done;){var l=o.value.source;if(l.datasetId===t&&l.variableName===n&&l.placeId===a)return!1}}catch(d){c.e(d)}finally{c.f()}}}catch(d){i.e(d)}finally{i.f()}return!0})),yn=Object(z.a)(Et,pn,(function(e,t){var n={};return He(t,(function(t,a){var r,i=Object(u.a)(e);try{for(i.s();!(r=i.n()).done;){if(r.value.timeSeriesArray.find((function(e){return e.source.placeId===a.id}))){n[a.id]=Ve(t,a);break}}}catch(o){i.e(o)}finally{i.f()}})),n})),wn=Object(z.a)(fn,(function(e){var t=[];return He(e,(function(e,n){t.push(Ve(e,n).label)})),t})),Sn=Object(z.a)(en,Kt,(function(e,t){return e&&L(e,t)||null})),Tn=Object(z.a)(Sn,(function(e){return e.controlState.timeChunkSize}),(function(e,t){if(e&&e.timeChunkSize){var n=e.timeChunkSize;return n*Math.ceil(t/n)}return t})),Cn=Object(z.a)(en,(function(e){return e&&R(e)||null})),kn=Object(z.a)(en,(function(e){return e&&e.attributions||null})),Pn=Object(z.a)(Cn,(function(e){return null===e||0===e.coordinates.length?null:e.coordinates})),En=Object(z.a)(qt,Pn,(function(e,t){return null===e||null===t?-1:Ct(t,e)}));var _n=Tt()((function(e){if(e)return function(t,n){e.getView().getInteracting()?e.once("moveend",(function(){t.getImage().src=n})):t.getImage().src=n}}),{serializer:function(e){var t=e[0];if(t){var n=t.getTarget();return"string"===typeof n?n:n&&n.id||"map"}return""}});function In(e,t,n,a,r,i,o,s,c,l,u,d){if(null!==s){var p;if(o){var m=Ct(o.coordinates,s);m>-1&&(p=o.labels[m])}p||(p=new Date(s).toISOString()),r=[].concat(Object(k.a)(r),[["time",p]])}"number"===typeof a&&(a+=3);var h=function(e,t,n,a,r,i,o,s,c){return new et.a({url:e,projection:t,tileGrid:n,attributions:a||void 0,transition:r?0:250,imageSmoothing:i,tileLoadFunction:o,maxZoom:c})}(w(t,r),l,function(e,t){if(e!==ht){var n="number"===typeof t?t+1:20;return new it.a({tileSize:[256,256],origin:[-180,90],extent:[-180,-90,180,90],resolutions:Array.from({length:n},(function(e,t){return 180/256/Math.pow(2,t)}))})}}(l,a),u,c,d,_n(Bt.map),0,a);return Object(ot.jsx)(xt,{id:e,source:h,zIndex:10,opacity:i})}var Nn=Object(z.a)(en,$t,(function(e){return e.controlState.showDatasetBoundaries}),(function(e,t,n){if(!e||!n)return null;var a=e.geometry;if(!a){if(!e.bbox)return console.warn("Dataset ".concat(e.id," has no bbox!")),null;var r=Object(G.a)(e.bbox,4),i=r[0],o=r[1],s=r[2],c=r[3];a={type:"Polygon",coordinates:[[[i,o],[s,o],[s,c],[i,c],[i,o]]]}}var l=new $e.a({features:new d.a({dataProjection:mt,featureProjection:t}).readFeatures({type:"Feature",geometry:a})}),u=new rt.c({stroke:new at.a({color:"orange",width:3,lineDash:[2,4]})});return Object(ot.jsx)(wt,{id:"".concat(e.id,".bbox"),source:l,style:u,zIndex:11,opacity:.5})})),Mn=Object(z.a)(It,(function(e){return e.controlState.selectedServerId}),(function(e,t){if(0===e.length)throw new Error("internal error: no servers configured");var n=e.find((function(e){return e.id===t}));if(!n)throw new Error('internal error: server with ID "'.concat(t,'" not found'));return n})),An=Object(z.a)(Mn,Ht,Sn,Cn,qt,Xt,$t,rn,on,cn,kn,Jt,(function(e,t,n,a,r,i,o,s,c,l,u,d){if(!n)return null;var p=[["crs",o],["vmin","".concat(s[0])],["vmax","".concat(s[1])],["cbar",c]];return In("variable",Rn(e.url,t,n.name),n.tileLevelMin,n.tileLevelMax,p,l,a,r,i,o,u,d)})),Ln=Object(z.a)(Mn,Ht,(function(e){return e.controlState.showRgbLayer}),un,cn,Cn,qt,Xt,$t,kn,Jt,(function(e,t,n,a,r,i,o,s,c,l,u){if(!n||!a)return null;var d=[["crs",c]];return In("rgb",Rn(e.url,t,"rgb"),a.tileLevelMin,a.tileLevelMax,d,r,i,o,s,c,l,u)}));function Rn(e,t,n){return e+"/tiles/"+encodeURIComponent(t)+"/"+encodeURIComponent(n)+"/{z}/{y}/{x}"}function Dn(){return new at.a({color:[200,0,0,.75],width:1.25})}function zn(){return new nt.a({color:[255,0,0,_e.instance.branding.polygonFillOpacity||.25]})}var Bn=Object(z.a)(hn,$t,(function(e,t){if(0===e.length)return null;var n=[];return e.forEach((function(e,a){Ke(e)&&n.push(Object(ot.jsx)(wt,{id:"placeGroup.".concat(e.id),style:new rt.c({image:new tt.a({fill:zn(),stroke:Dn(),radius:6}),stroke:Dn(),fill:zn()}),zIndex:100,source:new $e.a({features:new d.a({dataProjection:mt,featureProjection:t}).readFeatures(e)})},a))})),Object(ot.jsx)(st,{children:n})})),Fn=Object(z.a)(Qt,(function(e){var t=[];return Object.getOwnPropertyNames(e).forEach((function(n){e[n].visible&&t.push(n)})),t})),Vn=Object(z.a)(Qt,(function(e){var t={};return Object.getOwnPropertyNames(e).forEach((function(n){t[n]=e[n].viewMode||"text"})),t})),Gn=Object(z.a)((function(e){return e.controlState.activities}),(function(e){return Object.keys(e).map((function(t){return e[t]}))})),Un=Object(z.a)((function(e){return e.controlState.baseMapUrl}),(function(e){var t,n=function(e){var t,n=Object(u.a)(kt);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=a.datasets.find((function(t){return t.endpoint===e}));if(r)return{group:a,dataset:r}}}catch(i){n.e(i)}finally{n.f()}return null}(e);if(n){var a=(t=n.group.name,Re[t]),r=new et.a({url:n.dataset.endpoint+(a?"?".concat(a.param,"=").concat(a.token):""),attributions:["&copy; <a href=&quot;".concat(n.group.link,"&quot;>").concat(n.group.name,"</a>")]});return Object(ot.jsx)(xt,{id:n.group.name+"-"+n.dataset.name,source:r,zIndex:0})}if(e){var i=new et.a({url:e});return Object(ot.jsx)(xt,{id:e,source:i,zIndex:0})}return null}));var Wn=n(521),Hn=n.n(Wn),Kn=n(5),Zn=-new Date("1970-01-01T00:00:00").getTime();function Yn(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Date(e+(t?Zn:0))}function qn(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Yn(e,t).toISOString().substr(0,10)}function Xn(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Yn(e,t).toISOString().substr(0,n?16:19).replace("T"," ")}var Jn=31536e6;var Qn="POST_MESSAGE";function $n(e,t){return{type:Qn,messageType:e,messageText:t.message||t+""}}var ea="HIDE_MESSAGE";var ta=n(690),na="UPDATE_SERVER_INFO";function aa(){return function(e,t){var n,a=Mn(t());e(sr(na,v.get("Connecting to server"))),(n=a.url,S("".concat(n,"/"))).then((function(t){e(function(e){return{type:na,serverInfo:e}}(t))})).catch((function(t){e($n("error",t))})).then((function(){e(lr(na))}))}}var ra="UPDATE_RESOURCES";function ia(){return function(e,t){var n=Mn(t());e(sr(ra,v.get("Updating resources"))),function(e,t){var n=w("".concat(e,"/maintenance/update"),[]),a=y(t);try{return S(n,a).then((function(){return!0})).catch((function(e){return console.error(e),!1}))}catch(r){return console.error(r),Promise.resolve(!1)}}(n.url,t().userAuthState.accessToken).then((function(e){e&&window.location.reload()})).finally((function(){return e(lr(ra))}))}}var oa="UPDATE_DATASETS";function sa(){return function(e,t){var n,a,r=Mn(t());e(sr(oa,v.get("Loading data"))),(n=r.url,a=t().userAuthState.accessToken,S(w("".concat(n,"/datasets"),[["details","1"]]),y(a)).then((function(e){return e.datasets})).then(P)).then((function(n){if(e(ca(n)),n.length>0){var a=t().controlState.selectedDatasetId||n[0].id;e(Ia(a,n,!0))}})).catch((function(t){e($n("error",t)),e(ca([]))})).then((function(){e(lr(oa))}))}}function ca(e){return{type:oa,datasets:e}}var la="UPDATE_DATASET_PLACE_GROUP";function ua(e,t){return{type:la,datasetId:e,placeGroup:t}}var da="ADD_USER_PLACE";var pa="ADD_USER_PLACES";function ma(e){return function(t,n){var a,r=n().controlState.userPlacesFormatName;try{if("csv"===r){var i=function(e){return e.controlState.userPlacesFormatOptions.csv}(n());a=function(e,t){var n=H(e,t);if(n.length<2)throw new Error(v.get("Missing header line in CSV"));var a,r=Object(u.a)(n[0]);try{for(r.s();!(a=r.n()).done;){var i=a.value;if("string"!==typeof i||""===i)throw new Error(v.get("Invalid header line in CSV"))}}catch(k){r.e(k)}finally{r.f()}var o,s=n[0].map((function(e){return e})),c=s.map((function(e){return e.toLowerCase()})),l=s.length,d=Object(u.a)(n);try{for(d.s();!(o=d.n()).done;)if(o.value.length!==l)throw new Error(v.get("All rows must have same length"))}catch(k){d.e(k)}finally{d.f()}var p=t.labelName.toLowerCase(),m=t.xName.toLowerCase(),h=t.yName.toLowerCase(),f=t.geometryName.toLowerCase(),b=t.forceGeometry,g=c.findIndex((function(e){return e===p})),j=c.findIndex((function(e){return e===m})),O=c.findIndex((function(e){return e===h})),x=c.findIndex((function(e){return e===f}));if(b||j<0||O<0||j===O){if(x<0)throw new Error(v.get("No geometry column(s) found"))}else x=-1;var y=t.labelPrefix.trim();""===y&&(y=Y.labelPrefix);for(var w=new B.a,S=[],T=1,C=function(){var t=n[T],a=null;if(x>=0){if("string"===typeof t[x])try{a=w.readGeometry(e)}catch(u){}}else{var r=t[j],i=t[O];"number"===typeof r&&Number.isFinite(r)&&"number"===typeof i&&Number.isFinite(i)&&(a=new F.a([r,i]))}if(null===a)throw new Error(v.get("Invalid geometry in data row ".concat(T)));var o={color:"red"};t.forEach((function(e,t){if(t!==j&&t!==O&&t!==x){var n=s[t];o[n]=e}}));var c=void 0;if(g>=0)c="".concat(t[g]);else{var l=++qe;c="".concat(y).concat(l)}o.label=c,S.push(Qe(a,o))};T<n.length;T++)C();return S}(e,i)}else if("geojson"===r){var o=function(e){return e.controlState.userPlacesFormatOptions.geojson}(n());a=function(e,t){var n=t.labelNames,a=new Set(n.split(",").map((function(e){return e.trim().toLowerCase()})).filter((function(e){return""!==e}))),r=t.labelPrefix.trim();""===r&&(r=X.labelPrefix);var i,o=new d.a;try{i=o.readFeatures(e)}catch(l){try{var s=o.readGeometry(e);i=[new V.a(s)]}catch(l){throw new Error(v.get("Invalid GeoJSON"))}}var c=[];return i.forEach((function(e){var t=e.getProperties(),n=e.getGeometry();if(n){var i="",o={color:"red"};if(t)for(var s in t){var l=t[s];null!==l&&"number"!==typeof l&&"string"!==typeof l&&"boolean"!==typeof l||(o[s]=l),""===i&&"string"===typeof l&&a.has(s.toLowerCase())&&(i=l)}if(""===i){var u=++Xe;i="".concat(r,"-").concat(u)}o.label=i,c.push(Qe(n,o))}})),c}(e,o)}else if("wkt"===r){var s=function(e){return e.controlState.userPlacesFormatOptions.wkt}(n());a=function(e,t){var n=t.labelPrefix.trim();""===n&&(n=Q.labelPrefix);var a=t.label.trim();if(""===a){var r=++Je;a="".concat(n).concat(r)}try{return[Qe((new B.a).readGeometry(e),{label:a})]}catch(i){throw new Error(v.get("Invalid Geometry WKT"))}}(e,s)}else a=[]}catch(c){t($n("error",c)),t(mr("addUserPlacesFromText")),a=[]}a.length?(t(function(e,t,n){return{type:pa,places:e,mapProjection:t,selectPlace:n}}(a,$t(n()),!0)),t(za(["user"])),1===a.length&&(t(Fa(a[0].id,vn(n()),!0)),n().controlState.autoShowTimeSeries&&t(ba())),t($n("info",v.get("Imported ".concat(a.length," place(s)"))))):t($n("warning",v.get("No places imported")))}}var ha="REMOVE_USER_PLACE";var fa="REMOVE_ALL_USER_PLACES";function ba(){return function(e,t){var n=Mn(t()),a=Ht(t()),r=Cn(t()),i=Sn(t()),o=Yt(t()),s=gn(t()),c=t().controlState.timeSeriesUpdateMode,l=t().controlState.showTimeSeriesMedian,u=t().controlState.showTimeSeriesErrorBars,d=Tn(t()),p=Nt(t());if(a&&i&&o&&r){var m=r.labels,h=m.length,f=h-1,b=f-(d=d>0?d:h)+1,v=function(){var e=b>=0?m[b]:null,r=m[f];return function(e,t,n,a,r,i,o,s,c,l){var u,d=null,p=[];s?(p.push(["aggMethods","median"]),u="median"):c?(p.push(["aggMethods","mean,std"]),u="mean",d="std"):(p.push(["aggMethods","mean"]),u="mean"),i&&p.push(["startDate",i]),o&&p.push(["endDate",o]);var m=encodeURIComponent(t),h=encodeURIComponent(n.name);return S(w("".concat(e,"/timeseries/").concat(m,"/").concat(h),p),Object(C.a)(Object(C.a)({},y(l)),{},{method:"post",body:JSON.stringify(r)})).then((function(e){if(!(e=e.result)||0===e.length)return null;var i=e.map((function(e){return Object(C.a)(Object(C.a)({},e),{},{time:new Date(e.time).getTime()})}));return{source:{datasetId:t,variableName:n.name,variableUnits:n.units||void 0,placeId:a,geometry:r,valueDataKey:u,errorDataKey:d},data:i,color:"green"}}))}(n.url,a,i,s.id,s.geometry,e,r,l,u,t().userAuthState.accessToken)};v().then((function t(n){if(null!==n&&va(p,s.id)){var a=b>0,r=a?(h-b)/h:1;e(function(e,t,n){return{type:ga,timeSeries:e,updateMode:t,dataMode:n}}(Object(C.a)(Object(C.a)({},n),{},{dataProgress:r}),c,f===h-1?"new":"append")),a&&va(p,s.id)&&(b-=d,f-=d,v().then(t))}else e($n("info","No data found here"))})).catch((function(t){e($n("error",t))}))}}}function va(e,t){return null!==Ye(e,t)}var ga="UPDATE_TIME_SERIES";var ja="REMOVE_TIME_SERIES_GROUP";var Oa="REMOVE_ALL_TIME_SERIES";var xa="CONFIGURE_SERVERS";function ya(e,t){return{type:xa,servers:e,selectedServerId:t}}function wa(){return function(e){e(aa()),e(sa()),e((function(e,t){var n,a=Mn(t());(n=a.url,S("".concat(n,"/colorbars")).then(T)).then((function(t){e(function(e){return{type:Sa,colorBars:e}}(t))})).catch((function(t){e($n("error",t))}))}))}}var Sa="UPDATE_COLOR_BARS";var Ta="UPDATE_VARIABLE_COLOR_BAR";var Ca="UPDATE_VARIABLE_VOLUME";var ka=function e(){Object(p.a)(this,e)},Pa=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(e){var a;return Object(p.a)(this,n),(a=t.call(this)).fileName=void 0,a.zipArchive=void 0,a.fileName=e,a.zipArchive=new Hn.a,a}return Object(m.a)(n,[{key:"write",value:function(e,t){this.zipArchive.file(e,t)}},{key:"close",value:function(){var e=this;this.zipArchive.generateAsync({type:"blob"}).then((function(t){return ta(t,e.fileName)}))}}]),n}(ka),Ea=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"write",value:function(e,t){var n=new Blob([t],{type:"text/plain;charset=utf-8"});ta(n,e)}},{key:"close",value:function(){}}]),n}(ka);var _a="SELECT_DATASET";function Ia(e,t,n){return function(a){a(function(e,t){return{type:_a,selectedDatasetId:e,datasets:t}}(e,t)),e&&n&&a(Na(e))}}function Na(e){return function(t,n){var a=A(Pt(n()),e);a&&a.bbox&&t(Ra(a.bbox))}}var Ma=["Point","LineString","LinearRing","Polygon","MultiPoint","MultiLineString","MultiPolygon","Circle"];function Aa(e){return function(t,n){var a=Ye(fn(n()),e);a&&(a.bbox?t(Ra(a.bbox)):a.geometry&&Ma.includes(a.geometry.type)&&t(Ra((new d.a).readGeometry(a.geometry))))}}var La="FLY_TO";function Ra(e){return{type:La,mapId:"map",location:e}}var Da="SELECT_PLACE_GROUPS";function za(e){return function(t,n){var a=Mn(n());t(function(e){return{type:Da,selectedPlaceGroupIds:e}}(e));var r=en(n()),i=hn(n());if(null!==r&&i.length>0){var o,s=Object(u.a)(i);try{for(s.s();!(o=s.n()).done;){var c=o.value;Ke(c)||function(){var e=r.id,i=c.id,o="".concat(la,"-").concat(e,"-").concat(i);t(sr(o,v.get("Loading places"))),_(a.url,e,i,n().userAuthState.accessToken).then((function(e){t(ua(r.id,e))})).catch((function(e){t($n("error",e))})).finally((function(){t(lr(o))}))}()}}catch(l){s.e(l)}finally{s.f()}}}}var Ba="SELECT_PLACE";function Fa(e,t,n){return function(a){a(function(e,t){return{type:Ba,selectedPlaceId:e,places:t}}(e,t)),n&&e&&a(Aa(e))}}var Va="SET_RGB_LAYER_VISIBILITY";var Ga="SELECT_VARIABLE";var Ua="SELECT_TIME";function Wa(e){return{type:Ua,selectedTime:e}}var Ha="INC_SELECTED_TIME";var Ka="SELECT_TIME_RANGE";function Za(e){return{type:Ka,selectedTimeRange:e}}var Ya="SELECT_TIME_SERIES_UPDATE_MODE";var qa="UPDATE_TIME_ANIMATION";var Xa="SET_MAP_INTERACTION";function Ja(e){return{type:Xa,mapInteraction:e}}var Qa="SHOW_VOLUME_CARD";function $a(e){return{type:Qa,volumeCardOpen:e}}var er="SET_VOLUME_RENDER_MODE";var tr="UPDATE_VOLUME_STATE";var nr="SHOW_INFO_CARD";function ar(e){return{type:nr,infoCardOpen:e}}var rr="SET_VISIBLE_INFO_CARD_ELEMENTS";var ir="UPDATE_INFO_CARD_ELEMENT_VIEW_MODE";var or="ADD_ACTIVITY";function sr(e,t){return{type:or,id:e,message:t}}var cr="REMOVE_ACTIVITY";function lr(e){return{type:cr,id:e}}var ur="CHANGE_LOCALE";function dr(e){return{type:ur,locale:e}}var pr="OPEN_DIALOG";function mr(e){return{type:pr,dialogId:e}}var hr="CLOSE_DIALOG";function fr(e){return{type:hr,dialogId:e}}var br="UPDATE_SETTINGS";function vr(e){return{type:br,settings:e}}var gr=n(453),jr=n(989),Or=n(982),xr=n(1008),yr=n(990),wr=n(1017),Sr=n(1018),Tr=n(334),Cr=n(1011),kr=n(584),Pr=n(1002),Er=n(974),_r=n(1016),Ir=n(1019),Nr=n(529),Mr=n.n(Nr),Ar=n(388),Lr=n.n(Ar),Rr=n(387),Dr=n.n(Rr),zr=n(49),Br=n.n(zr),Fr=n(376),Vr=n(1001),Gr=n(1003),Ur=n(1015),Wr=n(976),Hr=n(1014),Kr=n(1013),Zr=n(977),Yr=n(448),qr=n.n(Yr),Xr=n(973),Jr=n(999),Qr=n(1009),$r=n(1e3),ei=n(972),ti=n(591),ni=function(e){var t=e.userInfo;return Object(ot.jsxs)(Jr.a,{container:!0,justifyContent:"center",spacing:1,children:[Object(ot.jsx)(Jr.a,{item:!0,children:Object(ot.jsx)("img",{src:t.picture,width:84,alt:v.get("User Profile")})}),Object(ot.jsx)(Jr.a,{item:!0,children:Object(ot.jsx)(ti.a,{elevation:3,children:Object(ot.jsxs)(Qr.a,{children:[Object(ot.jsx)($r.a,{children:Object(ot.jsx)(ei.a,{primary:t.name,secondary:v.get("User name")})}),Object(ot.jsx)(Xr.a,{light:!0}),Object(ot.jsx)($r.a,{children:Object(ot.jsx)(ei.a,{primary:"".concat(t.email," (").concat(t.email_verified?v.get("verified"):v.get("not verified"),")"),secondary:v.get("E-mail")})}),Object(ot.jsx)(Xr.a,{light:!0}),Object(ot.jsx)($r.a,{children:Object(ot.jsx)(ei.a,{primary:t.nickname,secondary:v.get("Nickname")})})]})})})]})},ai=function(e){var t=e.classes,n=e.updateAccessToken,r=Object(Fr.useAuth)(),i=a.useState(null),o=Object(G.a)(i,2),s=o[0],c=o[1],l=a.useState(!1),u=Object(G.a)(l,2),d=u[0],p=u[1];a.useEffect((function(){r.user&&r.user.access_token?n(r.user.access_token):n(null)}),[r.user,n]);var m=function(){p(!1)},h=function(){c(null)};if(r.user){var f,b=r.user.profile,g=Object(ot.jsx)(qr.a,{});if(b)if(b.picture)f=Object(ot.jsx)(Vr.a,{className:t.imageAvatar,src:b.picture,alt:b.name});else{var j=b.given_name||b.name||b.nickname,O=b.family_name,x=null;j&&O?x=j[0]+O[0]:j?x=j[0]:O&&(x=O[0]),null!==x&&(g=x.toUpperCase()),f=Object(ot.jsx)(Vr.a,{className:t.letterAvatar,children:g})}else f=Object(ot.jsx)(Vr.a,{className:t.letterAvatar,children:"?"});return Object(ot.jsxs)(a.Fragment,{children:[Object(ot.jsx)(Cr.a,{onClick:function(e){c(e.currentTarget)},"aria-controls":"user-menu","aria-haspopup":"true",size:"small",className:t.iconButton,children:f}),Object(ot.jsxs)(kr.a,{id:"user-menu",anchorEl:s,keepMounted:!0,open:Boolean(s),onClose:h,children:[Object(ot.jsx)(Pr.a,{onClick:function(){h(),p(!0)},children:v.get("Profile")}),Object(ot.jsx)(Pr.a,{onClick:function(){h(),r.signoutRedirect().then((function(){})).catch((function(e){console.error(e)}))},children:v.get("Log out")})]}),Object(ot.jsxs)(Wr.a,{open:d,keepMounted:!0,onClose:m,"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description",children:[Object(ot.jsx)(Zr.a,{id:"alert-dialog-slide-title",children:v.get("User Profile")}),Object(ot.jsx)(Kr.a,{children:Object(ot.jsx)(ni,{userInfo:r.user.profile})}),Object(ot.jsx)(Hr.a,{children:Object(ot.jsx)(Gr.a,{onClick:m,color:"primary",children:"OK"})})]})]})}var y=Object(ot.jsx)(Cr.a,{onClick:r.isLoading?void 0:function(){r.signinRedirect().then((function(){})).catch((function(e){console.error(e)}))},size:"small",children:Object(ot.jsx)(qr.a,{})});return r.isLoading&&(y=Object(ot.jsxs)("div",{className:t.signInWrapper,children:[y,Object(ot.jsx)(Ur.a,{size:24,className:t.signInProgress})]})),y},ri=Object(_r.a)((function(e){return Object(Er.a)({imageAvatar:{width:32,height:32,color:"#fff",backgroundColor:je.a[300]},letterAvatar:{width:32,height:32,color:"#fff",backgroundColor:je.a[300]},signInWrapper:{margin:e.spacing(1),position:"relative"},signInProgress:{color:je.a[300],position:"absolute",top:"50%",left:"50%",zIndex:1,marginTop:-12,marginLeft:-12},iconButton:{padding:0}})}))((function(e){return _e.instance.authClient?Object(ot.jsx)(ai,Object(C.a)({},e)):null})),ii="UPDATE_ACCESS_TOKEN";var oi={updateAccessToken:function(e){return function(t,n){var a=n().userAuthState.accessToken;a!==e&&(t(function(e){return{type:ii,accessToken:e}}(e)),null!==e&&null!==a||t(sa()))}}},si=Object(o.b)((function(e){return{}}),oi)(ri),ci=n(991),li=n(993),ui=n(168),di=n.n(ui),pi=n(978),mi=Object(li.a)((function(e){return Object(Er.a)({dialog:{backgroundColor:e.palette.grey[600]},appBar:{position:"relative"},title:{marginLeft:e.spacing(2),flex:1},text:{marginTop:e.spacing(4),marginLeft:e.spacing(40),marginRight:e.spacing(40)}})})),hi=r.a.forwardRef((function(e,t){return Object(ot.jsx)(pi.a,Object(C.a)({direction:"up",ref:t},e))})),fi=function(e){var t=e.title,n=e.href,r=e.open,i=e.onClose,o=Object(a.useState)(""),s=Object(G.a)(o,2),c=s[0],l=s[1];Object(a.useEffect)((function(){fetch(n).then((function(e){return e.text()})).then((function(e){return l(e)}))}));var u=mi();return Object(ot.jsxs)(Wr.a,{fullScreen:!0,open:r,onClose:i,TransitionComponent:hi,children:[Object(ot.jsx)(wr.a,{className:u.appBar,children:Object(ot.jsxs)(Sr.a,{children:[Object(ot.jsx)(Cr.a,{edge:"start",color:"inherit",onClick:i,"aria-label":"close",size:"large",children:Object(ot.jsx)(di.a,{})}),Object(ot.jsx)(Tr.a,{variant:"h6",className:u.title,children:t})]})}),Object(ot.jsx)(Kr.a,{className:u.dialog,children:Object(ot.jsx)("div",{className:u.text,children:Object(ot.jsx)(ci.a,{children:c,linkTarget:"_blank"})})})]})},bi={openDialog:mr,updateResources:ia},vi=Object(o.b)((function(e){return{locale:e.controlState.locale,appName:_e.instance.branding.appBarTitle,allowRefresh:_e.instance.branding.allowRefresh}}),bi)(Object(_r.a)((function(e){return Object(Er.a)({toolbar:{backgroundColor:_e.instance.branding.headerBackgroundColor,paddingRight:e.spacing(1)},appBar:{zIndex:e.zIndex.drawer+1,transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},logoAnchor:{display:"flex",alignItems:"center"},logo:{marginLeft:e.spacing(1)},title:Object(C.a)({flexGrow:1,marginLeft:e.spacing(1)},_e.instance.branding.headerTitleStyle),imageAvatar:{width:24,height:24,color:"#fff",backgroundColor:je.a[300]},letterAvatar:{width:24,height:24,color:"#fff",backgroundColor:je.a[300]},signInWrapper:{margin:e.spacing(1),position:"relative"},signInProgress:{color:je.a[300],position:"absolute",top:"50%",left:"50%",zIndex:1,marginTop:-12,marginLeft:-12},iconButton:Object(C.a)({marginLeft:e.spacing(2)},_e.instance.branding.headerIconStyle)})}))((function(e){var t=e.classes,n=e.appName,r=e.openDialog,i=e.allowRefresh,o=e.updateResources,s=a.useState(null),c=Object(G.a)(s,2),l=c[0],u=c[1],d=a.useState(!1),p=Object(G.a)(d,2),m=p[0],h=p[1],f=a.useState(!1),b=Object(G.a)(f,2),g=b[0],j=b[1],O=function(){u(null)};return Object(ot.jsxs)(wr.a,{position:"absolute",className:Br()(t.appBar),children:[Object(ot.jsxs)(Sr.a,{disableGutters:!0,className:t.toolbar,variant:"dense",children:[Object(ot.jsx)("a",{href:_e.instance.branding.organisationUrl||"",target:"_blank",rel:"noreferrer",className:t.logoAnchor,children:Object(ot.jsx)("img",{src:_e.instance.branding.logoImage,width:_e.instance.branding.logoWidth,alt:"xcube logo",className:t.logo})}),Object(ot.jsx)(Tr.a,{component:"h1",variant:"h6",color:"inherit",noWrap:!0,className:t.title,children:n}),Object(ot.jsx)(si,{}),i&&Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Refresh"),children:Object(ot.jsx)(Cr.a,{onClick:o,size:"small",className:t.iconButton,children:Object(ot.jsx)(Dr.a,{})})}),Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Help"),children:Object(ot.jsx)(Cr.a,{onClick:function(e){u(e.currentTarget)},size:"small",className:t.iconButton,children:Object(ot.jsx)(Mr.a,{})})}),Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Settings"),children:Object(ot.jsx)(Cr.a,{onClick:function(){r("settings")},size:"small",className:t.iconButton,children:Object(ot.jsx)(Lr.a,{})})})]}),Object(ot.jsxs)(kr.a,{id:"simple-menu",anchorEl:l,keepMounted:!0,open:Boolean(l),onClose:O,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:[Object(ot.jsx)(Pr.a,{onClick:function(){O(),j(!0)},children:v.get("User Manual")}),Object(ot.jsx)(Pr.a,{onClick:function(){O(),h(!0)},children:v.get("Imprint")})]}),Object(ot.jsx)(fi,{title:v.get("User Manual"),href:"manual.md",open:g,onClose:function(){j(!1)}}),Object(ot.jsx)(fi,{title:v.get("Imprint"),href:"imprint.md",open:m,onClose:function(){h(!1)}})]})}))),gi=Object(_r.a)((function(e){return Object(Er.a)({form:{display:"flex",flexWrap:"wrap",paddingTop:e.spacing(1),paddingLeft:e.spacing(1),paddingRight:e.spacing(1),flexGrow:0}})}))((function(e){var t=e.classes,n=e.children;return Object(ot.jsx)("form",{className:t.form,autoComplete:"off",children:n})})),ji=n(1022),Oi=n(1021),xi=n(995),yi=n(1020),wi=n(980),Si=Object(_r.a)((function(e){return Object(Er.a)({formControl:{marginRight:e.spacing(1)}})}))((function(e){var t=e.classes,n=e.label,a=e.control,r=e.actions;return Object(ot.jsx)(yi.a,{variant:"standard",className:t.formControl,children:Object(ot.jsxs)(wi.a,{children:[n,a,r]})})})),Ti=Object(_r.a)((function(e){return Object(Er.a)({formControl:{marginRight:e.spacing(2),marginBottom:e.spacing(1),minWidth:120},selectEmpty:{}})}))((function(e){var t=e.classes,n=e.selectedDatasetId,a=e.datasets,r=e.selectDataset;n=n||"",a=a||[];var i=Object(ot.jsx)(Oi.a,{shrink:!0,htmlFor:"dataset-select",children:v.get("Dataset")}),o=Object(ot.jsx)(xi.a,{variant:"standard",value:n,onChange:function(e){var t=e.target.value||null;r(t,a,!0)},input:Object(ot.jsx)(ji.a,{name:"dataset",id:"dataset-select"}),displayEmpty:!0,name:"dataset",className:t.selectEmpty,children:a.map((function(e){return Object(ot.jsx)(Pr.a,{value:e.id,selected:e.id===n,children:e.title},e.id)}))});return Object(ot.jsx)(Si,{label:i,control:o})})),Ci={selectDataset:Ia},ki=Object(o.b)((function(e){return{locale:e.controlState.locale,selectedDatasetId:e.controlState.selectedDatasetId,datasets:e.dataState.datasets}}),Ci)(Ti),Pi=n(530),Ei=n.n(Pi),_i=Object(_r.a)((function(e){return Object(Er.a)({formControl:{marginRight:e.spacing(2),marginBottom:e.spacing(1),minWidth:120},selectEmpty:{},button:{margin:e.spacing(.1)}})}))((function(e){var t=e.classes,n=e.canAddTimeSeries,a=e.selectedVariableName,r=e.variables,i=e.selectVariable,o=e.addTimeSeries;a=a||"",r=r||[];var s=Object(ot.jsx)(Oi.a,{shrink:!0,htmlFor:"variable-select",children:v.get("Variable")}),c=Object(ot.jsx)(xi.a,{variant:"standard",className:t.selectEmpty,value:a,onChange:function(e){i(e.target.value||null)},input:Object(ot.jsx)(ji.a,{name:"variable",id:"variable-select"}),displayEmpty:!0,name:"variable",children:r.map((function(e){return Object(ot.jsx)(Pr.a,{value:e.name,selected:e.name===a,children:e.title||e.name},e.name)}))}),l=Object(ot.jsx)(Cr.a,{className:t.button,disabled:!n,onClick:function(){o()},size:"large",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Show time-series diagram"),children:Object(ot.jsx)(Ei.a,{})})});return Object(ot.jsx)(Si,{label:s,control:c,actions:l})})),Ii={selectVariable:function(e){return{type:Ga,selectedVariableName:e}},addTimeSeries:ba},Ni=Object(o.b)((function(e){return{locale:e.controlState.locale,selectedVariableName:e.controlState.selectedVariableName,canAddTimeSeries:xn(e),variables:tn(e)}}),Ii)(_i),Mi=n(1024),Ai=n(1025),Li=Object(_r.a)((function(e){return Object(Er.a)({})}))((function(e){var t=e.showRgbLayer,n=e.rgbSchema,a=e.setRgbLayerVisibility;return Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Show RGB layer instead"),children:Object(ot.jsx)(Mi.a,{label:v.get("RGB"),control:Object(ot.jsx)(Ai.a,{color:"primary",checked:null!==n&&t,disabled:null===n,onChange:function(e){a(e.target.checked)}})})})})),Ri={setRgbLayerVisibility:function(e){return{type:Va,showRgbLayer:e}}},Di=Object(o.b)((function(e){return{locale:e.controlState.locale,rgbSchema:un(e),showRgbLayer:e.controlState.showRgbLayer}}),Ri)(Li),zi=n(998),Bi=n(389),Fi=n.n(Bi),Vi=Object(_r.a)((function(e){return Object(Er.a)({select:{minWidth:"5em"}})}))((function(e){var t=e.classes,n=e.placeGroups,a=e.selectPlaceGroups,r=e.selectedPlaceGroupIds,i=e.selectedPlaceGroupsTitle,o=e.removeAllUserPlaces;if(r=r||[],0===(n=n||[]).length||1===n.length&&"user"===n[0].id)return null;var s=Object(ot.jsx)(Oi.a,{shrink:!0,htmlFor:"place-groups-select",children:v.get("Places")}),c=Object(ot.jsx)(xi.a,{variant:"standard",multiple:!0,displayEmpty:!0,onChange:function(e){a(e.target.value||null)},input:Object(ot.jsx)(ji.a,{name:"place-groups",id:"place-groups-select"}),value:r,renderValue:function(){return i},name:"place-groups",className:t.select,children:n.map((function(e){return Object(ot.jsxs)(Pr.a,{value:e.id,children:[Object(ot.jsx)(zi.a,{checked:r.indexOf(e.id)>-1}),Object(ot.jsx)(ei.a,{primary:e.title})]},e.id)}))}),l=1===r.length&&"user"===r[0],u=Object(ot.jsx)(Cr.a,{disabled:!l,onClick:function(){o()},size:"large",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Remove places"),children:Object(ot.jsx)(Fi.a,{})})});return Object(ot.jsx)(Si,{label:s,control:c,actions:u})})),Gi={selectPlaceGroups:za,removeAllUserPlaces:function(){return{type:fa}}},Ui=Object(o.b)((function(e){return{locale:e.controlState.locale,selectedPlaceGroupIds:e.controlState.selectedPlaceGroupIds,placeGroups:pn(e),selectedPlaceGroupsTitle:bn(e)}}),Gi)(Vi),Wi=Object(_r.a)((function(e){return Object(Er.a)({select:{minWidth:"5em"},button:{}})}))((function(e){var t=e.classes,n=e.selectPlace,a=e.placeLabels,r=e.selectedPlaceId,i=e.selectedPlaceGroupIds,o=e.removeUserPlace,s=e.places;s=s||[],a=a||[],r=r||"",i=i||[];var c=Object(ot.jsx)(Oi.a,{shrink:!0,htmlFor:"place-select",children:v.get("Place")}),l=Object(ot.jsx)(xi.a,{variant:"standard",value:r,onChange:function(e){n(e.target.value||null,s,!0)},input:Object(ot.jsx)(ji.a,{name:"place",id:"place-select"}),displayEmpty:!0,name:"place",className:t.select,disabled:0===s.length,children:s.map((function(e,t){return Object(ot.jsx)(Pr.a,{value:e.id,selected:e.id===r,children:a[t]},e.id)}))}),u=s.length>0&&1===i.length&&"user"===i[0]&&""!==r,d=Object(ot.jsx)(Cr.a,{className:t.button,disabled:!u,onClick:function(){null!==r&&o(r,s)},size:"large",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Remove place"),children:Object(ot.jsx)(Fi.a,{})})});return Object(ot.jsx)(Si,{label:c,control:l,actions:d})})),Hi={selectPlace:Fa,removeUserPlace:function(e,t){return{type:ha,id:e,places:t}},openDialog:mr},Ki=Object(o.b)((function(e){return{locale:e.controlState.locale,datasets:e.dataState.datasets,userPlaceGroup:e.dataState.userPlaceGroup,selectedPlaceGroupIds:e.controlState.selectedPlaceGroupIds,selectedPlaceId:e.controlState.selectedPlaceId,places:vn(e),placeLabels:wn(e)}}),Hi)(Wi),Zi=n(532),Yi=n.n(Zi),qi=n(533),Xi=n.n(qi),Ji=n(531),Qi=n.n(Ji),$i=n(534),eo=n.n($i),to=n(535),no=n.n(to),ao=n(1026),ro=n(1005),io=Object(li.a)((function(e){return{formControl:{marginTop:e.spacing(1.5),marginRight:e.spacing(2)}}}));var oo={setMapInteraction:Ja},so=Object(o.b)((function(e){return{mapInteraction:e.controlState.mapInteraction}}),oo)((function(e){var t=e.mapInteraction,n=e.setMapInteraction,a=io();return Object(ot.jsx)(yi.a,{variant:"standard",className:a.formControl,children:Object(ot.jsxs)(ro.a,{size:"small",value:t,exclusive:!0,onChange:function(e,t){n(null!==t?t:"Select")},children:[Object(ot.jsx)(ao.a,{value:"Select",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Select a place in map"),children:Object(ot.jsx)(Qi.a,{})})},0),Object(ot.jsx)(ao.a,{value:"Point",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Add a point location in map"),children:Object(ot.jsx)(Yi.a,{})})},1),Object(ot.jsx)(ao.a,{value:"Polygon",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Draw a polygon area in map"),children:Object(ot.jsx)(Xi.a,{})})},2),Object(ot.jsx)(ao.a,{value:"Circle",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Draw a circular area in map"),children:Object(ot.jsx)(eo.a,{})})},3),Object(ot.jsx)(ao.a,{value:"Geometry",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Import geometry"),children:Object(ot.jsx)(no.a,{})})},4)]})})})),co=n(1027),lo=n(390),uo=n.n(lo),po=n(585),mo=n(582),ho=n(992),fo=Object(_r.a)((function(e){return Object(Er.a)({})}))((function(e){var t,n,a=e.hasTimeDimension,r=e.selectedTime,i=e.selectedTimeRange,o=e.selectTime,s=Object(ot.jsx)(uo.a,{shrink:!0,htmlFor:"time-select",children:"".concat(v.get("Time")," (UTC)")}),c="number"===typeof r?Yn(r):null;Array.isArray(i)&&(t=Yn(i[0]),n=Yn(i[1]));var l=Object(ot.jsx)(po.a,{dateAdapter:mo.a,children:Object(ot.jsx)(ho.a,{disabled:!a,variant:"inline",emptyLabel:a?void 0:v.get("Missing time axis"),inputFormat:"yyyy-MM-dd hh:mm:ss",id:"time-select",value:c,minDateTime:t,maxDateTime:n,onChange:function(e){o(null!==e?e.getTime():null)},ampm:!1,renderInput:function(e){return Object(ot.jsx)(co.a,Object(C.a)(Object(C.a)({},e),{},{variant:"standard",size:"small"}))}})});return Object(ot.jsx)(Si,{label:s,control:l})})),bo={selectTime:Wa},vo=Object(o.b)((function(e){return{locale:e.controlState.locale,hasTimeDimension:!!Cn(e),selectedTime:e.controlState.selectedTime,selectedTimeRange:e.controlState.selectedTimeRange}}),bo)(fo),go=n(1029),jo=Object(_r.a)((function(e){return Object(Er.a)({box:{marginTop:e.spacing(2),marginLeft:e.spacing(5),marginRight:e.spacing(5),minWidth:200},label:{color:"grey",fontSize:"1em"}})}))((function(e){var t=e.classes,n=e.hasTimeDimension,r=e.selectedTime,i=e.selectTime,o=e.selectedTimeRange,s=Object(a.useState)(r),c=Object(G.a)(s,2),l=c[0],u=c[1];if(Object(a.useEffect)((function(){u(r||(o?o[0]:0))}),[r,o]),!n)return null;var d=Array.isArray(o);d||(o=[Date.now()-2*Jn,Date.now()]);var p=[{value:o[0],label:qn(o[0])},{value:o[1],label:qn(o[1])}];return Object(ot.jsx)(wi.a,{className:t.box,children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Select time in dataset"),children:Object(ot.jsx)(go.a,{disabled:!d,min:o[0],max:o[1],value:l||0,valueLabelDisplay:"off",valueLabelFormat:function(e){return Xn(e)},marks:p,onChange:function(e,t){"number"===typeof t&&u(t)},onChangeCommitted:function(e,t){i&&"number"===typeof t&&i(t)},size:"small"})})})})),Oo={selectTime:Wa,selectTimeRange:Za},xo=Object(o.b)((function(e){return{locale:e.controlState.locale,hasTimeDimension:!!Cn(e),selectedTime:e.controlState.selectedTime,selectedTimeRange:e.controlState.selectedTimeRange}}),Oo)(jo),yo=n(539),wo=n.n(yo),So=n(540),To=n.n(So),Co=n(538),ko=n.n(Co),Po=n(541),Eo=n.n(Po),_o=n(536),Io=n.n(_o),No=n(537),Mo=n.n(No),Ao=Object(_r.a)((function(e){return Object(Er.a)({formControl:{marginTop:e.spacing(1),marginRight:e.spacing(1)}})}))((function(e){var t=e.classes,n=e.timeAnimationActive,r=e.timeAnimationInterval,i=e.updateTimeAnimation,o=e.selectedTime,s=e.selectedTimeRange,c=e.selectTime,l=e.incSelectedTime,u=Object(a.useRef)(null);Object(a.useEffect)((function(){return p(),h}));var d=function(){l(1)},p=function(){n?m():h()},m=function(){h(),u.current=window.setInterval(d,r)},h=function(){null!==u.current&&(window.clearInterval(u.current),u.current=null)},f="number"===typeof o,b=v.get(n?"Stop":"Start"),g=n?Object(ot.jsx)(Io.a,{}):Object(ot.jsx)(Mo.a,{}),j=Object(ot.jsx)(Cr.a,{disabled:!f,"aria-label":b,onClick:function(){i(!n,r)},size:"large",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Auto-step through times in the dataset"),children:g})}),O=Object(ot.jsx)(Cr.a,{disabled:!f||n,onClick:function(){c(s?s[0]:null)},size:"large",children:Object(ot.jsx)(ko.a,{})}),x=Object(ot.jsx)(Cr.a,{disabled:!f||n,onClick:function(){l(-1)},size:"large",children:Object(ot.jsx)(wo.a,{})}),y=Object(ot.jsx)(Cr.a,{disabled:!f||n,onClick:function(){l(1)},size:"large",children:Object(ot.jsx)(To.a,{})}),w=Object(ot.jsx)(Cr.a,{disabled:!f||n,onClick:function(){c(s?s[1]:null)},size:"large",children:Object(ot.jsx)(Eo.a,{})});return Object(ot.jsx)(yi.a,{variant:"standard",className:t.formControl,children:Object(ot.jsxs)(wi.a,{children:[O,x,j,y,w]})})})),Lo={selectTime:Wa,incSelectedTime:function(e){return{type:Ha,increment:e}},updateTimeAnimation:function(e,t){return{type:qa,timeAnimationActive:e,timeAnimationInterval:t}}},Ro=Object(o.b)((function(e){return{locale:e.controlState.locale,selectedTime:e.controlState.selectedTime,selectedTimeRange:e.controlState.selectedTimeRange,timeAnimationActive:e.controlState.timeAnimationActive,timeAnimationInterval:e.controlState.timeAnimationInterval}}),Lo)(Ao),Do=n(542),zo=n.n(Do),Bo=n(271),Fo=n.n(Bo),Vo=n(392),Go=n.n(Vo),Uo=n(543),Wo=n.n(Uo),Ho=Object(_r.a)((function(e){return Object(Er.a)({formControl:{marginTop:e.spacing(1),marginRight:e.spacing(1),marginLeft:"auto"}})}))((function(e){var t=e.classes,n=e.visible,a=e.flyToSelectedObject,r=e.volumeCardOpen,i=e.showVolumeCard,o=e.infoCardOpen,s=e.showInfoCard,c=e.timeSeriesGroups,l=e.openDialog,u=e.allowRefresh,d=e.updateResources,p=e.compact;if(!n)return null;var m,h=c.length>0;_e.instance.branding.allowDownloads&&(m=Object(ot.jsx)(Cr.a,{disabled:!h,onClick:function(){return l("export")},size:"small",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Export data"),children:Object(ot.jsx)(zo.a,{})})}));var f,b,g=Object(ot.jsx)(Cr.a,{onClick:a,size:"small",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Show selected place in map"),children:Object(ot.jsx)(Wo.a,{})})}),j=_e.instance.branding.allow3D&&Object(ot.jsx)(Cr.a,{onClick:function(){return i(!0)},disabled:r,size:"large",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:"Open volume panel (experimental!)",children:Object(ot.jsx)(Go.a,{})})}),O=Object(ot.jsx)(Cr.a,{onClick:function(){return s(!0)},disabled:o,size:"small",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Open information panel"),children:Object(ot.jsx)(Fo.a,{})})});return p&&(u&&(f=Object(ot.jsx)(Cr.a,{onClick:d,size:"small",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Refresh"),children:Object(ot.jsx)(Dr.a,{})})})),b=Object(ot.jsx)(Cr.a,{onClick:function(){return l("settings")},size:"small",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Settings"),children:Object(ot.jsx)(Lr.a,{})})})),Object(ot.jsx)(yi.a,{variant:"standard",className:t.formControl,children:Object(ot.jsxs)(wi.a,{children:[f,m,g,j,O,b]})})})),Ko={showVolumeCard:$a,showInfoCard:ar,flyToSelectedObject:function(){return function(e,t){var n=Yt(t()),a=Ht(t());n?e(Aa(n)):a&&e(Na(a))}},openDialog:mr,updateResources:ia},Zo=Object(o.b)((function(e){return{locale:e.controlState.locale,visible:!(!e.controlState.selectedDatasetId&&!e.controlState.selectedPlaceId),volumeCardOpen:e.controlState.volumeCardOpen,infoCardOpen:e.controlState.infoCardOpen,timeSeriesGroups:e.dataState.timeSeriesGroups,compact:_e.instance.branding.compact,allowRefresh:_e.instance.branding.allowRefresh}}),Ko)(Ho),Yo=Object(o.b)((function(e){return{locale:e.controlState.locale,show:e.dataState.datasets.length>0}}),{})((function(e){return e.show?Object(ot.jsxs)(gi,{children:[Object(ot.jsx)(ki,{}),Object(ot.jsx)(Ni,{}),Object(ot.jsx)(Di,{}),Object(ot.jsx)(Ui,{}),Object(ot.jsx)(Ki,{}),Object(ot.jsx)(so,{}),Object(ot.jsx)(vo,{}),Object(ot.jsx)(Ro,{}),Object(ot.jsx)(xo,{}),Object(ot.jsx)(Zo,{})]}):null})),qo=n(318),Xo=n(20),Jo=n(100),Qo=(n(751),function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(e){var a;return Object(p.a)(this,n),(a=t.call(this,e)).state={error:null},a}return Object(m.a)(n,[{key:"componentDidCatch",value:function(e,t){console.error(e),t.componentStack&&console.error(t.componentStack)}},{key:"render",value:function(){if(!this.props.children)throw new Error("An ErrorBoundary requires at least one child");return this.state.error?Object(ot.jsxs)("div",{children:[Object(ot.jsx)("h2",{className:"errorBoundary-header",children:v.get("Something went wrong.")}),Object(ot.jsxs)("details",{className:"errorBoundary-details",style:{whiteSpace:"pre-wrap"},children:[this.state.error.toString(),Object(ot.jsx)("br",{})]})]}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}}]),n}(a.Component)),$o=n(165),es=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).divRef=null,e.handleDivRef=function(t){e.divRef=t},e}return Object(m.a)(n,[{key:"addMapObject",value:function(e){var t=new $o.a({element:this.divRef});return e.addControl(t),t}},{key:"updateMapObject",value:function(e,t,n){return t}},{key:"removeMapObject",value:function(e,t){var n,a=Object(u.a)(e.getControls().getArray());try{for(a.s();!(n=a.n()).done;){if(n.value===t){e.removeControl(t);break}}}catch(r){a.e(r)}finally{a.f()}}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.style,a=e.className,r=(a?a+" ":"")+"ol-unselectable ol-control";return Object(ot.jsx)("div",{style:n,className:r,ref:this.handleDivRef,children:t})}}]),n}(jt),ts=n(358),ns=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"addMapObject",value:function(e){var t=new ts.a(this.getOptions());return e.addControl(t),t}},{key:"updateMapObject",value:function(e,t,n){return t.setProperties(this.getOptions()),t}},{key:"removeMapObject",value:function(e,t){e.removeControl(t)}}]),n}(jt),as=n(28),rs=n(25),is=n(359),os=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"addMapObject",value:function(e){var t=new is.a(this.getOptions()),n=!!this.props.active;return t.setActive(n),e.addInteraction(t),n&&this.listen(t,this.props),t}},{key:"updateMapObject",value:function(e,t,n){t.setProperties(this.getOptions());var a=!!this.props.active;return t.setActive(a),this.unlisten(t,n),a&&this.listen(t,this.props),t}},{key:"removeMapObject",value:function(e,t){this.unlisten(t,this.props),e.removeInteraction(t)}},{key:"getOptions",value:function(){var e=Object(as.a)(Object(rs.a)(n.prototype),"getOptions",this).call(this);delete e.layerId,delete e.active,delete e.onDrawStart,delete e.onDrawEnd;var t=this.props.layerId;if(t&&!e.source){var a=this.getMapObject(t);a&&(e.source=a.getSource())}return e}},{key:"listen",value:function(e,t){var n=t.onDrawStart,a=t.onDrawEnd;n&&e.on("drawstart",n),a&&e.on("drawend",a)}},{key:"unlisten",value:function(e,t){var n=t.onDrawStart,a=t.onDrawEnd;n&&e.un("drawstart",n),a&&e.un("drawend",a)}}]),n}(jt),ss=n(30),cs=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"addMapObject",value:function(e){return this.updateView(e)}},{key:"removeMapObject",value:function(e,t){}},{key:"updateMapObject",value:function(e,t){return this.updateView(e)}},{key:"updateView",value:function(e){var t=this.props.projection,n=e.getView().getProjection();if("string"===typeof t&&n&&(n=n.getCode()),t&&t!==n){var a=e.getView(),r=new pt.a(Object(C.a)(Object(C.a)({},this.props),{},{center:Object(ss.m)(a.getCenter()||[0,0],n,t),minZoom:a.getMinZoom(),zoom:a.getZoom()}));e.getLayers().forEach((function(e){e instanceof yt.a&&e.getSource().forEachFeature((function(e){var a;null===(a=e.getGeometry())||void 0===a||a.transform(n,t)}))})),e.setView(r)}else e.getView().setProperties(this.props);return e.getView()}}]),n}(jt),ls=n(544),us=n.n(ls);function ds(e,t,n){if(e.getGeometry()instanceof F.a)e.setStyle(function(e,t,n,a){var r=new nt.a({color:t}),i=new at.a({color:n,width:a});return new rt.c({image:new tt.a({radius:e,fill:r,stroke:i})})}(7,t,"white",1));else{n="number"===typeof n?n:.25;var a=us()(t);a=Array.isArray(a)?[a[0],a[1],a[2],n]:[255,255,255,n],e.setStyle(function(e,t,n){var a=new nt.a({color:e}),r=new at.a({color:t,width:n});return new rt.c({fill:a,stroke:r})}(a,t,2))}}var ps=new $e.a,ms=new $e.a,hs={zIndex:1e3,right:272,top:10},fs=new at.a({color:[255,200,0,1],width:3}),bs=new nt.a({color:[255,200,0,.05]}),vs=new rt.c({stroke:fs,fill:bs,image:new tt.a({radius:10,stroke:fs,fill:bs})}),gs=Object(_r.a)((function(e){return Object(Er.a)({})}),{withTheme:!0})((function(e){var t=e.theme,n=e.mapId,r=e.mapInteraction,i=e.mapProjection,o=e.baseMapLayer,s=e.rgbLayer,c=e.variableLayer,l=e.datasetBoundaryLayer,p=e.placeGroupLayers,m=e.colorBarLegend,h=e.addUserPlace,f=e.addUserPlacesFromText,b=e.userPlaceGroup,g=e.selectPlace,j=e.selectedPlaceId,O=e.places,x=e.imageSmoothing,y=e.onMapRef,w=Object(a.useState)(null),S=Object(G.a)(w,2),T=S[0],C=S[1],k=Object(a.useState)(j||null),P=Object(G.a)(k,2),E=P[0],_=P[1];Object(a.useEffect)((function(){if(T){var e=j||null;if(e!==E){if(ms.clear(),e){var t=function(e,t){var n,a=Object(u.a)(e.getLayers().getArray());try{for(a.s();!(n=a.n()).done;){var r=n.value;if(r instanceof yt.a){var i=r.getSource().getFeatureById(t);if(i)return i}}}catch(o){a.e(o)}finally{a.f()}return null}(T,e);if(t){var n=t.clone();n.setId("Select-"+t.getId()),n.setStyle(void 0),ms.addFeature(n)}}_(e)}}}),[T,j,E]),Object(a.useEffect)((function(){T&&T.getLayers().forEach((function(e){e instanceof ct.a?e.getSource().changed():e.changed()}))}),[T,x]);var I=function(e){if(null!==T&&h&&"Select"!==r){var n=function(){var n=e.feature,a=n.getGeometry();if(!a)return{v:void 0};var i="User-".concat(r,"-").concat($()),o=T.getView().getProjection();if(a instanceof qo.a){var s=Object(Jo.b)(a);n.setGeometry(s)}a=n.clone().getGeometry().transform(o,mt);var c=(new d.a).writeGeometryObject(a);n.setId(i);var l=0;Bt.userLayer&&(l=ps.getFeatures().length);var u=Ae(l);ds(n,Le(u,t.palette.mode),_e.instance.branding.polygonFillOpacity);for(var p=v.get(r),m="",f=1;m="".concat(p," ").concat(f),b.features.find((function(e){return(e.properties||{}).label===m}));f++);h(i,m,u,c,!0)}();if("object"===typeof n)return n.v}return!0};var N=null;m&&(N=Object(ot.jsx)(es,{id:"legend",style:hs,children:m})),null!==s&&(c=s);return Object(ot.jsx)(Qo,{children:Object(ot.jsxs)(gt,{id:n,onClick:function(e){return function(e){if("Select"===r){var t=null,n=e.map.getFeaturesAtPixel(e.pixel);if(n){var a,i=Object(u.a)(n);try{for(i.s();!(a=i.n()).done;){var o=a.value;if("function"===typeof o.getId){t=o.getId()+"";break}}}catch(s){i.e(s)}finally{i.f()}}g&&g(t,O,!1)}}(e)},onMapRef:function(e){y&&y(e),C(e)},mapObjects:Bt,isStale:!0,onDropFiles:function(e){f&&e.forEach((function(e){var t=new FileReader;t.onloadend=function(){"string"===typeof t.result&&f(t.result)},t.readAsText(e,"UTF-8")}))},children:[Object(ot.jsx)(cs,{id:"view",projection:i}),Object(ot.jsxs)(st,{children:[o,c,l,Object(ot.jsx)(wt,{id:"userLayer",opacity:1,zIndex:500,source:ps}),Object(ot.jsx)(wt,{id:"selectionLayer",opacity:.7,zIndex:510,style:vs,source:ms})]}),p,Object(ot.jsx)(os,{id:"drawPoint",layerId:"userLayer",active:"Point"===r,type:Xo.a.POINT,wrapX:!0,stopClick:!0,onDrawEnd:I}),Object(ot.jsx)(os,{id:"drawPolygon",layerId:"userLayer",active:"Polygon"===r,type:Xo.a.POLYGON,wrapX:!0,stopClick:!0,onDrawEnd:I}),Object(ot.jsx)(os,{id:"drawCircle",layerId:"userLayer",active:"Circle"===r,type:Xo.a.CIRCLE,wrapX:!0,stopClick:!0,onDrawEnd:I}),N,Object(ot.jsx)(ns,{bar:!1})]})})}));var js=n(1012);function Os(e){var t=e[0],n=e[e.length-1],a=Math.min(10,Math.max(2,Math.round(-Math.log10(n-t))));return e.map((function(e){return function(e,t){var n=Math.round(e);return Math.abs(n-e)<1e-8?n+"":e.toFixed(t)}(e,a)}))}function xs(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return Os(ys(e,t,n))}function ys(e,t,n){for(var a=(t-e)/(n-1),r=new Array(n),i=0;i<n;i++)r[i]=e+i*a;return r}var ws=function(e){var t=e.colorBar,n=e.opacity,r=e.width,i=e.height,o=e.onOpenEditor,s=Object(a.useRef)(null);return Object(a.useEffect)((function(){var e=s.current;null!==e&&Wt(t,n,e)}),[t,n]),Object(ot.jsx)(ot.Fragment,{children:Boolean(t.imageData)?Object(ot.jsx)("canvas",{ref:s,width:r||240,height:i||24,onClick:o}):Object(ot.jsx)("div",{children:v.get("Unknown color bar")+": ".concat(t.baseName)})})},Ss=Object(li.a)((function(e){return{title:{fontSize:"x-small",fontWeight:"bold",width:"100%",display:"flex",flexWrap:"nowrap",justifyContent:"center",paddingBottom:e.spacing(.5)},label:{fontSize:"x-small",fontWeight:"bold",width:"100%",display:"flex",flexWrap:"nowrap",justifyContent:"space-between"},container:{paddingLeft:e.spacing(1.5),paddingRight:e.spacing(1.5),paddingBottom:e.spacing(.5),paddingTop:e.spacing(.5),color:"black"},sliderBox:{marginTop:e.spacing(1),marginLeft:e.spacing(5),marginRight:e.spacing(5),minWidth:320,width:"calc(100% - ".concat(e.spacing(12),"px)")},colorBarBox:{marginTop:e.spacing(.6),marginLeft:e.spacing(1),marginRight:e.spacing(1),marginBottom:e.spacing(1)},colorBarGroupTitle:{marginTop:e.spacing(.4),color:e.palette.grey[400]},colorBarGroupItemBox:{marginTop:e.spacing(.2)},colorBarMinMaxEditor:{marginTop:e.spacing(2),marginBottom:e.spacing(2)},minMaxBox:{display:"flex",justifyContent:"center"},minTextField:{maxWidth:"8em",paddingRight:2},maxTextField:{maxWidth:"8em",paddingLeft:2}}}));function Ts(e){var t=e.minValue,n=e.maxValue,r=e.count;return Object(ot.jsx)(a.Fragment,{children:xs(t,n,r).map((function(e,t){return Object(ot.jsx)("span",{children:e},t)}))})}function Cs(e){return[e[0]+"",e[1]+""]}var ks={updateVariableColorBar:function(e,t,n){return function(a,r){var i=r().controlState.selectedDatasetId,o=r().controlState.selectedVariableName;i&&o&&a(function(e,t,n,a,r){return{type:Ta,datasetId:e,variableName:t,colorBarMinMax:n,colorBarName:a,opacity:r}}(i,o,e,t,n))}}},Ps=Object(o.b)((function(e){return{variableName:Kt(e),variableUnits:an(e),variableColorBarMinMax:rn(e),variableColorBarName:on(e),variableColorBar:sn(e),variableOpacity:cn(e),colorBars:e.dataState.colorBars}}),ks)((function(e){var t=e.variableName,n=e.variableUnits,r=e.variableColorBarMinMax,i=e.variableColorBarName,o=e.variableColorBar,s=e.variableOpacity,c=e.updateVariableColorBar,l=e.colorBars,d=e.width,p=e.height,m=e.numTicks,h=Ss(),f=a.useState(null),b=Object(G.a)(f,2),g=b[0],j=b[1],O=a.useState(null),x=Object(G.a)(O,2),y=x[0],w=x[1],S=a.useState(r),T=Object(G.a)(S,2),k=T[0],P=T[1],E=a.useState(r),_=Object(G.a)(E,2),I=_[0],N=_[1],M=a.useState(Cs(r)),A=Object(G.a)(M,2),L=A[0],R=A[1],D=a.useState([!1,!1]),z=Object(G.a)(D,2),B=z[0],F=z[1];a.useEffect((function(){R(Cs(r))}),[r]);var V=Boolean(g),U=Boolean(y);if(!t||!l)return null;var W,H,K="".concat(t," (").concat(n||"-",")");if(V){for(var Z,Y=Object(G.a)(I,2),q=Y[0],X=Y[1],J=q<X?X-q:1,Q=Math.floor(Math.log10(J)),$=J*Math.pow(10,-Q),ee=null,te=0,ne=[.25,.2,.15,.125,.1];te<ne.length;te++){var ae=$/ne[te],re=Math.floor(ae);if(Math.abs(re-ae)<1e-10){ee=re;break}}null!==ee&&ee>=2?Z=Math.max(2,Math.round(ee/2)):(Z=4,ee=8);var ie=q<X?J/ee:.5,oe=q-Z*ie,se=X+Z*ie,ce=(se-oe)/(ee+2*Z),le=[oe,q,X,se],ue=Os(le).map((function(e,t){return{value:le[t],label:e}}));W=Object(ot.jsxs)("div",{className:h.colorBarMinMaxEditor,children:[Object(ot.jsx)("span",{style:{paddingLeft:14},children:K}),Object(ot.jsx)(wi.a,{className:h.sliderBox,children:Object(ot.jsx)(go.a,{min:oe,max:se,value:k,marks:ue,step:ce,onChange:function(e,t){Array.isArray(t)&&P([t[0],t[1]])},onChangeCommitted:function(e,t){Array.isArray(t)&&c([t[0],t[1]],i,s)},valueLabelDisplay:"auto",size:"small"})}),Object(ot.jsxs)(wi.a,{component:"form",className:h.minMaxBox,children:[Object(ot.jsx)(co.a,{className:h.minTextField,label:"Minimum",variant:"filled",size:"small",value:L[0],error:B[0],onChange:function(e){return function(e){var t=e.target.value;R([t,L[1]]);var n=Number.parseFloat(t),a=!1;if(!Number.isNaN(n)&&n<k[1]){if(n!==k[0]){var r=[n,k[1]];P(r),N(r),c(r,i,s)}}else a=!0;F([a,B[1]])}(e)}}),Object(ot.jsx)(co.a,{className:h.maxTextField,label:"Maximum",variant:"filled",size:"small",value:L[1],error:B[1],onChange:function(e){return function(e){var t=e.target.value;R([L[0],t]);var n=Number.parseFloat(t),a=!1;if(!Number.isNaN(n)&&n>k[0]){if(n!==k[1]){var r=[k[0],n];P(r),N(r),c(r,i,s)}}else a=!0;F([B[0],a])}(e)}})]})]})}if(U){var de,pe=0,me=[],he=Object(u.a)(l.groups);try{for(he.s();!(de=he.n()).done;){var fe=de.value;if(fe.names&&0!==fe.names.length){me.push(Object(ot.jsx)(Ir.a,{arrow:!0,title:fe.description,placement:"left",children:Object(ot.jsx)(wi.a,{className:h.colorBarGroupTitle,children:fe.title})},pe++));var be,ve=Object(u.a)(fe.names);try{var ge=function(){var e=be.value;me.push(Object(ot.jsx)(wi.a,{className:h.colorBarGroupItemBox,border:1,borderColor:e===o.baseName?"orange":"black",width:240,height:20,children:Object(ot.jsx)(Ir.a,{arrow:!0,title:e,placement:"left",children:Object(ot.jsx)("img",{src:"data:image/png;base64,".concat(l.images[e]),alt:"Color Bar",width:"100%",height:"100%",onClick:function(){var t;t=e,i=Ut(Object(C.a)(Object(C.a)({},o),{},{baseName:t})),c(r,i,s)}})})},pe++))};for(ve.s();!(be=ve.n()).done;)ge()}catch(je){ve.e(je)}finally{ve.f()}}}}catch(je){he.e(je)}finally{he.f()}H=Object(ot.jsxs)(wi.a,{className:h.colorBarBox,children:[Object(ot.jsxs)(wi.a,{component:"span",children:[Object(ot.jsx)(zi.a,{color:"primary",checked:o.isAlpha,onChange:function(e){var t=e.currentTarget.checked;i=Ut(Object(C.a)(Object(C.a)({},o),{},{isAlpha:t})),c(r,i,s)},size:"small",style:{paddingLeft:0,paddingRight:2,paddingTop:4,paddingBottom:4}}),Object(ot.jsx)(wi.a,{component:"span",children:v.get("Hide small values")}),Object(ot.jsx)(zi.a,{color:"primary",checked:o.isReversed,onChange:function(e){var t=e.currentTarget.checked;i=Ut(Object(C.a)(Object(C.a)({},o),{},{isReversed:t})),c(r,i,s)},size:"small",style:{paddingLeft:10,paddingRight:2,paddingTop:4,paddingBottom:4}}),Object(ot.jsx)(wi.a,{component:"span",children:v.get("Reverse")})]}),Object(ot.jsxs)(wi.a,{component:"div",style:{display:"flex",alignItems:"center"},children:[Object(ot.jsx)("span",{children:v.get("Opacity")}),Object(ot.jsx)(go.a,{min:0,max:1,value:s,step:.01,style:{flexGrow:1,marginLeft:10,marginRight:10},onChange:function(e,t){c(r,i,t)},size:"small"})]}),me]})}return Object(ot.jsxs)("div",{className:"ol-control "+h.container,children:[Object(ot.jsx)("div",{className:h.title,children:Object(ot.jsx)("span",{children:K})}),Object(ot.jsx)(ws,{colorBar:o,opacity:s,width:d,height:p,onOpenEditor:function(e){w(e.currentTarget)}}),Object(ot.jsx)("div",{className:h.label,onClick:function(e){j(e.currentTarget),P(r),N(r)},children:Object(ot.jsx)(Ts,{minValue:r[0],maxValue:r[1],count:m||5})}),Object(ot.jsx)(js.a,{anchorEl:g,open:V,onClose:function(){j(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"center"},children:W}),Object(ot.jsx)(js.a,{anchorEl:y,open:U,onClose:function(){w(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:H})]})})),Es={addUserPlace:function(e,t,n,a,r){return function(i,o){i(function(e,t,n,a,r){return{type:da,id:e,label:t,color:n,geometry:a,selectPlace:r}}(e,t,n,a,r)),o().controlState.autoShowTimeSeries&&i(ba())}},addUserPlacesFromText:ma,selectPlace:Fa},_s=Object(o.b)((function(e,t){return{locale:e.controlState.locale,variableLayer:An(e),rgbLayer:Ln(e),datasetBoundaryLayer:Nn(e),placeGroupLayers:Bn(e),colorBarLegend:Object(ot.jsx)(Ps,{}),userPlaceGroup:_t(e),mapId:"map",mapInteraction:e.controlState.mapInteraction,mapProjection:$t(e),selectedPlaceId:e.controlState.selectedPlaceId,places:vn(e),baseMapLayer:Un(e),imageSmoothing:Jt(e),onMapRef:t.onMapRef}}),Es)(gs),Is=n(553),Ns=n.n(Is),Ms=n(545),As=n(587),Ls=n(549),Rs=n(552),Ds=n(986),zs=n(987),Bs=n(562),Fs=n(563),Vs=n(988),Gs=n(333),Us=n(325),Ws=function(e){return Object(Er.a)({chartContainer:{userSelect:"none",marginTop:e.spacing(1),width:"99%",height:"32vh",display:"flex",flexDirection:"column",alignItems:"flex-stretch"},responsiveContainer:{flexGrow:1},actionButton:{zIndex:1e3,opacity:.8},toolTipContainer:{backgroundColor:"black",opacity:.8,color:"white",border:"2px solid black",borderRadius:e.spacing(2),padding:e.spacing(1.5)},toolTipValue:{fontWeight:"bold"},toolTipLabel:{fontWeight:"bold",paddingBottom:e.spacing(1)},chartTitle:{}})},Hs=["dataMin","dataMax"],Ks=["auto","auto"],Zs=Object(_r.a)(Ws,{withTheme:!0})((function(e){var t,n,r=e.classes,i=e.timeSeriesGroup,o=e.selectTimeSeries,s=e.selectedTime,c=e.selectTime,l=e.selectedTimeRange,u=e.selectTimeRange,d=e.places,p=e.selectPlace,m=e.placeInfos,h=e.dataTimeRange,f=e.theme,b=e.showErrorBars,g=e.showPointsOnly,j=e.removeTimeSeriesGroup,O=e.completed,x=Object(a.useState)({}),y=Object(G.a)(x,2),w=y[0],S=y[1],T=function(){S({})},k=f.palette.mode,P=f.palette.primary.light,E=f.palette.primary.main,_=f.palette.primary.contrastText,I=!1,N=null,M=null;if(l){I=!((t=l)===(n=h||null)||null!==t&&null!=n&&t[0]===n[0]&&t[1]===n[1]);var A=Object(G.a)(l,2);N=A[0],M=A[1]}var L=function(){var e=w.firstTime,t=w.secondTime;if(e!==t&&void 0!==e&&void 0!==t){var n=e,a=t;if(n>a){var r=[a,n];n=r[0],a=r[1]}T(),u&&u([n,a])}else T()},R=function(){T(),u&&u(h||null)},D=null,z=i.timeSeriesArray.map((function(e,t){var n=e.source,a=n.valueDataKey,r=n.variableName,s="yellow";if(m){var c=m[n.placeId];if(c){var l=c.place,u=c.label,h=c.color;if("Point"===l.geometry.type){var f=l.geometry.coordinates[0],v=l.geometry.coordinates[1];r+=" (".concat(u,": ").concat(v.toFixed(5),",").concat(f.toFixed(5),")")}else r+=" (".concat(u,")");s=h}}var j=[];e.data.forEach((function(e){if(null!==e[a]){var t=!0,n=!0;null!==N&&(t=e.time>=N),null!==M&&(n=e.time<=M),t&&n&&j.push(e)}})),null===D&&(D=a);var O,x=Le(s,k);return a&&b&&n.errorDataKey&&(O=Object(ot.jsx)(Ms.a,{dataKey:n.errorDataKey,width:4,strokeWidth:1,stroke:x})),Object(ot.jsx)(As.a,{type:"monotone",name:r,unit:n.variableUnits,data:j,dataKey:a,dot:Object(ot.jsx)(qs,{radius:3,stroke:x,fill:"white",strokeWidth:2}),activeDot:Object(ot.jsx)(qs,{radius:3,stroke:"white",fill:x,strokeWidth:2}),stroke:x,strokeOpacity:g?0:e.dataProgress,isAnimationActive:!1,onClick:function(){return n=i.id,a=t,r=e,o&&o(n,a,r),void p(r.source.placeId,d,!0);var n,a,r},children:O},t)})),B=null;null!==s&&(B=Object(ot.jsx)(Ls.a,{isFront:!0,x:s,stroke:E,strokeWidth:3,strokeOpacity:.5}));var F=w.firstTime,V=w.secondTime,U=null;void 0!==F&&void 0!==V&&(U=Object(ot.jsx)(Rs.a,{x1:F,x2:V,strokeOpacity:.3,fill:P,fillOpacity:.3}));var W=[];if(I){var H=Object(ot.jsx)(Cr.a,{className:r.actionButton,"aria-label":"Zoom Out",onClick:function(){R()},size:"large",children:Object(ot.jsx)(Ns.a,{})},"zoomOutButton");W.push(H)}var K,Z=O.reduce((function(e,t){return e+t}),0)/O.length;K=Z>0&&Z<100?Object(ot.jsx)(Ur.a,{size:24,className:r.actionButton,color:"secondary"},"loadingTimeSeriesGroup"):Object(ot.jsx)(Cr.a,{className:r.actionButton,"aria-label":"Close",onClick:function(){j&&j(i.id)},size:"large",children:Object(ot.jsx)(di.a,{})},"removeTimeSeriesGroup"),W.push(K);var Y=v.get("Time-Series"),q=i.variableUnits||v.get("unknown units"),X="".concat(Y," (").concat(q,")");return Object(ot.jsxs)("div",{className:r.chartContainer,children:[Object(ot.jsxs)(wi.a,{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",children:[Object(ot.jsx)(Tr.a,{className:r.chartTitle,children:X}),Object(ot.jsx)(wi.a,{display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"center",children:W})]}),Object(ot.jsx)(Ds.a,{width:"99%",className:r.responsiveContainer,children:Object(ot.jsxs)(zs.a,{onMouseDown:function(e){var t=e&&e.activeLabel;S({firstTime:t})},onMouseMove:function(e){if(void 0!==w.firstTime){var t=e&&e.activeLabel;S(Object(C.a)(Object(C.a)({},w),{},{secondTime:t}))}},onMouseUp:function(e){L()},onMouseEnter:function(){T()},onMouseLeave:function(){T()},onClick:function(e){e&&c&&null!==e.activeLabel&&Number.isFinite(e.activeLabel)&&c(e.activeLabel),T()},syncId:"anyId",style:{color:_},children:[Object(ot.jsx)(Bs.a,{dataKey:"time",type:"number",tickCount:6,domain:l||Hs,tickFormatter:function(e){return"number"===typeof e&&Number.isFinite(e)?qn(e):null},stroke:_,allowDuplicatedCategory:!1}),Object(ot.jsx)(Fs.a,{dataKey:D||"mean",type:"number",domain:Ks,stroke:_}),Object(ot.jsx)(Vs.a,{strokeDasharray:"3 3"}),Object(ot.jsx)(Gs.a,{content:Object(ot.jsx)(Ys,{})}),Object(ot.jsx)(Us.a,{}),z,U,B]})})]})})),Ys=Object(_r.a)(Ws)((function(e){var t=e.classes,n=e.active,a=e.label,r=e.payload;if(!n)return null;if("number"!==typeof a)return null;if(!r||0===r.length)return null;var i=r.map((function(e,n){var a=e.name,r=e.value,i=e.color,o=e.unit,s=e.dataKey;if("number"!==typeof r)return null;var c=r.toFixed(3);"#00000000"===i&&(i="#FAFFDD");var l=-1!==a.indexOf(":")?"":" (".concat(s,")");return Object(ot.jsxs)("div",{children:[Object(ot.jsxs)("span",{children:[a,":\xa0"]}),Object(ot.jsx)("span",{className:t.toolTipValue,style:{color:i},children:c}),Object(ot.jsxs)("span",{children:["\xa0","".concat(o," ").concat(l)]})]},n)}));return i?Object(ot.jsxs)("div",{className:t.toolTipContainer,children:[Object(ot.jsx)("span",{className:t.toolTipLabel,children:"".concat(Xn(a)," UTC")}),i]}):null})),qs=function(e){var t=e.cx,n=e.cy,a=e.radius,r=e.stroke,i=e.fill,o=e.strokeWidth,s=a+.5*o,c=2*s,l=Math.floor(100*a/c+.5)+"%",u=Math.floor(100*o/c+.5)+"%";return"number"===typeof t&&"number"===typeof n?Object(ot.jsx)("svg",{x:t-s,y:n-s,width:c,height:c,viewBox:"0 0 ".concat(1024," ").concat(1024),children:Object(ot.jsx)("circle",{cx:"50%",cy:"50%",r:l,strokeWidth:u,stroke:r,fill:i})}):null},Xs=Object(_r.a)((function(e){return Object(Er.a)({box:{marginTop:e.spacing(1),marginLeft:e.spacing(5),marginRight:e.spacing(5),width:"calc(100% - ".concat(e.spacing(18),")"),height:"5em",display:"flex",alignItems:"flex-end"}})}))((function(e){var t=e.classes,n=e.dataTimeRange,r=e.selectedTimeRange,i=e.selectTimeRange,o=Object(a.useState)(r),s=Object(G.a)(o,2),c=s[0],l=s[1];Object(a.useEffect)((function(){l(r)}),[r]);var u=Array.isArray(n);u||(n=[Date.now()-2*Jn,Date.now()]);var d=[{value:n[0],label:qn(n[0])},{value:n[1],label:qn(n[1])}];return Object(ot.jsx)(wi.a,{className:t.box,children:Object(ot.jsx)(go.a,{disabled:!u,min:n[0],max:n[1],value:c,marks:d,onChange:function(e,t){Array.isArray(t)&&l([t[0],t[1]])},onChangeCommitted:function(e,t){i&&Array.isArray(t)&&i([t[0],t[1]])},size:"small",valueLabelDisplay:"on",valueLabelFormat:function(e){return Xn(e)}})})})),Js=Object(_r.a)((function(e){return Object(Er.a)({chartContainer:{display:"flex",flexDirection:"column",flexWrap:"wrap",flexFlow:"flex-start",alignItems:"center"},noChartsCard:{width:"20em"},noChartsTitle:{fontSize:14}})}),{withTheme:!0})((function(e){var t=e.classes,n=e.locale,a=e.timeSeriesGroups,r=e.selectedTime,i=e.selectedTimeRange,o=e.dataTimeRange,s=e.selectTime,c=e.selectTimeRange,l=e.removeTimeSeriesGroup,u=e.showPointsOnly,d=e.showErrorBars,p=e.placeInfos,m=e.places,h=e.selectPlace,f=a.map((function(e){var t=e.timeSeriesArray.map((function(e){return e.dataProgress?100*e.dataProgress:0}));return Object(ot.jsx)(Zs,{locale:n,timeSeriesGroup:e,selectedTime:r,selectedTimeRange:i,dataTimeRange:o,selectTime:s,selectTimeRange:c,removeTimeSeriesGroup:l,completed:t,showPointsOnly:u,showErrorBars:d,placeInfos:p,places:m,selectPlace:h},e.id)}));return 0===f.length?null:Object(ot.jsxs)("div",{className:t.chartContainer,children:[Object(ot.jsx)(Xs,{selectedTimeRange:i,dataTimeRange:o,selectTimeRange:c}),f]})})),Qs={selectTime:Wa,selectTimeRange:Za,removeTimeSeriesGroup:function(e){return{type:ja,id:e}},selectPlace:Fa},$s=Object(o.b)((function(e){return{locale:e.controlState.locale,timeSeriesGroups:e.dataState.timeSeriesGroups,selectedTime:e.controlState.selectedTime,selectedTimeRange:e.controlState.selectedTimeRange,dataTimeRange:ln(e),showPointsOnly:e.controlState.showTimeSeriesPointsOnly,showErrorBars:e.controlState.showTimeSeriesErrorBars,placeInfos:yn(e),places:vn(e)}}),Qs)(Js),ec=n(1030),tc=n(1031),nc=n(1032),ac=n(63),rc=n(29),ic={type:"change"},oc={type:"start"},sc={type:"end"},cc=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(e,a){var r;Object(p.a)(this,n),(r=t.call(this)).object=e,r.domElement=a,r.domElement.style.touchAction="none",r.enabled=!0,r.target=new rc.C,r.minDistance=0,r.maxDistance=1/0,r.minZoom=0,r.maxZoom=1/0,r.minPolarAngle=0,r.maxPolarAngle=Math.PI,r.minAzimuthAngle=-1/0,r.maxAzimuthAngle=1/0,r.enableDamping=!1,r.dampingFactor=.05,r.enableZoom=!0,r.zoomSpeed=1,r.enableRotate=!0,r.rotateSpeed=1,r.enablePan=!0,r.panSpeed=1,r.screenSpacePanning=!0,r.keyPanSpeed=7,r.autoRotate=!1,r.autoRotateSpeed=2,r.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},r.mouseButtons={LEFT:rc.l.ROTATE,MIDDLE:rc.l.DOLLY,RIGHT:rc.l.PAN},r.touches={ONE:rc.x.ROTATE,TWO:rc.x.DOLLY_PAN},r.target0=r.target.clone(),r.position0=r.object.position.clone(),r.zoom0=r.object.zoom,r._domElementKeyEvents=null,r.getPolarAngle=function(){return l.phi},r.getAzimuthalAngle=function(){return l.theta},r.getDistance=function(){return this.object.position.distanceTo(this.target)},r.listenToKeyEvents=function(e){e.addEventListener("keydown",Z),this._domElementKeyEvents=e},r.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},r.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(ic),i.update(),s=o.NONE},r.update=function(){var t=new rc.C,n=(new rc.s).setFromUnitVectors(e.up,new rc.C(0,1,0)),a=n.clone().invert(),r=new rc.C,p=new rc.s,f=2*Math.PI;return function(){var e=i.object.position;t.copy(e).sub(i.target),t.applyQuaternion(n),l.setFromVector3(t),i.autoRotate&&s===o.NONE&&k(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(l.theta+=u.theta*i.dampingFactor,l.phi+=u.phi*i.dampingFactor):(l.theta+=u.theta,l.phi+=u.phi);var b=i.minAzimuthAngle,v=i.maxAzimuthAngle;return isFinite(b)&&isFinite(v)&&(b<-Math.PI?b+=f:b>Math.PI&&(b-=f),v<-Math.PI?v+=f:v>Math.PI&&(v-=f),l.theta=b<=v?Math.max(b,Math.min(v,l.theta)):l.theta>(b+v)/2?Math.max(b,l.theta):Math.min(v,l.theta)),l.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=d,l.radius=Math.max(i.minDistance,Math.min(i.maxDistance,l.radius)),!0===i.enableDamping?i.target.addScaledVector(m,i.dampingFactor):i.target.add(m),t.setFromSpherical(l),t.applyQuaternion(a),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(u.theta*=1-i.dampingFactor,u.phi*=1-i.dampingFactor,m.multiplyScalar(1-i.dampingFactor)):(u.set(0,0,0),m.set(0,0,0)),d=1,!!(h||r.distanceToSquared(i.object.position)>c||8*(1-p.dot(i.object.quaternion))>c)&&(i.dispatchEvent(ic),r.copy(i.object.position),p.copy(i.object.quaternion),h=!1,!0)}}(),r.dispose=function(){i.domElement.removeEventListener("contextmenu",Y),i.domElement.removeEventListener("pointerdown",G),i.domElement.removeEventListener("pointercancel",H),i.domElement.removeEventListener("wheel",K),i.domElement.removeEventListener("pointermove",U),i.domElement.removeEventListener("pointerup",W),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",Z)};var i=Object(ac.a)(r),o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},s=o.NONE,c=1e-6,l=new rc.w,u=new rc.w,d=1,m=new rc.C,h=!1,f=new rc.B,b=new rc.B,v=new rc.B,g=new rc.B,j=new rc.B,O=new rc.B,x=new rc.B,y=new rc.B,w=new rc.B,S=[],T={};function C(){return Math.pow(.95,i.zoomSpeed)}function k(e){u.theta-=e}function P(e){u.phi-=e}var E=function(){var e=new rc.C;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),m.add(e)}}(),_=function(){var e=new rc.C;return function(t,n){!0===i.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),m.add(e)}}(),I=function(){var e=new rc.C;return function(t,n){var a=i.domElement;if(i.object.isPerspectiveCamera){var r=i.object.position;e.copy(r).sub(i.target);var o=e.length();o*=Math.tan(i.object.fov/2*Math.PI/180),E(2*t*o/a.clientHeight,i.object.matrix),_(2*n*o/a.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(E(t*(i.object.right-i.object.left)/i.object.zoom/a.clientWidth,i.object.matrix),_(n*(i.object.top-i.object.bottom)/i.object.zoom/a.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function N(e){i.object.isPerspectiveCamera?d/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function M(e){i.object.isPerspectiveCamera?d*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function A(e){f.set(e.clientX,e.clientY)}function L(e){g.set(e.clientX,e.clientY)}function R(){if(1===S.length)f.set(S[0].pageX,S[0].pageY);else{var e=.5*(S[0].pageX+S[1].pageX),t=.5*(S[0].pageY+S[1].pageY);f.set(e,t)}}function D(){if(1===S.length)g.set(S[0].pageX,S[0].pageY);else{var e=.5*(S[0].pageX+S[1].pageX),t=.5*(S[0].pageY+S[1].pageY);g.set(e,t)}}function z(){var e=S[0].pageX-S[1].pageX,t=S[0].pageY-S[1].pageY,n=Math.sqrt(e*e+t*t);x.set(0,n)}function B(e){if(1===S.length)b.set(e.pageX,e.pageY);else{var t=J(e),n=.5*(e.pageX+t.x),a=.5*(e.pageY+t.y);b.set(n,a)}v.subVectors(b,f).multiplyScalar(i.rotateSpeed);var r=i.domElement;k(2*Math.PI*v.x/r.clientHeight),P(2*Math.PI*v.y/r.clientHeight),f.copy(b)}function F(e){if(1===S.length)j.set(e.pageX,e.pageY);else{var t=J(e),n=.5*(e.pageX+t.x),a=.5*(e.pageY+t.y);j.set(n,a)}O.subVectors(j,g).multiplyScalar(i.panSpeed),I(O.x,O.y),g.copy(j)}function V(e){var t=J(e),n=e.pageX-t.x,a=e.pageY-t.y,r=Math.sqrt(n*n+a*a);y.set(0,r),w.set(0,Math.pow(y.y/x.y,i.zoomSpeed)),N(w.y),x.copy(y)}function G(e){!1!==i.enabled&&(0===S.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",U),i.domElement.addEventListener("pointerup",W)),function(e){S.push(e)}(e),"touch"===e.pointerType?function(e){switch(X(e),S.length){case 1:switch(i.touches.ONE){case rc.x.ROTATE:if(!1===i.enableRotate)return;R(),s=o.TOUCH_ROTATE;break;case rc.x.PAN:if(!1===i.enablePan)return;D(),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(i.touches.TWO){case rc.x.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&z(),i.enablePan&&D(),s=o.TOUCH_DOLLY_PAN;break;case rc.x.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&z(),i.enableRotate&&R(),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&i.dispatchEvent(oc)}(e):function(e){var t;switch(e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case rc.l.DOLLY:if(!1===i.enableZoom)return;!function(e){x.set(e.clientX,e.clientY)}(e),s=o.DOLLY;break;case rc.l.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;L(e),s=o.PAN}else{if(!1===i.enableRotate)return;A(e),s=o.ROTATE}break;case rc.l.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;A(e),s=o.ROTATE}else{if(!1===i.enablePan)return;L(e),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&i.dispatchEvent(oc)}(e))}function U(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(X(e),s){case o.TOUCH_ROTATE:if(!1===i.enableRotate)return;B(e),i.update();break;case o.TOUCH_PAN:if(!1===i.enablePan)return;F(e),i.update();break;case o.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&V(e),i.enablePan&&F(e)}(e),i.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&V(e),i.enableRotate&&B(e)}(e),i.update();break;default:s=o.NONE}}(e):function(e){switch(s){case o.ROTATE:if(!1===i.enableRotate)return;!function(e){b.set(e.clientX,e.clientY),v.subVectors(b,f).multiplyScalar(i.rotateSpeed);var t=i.domElement;k(2*Math.PI*v.x/t.clientHeight),P(2*Math.PI*v.y/t.clientHeight),f.copy(b),i.update()}(e);break;case o.DOLLY:if(!1===i.enableZoom)return;!function(e){y.set(e.clientX,e.clientY),w.subVectors(y,x),w.y>0?N(C()):w.y<0&&M(C()),x.copy(y),i.update()}(e);break;case o.PAN:if(!1===i.enablePan)return;!function(e){j.set(e.clientX,e.clientY),O.subVectors(j,g).multiplyScalar(i.panSpeed),I(O.x,O.y),g.copy(j),i.update()}(e)}}(e))}function W(e){q(e),0===S.length&&(i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",U),i.domElement.removeEventListener("pointerup",W)),i.dispatchEvent(sc),s=o.NONE}function H(e){q(e)}function K(e){!1!==i.enabled&&!1!==i.enableZoom&&s===o.NONE&&(e.preventDefault(),i.dispatchEvent(oc),function(e){e.deltaY<0?M(C()):e.deltaY>0&&N(C()),i.update()}(e),i.dispatchEvent(sc))}function Z(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){var t=!1;switch(e.code){case i.keys.UP:I(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:I(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:I(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:I(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function Y(e){!1!==i.enabled&&e.preventDefault()}function q(e){delete T[e.pointerId];for(var t=0;t<S.length;t++)if(S[t].pointerId===e.pointerId)return void S.splice(t,1)}function X(e){var t=T[e.pointerId];void 0===t&&(t=new rc.B,T[e.pointerId]=t),t.set(e.pageX,e.pageY)}function J(e){var t=e.pointerId===S[0].pointerId?S[1]:S[0];return T[t.pointerId]}return i.domElement.addEventListener("contextmenu",Y),i.domElement.addEventListener("pointerdown",G),i.domElement.addEventListener("pointercancel",H),i.domElement.addEventListener("wheel",K,{passive:!1}),r.update(),r}return n}(rc.g),lc={uniforms:{u_size:{value:new rc.C(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new rc.B(0,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:'\n\n        varying vec4 v_nearpos;\n        varying vec4 v_farpos;\n        varying vec3 v_position;\n\n        void main() {\n            // Prepare transforms to map to "camera view". See also:\n            // https://threejs.org/docs/#api/renderers/webgl/WebGLProgram\n            mat4 viewModelMatrix = inverse(modelViewMatrix);\n\n            // Project local vertex coordinate to camera position. Then do a step\n            // backward (in cam coords) to the near clipping plane, and project back. Do\n            // the same for the far clipping plane. This gives us all the information we\n            // need to calculate the ray and truncate it to the viewing cone.\n            vec4 position4 = vec4(position, 1.0);\n            vec4 pos_in_cam = modelViewMatrix * position4;\n\n            // Intersection of ray and near clipping plane (z = -1 in clip coords)\n            pos_in_cam.z = -pos_in_cam.w;\n            // pos_in_cam.w = 1.0;\n            // pos_in_cam.z = -1.0;\n            v_nearpos = viewModelMatrix * pos_in_cam;\n\n            // Intersection of ray and far clipping plane (z = +1 in clip coords)\n            pos_in_cam.z = pos_in_cam.w;\n            // pos_in_cam.z = 1.0;\n            v_farpos = viewModelMatrix * pos_in_cam;\n\n            // Set varyings and output pos\n            v_position = position;\n            gl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;\n        }',fragmentShader:"\n\n        precision highp float;\n        precision mediump sampler3D;\n\n        uniform vec3 u_size;\n        uniform int u_renderstyle;\n        uniform float u_renderthreshold;\n        uniform vec2 u_clim;\n\n        uniform sampler3D u_data;\n        uniform sampler2D u_cmdata;\n\n        varying vec3 v_position;\n        varying vec4 v_nearpos;\n        varying vec4 v_farpos;\n\n        // The maximum distance through our rendering volume is sqrt(3).\n        const int MAX_STEPS = 2000; // 887; // 887 for 512^3, 1774 for 1024^3\n        const int REFINEMENT_STEPS = 8; // 4;\n        const float relative_step_size = 1.0;\n        const vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);\n        const vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);\n        const vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);\n        const float shininess = 40.0;\n\n        void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);\n        void cast_aip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);\n        void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);\n\n        float sample1(vec3 texcoords);\n        vec4 apply_colormap(float val);\n        vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);\n\n        void main() {\n            // Normalize clipping plane info\n            vec3 farpos = v_farpos.xyz / v_farpos.w;\n            vec3 nearpos = v_nearpos.xyz / v_nearpos.w;\n\n            // Calculate unit vector pointing in the view direction through this fragment.\n            vec3 view_ray = normalize(nearpos.xyz - farpos.xyz);\n\n            // Compute the (negative) distance to the front surface or near clipping plane.\n            // v_position is the back face of the cuboid, so the initial distance calculated in the dot\n            // product below is the distance from near clip plane to the back of the cuboid\n            float distance = dot(nearpos - v_position, view_ray);\n            distance = max(distance, min((-0.5 - v_position.x) / view_ray.x,\n                                         (u_size.x - 0.5 - v_position.x) / view_ray.x));\n            distance = max(distance, min((-0.5 - v_position.y) / view_ray.y,\n                                         (u_size.y - 0.5 - v_position.y) / view_ray.y));\n            distance = max(distance, min((-0.5 - v_position.z) / view_ray.z,\n                                         (u_size.z - 0.5 - v_position.z) / view_ray.z));\n\n            // Now we have the starting position on the front surface\n            vec3 front = v_position + view_ray * distance;\n\n            // Decide how many steps to take\n            int nsteps = int(-distance / relative_step_size + 0.5);\n            if ( nsteps < 1 )\n                discard;\n\n            // Get starting location and step vector in texture coordinates\n            vec3 step = ((v_position - front) / u_size) / float(nsteps);\n            vec3 start_loc = front / u_size;\n\n            // For testing: show the number of steps. This helps to establish\n            // whether the rays are correctly oriented\n            //'gl_FragColor = vec4(0.0, float(nsteps) / 1.0 / u_size.x, 1.0, 1.0);\n            //'return;\n\n            if (u_renderstyle == 0)\n                cast_mip(start_loc, step, nsteps, view_ray);\n            else if (u_renderstyle == 1)\n                cast_aip(start_loc, step, nsteps, view_ray);\n            else if (u_renderstyle == 2)\n                cast_iso(start_loc, step, nsteps, view_ray);\n\n            if (gl_FragColor.a < 0.05)\n                discard;\n        }\n\n        float sample1(vec3 texcoords) {\n            /* Sample float value from a 3D texture. Assumes intensity data. */\n            return texture(u_data, texcoords.xyz).r;\n        }\n\n        vec4 apply_colormap(float val) {\n            val = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);\n            return texture2D(u_cmdata, vec2(val, 0.5));\n        }\n\n        void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {\n\n            float max_val = -1e6;\n            vec3 loc = start_loc;\n\n            // Enter the raycasting loop. In WebGL 1 the loop index cannot be compared with\n            // non-constant expression. So we use a hard-coded max, and an additional condition\n            // inside the loop.\n            for (int iter = 0; iter < MAX_STEPS; iter++) {\n                if (iter >= nsteps) {\n                    break;\n                }\n                // Sample from the 3D texture\n                float val = sample1(loc);\n                // Apply MIP operation\n                if (val > max_val) {\n                    max_val = val;\n                }\n                // Advance location deeper into the volume\n                loc += step;\n            }\n\n            // Resolve final color\n            gl_FragColor = apply_colormap(max_val);\n        }\n\n        void cast_aip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {\n\n            float avg_val = 0.0;\n            int count = 0;\n            vec3 loc = start_loc;\n            float eps = 0.02;\n\n            // Enter the raycasting loop. In WebGL 1 the loop index cannot be compared with\n            // non-constant expression. So we use a hard-coded max, and an additional condition\n            // inside the loop.\n            for (int iter = 0; iter < MAX_STEPS; iter++) {\n                if (iter >= nsteps) {\n                    break;\n                }\n                // Sample from the 3D texture\n                float val = sample1(loc);\n                // Apply SUM operation   \n                if (abs(loc.x - 0.5) < eps \n                    || abs(loc.y - 0.5) < eps \n                    || abs(loc.z - 0.5) < eps) {\n                    avg_val += val;\n                    count += 1;\n                }          \n                // Advance location deeper into the volume\n                loc += step;\n            }\n\n            // Resolve final color\n            if (count > 0) {\n                gl_FragColor = apply_colormap(avg_val / float(count));\n            } else {\n                gl_FragColor = vec4(0.0);\n            }\n        }\n\n        void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {\n\n            gl_FragColor = vec4(0.0);    // init transparent\n            vec4 color3 = vec4(0.0);    // final color\n            vec3 dstep = 1.5 / u_size;    // step to sample derivative\n            vec3 loc = start_loc;\n\n            float low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);\n\n            // Enter the raycasting loop. In WebGL 1 the loop index cannot be compared with\n            // non-constant expression. So we use a hard-coded max, and an additional condition\n            // inside the loop.\n            for (int iter=0; iter<MAX_STEPS; iter++) {\n                if (iter >= nsteps)\n                    break;\n\n                // Sample from the 3D texture\n                float val = sample1(loc);\n\n                if (val > low_threshold) {\n                    // Take the last interval in smaller steps\n                    vec3 iloc = loc - 0.5 * step;\n                    vec3 istep = step / float(REFINEMENT_STEPS);\n                    for (int i=0; i<REFINEMENT_STEPS; i++) {\n                        val = sample1(iloc);\n                        if (val > u_renderthreshold) {\n                            gl_FragColor = add_lighting(val, iloc, dstep, view_ray);\n                            return;\n                        }\n                        iloc += istep;\n                    }\n                }\n\n                // Advance location deeper into the volume\n                loc += step;\n            }\n        }\n\n        vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray) {\n            // Calculate color by incorporating lighting\n\n            // View direction\n            vec3 V = normalize(view_ray);\n\n            // calculate normal vector from gradient\n            vec3 N;\n            float val1, val2;\n            val1 = sample1(loc + vec3(-step[0], 0.0, 0.0));\n            val2 = sample1(loc + vec3(+step[0], 0.0, 0.0));\n            N[0] = val1 - val2;\n            val = max(max(val1, val2), val);\n            val1 = sample1(loc + vec3(0.0, -step[1], 0.0));\n            val2 = sample1(loc + vec3(0.0, +step[1], 0.0));\n            N[1] = val1 - val2;\n            val = max(max(val1, val2), val);\n            val1 = sample1(loc + vec3(0.0, 0.0, -step[2]));\n            val2 = sample1(loc + vec3(0.0, 0.0, +step[2]));\n            N[2] = val1 - val2;\n            val = max(max(val1, val2), val);\n\n            float gm = length(N); // gradient magnitude\n            N = normalize(N);\n\n            // Flip normal so it points towards viewer\n            float Nselect = float(dot(N, V) > 0.0);\n            N = (2.0 * Nselect - 1.0) * N;    // ==    Nselect * N - (1.0-Nselect)*N;\n\n            // Init colors\n            vec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);\n            vec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);\n            vec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);\n\n            // note: could allow multiple lights\n            for (int i=0; i<1; i++) {\n                 // Get light direction (make sure to prevent zero devision)\n                vec3 L = normalize(view_ray);    //lightDirs[i];\n                float lightEnabled = float( length(L) > 0.0 );\n                L = normalize(L + (1.0 - lightEnabled));\n\n                // Calculate lighting properties\n                float lambertTerm = clamp(dot(N, L), 0.0, 1.0);\n                vec3 H = normalize(L+V); // Halfway vector\n                float specularTerm = pow(max(dot(H, N), 0.0), shininess);\n\n                // Calculate mask\n                float mask1 = lightEnabled;\n\n                // Calculate colors\n                ambient_color +=    mask1 * ambient_color;    // * gl_LightSource[i].ambient;\n                diffuse_color +=    mask1 * lambertTerm;\n                specular_color += mask1 * specularTerm * specular_color;\n            }\n\n            // Calculate final color by componing different components\n            vec4 final_color;\n            vec4 color = apply_colormap(val);\n            final_color = color * (ambient_color + diffuse_color) + specular_color;\n            final_color.a = color.a;\n            return final_color;\n        }"};var uc=new(function(){function e(){Object(p.a)(this,e),this.textures=void 0,this.textures={}}return Object(m.a)(e,[{key:"get",value:function(e,t){var n=Ut(e),a=this.textures[n];return a||(a=(new rc.z).load("data:image/png;base64,".concat(e.imageData),t),this.textures[n]=a),a}}]),e}()),dc=function(){function e(t){if(Object(p.a)(this,e),this.canvas=void 0,this.camera=void 0,this.controls=void 0,this.renderer=void 0,this.scene=void 0,this.texture=void 0,this.material=void 0,!function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(t){return!1}}())throw new Error("Missing WebGL2");this.render=this.render.bind(this);var n=new rc.D({canvas:t});n.setPixelRatio(window.devicePixelRatio),n.setSize(t.clientWidth,t.clientHeight);var a=100,r=t.clientWidth/t.clientHeight,i=new rc.q(-a*r,a*r,a,-a,-1e3,1e3);i.position.set(0,0,100),i.up.set(0,1,0);var o=new cc(i,n.domElement);o.target.set(100,50,0),o.minZoom=.1,o.maxZoom=500,o.enablePan=!0,o.update(),this.canvas=t,this.renderer=n,this.camera=i,this.controls=o,this.scene=null,this.texture=null,this.material=null,o.addEventListener("change",this.render),t.addEventListener("resize",this.onCanvasResize)}return Object(m.a)(e,[{key:"setVolume",value:function(e,t){var n=new rc.e(e.data,e.xLength,e.yLength,e.zLength);n.format=rc.t,n.type=rc.i,n.minFilter=n.magFilter=rc.j,n.unpackAlignment=1,n.needsUpdate=!0;var a=lc,r=rc.A.clone(a.uniforms),i=Object(G.a)(e.spacing,3),o=i[0],s=i[1],c=i[2],l=Math.floor(o*e.xLength),u=Math.floor(s*e.yLength),d=Math.floor(c*e.zLength);r.u_data.value=n,r.u_size.value.set(l,u,d);var p=new rc.v({uniforms:r,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,side:rc.a}),m=new rc.b(l,u,d);m.translate(l/2,u/2,d/2);var h=new rc.o(m,p),f=new rc.u;f.add(h),f.add(new rc.c(h)),this.scene=f,this.material=p,this.texture=n,this.setVolumeOptions(t)}},{key:"setVolumeOptions",value:function(e){var t=this.material;if(null!==t){var n=e.value1,a=e.value2,r=e.isoThreshold,i=e.renderMode,o=e.colorBar,s=t.uniforms;s.u_clim.value.set(n,a),s.u_renderthreshold.value=r,s.u_renderstyle.value="mip"===i?0:"aip"===i?1:2,s.u_cmdata.value=uc.get(o,this.render),this.render()}}},{key:"getMaterial",value:function(){if(null===this.material)throw new Error("Volume not set!");return this.material}},{key:"onCanvasResize",value:function(){console.warn("Alarm: Canvas resize!");var e=this.renderer.domElement;this.renderer.setSize(e.clientWidth,e.clientHeight);var t=e.clientWidth/e.clientHeight,n=this.camera.top-this.camera.bottom;this.camera.left=-n*t/2,this.camera.right=n*t/2,this.camera.updateProjectionMatrix(),this.render()}},{key:"render",value:function(){null!==this.scene&&this.renderer.render(this.scene,this.camera)}}]),e}(),pc=n(564),mc=function(){function e(t,n,a){Object(p.a)(this,e);var r=this;this.volume=t,n=n||0,Object.defineProperty(this,"index",{get:function(){return n},set:function(e){return n=e,r.geometryNeedsUpdate=!0,n}}),this.axis=a||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var i=new rc.y(this.canvas);i.minFilter=rc.j,i.wrapS=i.wrapT=rc.d;var o=new rc.p({map:i,side:rc.f,transparent:!0});this.mesh=new rc.o(this.geometry,o),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()}return Object(m.a)(e,[{key:"repaint",value:function(){this.geometryNeedsUpdate&&this.updateGeometry();var e=this.iLength,t=this.jLength,n=this.sliceAccess,a=this.volume,r=this.canvasBuffer,i=this.ctxBuffer,o=i.getImageData(0,0,e,t),s=o.data,c=a.data,l=a.upperThreshold,u=a.lowerThreshold,d=a.windowLow,p=a.windowHigh,m=0;if("label"===a.dataType)for(var h=0;h<t;h++)for(var f=0;f<e;f++){var b=c[n(f,h)];b=b>=this.colorMap.length?b%this.colorMap.length+1:b;var v=this.colorMap[b];s[4*m]=v>>24&255,s[4*m+1]=v>>16&255,s[4*m+2]=v>>8&255,s[4*m+3]=255&v,m++}else for(var g=0;g<t;g++)for(var j=0;j<e;j++){var O=c[n(j,g)],x=255;x=l>=O&&u<=O?x:0,O=(O=Math.floor(255*(O-d)/(p-d)))>255?255:O<0?0:0|O,s[4*m]=O,s[4*m+1]=O,s[4*m+2]=O,s[4*m+3]=x,m++}i.putImageData(o,0,0),this.ctx.drawImage(r,0,0,e,t,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0}},{key:"updateGeometry",value:function(){var e=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=e.sliceAccess,this.jLength=e.jLength,this.iLength=e.iLength,this.matrix=e.matrix,this.canvas.width=e.planeWidth,this.canvas.height=e.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new rc.r(e.planeWidth,e.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix4(this.matrix)),this.geometryNeedsUpdate=!1}}]),e}(),hc=function(){function e(t,n,a,r,i){if(Object(p.a)(this,e),void 0!==t){switch(this.xLength=Number(t)||1,this.yLength=Number(n)||1,this.zLength=Number(a)||1,this.axisOrder=["x","y","z"],r){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(i);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(i);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(i);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(i);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(i);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(i);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw new Error("Error in Volume constructor : this type is not supported in JavaScript");case"Float32":case"float32":case"float":this.data=new Float32Array(i);break;case"Float64":case"float64":case"double":this.data=new Float64Array(i);break;default:this.data=new Uint8Array(i)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw new Error("Error in Volume constructor, lengths are not matching arrayBuffer size")}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new rc.m,this.matrix.identity();var o=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return o},set:function(e){o=e,this.sliceList.forEach((function(e){e.geometryNeedsUpdate=!0}))}});var s=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return s},set:function(e){s=e,this.sliceList.forEach((function(e){e.geometryNeedsUpdate=!0}))}}),this.sliceList=[]}return Object(m.a)(e,[{key:"getData",value:function(e,t,n){return this.data[n*this.xLength*this.yLength+t*this.xLength+e]}},{key:"access",value:function(e,t,n){return n*this.xLength*this.yLength+t*this.xLength+e}},{key:"reverseAccess",value:function(e){var t=Math.floor(e/(this.yLength*this.xLength)),n=Math.floor((e-t*this.yLength*this.xLength)/this.xLength);return[e-t*this.yLength*this.xLength-n*this.xLength,n,t]}},{key:"map",value:function(e,t){var n=this.data.length;t=t||this;for(var a=0;a<n;a++)this.data[a]=e.call(t,this.data[a],a,this.data);return this}},{key:"extractPerpendicularPlane",value:function(e,t){var n,a,r,i,o=new rc.C,s=new rc.C,c=new rc.C,l=(new rc.n).identity(),u=this,d=new rc.C(this.xLength,this.yLength,this.zLength);switch(e){case"x":o.set(1,0,0),s.set(0,0,-1),c.set(0,-1,0),n=this.spacing[this.axisOrder.indexOf("z")],a=this.spacing[this.axisOrder.indexOf("y")],i=new rc.C(t,0,0),l.multiply((new rc.n).makeRotationY(Math.PI/2)),r=(u.RASDimensions[0]-1)/2,l.setPosition(new rc.C(t-r,0,0));break;case"y":o.set(0,1,0),s.set(1,0,0),c.set(0,0,1),n=this.spacing[this.axisOrder.indexOf("x")],a=this.spacing[this.axisOrder.indexOf("z")],i=new rc.C(0,t,0),l.multiply((new rc.n).makeRotationX(-Math.PI/2)),r=(u.RASDimensions[1]-1)/2,l.setPosition(new rc.C(0,t-r,0));break;case"z":default:o.set(0,0,1),s.set(1,0,0),c.set(0,-1,0),n=this.spacing[this.axisOrder.indexOf("x")],a=this.spacing[this.axisOrder.indexOf("y")],i=new rc.C(0,0,t),r=(u.RASDimensions[2]-1)/2,l.setPosition(new rc.C(0,0,t-r))}s.applyMatrix4(u.inverseMatrix).normalize(),s.arglet="i",c.applyMatrix4(u.inverseMatrix).normalize(),c.arglet="j",o.applyMatrix4(u.inverseMatrix).normalize();var p=Math.floor(Math.abs(s.dot(d))),m=Math.floor(Math.abs(c.dot(d))),h=Math.abs(p*n),f=Math.abs(m*a);i=Math.abs(Math.round(i.applyMatrix4(u.inverseMatrix).dot(o)));var b=[new rc.C(1,0,0),new rc.C(0,1,0),new rc.C(0,0,1)],v=[s,c,o].find((function(e){return Math.abs(e.dot(b[0]))>.9})),g=[s,c,o].find((function(e){return Math.abs(e.dot(b[1]))>.9})),j=[s,c,o].find((function(e){return Math.abs(e.dot(b[2]))>.9}));return{iLength:p,jLength:m,sliceAccess:function(e,t){var n=v===o?i:"i"===v.arglet?e:t,a=g===o?i:"i"===g.arglet?e:t,r=j===o?i:"i"===j.arglet?e:t,s=v.dot(b[0])>0?n:u.xLength-1-n,c=g.dot(b[1])>0?a:u.yLength-1-a,l=j.dot(b[2])>0?r:u.zLength-1-r;return u.access(s,c,l)},matrix:l,planeWidth:h,planeHeight:f}}},{key:"extractSlice",value:function(e,t){var n=new mc(this,t,e);return this.sliceList.push(n),n}},{key:"repaintAllSlices",value:function(){return this.sliceList.forEach((function(e){e.repaint()})),this}},{key:"computeMinMax",value:function(){var e=1/0,t=-1/0,n=this.data.length,a=0;for(a=0;a<n;a++)if(!isNaN(this.data[a])){var r=this.data[a];e=Math.min(e,r),t=Math.max(t,r)}return this.min=e,this.max=t,[e,t]}}]),e}(),fc=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(e){return Object(p.a)(this,n),t.call(this,e)}return Object(m.a)(n,[{key:"load",value:function(e,t,n,a){var r=this,i=new rc.h(r.manager);i.setPath(r.path),i.setResponseType("arraybuffer"),i.setRequestHeader(r.requestHeader),i.setWithCredentials(r.withCredentials),i.load(e,(function(n){try{t(r.parse(n))}catch(i){a?a(i):console.error(i),r.manager.itemError(e)}}),n,a)}},{key:"parse",value:function(e){var t=e,n=0,a=new Int8Array(new Int16Array([1]).buffer)[0]>0,r={};var i,o=function(e,r){void 0!==r&&null!==r||(r=1);var i=1,o=Uint8Array;switch(e){case"uchar":break;case"schar":o=Int8Array;break;case"ushort":o=Uint16Array,i=2;break;case"sshort":o=Int16Array,i=2;break;case"uint":o=Uint32Array,i=4;break;case"sint":o=Int32Array,i=4;break;case"float":o=Float32Array,i=4;break;case"complex":case"double":o=Float64Array,i=8}var s=new o(t.slice(n,n+=r*i));return true!==a&&(s=function(e,t){for(var n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a=0;a<e.byteLength;a+=t)for(var r=a+t-1,i=a;r>i;r--,i++){var o=n[i];n[i]=n[r],n[r]=o}return e}(s,i)),1===r?s[0]:s}("uchar",e.byteLength),s=o.length,c=null,l=0;for(i=1;i<s;i++)if(10===o[i-1]&&10===o[i]){c=this.parseChars(o,0,i-2),l=i+1;break}if(function(e){var t,n,a,i,o,s,c,l,u=e.split(/\r?\n/);for(c=0,l=u.length;c<l;c++)(o=u[c]).match(/NRRD\d+/)?r.isNrrd=!0:!o.match(/^#/)&&(s=o.match(/(.*):(.*)/))&&(n=s[1].trim(),t=s[2].trim(),(a=bc[n])?a.call(r,t):r[n]=t);if(!r.isNrrd)throw new Error("Not an NRRD file");if("bz2"===r.encoding||"bzip2"===r.encoding)throw new Error("Bzip is not supported");if(!r.vectors&&(r.vectors=[],r.vectors.push([1,0,0]),r.vectors.push([0,1,0]),r.vectors.push([0,0,1]),r.spacings))for(i=0;i<=2;i++)if(!isNaN(r.spacings[i]))for(var d=0;d<=2;d++)r.vectors[i][d]*=r.spacings[i]}(c),t=o.subarray(l),"gz"===r.encoding.substring(0,2))t=pc.a(new Uint8Array(t));else if("ascii"===r.encoding||"text"===r.encoding||"txt"===r.encoding||"hex"===r.encoding)t=function(e,t,n){var a,i="";t=t||0,n=n||e.length;var o=r.sizes.reduce((function(e,t){return e*t}),1),s=10;"hex"===r.encoding&&(s=16);var c=new r.__array(o),l=0,u=parseInt;r.__array!==Float32Array&&r.__array!==Float64Array||(u=parseFloat);for(var d=t;d<n;d++)((a=e[d])<9||a>13)&&32!==a?i+=String.fromCharCode(a):(""!==i&&(c[l]=u(i,s),l++),i="");return""!==i&&(c[l]=u(i,s),l++),c}(t);else if("raw"===r.encoding){for(var u=new Uint8Array(t.length),d=0;d<t.length;d++)u[d]=t[d];t=u}t=t.buffer;var p=new hc;p.header=r,p.data=new r.__array(t);var m=p.computeMinMax(),h=m[0],f=m[1];if(p.windowLow=h,p.windowHigh=f,p.dimensions=[r.sizes[0],r.sizes[1],r.sizes[2]],p.xLength=p.dimensions[0],p.yLength=p.dimensions[1],p.zLength=p.dimensions[2],r.vectors){var b=r.vectors.findIndex((function(e){return 0!==e[0]})),v=r.vectors.findIndex((function(e){return 0!==e[1]})),g=r.vectors.findIndex((function(e){return 0!==e[2]})),j=[];j[b]="x",j[v]="y",j[g]="z",p.axisOrder=j}else p.axisOrder=["x","y","z"];var O=(new rc.C).fromArray(r.vectors[0]).length(),x=(new rc.C).fromArray(r.vectors[1]).length(),y=(new rc.C).fromArray(r.vectors[2]).length();p.spacing=[O,x,y],p.matrix=new rc.n;var w=new rc.n;if("left-posterior-superior"===r.space?w.set(-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1):"left-anterior-superior"===r.space&&w.set(1,0,0,0,0,1,0,0,0,0,-1,0,0,0,0,1),r.vectors){var S=r.vectors,T=(new rc.n).set(S[0][0],S[1][0],S[2][0],0,S[0][1],S[1][1],S[2][1],0,S[0][2],S[1][2],S[2][2],0,0,0,0,1);p.matrix=(new rc.n).multiplyMatrices(T,w)}else p.matrix.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return p.inverseMatrix=new rc.n,p.inverseMatrix.copy(p.matrix).invert(),p.RASDimensions=new rc.C(p.xLength,p.yLength,p.zLength).applyMatrix4(p.matrix).round().toArray().map(Math.abs),p.lowerThreshold===-1/0&&(p.lowerThreshold=h),p.upperThreshold===1/0&&(p.upperThreshold=f),p}},{key:"parseChars",value:function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=e.length);var a,r="";for(a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}}]),n}(rc.k),bc={type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+e)}return this.type=e},endian:function(e){return this.endian=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.dim=parseInt(e,10)},sizes:function(e){var t;return this.sizes=function(){for(var n=e.split(/\s+/),a=[],r=0,i=n.length;r<i;r++)t=n[r],a.push(parseInt(t,10));return a}()},space:function(e){return this.space=e},"space origin":function(e){return this.space_origin=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){var t,n,a=e.match(/\(.*?\)/g);return this.vectors=function(){for(var e=[],r=0,i=a.length;r<i;r++)n=a[r],e.push(function(){for(var e=n.slice(1,-1).split(/,/),a=[],r=0,i=e.length;r<i;r++)t=e[r],a.push(parseFloat(t));return a}());return e}()},spacings:function(e){var t,n=e.split(/\s+/);return this.spacings=function(){for(var e=[],a=0,r=n.length;a<r;a++)t=n[a],e.push(parseFloat(t));return e}()}},vc=(n(884),{width:"100%",height:"680px"}),gc={width:"100%",display:"flex",justifyContent:"center",margin:"1em",flexDirection:"column",alignItems:"center"},jc=Object(ot.jsx)(Tr.a,{variant:"body2",style:{color:"orange",position:"absolute",bottom:8,right:8,zIndex:10},className:"hint_wrap",children:"Press LMB to rotate, plus CTRL-key to shift."}),Oc={position:"relative"},xc={},yc=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(e){var a;return Object(p.a)(this,n),(a=t.call(this,e)).volumeScene=void 0,a.canvasRef=void 0,a.canvasRef=r.a.createRef(),a.volumeScene=null,a.handleLoadVolume=a.handleLoadVolume.bind(Object(ac.a)(a)),a}return Object(m.a)(n,[{key:"componentDidMount",value:function(){this.updateVolumeScene()}},{key:"componentDidUpdate",value:function(e){this.updateVolumeScene()}},{key:"componentWillUnmount",value:function(){this.volumeScene=null}},{key:"handleLoadVolume",value:function(){var e=this,t=this.volumeScene;if(null!==t){var a=this.props,r=a.selectedDataset,i=a.selectedVariable,o=a.selectedPlaceInfo,s=a.volumeId,c=a.updateVolumeState;if(r&&i&&s){c(s,{status:"loading"});var l="";if(o){var d=null;if("Polygon"===o.place.geometry.type)d=wc(o.place.geometry.coordinates[0]);else if("MultiPolygon"===o.place.geometry.type){for(var p=[],m=0;m<o.place.geometry.coordinates.length;m++)p.push(wc(o.place.geometry.coordinates[m][0]));d=function(e){var t,n=Object(G.a)(e[0],4),a=n[0],r=n[1],i=n[2],o=n[3],s=Object(u.a)(e.slice(1));try{for(s.s();!(t=s.n()).done;){var c=t.value;a=Math.min(a,c[0]),r=Math.min(r,c[1]),i=Math.max(i,c[2]),o=Math.max(o,c[3])}}catch(l){s.e(l)}finally{s.f()}return[a,r,i,o]}(p)}null!==d&&(l="&bbox=".concat(d[0],",").concat(d[1],",").concat(d[2],",").concat(d[3]))}var h="dummy=".concat((new Date).toLocaleTimeString()),f="".concat(this.props.serverUrl,"/volumes/")+"".concat(r.id,"/").concat(i.name)+"?".concat(h).concat(l);(new fc).load(f,(function(a){t.setVolume(a,n.getVolumeOptions(e.props)),xc[s]=a,c(s,{status:"ok"})}),(function(){}),(function(e){e.response instanceof Response?e.response.json().then((function(t){var n=t.error,a=!!n&&n.message;n&&n.exception&&console.debug("exception:",n.exception),c(s,{status:"error",message:a||"".concat(e)})})):c(s,{status:"error",message:"".concat(e)})}))}}}},{key:"render",value:function(){var e,t,n=this.props.volumeId;if(n){var a=this.props.volumeStates[n];console.log("volumeState:",a,xc),a&&"error"!==a.status&&xc[n]||(t=[Object(ot.jsx)(Gr.a,{onClick:this.handleLoadVolume,color:"primary",disabled:!!a&&"loading"===a.status,children:"Load Volume Data"}),Object(ot.jsx)(Tr.a,{variant:"body2",children:"Please note that the 3D volume rendering is still an experimental feature."})]),a&&("loading"===a.status?e=Object(ot.jsx)(Ur.a,{style:{margin:10}}):"error"===a.status&&(e=Object(ot.jsx)(Tr.a,{variant:"body2",color:"red",children:"Failed loading volume: ".concat(a.message)})))}else e=[Object(ot.jsx)(Tr.a,{variant:"subtitle2",children:"Cannot display 3D volume"}),Object(ot.jsx)(Tr.a,{variant:"body2",children:"To display a volume, a variable and a place that represents an area must be selected. Please note that the 3D volume rendering is still an experimental feature."})];return e&&(e=Object(ot.jsx)("div",{style:gc,children:e})),t&&(t=Object(ot.jsx)("div",{style:gc,children:t})),Object(ot.jsxs)("div",{style:Oc,children:[t,e,Object(ot.jsx)("canvas",{id:"VolumeCanvas-canvas",ref:this.canvasRef,style:vc}),!e&&!t&&jc]})}},{key:"updateVolumeScene",value:function(){var e=this.canvasRef.current;if(null!==e){var t;this.props.volumeId&&(t=xc[this.props.volumeId]);var a=!1;null!==this.volumeScene&&this.volumeScene.canvas===e||(this.volumeScene=new dc(e),a=!0),a&&t?this.volumeScene.setVolume(t,n.getVolumeOptions(this.props)):this.volumeScene.setVolumeOptions(n.getVolumeOptions(this.props))}else this.volumeScene=null}}],[{key:"getVolumeOptions",value:function(e){var t=e.selectedVariable,n=e.variableColorBar,a=e.volumeIsoThreshold,r=e.volumeRenderMode;return{value1:t?t.colorBarMin:0,value2:t?t.colorBarMax:1,renderMode:r,isoThreshold:a,colorBar:n}}}]),n}(r.a.PureComponent);function wc(e){var t,n=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=Object(u.a)(e);try{for(o.s();!(t=o.n()).done;){var s=t.value,c=s[0],l=s[1];n=Math.min(n,c),a=Math.min(a,l),r=Math.max(r,c),i=Math.max(i,l)}}catch(d){o.e(d)}finally{o.f()}return[n,a,r,i]}var Sc=Object(li.a)((function(e){return Object(Er.a)({card:{maxWidth:"100%",marginBottom:e.spacing(1),marginRight:e.spacing(1)},info:{marginRight:e.spacing(1)},close:{marginLeft:"auto"},cardContent:{padding:8},isoEditor:{display:"flex",flexDirection:"row"},isoTextField:{minWidth:"16em",marginLeft:"1em"},isoSlider:{minWidth:200}})})),Tc=function(e){var t=e.volumeCardOpen,n=e.showVolumeCard,a=e.selectedDataset,r=e.selectedVariable,i=e.selectedPlaceInfo,o=e.variableColorBar,s=e.volumeId,c=e.volumeRenderMode,l=e.setVolumeRenderMode,u=e.volumeStates,d=e.updateVolumeState,p=e.updateVariableVolume,m=e.serverUrl,h=Sc();if(!t)return null;var f=.5;r&&(f="number"===typeof r.volumeIsoThreshold?r.volumeIsoThreshold:.5*(r.colorBarMin+r.colorBarMax),"string"===typeof r.volumeRenderMode&&(c=r.volumeRenderMode));return Object(ot.jsxs)(ec.a,{className:h.card,children:[Object(ot.jsxs)(tc.a,{disableSpacing:!0,children:[Object(ot.jsx)(Go.a,{fontSize:"large",className:h.info}),r&&Object(ot.jsxs)(ot.Fragment,{children:[Object(ot.jsxs)(ro.a,{size:"small",exclusive:!0,value:c,onChange:function(e,t){null!==t&&(l(t),r&&p(a.id,r.name,o,t,f))},children:[Object(ot.jsx)(ao.a,{value:"mip",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:"Maximum intensity projection",children:Object(ot.jsx)("span",{children:"MIP"})})},"mip"),Object(ot.jsx)(ao.a,{value:"aip",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:"Average intensity projection",children:Object(ot.jsx)("span",{children:"AIP"})})},"aip"),Object(ot.jsx)(ao.a,{value:"iso",children:Object(ot.jsx)(Ir.a,{arrow:!0,title:"Iso-surface extraction",children:Object(ot.jsx)("span",{children:"ISO"})})},"iso")]},0),"iso"===c&&Object(ot.jsx)(Cc,{minValue:r.colorBarMin,maxValue:r.colorBarMax,value:f,setValue:function(e){p(a.id,r.name,o,c,e)}})]}),Object(ot.jsx)(Cr.a,{onClick:function(){n(!1)},className:h.close,children:Object(ot.jsx)(di.a,{})},1)]}),Object(ot.jsx)(nc.a,{className:h.cardContent,children:Object(ot.jsx)(yc,{selectedDataset:a,selectedVariable:r,selectedPlaceInfo:i,variableColorBar:o,volumeRenderMode:c,volumeIsoThreshold:f,volumeId:s,volumeStates:u,updateVolumeState:d,serverUrl:m})})]})},Cc=function(e){var t=e.value,n=e.minValue,a=e.maxValue,i=e.setValue,o=e.disabled,s=Sc(),c=r.a.useState(t),l=Object(G.a)(c,2),u=l[0],d=l[1],p=r.a.useState(""+t),m=Object(G.a)(p,2),h=m[0],f=m[1],b=r.a.useState(null),v=Object(G.a)(b,2),g=v[0],j=v[1];return Object(ot.jsx)(co.a,{className:s.isoTextField,disabled:o,label:"Iso-Threshold",variant:"filled",size:"small",value:h,error:null!==g,onChange:function(e){var t=e.target.value||"";f(t);var r=parseFloat(t);Number.isNaN(r)?j("Not a number"):j(r<n||r>a?"Out of range":null)},onKeyPress:function(e){if(console.log("key",e.key),"Enter"===e.key&&!g){var t=parseFloat(h);d(t),i(t)}},InputProps:{endAdornment:Object(ot.jsx)(go.a,{size:"small",className:s.isoSlider,min:n,max:a,value:u,step:(a-n)/20,onChange:function(e,t){d(t),f(t.toFixed(2))},onChangeCommitted:function(e,t){i(t)}})}})},kc={showVolumeCard:$a,setVolumeRenderMode:function(e){return{type:er,volumeRenderMode:e}},updateVolumeState:function(e,t){return{type:tr,volumeId:e,volumeState:t}},updateVariableVolume:function(e,t,n,a,r){return{type:Ca,datasetId:e,variableName:t,variableColorBar:n,volumeRenderMode:a,volumeIsoThreshold:r}}},Pc=Object(o.b)((function(e){return{locale:e.controlState.locale,volumeCardOpen:e.controlState.volumeCardOpen,selectedDataset:en(e),selectedVariable:nn(e),selectedPlaceInfo:jn(e),variableColorBar:sn(e),volumeRenderMode:e.controlState.volumeRenderMode,volumeId:On(e),volumeStates:e.controlState.volumeStates,serverUrl:Mn(e).url}}),kc)(Tc),Ec=n(1035),_c=n(1033),Ic=n(1034),Nc=n(1006),Mc=n(1037),Ac=n(1038),Lc=n(1040),Rc=n(1036),Dc=n(1039),zc=n(572),Bc=n.n(zc),Fc=n(568),Vc=n.n(Fc),Gc=n(571),Uc=n.n(Gc),Wc=n(569),Hc=n.n(Wc),Kc=n(570),Zc=n.n(Kc),Yc=n(567),qc=n.n(Yc),Xc=n(399),Jc=n(401),Qc=n(586),$c=n.p+"static/media/python-bw.071ec04f.png",el=Object(li.a)((function(e){return Object(Er.a)({card:{maxWidth:"100%",marginBottom:e.spacing(1),marginRight:e.spacing(1)},info:{marginRight:e.spacing(1)},close:{marginLeft:"auto"},table:{},keyValueTableContainer:{background:e.palette.divider},variableHtmlReprContainer:{background:e.palette.divider,padding:e.spacing(1),marginTop:e.spacing(1),marginBottom:e.spacing(1)},media:{height:200},cardContent:{padding:8},code:{fontFamily:"Monospace"}})})),tl=function(e){var t=e.infoCardOpen,n=e.showInfoCard,a=e.visibleInfoCardElements,r=e.setVisibleInfoCardElements,i=e.infoCardElementViewModes,o=e.updateInfoCardElementViewMode,s=e.selectedDataset,c=e.selectedVariable,l=e.selectedPlaceInfo,u=e.selectedTime,d=e.serverConfig,p=e.allowViewModePython,m=el();if(!t)return null;var h,f,b;if(s){var g="dataset",j=i.dataset,O=a.includes(g);h=Object(ot.jsx)(nl,{isIn:O,viewMode:j,setViewMode:function(e){return o(g,e)},dataset:s,serverConfig:d,hasPython:p})}if(s&&c){var x="variable",y=i.variable,w=a.includes(x);f=Object(ot.jsx)(al,{isIn:w,viewMode:y,setViewMode:function(e){return o(x,e)},variable:c,time:u,serverConfig:d,hasPython:p})}if(l){var S="place",T=i.place,C=a.includes(S);b=Object(ot.jsx)(rl,{isIn:C,viewMode:T,setViewMode:function(e){return o(S,e)},placeInfo:l})}return Object(ot.jsxs)(ec.a,{className:m.card,children:[Object(ot.jsxs)(tc.a,{disableSpacing:!0,children:[Object(ot.jsx)(Fo.a,{fontSize:"large",className:m.info}),Object(ot.jsxs)(ro.a,{size:"small",value:a,onChange:function(e,t){r(t)},children:[Object(ot.jsx)(ao.a,{value:"dataset",disabled:null===s,children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Dataset information"),children:Object(ot.jsx)(qc.a,{})})},0),Object(ot.jsx)(ao.a,{value:"variable",disabled:null===c,children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Variable information"),children:Object(ot.jsx)(Vc.a,{})})},1),Object(ot.jsx)(ao.a,{value:"place",disabled:null===l,children:Object(ot.jsx)(Ir.a,{arrow:!0,title:v.get("Place information"),children:Object(ot.jsx)(Hc.a,{})})},2)]},0),Object(ot.jsx)(Cr.a,{onClick:function(){n(!1)},className:m.close,size:"large",children:Object(ot.jsx)(di.a,{})},1)]}),h,f,b]})},nl=function(e){var t,n=e.isIn,a=e.viewMode,r=e.setViewMode,i=e.dataset,o=e.serverConfig,s=e.hasPython;if("code"===a){var c=dl(i.dimensions,["name","size","dtype"]),l=dl(i,["id","title","bbox","attrs"]);l.dimensions=c,t=Object(ot.jsx)(ll,{code:JSON.stringify(l,null,2)})}else if("list"===a)t=Object(ot.jsx)(sl,{children:Object(ot.jsx)(ol,{data:Object.getOwnPropertyNames(i.attrs||{}).map((function(e){return[e,i.attrs[e]]}))})});else if("text"===a){var u=[[v.get("Dimension names"),i.dimensions.map((function(e){return e.name})).join(", ")],[v.get("Dimension data types"),i.dimensions.map((function(e){return e.dtype})).join(", ")],[v.get("Dimension lengths"),i.dimensions.map((function(e){return e.size})).join(", ")],[v.get("Geographical extent")+" (x1, y1, x2, y2)",i.bbox.map((function(e){return e+""})).join(", ")],[v.get("Spatial reference system"),i.spatialRef]];t=Object(ot.jsx)(sl,{children:Object(ot.jsx)(ol,{data:u})})}else"python"===a&&(t=Object(ot.jsx)(ul,{code:pl(o,i)}));return Object(ot.jsx)(il,{title:i.title||"?",subheader:i.title&&"ID: ".concat(i.id),isIn:n,viewMode:a,setViewMode:r,hasPython:s,children:t})},al=function(e){var t,n,a=e.isIn,r=e.viewMode,i=e.setViewMode,o=e.variable,s=e.time,c=e.serverConfig,l=e.hasPython,u=el();if("code"===r){var d=dl(o,["id","name","title","units","shape","dtype","shape","timeChunkSize","colorBarMin","colorBarMax","colorBarName","attrs"]);t=Object(ot.jsx)(ll,{code:JSON.stringify(d,null,2)})}else if("list"===r){if(t=Object(ot.jsx)(sl,{children:Object(ot.jsx)(ol,{data:Object.getOwnPropertyNames(o.attrs||{}).map((function(e){return[e,o.attrs[e]]}))})}),o.htmlRepr){n=Object(ot.jsx)(sl,{children:Object(ot.jsx)(ti.a,{ref:function(e){e&&o.htmlRepr&&(e.innerHTML=o.htmlRepr)},className:u.variableHtmlReprContainer})})}}else if("text"===r){var p=[[v.get("Title"),o.title],[v.get("Name"),o.name],[v.get("Units"),o.units],[v.get("Data type"),o.dtype],[v.get("Dimension names"),o.dims.join(", ")],[v.get("Dimension lengths"),o.shape.map((function(e){return e+""})).join(", ")],[v.get("Time chunk size"),o.timeChunkSize]];t=Object(ot.jsx)(sl,{children:Object(ot.jsx)(ol,{data:p})})}else"python"===r&&(t=Object(ot.jsx)(ul,{code:ml(c,o,s)}));return Object(ot.jsxs)(il,{title:o.title||o.name,subheader:"".concat(v.get("Name"),": ").concat(o.name),isIn:a,viewMode:r,setViewMode:i,hasPython:l,children:[n,t]})},rl=function(e){var t,n,a,r=e.isIn,i=e.viewMode,o=e.setViewMode,s=e.placeInfo,c=el(),l=s.place;if("code"===i)t=Object(ot.jsx)(ll,{code:JSON.stringify(l,null,2)});else if("list"===i)if(l.properties){var u=Object.getOwnPropertyNames(l.properties).map((function(e){return[e,l.properties[e]]}));t=Object(ot.jsx)(sl,{children:Object(ot.jsx)(ol,{data:u})})}else t=Object(ot.jsx)(sl,{children:Object(ot.jsx)(Tr.a,{children:v.get("There is no information available for this location.")})});else s.image&&s.image.startsWith("http")&&(n=Object(ot.jsx)(_c.a,{className:c.media,image:s.image,title:s.label})),s.description&&(a=Object(ot.jsx)(sl,{children:Object(ot.jsx)(Tr.a,{children:s.description})}));return Object(ot.jsxs)(il,{title:s.label,subheader:"".concat(v.get("Geometry type"),": ").concat(v.get(l.geometry.type)),isIn:r,viewMode:i,setViewMode:o,children:[n,a,t]})},il=function(e){var t=e.isIn,n=e.title,a=e.subheader,r=e.viewMode,i=e.setViewMode,o=e.hasPython,s=e.children;return Object(ot.jsxs)(Ic.a,{in:t,timeout:"auto",unmountOnExit:!0,children:[Object(ot.jsx)(Ec.a,{title:n,subheader:a,action:Object(ot.jsxs)(ro.a,{size:"small",value:r,exclusive:!0,onChange:function(e,t){i(t)},children:[Object(ot.jsx)(ao.a,{value:"text",children:Object(ot.jsx)(Zc.a,{})},0),Object(ot.jsx)(ao.a,{value:"list",children:Object(ot.jsx)(Uc.a,{})},1),Object(ot.jsx)(ao.a,{value:"code",children:Object(ot.jsx)(Bc.a,{})},2),o&&Object(ot.jsx)(ao.a,{value:"python",children:Object(ot.jsx)("img",{src:$c,width:24,alt:"python logo"})},3)]},0)}),s]})},ol=function(e){var t=e.data,n=el();return Object(ot.jsx)(Rc.a,{component:ti.a,className:n.keyValueTableContainer,children:Object(ot.jsx)(Mc.a,{className:n.table,size:"small",children:Object(ot.jsx)(Ac.a,{children:t.map((function(e,t){var n=Object(G.a)(e,2),a=n[0],r=n[1],i=r;return"string"===typeof r&&(r.startsWith("http://")||r.startsWith("https://"))?i=Object(ot.jsx)(Nc.a,{href:r,target:"_blank",rel:"noreferrer",children:r}):Array.isArray(r)&&(i="["+r.map((function(e){return e+""})).join(", ")+"]"),Object(ot.jsxs)(Dc.a,{children:[Object(ot.jsx)(Lc.a,{children:a}),Object(ot.jsx)(Lc.a,{align:"right",children:i})]},t)}))})})})},sl=function(e){var t=e.children,n=el();return Object(ot.jsx)(nc.a,{className:n.cardContent,children:t})},cl=function(e){var t=e.code,n=e.extension;return Object(ot.jsx)(sl,{children:Object(ot.jsx)(Xc.a,{theme:_e.instance.branding.themeName||"light",height:"320px",extensions:[n],value:t,readOnly:!0})})},ll=function(e){var t=e.code;return Object(ot.jsx)(cl,{code:t,extension:Object(Jc.a)()})},ul=function(e){var t=e.code;return Object(ot.jsx)(cl,{code:t,extension:Object(Qc.a)()})};function dl(e,t){var n,a={},r=Object(u.a)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;i in e&&(a[i]=e[i])}}catch(o){r.e(o)}finally{r.f()}return a}function pl(e,t){var n=function(e){var t=e.lastIndexOf(".");return t>=0?[e.substring(0,t),e.substring(t)]:[e,""]}(t.id)[0]+".zarr";return["from xcube.core.store import new_data_store","","store = new_data_store(",'    "s3",','    root="datasets",  # can also use "pyramids" here',"    storage_options={",'        "anon": True,','        "client_kwargs": {','            "endpoint_url": "'.concat(e.url,'/s3"'),"        }","    }",")","# store.list_data_ids()",'dataset = store.open_data(data_id="'.concat(n,'")')].join("\n")}function ml(e,t,n){var a=t.name,r=t.colorBarMin,i=t.colorBarMax,o=t.colorBarName,s="";return null!==n&&(s='.sel(time="'.concat(Xn(n),'", method="nearest")')),["var = dataset.".concat(a).concat(s),"var.plot.imshow(vmin=".concat(r,", vmax=").concat(i,', cmap="').concat(o,'")')].join("\n")}var hl={showInfoCard:ar,setVisibleInfoCardElements:function(e){return{type:rr,visibleElements:e}},updateInfoCardElementViewMode:function(e,t){return{type:ir,elementType:e,viewMode:t}}},fl=Object(o.b)((function(e){return{locale:e.controlState.locale,infoCardOpen:e.controlState.infoCardOpen,visibleInfoCardElements:Fn(e),infoCardElementViewModes:Vn(e),selectedDataset:en(e),selectedVariable:nn(e),selectedPlaceInfo:jn(e),selectedTime:qt(e),serverConfig:Mn(e),allowViewModePython:_e.instance.branding.allowViewModePython}}),hl)(tl),bl=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(e){var a;if(Object(p.a)(this,n),(a=t.call(this,e)).lastPosition=null,a.bodyEventListeners=void 0,!e.onChange)throw Error("onChange property must be provided");return a.onMouseDown=a.onMouseDown.bind(Object(ac.a)(a)),a.bodyEventListeners=[["mousemove",a.onBodyMouseMove.bind(Object(ac.a)(a))],["mouseup",a.onBodyMouseUp.bind(Object(ac.a)(a))],["onmouseenter",a.onBodyMouseEnter.bind(Object(ac.a)(a))],["onmouseleave",a.onBodyMouseLeave.bind(Object(ac.a)(a))]],a}return Object(m.a)(n,[{key:"componentWillUnmount",value:function(){this.removeBodyMouseListeners()}},{key:"render",value:function(){return Object(ot.jsx)("div",{className:"hor"===this.props.dir?this.props.classes.hor:this.props.classes.ver,onMouseDown:this.onMouseDown})}},{key:"onMouseDown",value:function(e){this.isButton1Pressed(e)?(this.lastPosition=this.getCurrentPosition(e),this.removeBodyMouseListeners(),this.addBodyMouseListeners()):this.lastPosition=null}},{key:"onBodyMouseMove",value:function(e){if(null!==this.lastPosition&&this.isButton1Pressed(e)){var t=this.getCurrentPosition(e),n=t-this.lastPosition;this.lastPosition=t,0!==n&&this.props.onChange(n)}}},{key:"onBodyMouseUp",value:function(e){this.endDragging()}},{key:"onBodyMouseEnter",value:function(e){this.endDragging()}},{key:"onBodyMouseLeave",value:function(e){this.endDragging()}},{key:"isButton1Pressed",value:function(e){return 0===e.button&&1===e.buttons}},{key:"getCurrentPosition",value:function(e){return"hor"===this.props.dir?e.screenX:e.screenY}},{key:"endDragging",value:function(){this.removeBodyMouseListeners(),this.lastPosition=null}},{key:"addBodyMouseListeners",value:function(){this.bodyEventListeners.forEach((function(e){return document.body.addEventListener(e[0],e[1])}))}},{key:"removeBodyMouseListeners",value:function(){this.bodyEventListeners.forEach((function(e){return document.body.removeEventListener(e[0],e[1])}))}}]),n}(a.PureComponent),vl=Object(_r.a)((function(e){return Object(Er.a)({hor:{flex:"none",border:"none",outline:"none",width:"8px",minHeight:"100%",maxHeight:"100%",cursor:"col-resize",backgroundColor:"dark"===e.palette.mode?"white":"black",opacity:0},ver:{flex:"none",border:"none",outline:"none",height:"8px",minWidth:"100%",maxWidth:"100%",cursor:"row-resize",backgroundColor:"dark"===e.palette.mode?"white":"black",opacity:0}})}))(bl),gl=function(e){Object(g.a)(n,e);var t=Object(j.a)(n);function n(e){var a;return Object(p.a)(this,n),(a=t.call(this,e)).handleSplitDelta=a.handleSplitDelta.bind(Object(ac.a)(a)),a.state={size:e.initialSize||50},a}return Object(m.a)(n,[{key:"handleSplitDelta",value:function(e){var t=this;this.setState((function(n){var a=n.size,r=a+e;return t.props.onChange&&t.props.onChange(r,a),{size:r}}))}},{key:"render",value:function(){var e,t,n,a,r=this.props.children;if(!r||!Array.isArray(r))return r;if(1===r.length)return r[0];if(r.length>2)throw new Error("SplitPane expects not more than two children");if("hor"===this.props.dir){var i=this.state.size;e=this.props.classes.hor,t=this.props.classes.childVer,n=Object(C.a)({width:i},this.props.child1Style),a=this.props.child2Style}else{var o=this.state.size;e=this.props.classes.ver,t=this.props.classes.childVer,n=Object(C.a)({height:o},this.props.child1Style),a=this.props.child2Style}return Object(ot.jsxs)("div",{id:"SplitPane",className:Br()(e,this.props.className),style:this.props.style,children:[Object(ot.jsx)("div",{id:"SplitPane-Child-1",className:Br()(t,this.props.child1ClassName),style:n,children:r[0]}),Object(ot.jsx)(vl,{dir:this.props.dir,onChange:this.handleSplitDelta}),Object(ot.jsx)("div",{id:"SplitPane-Child-2",className:Br()(t,this.props.child2ClassName),style:a,children:r[1]})]})}}]),n}(a.PureComponent),jl=Object(_r.a)((function(e){return Object(Er.a)({hor:{display:"flex",flexFlow:"row nowrap",flex:"auto"},ver:{height:"100%",display:"flex",flexFlow:"column nowrap",flex:"auto"},childHor:{flex:"none"},childVer:{flex:"none"}})}))(gl),Ol={padding:0},xl=function(){return window.innerWidth/window.innerHeight>=1?"hor":"ver"},yl=Object(o.b)((function(e){var t=null!==e.controlState.selectedDatasetId&&e.dataState.datasets.length>0;return{hasInfoCard:e.controlState.infoCardOpen&&t,hasVolumeCard:e.controlState.volumeCardOpen&&t,hasTimeseries:e.dataState.timeSeriesGroups.length>0}}),{})(Object(_r.a)((function(e){return Object(Er.a)({splitPaneHor:{flexGrow:1,overflow:"hidden"},splitPaneVer:{flexGrow:1,overflowX:"hidden",overflowY:"auto"},mapPaneHor:Object(C.a)({height:"100%",overflow:"hidden"},Ol),mapPaneVer:Object(C.a)({width:"100%",overflow:"hidden"},Ol),detailsPaneHor:{flex:"auto",overflowX:"hidden",overflowY:"auto"},detailsPaneVer:{width:"100%",overflow:"hidden"},viewerContainer:{overflow:"hidden",width:"100%",height:"100%"}})}))((function(e){var t=e.classes,n=e.hasInfoCard,r=e.hasVolumeCard,i=e.hasTimeseries,o=a.useState(null),s=Object(G.a)(o,2),c=s[0],l=s[1],u=a.useState(xl()),d=Object(G.a)(u,2),p=d[0],m=d[1];a.useEffect((function(){h(),window.onresize=h}),[]);var h=function(){m(xl())};if(n||r||i){var f="hor"===p?t.splitPaneHor:t.splitPaneVer,b="hor"===p?t.mapPaneHor:t.mapPaneVer,v="hor"===p?t.detailsPaneHor:t.detailsPaneVer;return Object(ot.jsxs)(jl,{dir:p,initialSize:Math.max(window.innerWidth,window.innerHeight)/2,onChange:function(e){c&&c.updateSize()},className:f,child1ClassName:b,child2ClassName:v,children:[Object(ot.jsx)(_s,{onMapRef:l}),Object(ot.jsxs)("div",{children:[Object(ot.jsx)(fl,{}),Object(ot.jsx)(Pc,{}),Object(ot.jsx)($s,{})]})]})}return Object(ot.jsx)("div",{className:t.viewerContainer,children:Object(ot.jsx)(_s,{onMapRef:l})})}))),wl=Object(o.b)((function(e){return{locale:e.controlState.locale,hasConsent:e.controlState.privacyNoticeAccepted,compact:_e.instance.branding.compact}}),{})(Object(_r.a)((function(e){return Object(Er.a)({main:Object(Kn.a)({padding:0,width:"100vw",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"stretch"},e.breakpoints.up("md"),{overflow:"hidden"})})}))((function(e){var t=e.classes,n=e.hasConsent,a=e.compact;return Object(ot.jsxs)("main",{className:t.main,children:[!a&&Object(ot.jsx)(Sr.a,{variant:"dense"}),n&&Object(ot.jsxs)(ot.Fragment,{children:[Object(ot.jsx)(Yo,{}),Object(ot.jsx)(yl,{})]})]})}))),Sl=n(1041),Tl=n(573),Cl=n.n(Tl),kl=Object(li.a)((function(e){return{icon:{marginRight:e.spacing(2)}}}));var Pl={updateSettings:vr,syncWithServer:wa},El=Object(o.b)((function(e){return{open:!e.controlState.privacyNoticeAccepted,settings:e.controlState}}),Pl)((function(e){var t=e.open,n=e.settings,r=e.updateSettings,i=e.syncWithServer,o=Object(a.useState)(null),s=Object(G.a)(o,2),c=s[0],l=s[1];Object(a.useEffect)((function(){var e=v.get("legal/privacy-note.en.md");fetch(e).then((function(e){return e.text()})).then((function(e){return l(e)}))}));var u=kl();return t?Object(ot.jsxs)(Wr.a,{open:t,disableEscapeKeyDown:!0,keepMounted:!0,scroll:"body",children:[Object(ot.jsx)(Zr.a,{children:v.get("Privacy Notice")}),Object(ot.jsx)(Kr.a,{children:Object(ot.jsx)(Sl.a,{children:null===c?Object(ot.jsx)(Ur.a,{}):Object(ot.jsx)(ci.a,{children:c,linkTarget:"_blank"})})}),Object(ot.jsxs)(Hr.a,{children:[Object(ot.jsxs)(Gr.a,{onClick:function(){r(Object(C.a)(Object(C.a)({},n),{},{privacyNoticeAccepted:!0})),i()},color:"primary",children:[Object(ot.jsx)(Cl.a,{className:u.icon}),v.get("Accept and continue")]}),Object(ot.jsx)(Gr.a,{onClick:function(){try{window.history.length>0?window.history.back():"function"===typeof window.home?window.home():window.location.href="about:home"}catch(e){console.error(e)}},children:v.get("Leave")})]})]}):null})),_l=Object(_r.a)((function(e){return Object(Er.a)({progress:{margin:e.spacing(2)},message:{margin:e.spacing(1)},contentContainer:{margin:e.spacing(1),textAlign:"center",display:"flex",alignItems:"center",flexDirection:"column"}})}))((function(e){var t=e.classes,n=e.messages;return 0===n.length?null:Object(ot.jsxs)(Wr.a,{open:!0,"aria-labelledby":"loading",children:[Object(ot.jsx)(Zr.a,{id:"loading",children:v.get("Please wait...")}),Object(ot.jsxs)("div",{className:t.contentContainer,children:[Object(ot.jsx)(Ur.a,{className:t.progress}),n.map((function(e,n){return Object(ot.jsx)(Tr.a,{component:"div",className:t.message,children:e},n)}))]})]})})),Il=Object(o.b)((function(e){return{locale:e.controlState.locale,messages:Gn(e)}}),{})(_l),Nl=n(1042),Ml=n(1043),Al=n(576),Ll=n.n(Al),Rl=n(575),Dl=n.n(Rl),zl=n(574),Bl={success:n.n(zl).a,warning:Dl.a,error:Ll.a,info:Fo.a},Fl={vertical:"bottom",horizontal:"center"},Vl=Object(_r.a)((function(e){return Object(Er.a)({close:{padding:e.spacing(.5)},success:{color:e.palette.error.contrastText,backgroundColor:se.a[600]},error:{color:e.palette.error.contrastText,backgroundColor:e.palette.error.dark},info:{color:e.palette.error.contrastText,backgroundColor:e.palette.primary.dark},warning:{color:e.palette.error.contrastText,backgroundColor:fe.a[700]},icon:{fontSize:20},iconVariant:{opacity:.9,marginRight:e.spacing(1)},message:{display:"flex",alignItems:"center"}})}))((function(e){var t=e.classes,n=e.className,a=e.message,r=e.hideMessage,i=function(){r(a.id)};if(!a)return null;var o=Bl[a.type];return Object(ot.jsx)(Nl.a,{open:!0,anchorOrigin:Fl,autoHideDuration:5e3,onClose:i,children:Object(ot.jsx)(Ml.a,{className:Br()(t[a.type],n),"aria-describedby":"client-snackbar",message:Object(ot.jsxs)("span",{id:"client-snackbar",className:t.message,children:[Object(ot.jsx)(o,{className:Br()(t.icon,t.iconVariant)}),a.text]}),action:[Object(ot.jsx)(Cr.a,{"aria-label":"Close",color:"inherit",className:t.close,onClick:i,size:"large",children:Object(ot.jsx)(di.a,{className:t.icon})},"close")]})},a.type+":"+a.text)})),Gl={hideMessage:function(e){return{type:ea,messageId:e}}},Ul=Object(o.b)((function(e){var t=e.messageLogState.newEntries;return{locale:e.controlState.locale,message:t.length>0?t[0]:null}}),Gl)(Vl),Wl=function(e){var t=e.children,n=_e.instance.authClient;if(!n)return Object(ot.jsx)(ot.Fragment,{children:t});var a=Se.href;return Object(ot.jsx)(Qo,{children:Object(ot.jsx)(Fr.AuthProvider,Object(C.a)(Object(C.a)({},n),{},{loadUserInfo:!0,scope:"openid email profile",automaticSilentRenew:!0,redirect_uri:a,post_logout_redirect_uri:a,popup_post_logout_redirect_uri:a,onSigninCallback:function(e){console.info("handleSigninCallback:",e),window.history.replaceState({},document.title,window.location.pathname)},onRemoveUser:function(){console.info("handleRemoveUser"),window.location.pathname="/"},children:t}))})},Hl=n(1028),Kl=n(577),Zl=n.n(Kl),Yl=n(579),ql=n.n(Yl),Xl=n(578),Jl=n.n(Xl),Ql=Object(_r.a)((function(e){return Object(Er.a)({formControl:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:200},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:200},textField2:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:400},button:{margin:.1*e.spacing(1)}})}))((function(e){var t=e.classes,n=e.open,r=e.servers,i=e.selectedServer,o=e.closeDialog,s=e.configureServers,c=Object(a.useRef)(!1),l=Object(a.useState)(r),u=Object(G.a)(l,2),d=u[0],p=u[1],m=Object(a.useState)(i),h=Object(G.a)(m,2),f=h[0],b=h[1],g=Object(a.useState)("select"),j=Object(G.a)(g,2),O=j[0],x=j[1];Object(a.useEffect)((function(){c.current&&(p(r),b(i)),c.current=!0}),[r,i]);var y,w,S,T=function(){o("server")},P=function(){var e=f.id;return d.findIndex((function(t){return t.id===e}))},E=function(e,t){var n=Object(k.a)(d);n[e]=t,p(n),b(t),x("select")},_=function(e,t){p(e),b(t),x("select")},I=function(){var e=Object(C.a)(Object(C.a)({},f),{},{id:$()}),t=[].concat(Object(k.a)(d),[e]);_(t,e)},N=function(){E(P(),Object(C.a)({},f))},M=function(){var e=P();E(P(),d[e])},A=function(){var e=Object(k.a)(d);if(e.length<2)throw new Error("internal error: server list cannot be emptied");var t=P(),n=e[t+(t>0?-1:1)];e.splice(t,1),_(e,n)},L=d.map((function(e,t){return Object(ot.jsx)(Pr.a,{value:e.id,children:e.name},t)}));return y="add"===O?v.get("Add"):"edit"===O?v.get("Save"):v.get("OK"),w="add"===O?v.get("Add Server"):"edit"===O?v.get("Edit Server"):v.get("Select Server"),S="add"===O||"edit"===O?Object(ot.jsxs)(Kr.a,{dividers:!0,children:[Object(ot.jsx)(co.a,{variant:"standard",required:!0,id:"server-name",label:"Name",className:t.textField,margin:"normal",value:f.name,onChange:function(e){var t=e.target.value,n=Object(C.a)(Object(C.a)({},f),{},{name:t});b(n)}}),Object(ot.jsx)("br",{}),Object(ot.jsx)(co.a,{variant:"standard",required:!0,id:"server-url",label:"URL",className:t.textField2,margin:"normal",value:f.url,onChange:function(e){var t=e.target.value,n=Object(C.a)(Object(C.a)({},f),{},{url:t});b(n)}})]}):Object(ot.jsx)(Kr.a,{dividers:!0,children:Object(ot.jsxs)("div",{children:[Object(ot.jsxs)(yi.a,{variant:"standard",className:t.formControl,children:[Object(ot.jsx)(uo.a,{htmlFor:"server-name",children:"Name"}),Object(ot.jsx)(xi.a,{variant:"standard",value:f.id,onChange:function(e){var t=e.target.value,n=d.find((function(e){return e.id===t}));b(n)},inputProps:{name:"server-name",id:"server-name"},children:L}),Object(ot.jsx)(Hl.a,{children:f.url})]}),Object(ot.jsx)(Cr.a,{className:t.button,"aria-label":"Add",color:"primary",onClick:function(){x("add")},size:"large",children:Object(ot.jsx)(Zl.a,{fontSize:"small"})}),Object(ot.jsx)(Cr.a,{className:t.button,"aria-label":"Edit",onClick:function(){x("edit")},size:"large",children:Object(ot.jsx)(Jl.a,{fontSize:"small"})}),Object(ot.jsx)(Cr.a,{className:t.button,"aria-label":"Delete",disabled:d.length<2,onClick:function(){A()},size:"large",children:Object(ot.jsx)(ql.a,{fontSize:"small"})})]})}),Object(ot.jsxs)(Wr.a,{open:n,onClose:function(){T()},"aria-labelledby":"server-dialog-title",children:[Object(ot.jsx)(Zr.a,{id:"server-dialog-title",children:w}),S,Object(ot.jsxs)(Hr.a,{children:[Object(ot.jsx)(Gr.a,{onClick:function(){"select"===O?T():M()},children:v.get("Cancel")}),Object(ot.jsx)(Gr.a,{onClick:function(){"select"===O?(o("server"),s(d,f.id)):"add"===O?I():"edit"===O&&N()},autoFocus:!0,color:"primary",children:y})]})]})})),$l={closeDialog:fr,configureServers:function(e,t){return function(n,a){a().controlState.selectedServerId!==t?(n({type:Oa}),n(ya(e,t)),n(wa())):a().dataState.userServers!==e&&n(ya(e,t))}}},eu=Object(o.b)((function(e){return{open:!!e.controlState.dialogOpen.server,servers:It(e),selectedServer:Mn(e)}}),$l)(Ql),tu=n(1044),nu=n(437),au=Object(li.a)((function(e){return{settingsPanelTitle:{marginBottom:e.spacing(1)},settingsPanelPaper:{backgroundColor:("dark"===e.palette.mode?nu.j:nu.c)(e.palette.background.paper,.1),marginBottom:e.spacing(2)},settingsPanelList:{margin:0}}})),ru=function(e){var t=e.title,n=e.children,a=au(),i=r.a.Children.count(n),o=[];return r.a.Children.forEach(n,(function(e,t){o.push(e),t<i-1&&o.push(Object(ot.jsx)(Xr.a,{variant:"fullWidth",component:"li"},i+t))})),Object(ot.jsxs)(wi.a,{children:[t&&""!==t&&Object(ot.jsx)(Tr.a,{variant:"body1",className:a.settingsPanelTitle,children:t}),Object(ot.jsx)(ti.a,{elevation:4,className:a.settingsPanelPaper,children:Object(ot.jsx)(Qr.a,{component:"nav",dense:!0,className:a.settingsPanelList,children:o})})]})},iu=n(1010),ou=function(e){var t,n=e.label,a=e.value,r=e.onClick,i=e.children;a||(t={marginBottom:10});var o,s=Object(ot.jsx)(ei.a,{primary:n,secondary:a});return i&&(o=Object(ot.jsx)(iu.a,{children:i})),r?Object(ot.jsxs)($r.a,{style:t,button:!0,onClick:r,children:[s,o]}):Object(ot.jsxs)($r.a,{style:t,children:[s,o]})},su=function(e){var t=e.propertyName,n=e.settings,a=e.updateSettings,r=e.disabled;return Object(ot.jsx)(Ai.a,{checked:!!n[t],onChange:function(){return a(Object(C.a)(Object(C.a)({},n),{},Object(Kn.a)({},t,!n[t])))},disabled:r})},cu=n(996),lu=n(1007),uu=function(e){var t=e.propertyName,n=e.settings,a=e.updateSettings,r=e.options,i=e.disabled;return Object(ot.jsx)(lu.a,{row:!0,value:n[t],onChange:function(e,r){a(Object(C.a)(Object(C.a)({},n),{},Object(Kn.a)({},t,r)))},children:r.map((function(e){var t=Object(G.a)(e,2),n=t[0],a=t[1];return Object(ot.jsx)(Mi.a,{control:Object(ot.jsx)(cu.a,{}),value:a,label:n,disabled:i},n)}))})},du=Object(li.a)((function(e){return{textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),fontSize:e.typography.fontSize/2},intTextField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),fontSize:e.typography.fontSize/2,width:e.spacing(6)},localeAvatar:{margin:10}}})),pu=function(e){var t=e.open,n=e.closeDialog,a=e.settings,i=e.selectedServer,o=e.updateSettings,s=e.changeLocale,c=e.openDialog,l=e.viewerVersion,u=e.serverInfo,d=r.a.useState(null),p=Object(G.a)(d,2),m=p[0],h=p[1],f=r.a.useState(null),b=Object(G.a)(f,2),g=b[0],j=b[1],O=r.a.useState(a.timeChunkSize+""),x=Object(G.a)(O,2),y=x[0],w=x[1],S=du();if(r.a.useEffect((function(){var e=parseInt(y);Number.isNaN(e)||e===a.timeChunkSize||o({timeChunkSize:e})}),[y,a,o]),!t)return null;var T=null;Boolean(m)&&(T=Object.getOwnPropertyNames(v.languages).map((function(e){var t=v.languages[e];return Object(ot.jsx)(Pr.a,{selected:e===a.locale,onClick:function(){return s(e)},children:Object(ot.jsx)(ei.a,{primary:t})},e)})));var C=null;Boolean(g)&&(C=[],kt.forEach((function(e,t){C.push(Object(ot.jsx)(tu.a,{disableSticky:!0,children:e.name},t)),e.datasets.forEach((function(e,n){C.push(Object(ot.jsx)(Pr.a,{selected:a.baseMapUrl===e.endpoint,onClick:function(){return o({baseMapUrl:e.endpoint})},children:Object(ot.jsx)(ei.a,{primary:e.name})},t+"."+n))}))})));var k=a.baseMapUrl;return kt.forEach((function(e){e.datasets.forEach((function(t){t.endpoint===a.baseMapUrl&&(k="".concat(e.name," / ").concat(t.name))}))})),Object(ot.jsxs)("div",{children:[Object(ot.jsxs)(Wr.a,{open:t,fullWidth:!0,maxWidth:"sm",onClose:function(){n("settings")},scroll:"body",children:[Object(ot.jsx)(Zr.a,{children:v.get("Settings")}),Object(ot.jsxs)(Kr.a,{children:[Object(ot.jsxs)(ru,{title:v.get("General"),children:[Object(ot.jsx)(ou,{label:v.get("Server"),value:i.name,onClick:function(){c("server")}}),Object(ot.jsx)(ou,{label:v.get("Language"),value:v.languages[a.locale],onClick:function(e){h(e.currentTarget)}}),Object(ot.jsx)(ou,{label:v.get("Time interval of the player"),children:Object(ot.jsx)(co.a,{variant:"standard",select:!0,className:S.textField,value:a.timeAnimationInterval,onChange:function(e){o({timeAnimationInterval:parseInt(e.target.value)})},margin:"normal",children:Dt.map((function(e,t){return Object(ot.jsx)(Pr.a,{value:e,children:e+" ms"},t)}))})})]}),Object(ot.jsxs)(ru,{title:v.get("Time-Series"),children:[Object(ot.jsx)(ou,{label:v.get("Show graph after adding a place"),value:mu(a.autoShowTimeSeries),children:Object(ot.jsx)(su,{propertyName:"autoShowTimeSeries",settings:a,updateSettings:o})}),Object(ot.jsx)(ou,{label:v.get("Show dots only, hide lines"),value:mu(a.showTimeSeriesPointsOnly),children:Object(ot.jsx)(su,{propertyName:"showTimeSeriesPointsOnly",settings:a,updateSettings:o})}),Object(ot.jsx)(ou,{label:v.get("Show error bars"),value:mu(a.showTimeSeriesErrorBars),children:Object(ot.jsx)(su,{propertyName:"showTimeSeriesErrorBars",settings:a,updateSettings:o})}),Object(ot.jsx)(ou,{label:v.get("Show median instead of mean (disables error bars)"),value:mu(a.showTimeSeriesMedian),children:Object(ot.jsx)(su,{propertyName:"showTimeSeriesMedian",settings:a,updateSettings:o})}),Object(ot.jsx)(ou,{label:v.get("Minimal number of data points in a time series update"),children:Object(ot.jsx)(co.a,{variant:"standard",className:S.intTextField,value:y,onChange:function(e){w(e.target.value)},margin:"normal",size:"small"})})]}),Object(ot.jsxs)(ru,{title:v.get("Map"),children:[Object(ot.jsx)(ou,{label:v.get("Base map"),value:k,onClick:function(e){j(e.currentTarget)}}),Object(ot.jsx)(ou,{label:v.get("Projection"),children:Object(ot.jsx)(uu,{propertyName:"mapProjection",settings:a,updateSettings:o,options:[[v.get("Geographic"),mt],[v.get("Mercator"),ht]]})}),Object(ot.jsx)(ou,{label:v.get("Image smoothing"),value:mu(a.imageSmoothingEnabled),children:Object(ot.jsx)(su,{propertyName:"imageSmoothingEnabled",settings:a,updateSettings:o})}),Object(ot.jsx)(ou,{label:v.get("Show dataset boundaries"),value:mu(a.showDatasetBoundaries),children:Object(ot.jsx)(su,{propertyName:"showDatasetBoundaries",settings:a,updateSettings:o})})]}),Object(ot.jsx)(ru,{title:v.get("Legal Agreement"),children:Object(ot.jsx)(Gr.a,{onClick:function(){o({privacyNoticeAccepted:!1}),window.location.reload()},children:v.get("Revoke consent")})}),Object(ot.jsxs)(ru,{title:v.get("System Information"),children:[Object(ot.jsx)(ou,{label:"xcube Viewer ".concat(v.get("version")),value:l}),Object(ot.jsx)(ou,{label:"xcube Server ".concat(v.get("version")),value:u?u.version:v.get("Cannot reach server")})]})]})]}),Object(ot.jsx)(kr.a,{anchorEl:m,keepMounted:!0,open:Boolean(m),onClose:function(){h(null)},children:T}),Object(ot.jsx)(kr.a,{anchorEl:g,keepMounted:!0,open:Boolean(g),onClose:function(){j(null)},children:C})]})},mu=function(e){return e?v.get("On"):v.get("Off")},hu={closeDialog:fr,updateSettings:vr,changeLocale:dr,openDialog:mr},fu=Object(o.b)((function(e){return{locale:e.controlState.locale,open:e.controlState.dialogOpen.settings,settings:e.controlState,selectedServer:Mn(e),viewerVersion:"1.0.1-dev.2",serverInfo:e.dataState.serverInfo}}),hu)(pu),bu=Object(li.a)((function(e){return{separatorTextField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),fontSize:e.typography.fontSize/2,maxWidth:"6em"},fileNameTextField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),fontSize:e.typography.fontSize/2}}})),vu=function(e){var t=e.open,n=e.closeDialog,a=e.settings,r=e.updateSettings,i=e.downloadTimeSeries,o=bu(),s=function(){n("export")};return Object(ot.jsx)("div",{children:Object(ot.jsxs)(Wr.a,{open:t,fullWidth:!0,maxWidth:"xs",onClose:s,scroll:"body",children:[Object(ot.jsx)(Kr.a,{children:Object(ot.jsxs)(ru,{title:v.get("Export Settings"),children:[Object(ot.jsx)(ou,{label:v.get("Include time-series data")+" (*.txt)",value:gu(a.exportTimeSeries),children:Object(ot.jsx)(su,{propertyName:"exportTimeSeries",settings:a,updateSettings:r})}),Object(ot.jsx)(ou,{label:v.get("Separator for time-series data"),children:Object(ot.jsx)(co.a,{variant:"standard",className:o.separatorTextField,value:a.exportTimeSeriesSeparator,onChange:function(e){r({exportTimeSeriesSeparator:e.target.value})},disabled:!a.exportTimeSeries,margin:"normal",size:"small"})}),Object(ot.jsx)(ou,{label:v.get("Include places data")+" (*.geojson)",value:gu(a.exportPlaces),children:Object(ot.jsx)(su,{propertyName:"exportPlaces",settings:a,updateSettings:r})}),Object(ot.jsx)(ou,{label:v.get("Combine place data in one file"),value:gu(a.exportPlacesAsCollection),children:Object(ot.jsx)(su,{propertyName:"exportPlacesAsCollection",settings:a,updateSettings:r,disabled:!a.exportPlaces})}),Object(ot.jsx)(ou,{label:v.get("As ZIP archive"),value:gu(a.exportZipArchive),children:Object(ot.jsx)(su,{propertyName:"exportZipArchive",settings:a,updateSettings:r})}),Object(ot.jsx)(ou,{label:v.get("File name"),children:Object(ot.jsx)(co.a,{variant:"standard",className:o.fileNameTextField,value:a.exportFileName,onChange:function(e){r({exportFileName:e.target.value})},margin:"normal",size:"small"})})]})}),Object(ot.jsx)(Hr.a,{children:Object(ot.jsx)(Gr.a,{onClick:function(){s(),i()},color:"primary",disabled:!ju(a),children:v.get("Download")})})]})})},gu=function(e){return e?v.get("On"):v.get("Off")},ju=function(e){return(e.exportTimeSeries||e.exportPlaces)&&(n=e.exportFileName,/^[0-9a-zA-Z_-]+$/.test(n))&&(!e.exportTimeSeries||("TAB"===(t=e.exportTimeSeriesSeparator).toUpperCase()||1===t.length));var t,n},Ou={closeDialog:fr,updateSettings:vr,downloadTimeSeries:function(){return function(e,t){var n=t().controlState,a=n.exportTimeSeries,r=n.exportTimeSeriesSeparator,i=n.exportPlaces,o=n.exportPlacesAsCollection,s=n.exportZipArchive,c=n.exportFileName,l=[];a?(l=[],Pt(t()).forEach((function(e){e.placeGroups&&(l=l.concat(e.placeGroups))})),l.push(_t(t()))):i&&(l=fn(t()));!function(e,t,n){var a,r,i=n.includeTimeSeries,o=n.separator,s=n.includePlaces,c=n.fileName,l=n.placesAsCollection,d=n.zip;"TAB"===(o=o||"TAB").toUpperCase()&&(o="\t");if(c=c||"export",!i&&!s)return;a=d?new Pa("".concat(c,".zip")):new Ea;if(i){var p=function(e,t){var n,a=new Set,r=new Set,i={},o=Object(u.a)(e);try{for(o.s();!(n=o.n()).done;){var s,c=n.value,l=Object(u.a)(c.timeSeriesArray);try{var d=function(){var e=s.value,t=e.source,n=t.placeId,o=t.datasetId,c=t.variableName,l=t.valueDataKey,u=t.errorDataKey;r.add(n);var d="".concat(o,".").concat(c,".").concat(l);a.add(d);var p=null;Boolean(u)&&(p="".concat(o,".").concat(c,".").concat(u),a.add(p)),e.data.forEach((function(e){var t=Xn(e.time),a=n+"-"+t,r=i[a];i[a]=r?Object(C.a)(Object(C.a)({},r),{},Object(Kn.a)({},d,e[l])):Object(Kn.a)({placeId:n,time:t},d,e[l]),null!==p&&(i[a][p]=e[u])}))};for(l.s();!(s=l.n()).done;)d()}catch(f){l.e(f)}finally{l.f()}}}catch(f){o.e(f)}finally{o.f()}var p=["placeId","time"].concat(Array.from(a).sort()),m=[];Object.keys(i).forEach((function(e){var t=i[e],n=new Array(p.length);p.forEach((function(e,a){n[a]=t[e]})),m.push(n)})),m.sort((function(e,t){var n=e[1],a=t[1],r=n.localeCompare(a);if(0!==r)return r;var i=e[0],o=t[0];return i.localeCompare(o)}));var h={};return r.forEach((function(e){h[e]=Ye(t,e)})),{colNames:p,dataRows:m,referencedPlaces:h}}(e,t),m=p.colNames,h=p.dataRows,f=p.referencedPlaces,b={number:!0,string:!0},v=m.join(o),g=h.map((function(e){return e.map((function(e){return b[typeof e]?e+"":""})).join(o)})),j=[v].concat(g).join("\n");a.write("".concat(c,".txt"),j),r=f}else r={},t.forEach((function(e){e.features&&e.features.forEach((function(e){r[e.id]=e}))}));if(s)if(l){var O={type:"FeatureCollection",features:Object.keys(r).map((function(e){return r[e]}))};a.write("".concat(c,".geojson"),JSON.stringify(O,null,2))}else Object.keys(r).forEach((function(e){a.write("".concat(e,".geojson"),JSON.stringify(r[e],null,2))}));a.close()}(t().dataState.timeSeriesGroups,l,{includeTimeSeries:a,includePlaces:i,separator:r,placesAsCollection:o,zip:s,fileName:c})}}},xu=Object(o.b)((function(e){return{locale:e.controlState.locale,open:Boolean(e.controlState.dialogOpen.export),settings:e.controlState}}),Ou)(vu),yu=n(581),wu=n.n(yu),Su=n(580),Tu=n.n(Su),Cu=function(e){var t=e.title,n=e.accept,r=e.multiple,i=e.disabled,o=e.onSelect,s=e.className,c=a.useRef(null);return Object(ot.jsxs)(ot.Fragment,{children:[Object(ot.jsx)("input",{type:"file",accept:n,multiple:r,ref:c,hidden:!0,onChange:function(e){if(null!==e.target.files&&e.target.files.length){for(var t=[],n=0;n<e.target.files.length;n++)t.push(e.target.files[n]);o(t)}},disabled:i}),Object(ot.jsx)(Gr.a,{onClick:function(){null!==c.current&&c.current.click()},disabled:i,className:s,variant:"outlined",size:"small",children:t})]})},ku=function(e){var t=e.options,n=e.updateOptions,a=e.className;return Object(ot.jsxs)("div",{className:a,children:[Object(ot.jsx)(co.a,{label:v.get("Label property names"),value:t.labelNames,onChange:function(e){n({labelNames:e.target.value})},size:"small",variant:"standard",style:{flexGrow:1,marginRight:10}}),Object(ot.jsx)(co.a,{label:v.get("Label prefix (used as fallback)"),value:t.labelPrefix,onChange:function(e){n({labelPrefix:e.target.value})},size:"small",variant:"standard",style:{flexGrow:1}})]})},Pu=function(e){var t=e.options,n=e.updateOptions,a=e.optionName,r=e.label;return Object(ot.jsx)(co.a,{label:v.get(r),value:t[a],onChange:function(e){return n(Object(Kn.a)({},a,e.target.value))},size:"small",variant:"standard"})},Eu=function(e){var t=e.options,n=e.updateOptions;e.className;return Object(ot.jsxs)("div",{children:[Object(ot.jsxs)("div",{style:{display:"grid",gap:12,paddingTop:12,gridTemplateColumns:"auto auto"},children:[Object(ot.jsx)(Pu,{optionName:"xName",label:"X/longitude column name",options:t,updateOptions:n}),Object(ot.jsx)(Pu,{optionName:"yName",label:"Y/latitude column name",options:t,updateOptions:n}),Object(ot.jsxs)("span",{children:[Object(ot.jsx)(zi.a,{checked:t.forceGeometry,onChange:function(e){return n({forceGeometry:e.target.checked})},size:"small"}),Object(ot.jsx)("span",{children:"Use geometry column"})]}),Object(ot.jsx)(Pu,{optionName:"geometryName",label:"Geometry column name",options:t,updateOptions:n}),Object(ot.jsx)(Pu,{optionName:"labelName",label:"Label column name",options:t,updateOptions:n}),Object(ot.jsx)(Pu,{optionName:"labelPrefix",label:"Label prefix (used as fallback)",options:t,updateOptions:n})]}),Object(ot.jsxs)("div",{style:{display:"grid",gap:12,paddingTop:12,gridTemplateColumns:"auto auto auto"},children:[Object(ot.jsx)(Pu,{optionName:"separator",label:"Separator character",options:t,updateOptions:n}),Object(ot.jsx)(Pu,{optionName:"comment",label:"Comment character",options:t,updateOptions:n}),Object(ot.jsx)(Pu,{optionName:"quote",label:"Quote character",options:t,updateOptions:n}),Object(ot.jsx)(Pu,{optionName:"escape",label:"Escape character",options:t,updateOptions:n}),Object(ot.jsx)("div",{}),Object(ot.jsxs)("span",{children:[Object(ot.jsx)(zi.a,{checked:t.trim,onChange:function(e){return n({trim:e.target.checked})},size:"small"}),Object(ot.jsx)("span",{children:"Remove whitespaces"})]}),Object(ot.jsx)(Pu,{optionName:"nanToken",label:"Not-a-number token",options:t,updateOptions:n}),Object(ot.jsx)(Pu,{optionName:"trueToken",label:"True token",options:t,updateOptions:n}),Object(ot.jsx)(Pu,{optionName:"falseToken",label:"False token",options:t,updateOptions:n})]})]})},_u=function(e){var t=e.options,n=e.updateOptions,a=e.className;return Object(ot.jsxs)("div",{className:a,children:[Object(ot.jsx)(co.a,{label:v.get("Label"),value:t.label,onChange:function(e){n({label:e.target.value})},size:"small",variant:"standard",style:{flexGrow:1,marginRight:10}}),Object(ot.jsx)(co.a,{label:v.get("Label prefix (used as fallback)"),value:t.labelPrefix,onChange:function(e){n({labelPrefix:e.target.value})},size:"small",variant:"standard",style:{flexGrow:1}})]})},Iu=["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"].map((function(e){return e.toLowerCase()}));function Nu(e){if(""===(e=e.trim()))return"csv";if("{"===e[0])return"geojson";var t=e.substr(0,20).toLowerCase();return Iu.find((function(e){return t.startsWith(e)&&(t.length===e.length||"\n\t (".indexOf(t[e.length])>=0)}))?"wkt":"csv"}var Mu={csv:Object(C.a)(Object(C.a)({},Z),{},{codeExt:[]}),geojson:Object(C.a)(Object(C.a)({},q),{},{codeExt:[Object(Jc.a)()]}),wkt:Object(C.a)(Object(C.a)({},J),{},{codeExt:[]})},Au=Object(li.a)((function(e){return{spacer:{flexGrow:1},actionBox:{paddingTop:e.spacing(.5),display:"flex",flexDirection:"row",alignItems:"center"},actionButton:{marginRight:e.spacing(1)},error:{fontSize:"small"}}})),Lu=function(e){var t=e.open,n=e.closeDialog,r=e.userPlacesFormatName,i=e.userPlacesFormatOptions,o=e.updateSettings,s=e.addUserPlacesFromText,c=e.nextMapInteraction,l=e.setMapInteraction,u=a.useState(""),d=Object(G.a)(u,2),p=d[0],m=d[1],h=a.useState(null),f=Object(G.a)(h,2),b=f[0],g=f[1],j=a.useState(!1),O=Object(G.a)(j,2),x=O[0],y=O[1],w=a.useState(!1),S=Object(G.a)(w,2),T=S[0],k=S[1],P=a.useState(r),E=Object(G.a)(P,2),_=E[0],I=E[1],N=a.useState(i),M=Object(G.a)(N,2),A=M[0],L=M[1],R=Au();if(a.useEffect((function(){I(r)}),[r]),a.useEffect((function(){L(i)}),[i]),!t)return null;var D,z=function(){l(c),n("addUserPlacesFromText")},B=function(){console.info("PASTE!",p)};return D="csv"===_?Object(ot.jsx)(Eu,{options:A.csv,updateOptions:function(e){L(Object(C.a)(Object(C.a)({},A),{},{csv:Object(C.a)(Object(C.a)({},A.csv),e)}))},className:R.actionBox}):"geojson"===_?Object(ot.jsx)(ku,{options:A.geojson,updateOptions:function(e){L(Object(C.a)(Object(C.a)({},A),{},{geojson:Object(C.a)(Object(C.a)({},A.geojson),e)}))},className:R.actionBox}):Object(ot.jsx)(_u,{options:A.wkt,updateOptions:function(e){L(Object(C.a)(Object(C.a)({},A),{},{wkt:Object(C.a)(Object(C.a)({},A.wkt),e)}))},className:R.actionBox}),Object(ot.jsxs)(Wr.a,{fullWidth:!0,open:t,onClose:z,"aria-labelledby":"server-dialog-title",children:[Object(ot.jsx)(Zr.a,{id:"server-dialog-title",children:v.get("Add Places")}),Object(ot.jsxs)(Kr.a,{dividers:!0,children:[Object(ot.jsxs)(lu.a,{row:!0,value:_,onChange:function(e){return function(e){I(e.target.value)}(e)},children:[Object(ot.jsx)(Mi.a,{value:"csv",label:v.get(Z.name),control:Object(ot.jsx)(cu.a,{})},"csv"),Object(ot.jsx)(Mi.a,{value:"geojson",label:v.get(q.name),control:Object(ot.jsx)(cu.a,{})},"geojson"),Object(ot.jsx)(Mi.a,{value:"wkt",label:v.get(J.name),control:Object(ot.jsx)(cu.a,{})},"wkt")]}),Object(ot.jsx)(Xc.a,{theme:_e.instance.branding.themeName||"light",placeholder:v.get("Enter text or drag & drop a text file."),autoFocus:!0,height:"400px",extensions:Mu[_].codeExt,value:p,onChange:function(e){var t=_;""===p&&e.length>10&&(t=Nu(e),I(t)),m(e),g(Mu[t].checkError(e))},onDrop:function(){m("")},onPaste:B,onPasteCapture:B}),b&&Object(ot.jsx)(Tr.a,{color:"error",className:R.error,children:b}),Object(ot.jsxs)("div",{className:R.actionBox,children:[Object(ot.jsx)(Cu,{title:v.get("From File")+"...",accept:Mu[_].fileExt,multiple:!1,onSelect:function(e){var t=e[0];y(!0);var n=new FileReader;n.onloadend=function(){var e=n.result;I(Nu(e)),m(e),y(!1)},n.onabort=n.onerror=function(){y(!1)},n.readAsText(t,"UTF-8")},disabled:x,className:R.actionButton}),Object(ot.jsx)(Gr.a,{onClick:function(){m("")},disabled:""===p.trim()||x,className:R.actionButton,variant:"outlined",size:"small",children:v.get("Clear")}),Object(ot.jsx)(wi.a,{className:R.spacer}),Object(ot.jsx)(Gr.a,{onClick:function(){return k(!T)},endIcon:T?Object(ot.jsx)(Tu.a,{}):Object(ot.jsx)(wu.a,{}),variant:"outlined",size:"small",children:v.get("Options")})]}),Object(ot.jsx)(Ic.a,{in:T,timeout:"auto",unmountOnExit:!0,children:D})]}),Object(ot.jsxs)(Hr.a,{children:[Object(ot.jsx)(Gr.a,{onClick:z,variant:"text",children:v.get("Cancel")}),Object(ot.jsx)(Gr.a,{onClick:function(){l("Select"),n("addUserPlacesFromText"),o({userPlacesFormatName:_,userPlacesFormatOptions:A}),s(p)},disabled:""===p.trim()||null!==b||x,color:"primary",variant:"text",children:v.get("OK")})]})]})},Ru={closeDialog:fr,updateSettings:vr,setMapInteraction:Ja,addUserPlacesFromText:ma},Du=Object(o.b)((function(e){return{open:!!e.controlState.dialogOpen.addUserPlacesFromText,userPlacesFormatName:e.controlState.userPlacesFormatName,userPlacesFormatOptions:e.controlState.userPlacesFormatOptions,nextMapInteraction:e.controlState.lastMapInteraction}}),Ru)(Lu),zu=Object(o.b)((function(e){return{compact:_e.instance.branding.compact}}),{})((function(e){var t=e.compact;return Object(ot.jsx)(Wl,{children:Object(ot.jsx)(Or.a,{injectFirst:!0,children:Object(ot.jsxs)(xr.a,{theme:Object(gr.a)(Object(jr.a)({typography:{fontSize:12,htmlFontSize:14},palette:{mode:_e.instance.branding.themeName,primary:_e.instance.branding.primaryColor,secondary:_e.instance.branding.secondaryColor}})),children:[Object(ot.jsx)(yr.a,{}),!t&&Object(ot.jsx)(vi,{}),Object(ot.jsx)(wl,{}),Object(ot.jsxs)(ot.Fragment,{children:[Object(ot.jsx)(Il,{}),Object(ot.jsx)(eu,{}),Object(ot.jsx)(fu,{}),Object(ot.jsx)(xu,{}),Object(ot.jsx)(Du,{}),Object(ot.jsx)(El,{}),Object(ot.jsx)(Ul,{})]})]})})})}));function Bu(){var e=function(){var e=Mt(_e.instance.name);if(e)try{return e.getObjectItem("userServers",[])}catch(t){console.warn("failed to load user servers: ".concat(t))}return[]}(),t=[Object(C.a)({},_e.instance.server)];return e.forEach((function(e){t.find((function(t){return t.id===e.id}))||t.push(e)})),{serverInfo:null,datasets:[],colorBars:null,timeSeriesGroups:[],userPlaceGroup:{id:"user",title:v.get("My places"),type:"FeatureCollection",features:[]},userServers:t}}function Fu(e,t){switch(void 0===e&&(e=Bu()),t.type){case na:return Object(C.a)(Object(C.a)({},e),{},{serverInfo:t.serverInfo});case oa:return Object(C.a)(Object(C.a)({},e),{},{datasets:t.datasets});case Ta:var n=t.datasetId,a=t.variableName,r=t.colorBarMinMax,i=t.colorBarName,o=t.opacity;return Gu(e,n,a,{colorBarMin:r[0],colorBarMax:r[1],colorBarName:i,opacity:o});case Ca:return Gu(e,t.datasetId,t.variableName,{volumeRenderMode:t.volumeRenderMode,volumeIsoThreshold:t.volumeIsoThreshold});case la:var s=t.placeGroup,c=e.datasets.map((function(e){if(e.placeGroups){var t=e.placeGroups.findIndex((function(e){return e.id===s.id}));if(t>=0){var n=Object(k.a)(e.placeGroups);return n[t]=s,Object(C.a)(Object(C.a)({},e),{},{placeGroups:n})}}return e}));return Object(C.a)(Object(C.a)({},e),{},{datasets:c});case da:var l=t.id,u=t.label,p=t.color,m={type:"Feature",id:l,geometry:t.geometry,properties:{label:u,color:p}},h=[].concat(Object(k.a)(e.userPlaceGroup.features),[m]),f=Object(C.a)(Object(C.a)({},e.userPlaceGroup),{},{features:h});return Object(C.a)(Object(C.a)({},e),{},{userPlaceGroup:f});case pa:var b=t.places,v=t.mapProjection;b.forEach((function(e){return function(e,t){if(Bt.userLayer){var n=Bt.userLayer,a=n.getSource(),r=(new d.a).readFeature(e,{dataProjection:"EPSG:4326",featureProjection:t});ds(r,(e.properties||{}).color||"red",_e.instance.branding.polygonFillOpacity),a.addFeature(r),n.changed()}}(e,v)}));var g=[].concat(Object(k.a)(e.userPlaceGroup.features),Object(k.a)(b)),j=Object(C.a)(Object(C.a)({},e.userPlaceGroup),{},{features:g});return Object(C.a)(Object(C.a)({},e),{},{userPlaceGroup:j});case ha:var O=t.id,x=e.userPlaceGroup.features.findIndex((function(e){return e.id===O}));if(x>=0){Vu([O]);var y=Object(k.a)(e.userPlaceGroup.features);y.splice(x,1);var w=Object(C.a)(Object(C.a)({},e.userPlaceGroup),{},{features:y}),S=Wu(e.timeSeriesGroups,[O]),T=e.timeSeriesGroups;return S.forEach((function(e){T=Uu(T,e,"remove","append")})),Object(C.a)(Object(C.a)({},e),{},{userPlaceGroup:w,timeSeriesGroups:T})}return e;case fa:var P=e.userPlaceGroup.features.map((function(e){return e.id}));Vu(P);var E=Object(C.a)(Object(C.a)({},e.userPlaceGroup),{},{features:[]}),_=Wu(e.timeSeriesGroups,P),I=e.timeSeriesGroups;return _.forEach((function(e){I=Uu(I,e,"remove","append")})),Object(C.a)(Object(C.a)({},e),{},{userPlaceGroup:E,timeSeriesGroups:I});case Sa:return Object(C.a)(Object(C.a)({},e),{},{colorBars:t.colorBars});case ga:var N=t.timeSeries,M=t.updateMode,A=t.dataMode,L=Uu(e.timeSeriesGroups,N,M,A);return L!==e.timeSeriesGroups?Object(C.a)(Object(C.a)({},e),{},{timeSeriesGroups:L}):e;case ja:var R=e.timeSeriesGroups.findIndex((function(e){return e.id===t.id}));if(R>=0){var D=Object(k.a)(e.timeSeriesGroups);return D.splice(R,1),Object(C.a)(Object(C.a)({},e),{},{timeSeriesGroups:D})}return e;case Oa:return Object(C.a)(Object(C.a)({},e),{},{timeSeriesGroups:[]});case xa:return e.userServers!==t.servers?(function(e){var t=Mt(_e.instance.name);if(t)try{t.setObjectItem("userServers",e)}catch(n){console.warn("failed to store user servers: ".concat(n))}}(t.servers),Object(C.a)(Object(C.a)({},e),{},{userServers:t.servers})):e}return e}function Vu(e){if(Bt.userLayer){var t=Bt.userLayer.getSource();e.forEach((function(e){var n=t.getFeatureById(e);n&&t.removeFeature(n)}))}}function Gu(e,t,n,a){var r=e.datasets.findIndex((function(e){return e.id===t}));if(r>=0){var i=e.datasets[r],o=i.variables.findIndex((function(e){return e.name===n}));if(o>=0){var s=i.variables[o],c=e.datasets.slice(),l=i.variables.slice();return l[o]=Object(C.a)(Object(C.a)({},s),a),c[r]=Object(C.a)(Object(C.a)({},i),{},{variables:l}),Object(C.a)(Object(C.a)({},e),{},{datasets:c})}}return e}function Uu(e,t,n,a){var r,i=t,o=e.findIndex((function(e){return e.variableUnits===i.source.variableUnits}));if(o>=0){var s,c=e[o],l=c.timeSeriesArray,u=l.findIndex((function(e){return e.source.datasetId===i.source.datasetId&&e.source.variableName===i.source.variableName&&e.source.placeId===i.source.placeId}));if(u>=0){var d=l[u];"append"===a&&(i=Object(C.a)(Object(C.a)({},i),{},{data:[].concat(Object(k.a)(i.data),Object(k.a)(d.data))})),"replace"===n?s=[i]:"add"===n?(s=l.slice())[u]=i:(s=l.slice()).splice(u,1)}else s="replace"===n?[i]:"add"===n?[i].concat(Object(k.a)(l)):l;"replace"===n?r=[Object(C.a)(Object(C.a)({},c),{},{timeSeriesArray:s})]:"add"===n||s.length>=0?(r=e.slice())[o]=Object(C.a)(Object(C.a)({},c),{},{timeSeriesArray:s}):(r=e.slice()).splice(o,1)}else{if("replace"===n)r=[{id:$(),variableUnits:i.source.variableUnits,timeSeriesArray:[i]}];else if("add"===n){r=[{id:$(),variableUnits:i.source.variableUnits,timeSeriesArray:[i]}].concat(Object(k.a)(e))}else r=e}return r}function Wu(e,t){var n=[];return e.forEach((function(e){e.timeSeriesArray.forEach((function(e){t.forEach((function(t){e.source.placeId===t&&n.push(e)}))}))})),n}function Hu(e,t,n){switch(void 0===e&&(e=zt()),t.type){case br:var a=Object(C.a)(Object(C.a)({},e),t.settings);return Rt(a),a;case oa:var r=e.selectedDatasetId||Ee.get("dataset"),i=e.selectedVariableName||Ee.get("variable"),o=e.mapInteraction,s=A(t.datasets,r),c=s&&L(s,i)||null;return s?c||(i=s.variables.length?s.variables[0].name:null):(r=null,i=null,(s=t.datasets.length?t.datasets[0]:null)&&(r=s.id,s.variables.length>0&&(i=s.variables[0].name))),r||(o="Select"),Object(C.a)(Object(C.a)({},e),{},{selectedDatasetId:r,selectedVariableName:i,mapInteraction:o});case _a:var l=e.selectedVariableName,u=A(t.datasets,t.selectedDatasetId);!L(u,l)&&u.variables.length>0&&(l=u.variables[0].name);var d=t.selectedDatasetId,p=D(u),m=p?p[1]:null;return Object(C.a)(Object(C.a)({},e),{},{selectedDatasetId:d,selectedVariableName:l,selectedTimeRange:p,selectedTime:m});case La:var h=Bt[t.mapId],f=t.location;if(h instanceof dt.a&&null!==f){var b,g=h,j=g.getView().getProjection();Array.isArray(f)?(b=Object(ss.n)(f,mt,j),g.getView().fit(b,{size:g.getSize()})):"Point"===(b=f.transform(mt,j)).getType()?g.getView().setCenter(b.getFirstCoordinate()):g.getView().fit(b,{size:g.getSize()})}return e.flyTo!==t.location?Object(C.a)(Object(C.a)({},e),{},{flyTo:t.location}):e;case Da:var O=t.selectedPlaceGroupIds;return Object(C.a)(Object(C.a)({},e),{},{selectedPlaceGroupIds:O,selectedPlaceId:null});case Ba:var x=t.selectedPlaceId;return Object(C.a)(Object(C.a)({},e),{},{selectedPlaceId:x});case Ga:return Object(C.a)(Object(C.a)({},e),{},{selectedVariableName:t.selectedVariableName});case Va:return Object(C.a)(Object(C.a)({},e),{},{showRgbLayer:t.showRgbLayer});case Ua:var y=t.selectedTime;if(null!==y&&n){var w=Pn(n),S=w?Ct(w,y):-1;S>=0&&(y=w[S])}return e.selectedTime!==y?Object(C.a)(Object(C.a)({},e),{},{selectedTime:y}):e;case Ha:if(n){var T=En(n);if(T>=0){var k=Pn(n);(T+=t.increment)<0&&(T=k.length-1),T>k.length-1&&(T=0);var P=k[T],E=e.selectedTimeRange;if(null!==E&&(P<E[0]&&(P=E[0]),P>E[1]&&(P=E[1])),e.selectedTime!==P)return Object(C.a)(Object(C.a)({},e),{},{selectedTime:P})}}return e;case Ka:return Object(C.a)(Object(C.a)({},e),{},{selectedTimeRange:t.selectedTimeRange});case Ya:return Object(C.a)(Object(C.a)({},e),{},{timeSeriesUpdateMode:t.timeSeriesUpdateMode});case qa:return Object(C.a)(Object(C.a)({},e),{},{timeAnimationActive:t.timeAnimationActive,timeAnimationInterval:t.timeAnimationInterval});case da:return t.selectPlace?Ku(e,t.id):e;case pa:return t.selectPlace&&t.places.length?Ku(e,t.places[0].id):e;case ha:var _=t.id,I=t.places;if(_===e.selectedPlaceId){var N=null,M=I.findIndex((function(e){return e.id===_}));return M>=0&&(M<I.length-1?N=I[M+1].id:M>0&&(N=I[M-1].id)),Object(C.a)(Object(C.a)({},e),{},{selectedPlaceId:N})}return e;case Xa:var R=Object(C.a)(Object(C.a)({},e),{},{mapInteraction:t.mapInteraction,lastMapInteraction:e.mapInteraction});return"Geometry"===t.mapInteraction&&(R=Object(C.a)(Object(C.a)({},R),{},{dialogOpen:Object(C.a)(Object(C.a)({},e.dialogOpen),{},{addUserPlacesFromText:!0})})),R;case Qa:return Rt(e=Object(C.a)(Object(C.a)({},e),{},{volumeCardOpen:t.volumeCardOpen})),e;case er:return Rt(e=Object(C.a)(Object(C.a)({},e),{},{volumeRenderMode:t.volumeRenderMode})),e;case tr:var z=t.volumeId,B=t.volumeState;return e=Object(C.a)(Object(C.a)({},e),{},{volumeStates:Object(C.a)(Object(C.a)({},e.volumeStates),{},Object(Kn.a)({},z,B))});case nr:return Rt(e=Object(C.a)(Object(C.a)({},e),{},{infoCardOpen:t.infoCardOpen})),e;case rr:var F=Object(C.a)({},e.infoCardElementStates);return Object.getOwnPropertyNames(F).forEach((function(e){F[e]=Object(C.a)(Object(C.a)({},F[e]),{},{visible:t.visibleElements.includes(e)})})),Rt(e=Object(C.a)(Object(C.a)({},e),{},{infoCardElementStates:F})),e;case ir:return Rt(e=Object(C.a)(Object(C.a)({},e),{},{infoCardElementStates:Object(C.a)(Object(C.a)({},e.infoCardElementStates),{},Object(Kn.a)({},t.elementType,Object(C.a)(Object(C.a)({},e.infoCardElementStates[t.elementType]),{},{viewMode:t.viewMode})))})),e;case or:return Object(C.a)(Object(C.a)({},e),{},{activities:Object(C.a)(Object(C.a)({},e.activities),{},Object(Kn.a)({},t.id,t.message))});case cr:var V=Object(C.a)({},e.activities);return delete V[t.id],Object(C.a)(Object(C.a)({},e),{},{activities:V});case ur:var G=t.locale;return v.locale=G,G!==e.locale&&Rt(e=Object(C.a)(Object(C.a)({},e),{},{locale:G})),e;case pr:var U=t.dialogId;return Object(C.a)(Object(C.a)({},e),{},{dialogOpen:Object(C.a)(Object(C.a)({},e.dialogOpen),{},Object(Kn.a)({},U,!0))});case hr:var W=t.dialogId;return Object(C.a)(Object(C.a)({},e),{},{dialogOpen:Object(C.a)(Object(C.a)({},e.dialogOpen),{},Object(Kn.a)({},W,!1))});case xa:if(e.selectedServerId!==t.selectedServerId)return Object(C.a)(Object(C.a)({},e),{},{selectedServerId:t.selectedServerId})}return e}function Ku(e,t){var n;return n=e.selectedPlaceGroupIds&&0!==e.selectedPlaceGroupIds.length?e.selectedPlaceGroupIds.find((function(e){return"user"===e}))?e.selectedPlaceGroupIds:[].concat(Object(k.a)(e.selectedPlaceGroupIds),["user"]):["user"],Object(C.a)(Object(C.a)({},e),{},{selectedPlaceGroupIds:n,selectedPlaceId:t})}var Zu=0;function Yu(e,t){void 0===e&&(e={newEntries:[],oldEntries:[]});var n=e.newEntries;switch(t.type){case Qn:var a=t.messageType,r=t.messageText,i=n.length?n[0]:null;return i&&a===i.type&&r===i.text?e:(i={id:++Zu,type:a,text:r},Object(C.a)(Object(C.a)({},e),{},{newEntries:[i].concat(Object(k.a)(n))}));case ea:var o=n.findIndex((function(e){return e.id===t.messageId}));if(o>=0){var s=n[o],c=Object(k.a)(n);c.splice(o,1);var l=[s].concat(Object(k.a)(e.oldEntries));return Object(C.a)(Object(C.a)({},e),{},{newEntries:c,oldEntries:l})}}return e}function qu(e,t){switch(void 0===e&&(e={accessToken:null}),t.type){case ii:return Object(C.a)(Object(C.a)({},e),{},{accessToken:t.accessToken})}return e}function Xu(e,t){return{dataState:Fu(e&&e.dataState,t),controlState:Hu(e&&e.controlState,t,e),messageLogState:Yu(e&&e.messageLogState,t),userAuthState:qu(e&&e.userAuthState,t)}}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));_e.load().then((function(){var e=c.createLogger({collapsed:!0,diff:!1}),t=s.b(Xu,s.a(l.a,e));t.dispatch(dr(t.getState().controlState.locale)),t.getState().controlState.privacyNoticeAccepted&&t.dispatch(wa()),i.render(Object(ot.jsx)(o.a,{store:t,children:Object(ot.jsx)(zu,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}))}},[[885,1,2]]]);
//# sourceMappingURL=main.55d14e77.chunk.js.map